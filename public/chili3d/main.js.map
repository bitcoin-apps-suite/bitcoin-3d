{"version":3,"file":"main.js","sources":["webpack://chili3d/./packages/chili-controls/src/converters/urlConverter.ts","webpack://chili3d/./packages/chili-controls/src/controls.ts","webpack://chili3d/./packages/chili-controls/src/collection.ts","webpack://chili3d/./packages/chili-controls/src/converters/colorConverter.ts","webpack://chili3d/./packages/chili-controls/src/converters/numberConverter.ts","webpack://chili3d/./packages/chili-controls/src/converters/stringConverter.ts","webpack://chili3d/./packages/chili-controls/src/converters/xyzConverter.ts","webpack://chili3d/./packages/chili-controls/src/expander/expander.ts","webpack://chili3d/./packages/chili-controls/src/radioGroup.ts","webpack://chili3d/./packages/chili-core/src/application.ts","webpack://chili3d/./packages/chili-core/src/foundation/asyncController.ts","webpack://chili3d/./packages/chili-core/src/foundation/binding.ts","webpack://chili3d/./packages/chili-core/src/foundation/collection.ts","webpack://chili3d/./packages/chili-core/src/foundation/history.ts","webpack://chili3d/./packages/chili-core/src/serialize/classMap.ts","webpack://chili3d/./packages/chili-core/src/serialize/serializer.ts","webpack://chili3d/./packages/chili-core/src/foundation/messageType.ts","webpack://chili3d/./packages/chili-core/src/foundation/precision.ts","webpack://chili3d/./packages/chili-core/src/command/decarator.ts","webpack://chili3d/./packages/chili-core/src/snapType.ts","webpack://chili3d/./packages/chili-core/src/shape/curve.ts","webpack://chili3d/./packages/chili-core/src/shape/geometry.ts","webpack://chili3d/./packages/chili-core/src/shape/lineType.ts","webpack://chili3d/./packages/chili-core/src/shape/meshData.ts","webpack://chili3d/./packages/chili-core/src/shape/shape.ts","webpack://chili3d/./packages/chili-core/src/shape/shapeType.ts","webpack://chili3d/./packages/chili-core/src/shape/surface.ts","webpack://chili3d/./packages/chili-core/src/navigation.ts","webpack://chili3d/./packages/chili-core/src/ui/button.ts","webpack://chili3d/./packages/chili-core/src/ui/dialog.ts","webpack://chili3d/./packages/chili-core/src/visual/view.ts","webpack://chili3d/./packages/chili-core/src/visual/visualShape.ts","webpack://chili3d/./packages/chili-core/src/foundation/logger.ts","webpack://chili3d/./packages/chili-core/src/foundation/transaction.ts","webpack://chili3d/./packages/chili-core/src/foundation/observer.ts","webpack://chili3d/./packages/chili-core/src/foundation/result.ts","webpack://chili3d/./packages/chili-core/src/foundation/deepObserver.ts","webpack://chili3d/./packages/chili-core/src/foundation/disposable.ts","webpack://chili3d/./packages/chili-core/src/foundation/gc.ts","webpack://chili3d/./packages/chili-core/src/foundation/id.ts","webpack://chili3d/./packages/chili-core/src/foundation/objectStorage.ts","webpack://chili3d/./packages/chili-core/src/foundation/pubsub.ts","webpack://chili3d/./packages/chili-core/src/foundation/utils/debounce.ts","webpack://chili3d/./packages/chili-core/src/foundation/utils/download.ts","webpack://chili3d/./packages/chili-core/src/foundation/utils/readFileAsync.ts","webpack://chili3d/./packages/chili-core/src/property.ts","webpack://chili3d/./packages/chili-core/src/command/command.ts","webpack://chili3d/./packages/chili-core/src/i18n/en.ts","webpack://chili3d/./packages/chili-core/src/i18n/zh-cn.ts","webpack://chili3d/./packages/chili-core/src/i18n/pt-br.ts","webpack://chili3d/./packages/chili-core/src/i18n/i18n.ts","webpack://chili3d/./packages/chili-core/src/config.ts","webpack://chili3d/./packages/chili-core/src/constants.ts","webpack://chili3d/./packages/chili-core/src/document.ts","webpack://chili3d/./packages/chili-core/src/math/mathUtils.ts","webpack://chili3d/./packages/chili-core/src/math/xyz.ts","webpack://chili3d/./packages/chili-core/src/math/boundingBox.ts","webpack://chili3d/./packages/chili-core/src/math/quaternion.ts","webpack://chili3d/./packages/chili-core/src/math/matrix4.ts","webpack://chili3d/./packages/chili-core/src/math/plane.ts","webpack://chili3d/./packages/chili-core/src/math/planeAngle.ts","webpack://chili3d/./packages/chili-core/src/math/ray.ts","webpack://chili3d/./packages/chili-core/src/math/xy.ts","webpack://chili3d/./packages/chili-core/src/material.ts","webpack://chili3d/./packages/chili-core/src/model/node.ts","webpack://chili3d/./packages/chili-core/src/model/visualNode.ts","webpack://chili3d/./packages/chili-core/src/model/meshNode.ts","webpack://chili3d/./packages/chili-core/src/model/geometryNode.ts","webpack://chili3d/./packages/chili-core/src/model/shapeNode.ts","webpack://chili3d/./packages/chili-core/src/model/component.ts","webpack://chili3d/./packages/chili-core/src/model/facebaseNode.ts","webpack://chili3d/./packages/chili-core/src/model/folderNode.ts","webpack://chili3d/./packages/chili-core/src/model/groupNode.ts","webpack://chili3d/./packages/chili-core/src/selectionFilter.ts","webpack://chili3d/./packages/chili-core/src/ui/combobox.ts","webpack://chili3d/./packages/chili-core/src/visual/act.ts","webpack://chili3d/./packages/chili-core/src/visual/visualObject.ts","webpack://chili3d/./packages/chili-geo/src/mesh.ts","webpack://chili3d/./packages/chili-geo/src/utils.ts","webpack://chili3d/./packages/chili-vis/src/selectionEventHandler.ts","webpack://chili3d/./packages/chili-vis/src/nodeSelectionEventHandler.ts","webpack://chili3d/./packages/chili-vis/src/shapeSelectionEventHandler.ts","webpack://chili3d/./packages/chili-vis/src/viewUtils.ts","webpack://chili3d/./packages/chili/src/snap/dimension.ts","webpack://chili3d/./packages/chili/src/selection.ts","webpack://chili3d/./packages/chili/src/document.ts","webpack://chili3d/./packages/chili/src/utils.ts","webpack://chili3d/./packages/chili/src/application.ts","webpack://chili3d/./packages/chili/src/bodys/box.ts","webpack://chili3d/./packages/chili/src/bodys/circle.ts","webpack://chili3d/./packages/chili/src/bodys/cone.ts","webpack://chili3d/./packages/chili/src/bodys/cylinder.ts","webpack://chili3d/./packages/chili/src/bodys/ellipse.ts","webpack://chili3d/./packages/chili/src/bodys/line.ts","webpack://chili3d/./packages/chili/src/bodys/polygon.ts","webpack://chili3d/./packages/chili/src/bodys/prism.ts","webpack://chili3d/./packages/chili/src/bodys/pyramid.ts","webpack://chili3d/./packages/chili/src/bodys/rect.ts","webpack://chili3d/./packages/chili/src/bodys/revolve.ts","webpack://chili3d/./packages/chili/src/bodys/sphere.ts","webpack://chili3d/./packages/chili/src/bodys/sweep.ts","webpack://chili3d/./packages/chili/src/commands/application/newDocument.ts","webpack://chili3d/./packages/chili/src/commands/application/openDocument.ts","webpack://chili3d/./packages/chili/src/commands/application/performanceTest.ts","webpack://chili3d/./packages/chili/src/commands/application/saveDocument.ts","webpack://chili3d/./packages/chili/src/commands/application/toFile.ts","webpack://chili3d/./packages/chili/src/commands/application/toggleDynamicWorkplane.ts","webpack://chili3d/./packages/chili/src/commands/application/wechatGroup.ts","webpack://chili3d/./packages/chili/src/bodys/boolean.ts","webpack://chili3d/./packages/chili/src/snap/snaps/axisSnap.ts","webpack://chili3d/./packages/chili/src/snap/snaps/baseSnap.ts","webpack://chili3d/./packages/chili/src/snap/snaps/featurePointStrategy.ts","webpack://chili3d/./packages/chili/src/snap/snaps/objectSnap.ts","webpack://chili3d/./packages/chili/src/snap/snaps/planeSnap.ts","webpack://chili3d/./packages/chili/src/snap/snaps/pointOnCurveSnap.ts","webpack://chili3d/./packages/chili/src/snap/tracking/axis.ts","webpack://chili3d/./packages/chili/src/snap/tracking/trackingBase.ts","webpack://chili3d/./packages/chili/src/snap/tracking/axisTracking.ts","webpack://chili3d/./packages/chili/src/snap/tracking/objectTracking.ts","webpack://chili3d/./packages/chili/src/snap/tracking/trackingSnap.ts","webpack://chili3d/./packages/chili/src/snap/handlers/snapEventHandler.ts","webpack://chili3d/./packages/chili/src/snap/handlers/angleSnapEventHandler.ts","webpack://chili3d/./packages/chili/src/snap/handlers/lengthSnapEventHandler.ts","webpack://chili3d/./packages/chili/src/snap/handlers/pointSnapEventHandler.ts","webpack://chili3d/./packages/chili/src/step/step.ts","webpack://chili3d/./packages/chili/src/step/angleStep.ts","webpack://chili3d/./packages/chili/src/step/lengthStep.ts","webpack://chili3d/./packages/chili/src/step/pointStep.ts","webpack://chili3d/./packages/chili/src/step/selectStep.ts","webpack://chili3d/./packages/chili/src/commands/multistepCommand.ts","webpack://chili3d/./packages/chili/src/commands/boolean.ts","webpack://chili3d/./packages/chili/src/bodys/arc.ts","webpack://chili3d/./packages/chili/src/commands/createCommand.ts","webpack://chili3d/./packages/chili/src/commands/create/arc.ts","webpack://chili3d/./packages/chili/src/commands/create/bezier.ts","webpack://chili3d/./packages/chili/src/commands/create/rect.ts","webpack://chili3d/./packages/chili/src/commands/create/box.ts","webpack://chili3d/./packages/chili/src/commands/create/circle.ts","webpack://chili3d/./packages/chili/src/commands/create/cone.ts","webpack://chili3d/./packages/chili/src/bodys/face.ts","webpack://chili3d/./packages/chili/src/bodys/wire.ts","webpack://chili3d/./packages/chili/src/commands/create/converter.ts","webpack://chili3d/./packages/chili/src/commands/create/copySubShape.ts","webpack://chili3d/./packages/chili/src/commands/create/curveProjection.ts","webpack://chili3d/./packages/chili/src/commands/create/cylinder.ts","webpack://chili3d/./packages/chili/src/commands/create/ellipse.ts","webpack://chili3d/./packages/chili/src/commands/create/fuse.ts","webpack://chili3d/./packages/chili/src/commands/create/group.ts","webpack://chili3d/./packages/chili/src/commands/create/line.ts","webpack://chili3d/./packages/chili/src/commands/create/offset.ts","webpack://chili3d/./packages/chili/src/commands/create/polygon.ts","webpack://chili3d/./packages/chili/src/commands/create/prism.ts","webpack://chili3d/./packages/chili/src/commands/create/pyramid.ts","webpack://chili3d/./packages/chili/src/commands/create/revolve.ts","webpack://chili3d/./packages/chili/src/commands/create/section.ts","webpack://chili3d/./packages/chili/src/commands/create/sphere.ts","webpack://chili3d/./packages/chili/src/commands/create/sweep.ts","webpack://chili3d/./packages/chili/src/commands/create/thickSolid.ts","webpack://chili3d/./packages/chili/src/commands/createActCommand.ts","webpack://chili3d/./packages/chili/src/commands/delete.ts","webpack://chili3d/./packages/chili/src/commands/folder.ts","webpack://chili3d/./packages/chili/src/commands/importExport.ts","webpack://chili3d/./packages/chili/src/commands/measure/angle.ts","webpack://chili3d/./packages/chili/src/commands/measure/length.ts","webpack://chili3d/./packages/chili/src/commands/measure/select.ts","webpack://chili3d/./packages/chili/src/commands/modify/array.ts","webpack://chili3d/./packages/chili/src/commands/modify/break.ts","webpack://chili3d/./packages/chili/src/commands/modify/brush.ts","webpack://chili3d/./packages/chili/src/commands/modify/chamfer.ts","webpack://chili3d/./packages/chili/src/commands/modify/explode.ts","webpack://chili3d/./packages/chili/src/commands/modify/fillet.ts","webpack://chili3d/./packages/chili/src/commands/modify/transformedCommand.ts","webpack://chili3d/./packages/chili/src/commands/modify/mirror.ts","webpack://chili3d/./packages/chili/src/commands/modify/move.ts","webpack://chili3d/./packages/chili/src/commands/modify/removeFeature.ts","webpack://chili3d/./packages/chili/src/commands/modify/removeSubShapes.ts","webpack://chili3d/./packages/chili/src/commands/modify/rotate.ts","webpack://chili3d/./packages/chili/src/commands/modify/split.ts","webpack://chili3d/./packages/chili/src/commands/modify/trim.ts","webpack://chili3d/./packages/chili/src/commands/redo.ts","webpack://chili3d/./packages/chili/src/commands/undo.ts","webpack://chili3d/./packages/chili/src/commands/workingPlane.ts","webpack://chili3d/./packages/chili/src/editEventHandler.ts","webpack://chili3d/./packages/chili/src/services/commandService.ts","webpack://chili3d/./packages/chili/src/services/editorService.ts","webpack://chili3d/./packages/chili/src/services/hotkeyService.ts","webpack://chili3d/./packages/chili-builder/src/defaultDataExchange.ts","webpack://chili3d/./packages/chili-builder/src/appBuilder.ts","webpack://chili3d/./packages/chili-web/src/loading.ts","webpack://chili3d/./packages/chili-web/src/index.ts"],"sourcesContent":["// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IConverter, Result } from \"chili-core\";\n\nexport class UrlStringConverter implements IConverter<string> {\n    convert(value: string): Result<string> {\n        return Result.ok(`url('${value}')`);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Localize, PathBinding } from \"chili-core\";\nimport { Collection, CollectionProps } from \"./collection\";\nimport { HTMLProps } from \"./htmlProps\";\n\nexport function createControl<K extends keyof HTMLElementTagNameMap>(tag: K) {\n    return (\n        props?: HTMLProps<HTMLElementTagNameMap[K]> | string | Node,\n        ...children: (Node | string)[]\n    ): HTMLElementTagNameMap[K] => {\n        const e: HTMLElementTagNameMap[K] = document.createElement(tag);\n        if (props) {\n            if (typeof props === \"string\" || props instanceof Node) {\n                e.append(props);\n            } else {\n                setProperties(e, props);\n            }\n        }\n        children.forEach((c) => e.append(c));\n        return e;\n    };\n}\n\nexport function setProperties<T extends { [K: string]: any }>(left: T, prop: HTMLProps<T>) {\n    for (const key in prop) {\n        const value = prop[key];\n        if (value instanceof Localize && (key === \"textContent\" || key === \"title\")) {\n            value.set(left, key);\n        } else if (value instanceof PathBinding) {\n            value.setBinding(left, key);\n        } else if (typeof value === \"object\" && typeof left[key] === \"object\") {\n            setProperties(left[key], value);\n        } else {\n            (left as any)[key] = value;\n        }\n    }\n}\n\nexport const div = createControl(\"div\");\nexport const span = createControl(\"span\");\nexport const input = createControl(\"input\");\nexport const button = createControl(\"button\");\nexport const label = createControl(\"label\");\nexport const textarea = createControl(\"textarea\");\nexport const select = createControl(\"select\");\nexport const option = createControl(\"option\");\nexport const a = createControl(\"a\");\nexport const h1 = createControl(\"h1\");\nexport const h2 = createControl(\"h2\");\nexport const h3 = createControl(\"h3\");\nexport const p = createControl(\"p\");\nexport const ul = createControl(\"ul\");\nexport const li = createControl(\"li\");\nexport const img = createControl(\"img\");\nexport const dialog = createControl(\"dialog\");\nexport const canvas = createControl(\"canvas\");\nexport const sup = createControl(\"sup\");\nexport const form = createControl(\"form\");\nexport const br = createControl(\"br\");\n\nexport function svg(props: HTMLProps<HTMLElement> & { icon: string }) {\n    const ns = \"http://www.w3.org/2000/svg\";\n    const child = document.createElementNS(ns, \"use\");\n    child.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\", `#${props.icon}`);\n    const svg = document.createElementNS(ns, \"svg\");\n    svg.append(child);\n    const className = String(props.className);\n    delete props.className;\n    setProperties(svg, props);\n    svg.classList.add(className);\n    if (props.title) {\n        addTitle(props, svg);\n    }\n    return svg;\n}\n\nexport function setSVGIcon(svg: SVGSVGElement, newIcon: string) {\n    const child = svg.firstChild as SVGUseElement;\n    child?.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\", `#${newIcon}`);\n}\n\nfunction addTitle(props: HTMLProps<HTMLElement> & { icon: string }, svg: SVGSVGElement) {\n    const title = document.createElementNS(\"http://www.w3.org/2000/svg\", \"title\");\n    if (props.title instanceof Localize) {\n        props.title.set(title as any, \"textContent\");\n    } else if (typeof props.title === \"string\") {\n        title.textContent = props.title;\n    } else {\n        props.title?.setBinding(title, \"textContent\");\n    }\n\n    svg.appendChild(title);\n}\n\nexport const collection = <T>(options: CollectionProps<T>) => new Collection(options);\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { CollectionAction, CollectionChangedArgs, ObservableCollection } from \"chili-core\";\nimport { setProperties } from \"./controls\";\nimport { HTMLProps } from \"./htmlProps\";\n\nexport type CollectionProps<T> = HTMLProps<Collection<T>> & {\n    sources: ObservableCollection<T> | Array<T>;\n    template: (item: T, index: number) => HTMLElement | SVGSVGElement;\n};\n\nexport class Collection<T> extends HTMLElement {\n    private readonly _itemMap = new Map<T, HTMLElement | SVGSVGElement>();\n    constructor(readonly props: CollectionProps<T>) {\n        super();\n        setProperties(this, props as any);\n    }\n\n    getItem(item: T): HTMLElement | SVGSVGElement | undefined {\n        return this._itemMap.get(item);\n    }\n\n    connectedCallback() {\n        const items = Array.isArray(this.props.sources) ? this.props.sources : this.props.sources.items;\n        this.append(...this._mapItems(items));\n        if (this.props.sources instanceof ObservableCollection)\n            this.props.sources.onCollectionChanged(this._onCollectionChanged);\n    }\n\n    disconnectedCallback() {\n        this._itemMap.forEach((x) => x.remove());\n        this._itemMap.clear();\n        if (this.props.sources instanceof ObservableCollection)\n            this.props.sources.removeCollectionChanged(this._onCollectionChanged);\n    }\n\n    private readonly _onCollectionChanged = (args: CollectionChangedArgs) => {\n        switch (args.action) {\n            case CollectionAction.add:\n                this.append(...this._mapItems(args.items));\n                break;\n            case CollectionAction.remove:\n                this._removeItem(args.items);\n                break;\n            case CollectionAction.move:\n                this._moveItem(args.from, args.to);\n                break;\n            case CollectionAction.replace:\n                this._replaceItem(args.index, args.item, args.items);\n                break;\n            default:\n                throw new Error(\"Unknown collection action\");\n        }\n    };\n\n    private _moveItem(from: number, to: number) {\n        const item1 = this.children.item(from);\n        const item2 = this.children.item(to);\n        if (item1 && item2) this.insertBefore(item1, item2);\n    }\n\n    private _replaceItem(index: number, item: T, items: T[]) {\n        const child = this._itemMap.get(item);\n        if (child) {\n            items.forEach((item, i) => {\n                const e = this.props.template(item, index + i);\n                this._itemMap.set(item, e);\n                this.insertBefore(e, child);\n            });\n            this._removeItem([item]);\n        }\n    }\n\n    private _mapItems(items: T[]) {\n        const index = this._itemMap.size;\n        return items.map((item, i) => {\n            if (this._itemMap.has(item)) return this._itemMap.get(item)!;\n            const e = this.props.template(item, index + i);\n            this._itemMap.set(item, e);\n            return e;\n        });\n    }\n\n    private _removeItem(items: T[]) {\n        items.forEach((item) => {\n            const child = this._itemMap.get(item);\n            if (child) {\n                child.remove();\n                this._itemMap.delete(item);\n            }\n        });\n    }\n}\n\ncustomElements.define(\"chili-collection\", Collection);\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IConverter, Result } from \"chili-core\";\n\nexport class ColorConverter implements IConverter<number | string> {\n    convert(value: number | string): Result<string> {\n        // Handle undefined, null, or invalid values\n        if (value === undefined || value === null) {\n            return Result.ok(\"#808080\"); // Default gray color\n        }\n\n        if (typeof value === \"string\") {\n            // If it's already a valid hex string, return it\n            if (value.startsWith(\"#\") && /^#[0-9A-Fa-f]{6}$/.test(value)) {\n                return Result.ok(value);\n            }\n            // If it's a hex string without #, add it\n            if (/^[0-9A-Fa-f]{6}$/.test(value)) {\n                return Result.ok(`#${value}`);\n            }\n            // If it's an empty string or invalid, use default\n            return Result.ok(\"#808080\");\n        }\n\n        if (typeof value === \"number\" && !isNaN(value)) {\n            return Result.ok(`#${value.toString(16).padStart(6, \"0\")}`);\n        }\n\n        // Fallback for any other invalid values\n        return Result.ok(\"#808080\");\n    }\n\n    convertBack(value: string): Result<number> {\n        const hexValue = value.startsWith(\"#\") ? value.substring(1) : value;\n        const result = parseInt(hexValue, 16);\n        return Number.isNaN(result) ? Result.err(`Invalid hex string: ${value}`) : Result.ok(result);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IConverter, Result } from \"chili-core\";\n\nexport class NumberConverter implements IConverter<number> {\n    convert(value: number): Result<string> {\n        return Number.isNaN(value) ? Result.err(\"Number is NaN\") : Result.ok(String(value));\n    }\n\n    convertBack(value: string): Result<number> {\n        const n = Number(value);\n        return Number.isNaN(n) ? Result.err(`${value} can not convert to number`) : Result.ok(n);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IConverter, Result } from \"chili-core\";\n\nexport class StringConverter implements IConverter<string> {\n    convert(value: string): Result<string> {\n        return Result.ok(value);\n    }\n    convertBack(value: string): Result<string> {\n        return Result.ok(value);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IConverter, Result, XY, XYZ } from \"chili-core\";\n\nexport class XYConverter implements IConverter<XY> {\n    convert(value: XY) {\n        return Result.ok(`${value.x},${value.y}`);\n    }\n\n    convertBack(value: string): Result<XY> {\n        const vs = value.split(\",\").map(Number).filter(isFinite);\n        return vs.length === 2\n            ? Result.ok(new XY(vs[0], vs[1]))\n            : Result.err(`${value} convert to XY error`);\n    }\n}\n\nexport class XYZConverter implements IConverter<XYZ> {\n    convert(value: XYZ) {\n        return Result.ok(`${value.x},${value.y},${value.z}`);\n    }\n\n    convertBack(value: string): Result<XYZ> {\n        const vs = value.split(\",\").map(Number).filter(isFinite);\n        return vs.length === 3\n            ? Result.ok(new XYZ(vs[0], vs[1], vs[2]))\n            : Result.err(`${value} convert to XYZ error`);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { I18nKeys, Localize } from \"chili-core\";\nimport style from \"./expander.module.css\";\nimport { div, label, setSVGIcon, svg } from \"../controls\";\n\nexport class Expander extends HTMLElement {\n    private _isExpanded = true;\n    private readonly expanderIcon: SVGSVGElement;\n    private readonly headerPanel = div({ className: style.headerPanel });\n    readonly contenxtPanel = div({ className: style.contextPanel });\n\n    constructor(header: I18nKeys) {\n        super();\n        this.className = style.rootPanel;\n        this.expanderIcon = svg({\n            icon: this.getExpanderIcon(),\n            className: style.expanderIcon,\n            onclick: this._handleExpanderClick,\n        });\n        const text = label({\n            textContent: new Localize(header),\n            className: style.headerText,\n        });\n        this.headerPanel.append(this.expanderIcon, text);\n        super.append(this.headerPanel, this.contenxtPanel);\n    }\n\n    override appendChild<T extends Node>(node: T): T {\n        return this.contenxtPanel.appendChild(node);\n    }\n\n    override append(...nodes: Node[]): void {\n        this.contenxtPanel.append(...nodes);\n    }\n\n    override removeChild<T extends Node>(child: T): T {\n        return this.contenxtPanel.removeChild(child);\n    }\n\n    addItem(...nodes: Node[]) {\n        this.append(...nodes);\n        return this;\n    }\n\n    private getExpanderIcon() {\n        return this._isExpanded ? \"icon-angle-down\" : \"icon-angle-right\";\n    }\n\n    private readonly _handleExpanderClick = (e: MouseEvent) => {\n        e.stopPropagation();\n        this._isExpanded = !this._isExpanded;\n        setSVGIcon(this.expanderIcon, this.getExpanderIcon());\n        this.contenxtPanel.classList.toggle(style.hidden, !this._isExpanded);\n    };\n}\n\ncustomElements.define(\"chili-expander\", Expander);\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { SelectableItems } from \"chili-core\";\nimport { div, input, label } from \"./controls\";\nimport style from \"./radioGroup.module.css\";\n\nexport class RadioGroup extends HTMLElement {\n    constructor(\n        readonly header: string,\n        readonly context: SelectableItems<any>,\n    ) {\n        super();\n        this.appendChild(this.render());\n    }\n\n    render() {\n        return div(\n            { className: style.radioGroup },\n            ...this.context.items.flatMap((x, i) => [\n                input({\n                    type: \"radio\",\n                    value: x,\n                    checked: this.context.selectedItems.has(x),\n                    id: `radio-${i}`,\n                }),\n                label({\n                    htmlFor: `radio-${i}`,\n                    textContent: x,\n                }),\n            ]),\n        );\n    }\n\n    connectedCallback() {\n        this.addEventListener(\"click\", this._onClick);\n    }\n\n    disconnectedCallback() {\n        this.removeEventListener(\"click\", this._onClick);\n    }\n\n    private readonly _onClick = (e: MouseEvent) => {\n        const target = e.target as HTMLInputElement;\n        if (target?.type === \"radio\") {\n            this.querySelectorAll(\"input\").forEach((x) => (x.checked = x === target));\n            this.context.selectedItems = new Set([target.value]);\n        }\n    };\n}\n\ncustomElements.define(\"chili-radios\", RadioGroup);\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { ICommand } from \"./command\";\nimport { IDataExchange } from \"./dataExchange\";\nimport { IDocument } from \"./document\";\nimport { IStorage, ObservableCollection } from \"./foundation\";\nimport { Serialized } from \"./serialize\";\nimport { IService } from \"./service\";\nimport { IShapeFactory } from \"./shape\";\nimport { IWindow } from \"./ui/window\";\nimport { IView, IVisualFactory } from \"./visual\";\n\nexport interface IApplication {\n    readonly mainWindow?: IWindow;\n    readonly dataExchange: IDataExchange;\n    readonly visualFactory: IVisualFactory;\n    readonly shapeFactory: IShapeFactory;\n    readonly services: IService[];\n    readonly storage: IStorage;\n    readonly views: ObservableCollection<IView>;\n    readonly documents: Set<IDocument>;\n    executingCommand: ICommand | undefined;\n    activeView: IView | undefined;\n    newDocument(name: string): Promise<IDocument>;\n    openDocument(id: string): Promise<IDocument | undefined>;\n    loadDocument(data: Serialized): Promise<IDocument | undefined>;\n}\n\nlet currentApplication: IApplication | undefined;\nexport function getCurrentApplication() {\n    return currentApplication;\n}\n\nexport function setCurrentApplication(app: IApplication): void {\n    currentApplication = app;\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IDisposable } from \"./disposable\";\n\nexport interface AsyncResult {\n    status: \"success\" | \"fail\" | \"cancel\";\n    message?: string;\n}\n\nexport class AsyncController implements IDisposable {\n    private readonly _failListeners = new Set<(state: AsyncResult) => void>();\n    private readonly _successListeners = new Set<(state: AsyncResult) => void>();\n    private _result: AsyncResult | undefined;\n\n    get result() {\n        return this._result;\n    }\n\n    readonly fail = (message?: string) => {\n        this.notifyListeners(this._failListeners, \"fail\", message);\n    };\n\n    readonly cancel = (message?: string) => {\n        this.notifyListeners(this._failListeners, \"cancel\", message);\n    };\n\n    readonly success = (message?: string) => {\n        this.notifyListeners(this._successListeners, \"success\", message);\n    };\n\n    private notifyListeners(\n        listeners: Set<(result: AsyncResult) => void>,\n        status: AsyncResult[\"status\"],\n        message?: string,\n    ) {\n        if (this._result === undefined) {\n            this._result = { status, message };\n            listeners.forEach((listener) => listener(this._result!));\n        }\n    }\n\n    onCancelled(listener: (result: AsyncResult) => void): void {\n        this._failListeners.add(listener);\n    }\n\n    onCompleted(listener: (result: AsyncResult) => void): void {\n        this._successListeners.add(listener);\n    }\n\n    dispose() {\n        this._failListeners.clear();\n        this._successListeners.clear();\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IConverter } from \"./converter\";\nimport { IPropertyChanged } from \"./observer\";\n\nconst registry = new FinalizationRegistry((binding: PathBinding<IPropertyChanged>) => {\n    binding.removeBinding();\n});\n\n/**\n * Bind the property chain as a path, separated by dots\n *\n * @example\n * ```ts\n * const binding = new PathBinding(source, \"a.b.c\");\n * binding.setBinding(element, \"property\");\n * ```\n */\nexport class PathBinding<T extends IPropertyChanged = IPropertyChanged> {\n    private _target?: { element: WeakRef<object>; property: PropertyKey };\n    private _oldPathObjects?: { source: IPropertyChanged; property: string }[];\n    private _actualSource?: { source: IPropertyChanged; property: string };\n\n    constructor(\n        readonly source: T,\n        readonly path: string,\n        public converter?: IConverter,\n    ) {}\n\n    setBinding<U extends object>(element: U, property: keyof U) {\n        if (this._target) throw new Error(\"Binding already set\");\n        this._target = { element: new WeakRef(element), property };\n        registry.register(element, this);\n        this.addPropertyChangedHandler();\n    }\n\n    removeBinding() {\n        const element = this._target?.element.deref();\n        if (element) registry.unregister(element);\n        this._target = undefined;\n        this.removePropertyChangedHandler();\n    }\n\n    private readonly handleAllPathPropertyChanged = (property: string, source: any) => {\n        if (this.shouldUpdateHandler(property, source)) {\n            this.removePropertyChangedHandler();\n            this.addPropertyChangedHandler();\n        }\n    };\n\n    private readonly handlePropertyChanged = (property: string, source: any) => {\n        if (this.path.endsWith(property) && this._target) {\n            this.setValue(source, property);\n        }\n    };\n\n    private shouldUpdateHandler(property: string, source: any) {\n        if (this._oldPathObjects === undefined) {\n            return true;\n        }\n\n        if (\n            this._oldPathObjects.some(\n                (element) => element.property === property && element.source === source,\n            )\n        ) {\n            return true;\n        }\n\n        if (!this._actualSource) {\n            return this.path.includes(property);\n        }\n\n        return false;\n    }\n\n    private addPropertyChangedHandler() {\n        const props = this.path.split(\".\");\n        let source: any = this.source;\n        this._oldPathObjects = [];\n        for (let i = 0; i < props.length; i++) {\n            if (!source || !(props[i] in source)) break;\n\n            const sourceProperty = { source, property: props[i] };\n            if (i === props.length - 1) {\n                this.setValue(source, props[i]);\n                this._actualSource = sourceProperty;\n                source.onPropertyChanged(this.handlePropertyChanged);\n                break;\n            }\n\n            source.onPropertyChanged(this.handleAllPathPropertyChanged);\n            this._oldPathObjects.push(sourceProperty);\n            source = source[props[i]];\n        }\n    }\n\n    private removePropertyChangedHandler() {\n        if (!this._oldPathObjects) return;\n        this._oldPathObjects.forEach((element) =>\n            element.source.removePropertyChanged(this.handleAllPathPropertyChanged),\n        );\n        this._actualSource?.source.removePropertyChanged(this.handlePropertyChanged);\n        this._actualSource = undefined;\n        this._oldPathObjects = undefined;\n    }\n\n    private setValue(source: any, property: string) {\n        if (!this._target) return;\n        const element = this._target.element.deref();\n        if (!element) return;\n\n        const value = source[property];\n        if (this.converter) {\n            const converted = this.converter.convert(value);\n            if (converted.isOk) (element as any)[this._target.property] = converted.value;\n        } else {\n            (element as any)[this._target.property] = value;\n        }\n    }\n\n    getPropertyValue() {\n        return this._actualSource\n            ? (this._actualSource.source as any)[this._actualSource.property]\n            : undefined;\n    }\n}\n\nexport class Binding<T extends IPropertyChanged = IPropertyChanged> extends PathBinding<T> {\n    constructor(source: T, path: keyof T, converter?: IConverter) {\n        super(source, path.toString(), converter);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IDisposable } from \"./disposable\";\n\nexport enum CollectionAction {\n    add,\n    remove,\n    move,\n    replace,\n}\n\nexport type CollectionChangedArgs =\n    | {\n          action: CollectionAction.add;\n          items: any[];\n      }\n    | {\n          action: CollectionAction.remove;\n          items: any[];\n      }\n    | {\n          action: CollectionAction.move;\n          from: number;\n          to: number;\n      }\n    | {\n          action: CollectionAction.replace;\n          index: number;\n          item: any;\n          items: any[];\n      };\n\nexport interface ICollectionChanged {\n    onCollectionChanged(callback: (args: CollectionChangedArgs) => void): void;\n    removeCollectionChanged(callback: (args: CollectionChangedArgs) => void): void;\n}\n\nexport class ObservableCollection<T> implements ICollectionChanged, IDisposable {\n    private readonly _callbacks = new Set<(args: CollectionChangedArgs) => void>();\n    private _items: T[];\n\n    constructor(...items: T[]) {\n        this._items = [...items];\n    }\n\n    push(...items: T[]) {\n        if (items.length === 0) return;\n        this._items.push(...items);\n        this.notifyChange({\n            action: CollectionAction.add,\n            items,\n        });\n    }\n\n    remove(...items: T[]) {\n        if (items.length === 0) return;\n        const itemSet = new Set(items);\n        this._items = this._items.filter((item) => !itemSet.has(item));\n        this.notifyChange({\n            action: CollectionAction.remove,\n            items,\n        });\n    }\n\n    move(from: number, to: number) {\n        if (!this.isValidMove(from, to)) return;\n\n        const items = this._items.splice(from, 1);\n        this._items.splice(from < to ? to - 1 : to, 0, ...items);\n        this.notifyChange({\n            action: CollectionAction.move,\n            from,\n            to,\n        });\n    }\n\n    private isValidMove(from: number, to: number): boolean {\n        return from !== to && from >= 0 && from < this._items.length && to >= 0 && to < this._items.length;\n    }\n\n    clear() {\n        if (this._items.length === 0) return;\n        const items = [...this._items];\n        this._items = [];\n        this.notifyChange({\n            action: CollectionAction.remove,\n            items,\n        });\n    }\n\n    get length() {\n        return this._items.length;\n    }\n\n    replace(index: number, ...items: T[]) {\n        if (!this.isValidIndex(index)) return;\n\n        const item = this._items[index];\n        this._items.splice(index, 1, ...items);\n        this.notifyChange({\n            action: CollectionAction.replace,\n            index,\n            item,\n            items,\n        });\n    }\n\n    private isValidIndex(index: number): boolean {\n        return index >= 0 && index < this._items.length;\n    }\n\n    private notifyChange(args: CollectionChangedArgs) {\n        this._callbacks.forEach((callback) => callback(args));\n    }\n\n    forEach(callback: (item: T, index: number) => void) {\n        this.items.forEach(callback);\n    }\n\n    map(callback: (item: T, index: number) => any) {\n        return this.items.map(callback);\n    }\n\n    get items() {\n        return [...this._items];\n    }\n\n    [Symbol.iterator]() {\n        return this.items[Symbol.iterator]();\n    }\n\n    item(index: number) {\n        return this._items[index];\n    }\n\n    at(index: number) {\n        return this._items.at(index);\n    }\n\n    filter(predicate: (value: T, index: number, array: T[]) => boolean) {\n        return this._items.filter(predicate);\n    }\n\n    find(predicate: (value: T, index: number, array: T[]) => boolean) {\n        return this._items.find(predicate);\n    }\n\n    indexOf(item: T, fromIndex?: number) {\n        return this._items.indexOf(item, fromIndex);\n    }\n\n    contains(item: T) {\n        return this._items.indexOf(item) !== -1;\n    }\n\n    get count() {\n        return this._items.length;\n    }\n\n    onCollectionChanged(callback: (args: CollectionChangedArgs) => void): void {\n        this._callbacks.add(callback);\n    }\n\n    removeCollectionChanged(callback: (args: CollectionChangedArgs) => void): void {\n        this._callbacks.delete(callback);\n    }\n\n    dispose() {\n        this._callbacks.clear();\n        this._items.length = 0;\n    }\n}\n\nexport enum SelectMode {\n    check,\n    radio,\n    combo,\n}\n\nexport class SelectableItems<T> {\n    readonly items: ReadonlyArray<T>;\n    selectedItems: Set<T>;\n\n    get selectedIndexes(): number[] {\n        let indexes: number[] = [];\n        this.selectedItems.forEach((x) => {\n            let index = this.items.indexOf(x);\n            if (index > -1) {\n                indexes.push(index);\n            }\n        });\n        return indexes;\n    }\n\n    firstSelectedItem() {\n        return this.selectedItems.values().next().value;\n    }\n\n    constructor(\n        items: T[],\n        readonly mode: SelectMode = SelectMode.radio,\n        selectedItems?: T[],\n    ) {\n        this.items = items;\n        this.selectedItems = new Set(selectedItems ?? []);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { INode, INodeLinkedList } from \"../model\";\nimport { IDisposable } from \"./disposable\";\n\nexport interface IHistoryRecord extends IDisposable {\n    readonly name: string;\n    undo(): void;\n    redo(): void;\n}\n\nexport class History implements IDisposable {\n    private readonly _undos: IHistoryRecord[] = [];\n    private readonly _redos: IHistoryRecord[] = [];\n\n    disabled = false;\n    undoLimits = 50;\n\n    dispose(): void {\n        this._redos.forEach((record) => record.dispose());\n        this._undos.forEach((record) => record.dispose());\n        this.clear();\n    }\n\n    private clear(): void {\n        this._undos.length = 0;\n        this._redos.length = 0;\n    }\n\n    add(record: IHistoryRecord) {\n        if (this.disabled) return;\n\n        this._redos.length = 0;\n        this._undos.push(record);\n\n        if (this._undos.length > this.undoLimits) {\n            const removed = this._undos.shift();\n            removed?.dispose();\n        }\n    }\n\n    undoCount() {\n        return this._undos.length;\n    }\n\n    redoCount() {\n        return this._redos.length;\n    }\n\n    undo() {\n        this.tryOperate(() => {\n            const record = this._undos.pop();\n            if (!record) return;\n\n            record.undo();\n            this._redos.push(record);\n        });\n    }\n\n    redo() {\n        this.tryOperate(() => {\n            const record = this._redos.pop();\n            if (!record) return;\n\n            record.redo();\n            this._undos.push(record);\n        });\n    }\n\n    private tryOperate(action: () => void) {\n        const previousState = this.disabled;\n        this.disabled = true;\n        try {\n            action();\n        } finally {\n            this.disabled = previousState;\n        }\n    }\n}\n\nexport class PropertyHistoryRecord implements IHistoryRecord {\n    readonly name: string;\n    constructor(\n        readonly object: any,\n        readonly property: string | symbol | number,\n        readonly oldValue: any,\n        readonly newValue: any,\n    ) {\n        this.name = `change ${String(property)} property`;\n    }\n\n    dispose(): void {}\n\n    undo(): void {\n        this.object[this.property] = this.oldValue;\n    }\n\n    redo(): void {\n        this.object[this.property] = this.newValue;\n    }\n}\n\nexport enum NodeAction {\n    add,\n    remove,\n    move,\n    transfer,\n    insertAfter,\n    insertBefore,\n}\n\nexport interface NodeRecord {\n    node: INode;\n    action: NodeAction;\n    oldParent?: INodeLinkedList;\n    oldPrevious?: INode;\n    newParent?: INodeLinkedList;\n    newPrevious?: INode;\n}\n\nexport interface INodeChangedObserver {\n    handleNodeChanged(records: NodeRecord[]): void;\n}\n\nexport class NodeLinkedListHistoryRecord implements IHistoryRecord {\n    readonly name: string;\n\n    constructor(readonly records: NodeRecord[]) {\n        this.name = \"change node\";\n    }\n\n    dispose(): void {\n        this.records.forEach((record) => {\n            if (record.action === NodeAction.remove) {\n                record.node.dispose();\n            }\n        });\n        this.records.length = 0;\n    }\n\n    private handleUndo(record: NodeRecord): void {\n        switch (record.action) {\n            case NodeAction.add:\n                record.newParent?.remove(record.node);\n                break;\n            case NodeAction.remove:\n                record.oldParent?.add(record.node);\n                break;\n            case NodeAction.transfer:\n                record.oldParent?.add(record.node);\n                break;\n            case NodeAction.move:\n                record.newParent?.move(record.node, record.oldParent!, record.oldPrevious);\n                break;\n            case NodeAction.insertAfter:\n                record.newParent?.remove(record.node);\n                break;\n            case NodeAction.insertBefore:\n                record.newParent?.remove(record.node);\n                break;\n        }\n    }\n\n    private handleRedo(record: NodeRecord): void {\n        switch (record.action) {\n            case NodeAction.add:\n                record.newParent?.add(record.node);\n                break;\n            case NodeAction.remove:\n                record.oldParent?.remove(record.node);\n                break;\n            case NodeAction.transfer:\n                record.oldParent?.transfer(record.node);\n                break;\n            case NodeAction.move:\n                record.oldParent?.move(record.node, record.newParent!, record.newPrevious);\n                break;\n            case NodeAction.insertAfter:\n                record.newParent?.insertAfter(record.newPrevious, record.node);\n                break;\n            case NodeAction.insertBefore:\n                record.newParent?.insertBefore(record.newPrevious?.nextSibling, record.node);\n                break;\n        }\n    }\n\n    undo(): void {\n        for (let i = this.records.length - 1; i >= 0; i--) {\n            this.handleUndo(this.records[i]);\n        }\n    }\n\n    redo(): void {\n        this.records.forEach((record) => this.handleRedo(record));\n    }\n}\n\nexport class ArrayRecord implements IHistoryRecord {\n    readonly records: Array<IHistoryRecord> = [];\n\n    constructor(readonly name: string) {}\n\n    dispose(): void {\n        this.records.forEach((r) => r.dispose());\n    }\n\n    undo() {\n        for (let index = this.records.length - 1; index >= 0; index--) {\n            this.records[index].undo();\n        }\n    }\n\n    redo() {\n        for (const record of this.records) {\n            record.redo();\n        }\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nconst classNameToClass = new Map<string, new (...args: any[]) => any>();\n\nexport namespace ClassMap {\n    export function save(className: string, ctor: new (...args: any[]) => any) {\n        if (classNameToClass.has(className)) throw new Error(`Class ${className} already registered`);\n        classNameToClass.set(className, ctor);\n    }\n\n    export function getClass(className: string): new (...args: any[]) => any {\n        const cls = classNameToClass.get(className);\n        if (cls) return cls;\n        throw new Error(`Type ${className} is not find, please add the @Serializer.register decorator.`);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IDocument } from \"../document\";\nimport { ClassMap } from \"./classMap\";\n\nexport interface ISerialize {\n    serialize(): Serialized;\n}\n\nexport type Serialized = {\n    classKey: string;\n    properties: SerializedProperties<any>;\n};\n\nexport type SerializedProperties<T> = {\n    [P in keyof T]?: any;\n};\n\ninterface RefelectData {\n    ctor: new (...args: any[]) => any;\n    ctorParamNames: string[];\n    serialize?: (target: any) => SerializedProperties<any>;\n    deserialize?: (...args: any[]) => any;\n}\n\nexport function serializeTypeArray(TypeArray: new (array: number[]) => Float32Array | Uint32Array): RefelectData {\n    return {\n        ctor: TypeArray,\n        ctorParamNames: [\"buffer\"],\n        serialize: (target: Float16Array | Uint32Array) => {\n            return {\n                buffer: Array.from(target),\n            };\n        },\n        deserialize: (buffer) => {\n            return new TypeArray(buffer);\n        },\n    }\n}\n\nconst propertiesMap = new Map<new (...args: any[]) => any, Set<string>>();\nconst reflectMap = new Map<string, RefelectData>();\nreflectMap.set(\"Float32Array\", serializeTypeArray(Float32Array));\nreflectMap.set(\"Uint32Array\", serializeTypeArray(Uint32Array));\n\nexport namespace Serializer {\n    export function serialze() {\n        return (target: any, property: string) => {\n            let keys = propertiesMap.get(target);\n            if (keys === undefined) {\n                keys = new Set();\n                propertiesMap.set(target, keys);\n            }\n            keys.add(property);\n        };\n    }\n\n    export function register<T>(\n        ctorParamNames: (keyof T & string)[],\n        deserialize?: (...args: any[]) => T,\n        serialize?: (target: T) => SerializedProperties<T>,\n    ) {\n        return (target: new (...args: any[]) => T) => {\n            ClassMap.save(target.name, target);\n            reflectMap.set(target.name, {\n                ctor: target,\n                ctorParamNames,\n                serialize,\n                deserialize,\n            });\n        };\n    }\n}\n\nexport namespace Serializer {\n    /**\n     * Deserialize an object\n     *\n     * @param document Document that contains the object.\n     * @param data Serialize the data. If the serialized data does not contain\n     * the parameters required by the deserialization function, these parameters\n     * should be added to the serialized data, for example:\n     * ```\n     * data.properties[“parent”] = node.\n     * ```\n     * @returns Deserialized object\n     */\n    export function deserializeObject(document: IDocument, data: Serialized) {\n        let instance = deserializeInstance(document, data.classKey, data.properties);\n        deserializeProperties(document, instance, data);\n        return instance;\n    }\n\n    function deserializeInstance(\n        document: IDocument,\n        className: string,\n        properties: SerializedProperties<any>,\n    ) {\n        if (!reflectMap.has(className)) {\n            throw new Error(\n                `${className} cannot be deserialize. Did you forget to add the decorator @Serializer.register?`,\n            );\n        }\n\n        const { ctor, ctorParamNames, deserialize } = reflectMap.get(className)!;\n        const parameters = deserilizeParameters(document, ctorParamNames, properties, className);\n        if (deserialize) {\n            return deserialize(...ctorParamNames.map((x) => parameters[x]));\n        }\n        return new ctor(...ctorParamNames.map((x) => parameters[x]));\n    }\n\n    function deserilizeParameters(\n        document: IDocument,\n        ctorParamNames: any[],\n        properties: SerializedProperties<any>,\n        className: string,\n    ) {\n        const parameters: SerializedProperties<any> = {};\n        parameters[\"document\"] = document;\n        for (const key of ctorParamNames) {\n            if (key in properties) {\n                if (properties[key] !== undefined)\n                    parameters[key] = deserialValue(document, properties[key]);\n            } else if (key !== \"document\") {\n                parameters[key] = undefined;\n                console.warn(`${className} constructor parameter ${key} is missing`);\n            }\n        }\n        return parameters;\n    }\n\n    function deserialValue(document: IDocument, value: any) {\n        if (value === undefined) {\n            return undefined;\n        }\n        if (Array.isArray(value)) {\n            return value.map((v) => {\n                return typeof v === \"object\" ? deserializeObject(document, v) : v;\n            });\n        }\n        return (value as Serialized).classKey ? deserializeObject(document, value) : value;\n    }\n\n    function deserializeProperties(\n        document: IDocument,\n        instance: any,\n        data: Serialized,\n        ignores?: string[],\n    ) {\n        let { ctorParamNames } = reflectMap.get(data.classKey)!;\n        const filter = (key: string) => {\n            return !ctorParamNames.includes(key) && !ignores?.includes(key);\n        };\n        let keys = Object.keys(data.properties).filter(filter);\n        for (const key of keys) {\n            instance[key] = deserialValue(document, data.properties[key]);\n        }\n    }\n}\n\nexport namespace Serializer {\n    export function serializeObject(target: Object) {\n        let classKey = target.constructor.name;\n        if (!reflectMap.has(classKey)) {\n            console.log(target);\n\n            throw new Error(\n                `Type ${target.constructor.name} is not registered, please add the @Serializer.register decorator.`,\n            );\n        }\n        let data = reflectMap.get(classKey)!;\n        let properties = data.serialize?.(target) ?? serializeProperties(target);\n        return {\n            classKey,\n            properties,\n        };\n    }\n\n    export function serializeProperties(target: Object) {\n        let data: SerializedProperties<any> = {};\n        let keys = getAllKeysOfPrototypeChain(target, propertiesMap);\n        for (const key of keys) {\n            let value = (target as any)[key];\n            if (Array.isArray(value)) {\n                data[key] = value.map((v) => serializePropertyValue(v));\n            } else {\n                data[key] = serializePropertyValue(value);\n            }\n        }\n        return data;\n    }\n\n    function serializePropertyValue(value: any) {\n        let type = typeof value;\n        if (type === \"object\") {\n            return serializeObject(value);\n        }\n        if (type !== \"function\" && type !== \"symbol\") {\n            return value;\n        }\n        throw new Error(`Unsupported serialized object: ${value}`);\n    }\n\n    function getAllKeysOfPrototypeChain(target: Object, map: Map<new (...args: any[]) => any, Set<string>>) {\n        let keys: string[] = [];\n        let prototype = Object.getPrototypeOf(target);\n        while (prototype !== null) {\n            let k = map.get(prototype);\n            if (k) keys.push(...k.values());\n            prototype = Object.getPrototypeOf(prototype); // prototype chain\n        }\n        return new Set(keys);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nexport enum MessageType {\n    info,\n    warn,\n    error,\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nexport namespace Precision {\n    export const Distance = 1e-7;\n    export const Angle = 1e-3;\n    export const Float = 1e-7;\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Binding } from \"../foundation\";\nimport { ICommand } from \"./command\";\nimport { CommandKeys } from \"./commandKeys\";\n\nconst commandRegistry = new Map<string, CommandConstructor>();\n\nexport type CommandConstructor = new (...args: any[]) => ICommand;\n\nexport interface CommandData {\n    key: CommandKeys;\n    icon: string;\n    toggle?: Binding;\n    helpText?: string;\n    helpUrl?: string;\n    isApplicationCommand?: boolean;\n}\n\nexport function command<T extends CommandConstructor>(metadata: CommandData) {\n    return (constructor: T) => {\n        commandRegistry.set(metadata.key, constructor);\n        constructor.prototype.data = metadata;\n    };\n}\n\nexport namespace Command {\n    export function getData(target: string | ICommand | CommandConstructor): CommandData | undefined {\n        if (typeof target === \"string\") {\n            const constructor = commandRegistry.get(target);\n            return constructor?.prototype.data;\n        }\n\n        const prototype = typeof target === \"function\" ? target.prototype : Object.getPrototypeOf(target);\n\n        return prototype.data;\n    }\n\n    export function get(name: CommandKeys): CommandConstructor | undefined {\n        return commandRegistry.get(name);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nexport enum ObjectSnapType {\n    none = 0,\n    endPoint = 1,\n    midPoint = 1 << 1,\n    center = 1 << 2,\n    angle = 1 << 3,\n    intersection = 1 << 4,\n    perpendicular = 1 << 5,\n    extension = 1 << 6,\n    parallel = 1 << 7,\n    special = 1 << 8,\n    nearest = 1 << 9,\n    vertex = 1 << 10,\n    grid = 1 << 11,\n}\n\nexport namespace ObjectSnapType {\n    export function has(snapTypes: ObjectSnapType, targetType: ObjectSnapType) {\n        return (snapTypes & targetType) === targetType;\n    }\n\n    export function add(snapTypes: ObjectSnapType, targetType: ObjectSnapType) {\n        return snapTypes | targetType;\n    }\n\n    export function remove(snapTypes: ObjectSnapType, targetType: ObjectSnapType) {\n        return snapTypes & ~targetType;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Ray, XYZ } from \"../math\";\nimport { IGeometry } from \"./geometry\";\nimport { IEdge } from \"./shape\";\n\nexport enum CurveType {\n    Line,\n    Circle,\n    Ellipse,\n    Hyperbola,\n    Parabola,\n    BezierCurve,\n    BSplineCurve,\n    OffsetCurve,\n    OtherCurve,\n    TrimmedCurve,\n}\n\nexport enum Continuity {\n    C0,\n    G1,\n    C1,\n    G2,\n    C2,\n    C3,\n    CN,\n}\n\nexport interface ICurve extends IGeometry {\n    get curveType(): CurveType;\n    uniformAbscissaByLength(length: number): XYZ[];\n    uniformAbscissaByCount(curveCount: number): XYZ[];\n    length(): number;\n    parameter(point: XYZ, tolerance: number): number | undefined;\n    firstParameter(): number;\n    lastParameter(): number;\n    project(point: XYZ): XYZ[];\n    value(parameter: number): XYZ;\n    isCN(n: number): boolean;\n    trim(u1: number, u2: number): ITrimmedCurve;\n    d0(u: number): XYZ;\n    d1(u: number): { point: XYZ; vec: XYZ };\n    d2(u: number): { point: XYZ; vec1: XYZ; vec2: XYZ };\n    d3(u: number): { point: XYZ; vec1: XYZ; vec2: XYZ; vec3: XYZ };\n    dn(u: number, n: number): XYZ;\n    reverse(): void;\n    reversed(): ICurve;\n    nearestFromPoint(point: XYZ): {\n        point: XYZ;\n        parameter: number;\n        distance: number;\n    };\n    nearestExtrema(curve: ICurve | Ray):\n        | undefined\n        | {\n              isParallel: boolean;\n              distance: number;\n              p1: XYZ;\n              p2: XYZ;\n              u1: number;\n              u2: number;\n          };\n    isClosed(): boolean;\n    period(): number;\n    isPeriodic(): boolean;\n    continutity(): Continuity;\n    makeEdge(): IEdge;\n}\n\nexport interface ILine extends ICurve {\n    direction: XYZ;\n}\n\nexport interface IConic extends ICurve {\n    axis: XYZ;\n    xAxis: XYZ;\n    yAxis: XYZ;\n    eccentricity(): number;\n}\n\nexport interface ICircle extends IConic {\n    center: XYZ;\n    radius: number;\n}\n\nexport interface IEllipse extends IConic {\n    center: XYZ;\n    get focus1(): XYZ;\n    get focus2(): XYZ;\n    majorRadius: number;\n    minorRadius: number;\n}\n\nexport interface IHyperbola extends IConic {\n    focal(): number;\n    location: XYZ;\n    get focus1(): XYZ;\n    get focus2(): XYZ;\n    majorRadius: number;\n    minorRadius: number;\n}\n\nexport interface IParabola extends IConic {\n    focal(): number;\n    get focus(): XYZ;\n    get directrix(): XYZ;\n}\n\nexport interface IBoundedCurve extends ICurve {\n    startPoint(): XYZ;\n    endPoint(): XYZ;\n}\n\nexport interface IBezierCurve extends IBoundedCurve {\n    degree(): number;\n    weight(index: number): number;\n    insertPoleAfter(index: number, point: XYZ, weight?: number): void;\n    insertPoleBefore(index: number, point: XYZ, weight?: number): void;\n    removePole(index: number): void;\n    setPole(index: number, point: XYZ, weight?: number): void;\n    setWeight(index: number, weight: number): void;\n    nbPoles(): number;\n    pole(index: number): XYZ;\n    poles(): XYZ[];\n}\n\nexport interface IBSplineCurve extends IBoundedCurve {\n    degree(): number;\n    nbKnots(): number;\n    knot(index: number): number;\n    setKnot(index: number, value: number): void;\n    nbPoles(): number;\n    pole(index: number): XYZ;\n    poles(): XYZ[];\n    weight(index: number): number;\n    setWeight(index: number, value: number): void;\n}\n\nexport interface ITrimmedCurve extends IBoundedCurve {\n    get basisCurve(): ICurve;\n    setTrim(u1: number, u2: number): void;\n}\n\nexport interface IOffsetCurve extends ICurve {\n    get basisCurve(): ICurve;\n    offset(): number;\n    direction(): XYZ;\n}\n\nexport interface IComplexCurve {\n    nbCurves(): number;\n    curve(index: number): ICurve;\n}\n\nexport namespace ICurve {\n    export function isConic(curve: ICurve): curve is IConic {\n        return (curve as IConic).axis !== undefined;\n    }\n\n    export function isCircle(curve: ICurve): curve is ICircle {\n        let circle = curve as ICircle;\n        return circle.center !== undefined && circle.radius !== undefined;\n    }\n\n    export function isLine(curve: ICurve): curve is ILine {\n        return (curve as ILine).direction !== undefined;\n    }\n\n    export function isTrimmed(curve: ICurve): curve is ITrimmedCurve {\n        return (curve as ITrimmedCurve).basisCurve !== undefined;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IDisposable } from \"../foundation\";\nimport { Matrix4 } from \"../math\";\n\nexport enum GeometryType {\n    Curve,\n    Surface,\n}\n\nexport interface IGeometry extends IDisposable {\n    get geometryType(): GeometryType;\n    transform(matrix: Matrix4): void;\n    transformed(matrix: Matrix4): IGeometry;\n    copy(): IGeometry;\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nexport enum LineType {\n    Solid,\n    Dash,\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { VisualConfig } from \"../config\";\nimport { Matrix4, XYZ } from \"../math\";\nimport { Serializer } from \"../serialize\";\nimport { LineType } from \"./lineType\";\nimport { ISubShape } from \"./shape\";\n\n@Serializer.register([\"start\", \"count\", \"materialIndex\"])\nexport class MeshGroup {\n    @Serializer.serialze()\n    start: number;\n    @Serializer.serialze()\n    count: number;\n    @Serializer.serialze()\n    materialIndex: number;\n\n    constructor(start: number, count: number, materialIndex: number) {\n        this.start = start;\n        this.count = count;\n        this.materialIndex = materialIndex;\n    }\n}\n\nexport type MeshType = \"surface\" | \"linesegments\";\n\n@Serializer.register([])\nexport class Mesh {\n    static createSurface(positionSize: number, indexSize: number) {\n        let mesh = new Mesh();\n        mesh.meshType = \"surface\";\n        mesh.normal = new Float32Array(positionSize * 3);\n        mesh.uv = new Float32Array(positionSize * 2);\n        mesh.position = new Float32Array(positionSize * 3);\n        mesh.index = new Uint32Array(indexSize);\n        return mesh;\n    }\n\n    static createLineSegments(size: number) {\n        let mesh = new Mesh();\n        mesh.meshType = \"linesegments\";\n        mesh.position = new Float32Array(size * 3);\n        return mesh;\n    }\n\n    @Serializer.serialze()\n    meshType: MeshType = \"linesegments\";\n\n    @Serializer.serialze()\n    position: Float32Array | undefined;\n\n    @Serializer.serialze()\n    normal: Float32Array | undefined = undefined;\n\n    @Serializer.serialze()\n    index: Uint32Array | undefined = undefined;\n\n    @Serializer.serialze()\n    color: number | number[] = 0xfff;\n\n    @Serializer.serialze()\n    uv: Float32Array | undefined = undefined;\n\n    @Serializer.serialze()\n    groups: MeshGroup[] = [];\n}\n\nexport interface IShapeMeshData {\n    edges: EdgeMeshData | undefined;\n    faces: FaceMeshData | undefined;\n}\n\nexport interface ShapeMeshRange {\n    start: number;\n    count: number;\n    shape: ISubShape;\n    transform?: Matrix4;\n}\n\nexport interface ShapeMeshData {\n    position: Float32Array;\n    range: ShapeMeshRange[];\n    color?: number | number[];\n}\n\nexport interface MeshLike {\n    position: Float32Array;\n    index: Uint32Array;\n    normal: Float32Array;\n    uv: Float32Array;\n    color?: number | number[];\n}\n\nexport namespace ShapeMeshData {\n    export function isVertex(data: ShapeMeshData): data is VertexMeshData {\n        return (data as VertexMeshData)?.size !== undefined;\n    }\n\n    export function isEdge(data: ShapeMeshData): data is EdgeMeshData {\n        return (data as EdgeMeshData)?.lineType !== undefined;\n    }\n\n    export function isFace(data: ShapeMeshData): data is FaceMeshData {\n        return (data as FaceMeshData)?.index !== undefined;\n    }\n}\n\nexport interface VertexMeshData extends ShapeMeshData {\n    size: number;\n}\n\nexport namespace VertexMeshData {\n    export function from(point: XYZ, size: number, color: number): VertexMeshData {\n        return {\n            position: new Float32Array([point.x, point.y, point.z]),\n            range: [],\n            color,\n            size,\n        };\n    }\n}\n\nexport interface EdgeMeshData extends ShapeMeshData {\n    lineType: LineType;\n    lineWidth?: number;\n}\n\nexport function concatTypedArrays<T extends Float32Array | Uint32Array>(arrays: T[]): T {\n    const totalLength = arrays.reduce((acc, arr) => acc + arr.length, 0);\n    const result = new (arrays[0].constructor as new (length: number) => T)(totalLength);\n    let offset = 0;\n    for (const arr of arrays) {\n        result.set(arr, offset);\n        offset += arr.length;\n    }\n    return result;\n}\n\nexport namespace EdgeMeshData {\n    export function from(start: XYZ, end: XYZ, color: number, lineType: LineType): EdgeMeshData {\n        return {\n            position: new Float32Array([start.x, start.y, start.z, end.x, end.y, end.z]),\n            color,\n            lineType,\n            range: [],\n        };\n    }\n\n    export function merge(data: EdgeMeshData, other: EdgeMeshData): EdgeMeshData {\n        const otherRange = other.range.map((range) => {\n            return {\n                start: range.start + data.position.length / 3,\n                count: range.count,\n                shape: range.shape,\n                transform: range.transform,\n            };\n        });\n        return {\n            position: concatTypedArrays([data.position, other.position]),\n            range: data.range.concat(otherRange),\n            color: data.color,\n            lineType: data.lineType,\n            lineWidth: data.lineWidth,\n        };\n    }\n}\n\nexport interface FaceMeshData extends ShapeMeshData {\n    index: Uint32Array;\n    normal: Float32Array;\n    uv: Float32Array;\n    groups: MeshGroup[];\n}\n\nexport namespace FaceMeshData {\n    export function merge(data: FaceMeshData, other: FaceMeshData): FaceMeshData {\n        const otherRange = other.range.map((range) => {\n            return {\n                start: range.start + data.position.length / 3,\n                count: range.count,\n                shape: range.shape,\n                transform: range.transform,\n            };\n        });\n        const groups = other.groups.map((group) => {\n            return {\n                start: group.start + data.index.length,\n                count: group.count,\n                materialIndex: group.materialIndex,\n            };\n        });\n        return {\n            position: concatTypedArrays([data.position, other.position]),\n            range: data.range.concat(otherRange),\n            index: concatTypedArrays([data.index, other.index]),\n            normal: concatTypedArrays([data.normal, other.normal]),\n            uv: concatTypedArrays([data.uv, other.uv]),\n            color: data.color,\n            groups,\n        };\n    }\n}\n\nexport abstract class MeshDataBuilder<T extends ShapeMeshData> {\n    protected readonly _positions: number[] = [];\n    protected readonly _groups: ShapeMeshRange[] = [];\n    protected _color: number | undefined;\n    protected _vertexColor: number[] | undefined;\n\n    setColor(color: number) {\n        this._color = color;\n    }\n\n    addColor(r: number, g: number, b: number) {\n        this._vertexColor ??= [];\n        this._vertexColor.push(r, g, b);\n        return this;\n    }\n\n    protected getColor() {\n        let color: number | number[] | undefined = this._vertexColor;\n        if (this._vertexColor?.length !== this._positions.length) {\n            color = this._color;\n        }\n        return color;\n    }\n\n    abstract newGroup(): this;\n\n    abstract endGroup(shape: ISubShape): this;\n\n    abstract addPosition(x: number, y: number, z: number): this;\n\n    abstract build(): T;\n}\n\n/**\n * LineSegments\n */\nexport class EdgeMeshDataBuilder extends MeshDataBuilder<EdgeMeshData> {\n    protected _positionStart: number = 0;\n    private _previousVertex: [number, number, number] | undefined = undefined;\n    private _lineType: LineType = LineType.Solid;\n\n    constructor() {\n        super();\n        this._color = VisualConfig.defaultEdgeColor;\n    }\n\n    setType(type: LineType) {\n        this._lineType = type;\n    }\n\n    override newGroup() {\n        this._positionStart = this._positions.length;\n        this._previousVertex = undefined;\n        return this;\n    }\n\n    override endGroup(shape: ISubShape) {\n        this._groups.push({\n            start: this._positionStart / 3,\n            count: (this._positions.length - this._positionStart) / 3,\n            shape,\n        });\n        return this;\n    }\n\n    override addPosition(x: number, y: number, z: number) {\n        if (this._previousVertex) {\n            this._positions.push(...this._previousVertex, x, y, z);\n        }\n        this._previousVertex = [x, y, z];\n        return this;\n    }\n\n    override build(): EdgeMeshData {\n        let color = this.getColor()!;\n        return {\n            position: new Float32Array(this._positions),\n            range: this._groups,\n            lineType: this._lineType,\n            color,\n        };\n    }\n}\n\nexport class FaceMeshDataBuilder extends MeshDataBuilder<FaceMeshData> {\n    private _indexStart: number = 0;\n    private _groupStart: number = 0;\n    private readonly _normals: number[] = [];\n    private readonly _uvs: number[] = [];\n    private readonly _indices: number[] = [];\n\n    constructor() {\n        super();\n        this._color = VisualConfig.defaultFaceColor;\n    }\n\n    override newGroup() {\n        this._groupStart = this._indices.length;\n        this._indexStart = this._positions.length / 3;\n        return this;\n    }\n\n    override endGroup(shape: ISubShape) {\n        this._groups.push({\n            start: this._groupStart,\n            count: this._indices.length - this._groupStart,\n            shape,\n        });\n        return this;\n    }\n\n    override addPosition(x: number, y: number, z: number) {\n        this._positions.push(x, y, z);\n        return this;\n    }\n\n    addNormal(x: number, y: number, z: number) {\n        this._normals.push(x, y, z);\n        return this;\n    }\n\n    addUV(u: number, v: number) {\n        this._uvs.push(u, v);\n        return this;\n    }\n\n    addIndices(i1: number, i2: number, i3: number) {\n        this._indices.push(this._indexStart + i1, this._indexStart + i2, this._indexStart + i3);\n        return this;\n    }\n\n    build(): FaceMeshData {\n        return {\n            position: new Float32Array(this._positions),\n            color: this.getColor()!,\n            normal: new Float32Array(this._normals),\n            index: new Uint32Array(this._indices),\n            uv: new Float32Array(this._uvs),\n            range: this._groups,\n            groups: [],\n        };\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IDisposable, Result } from \"../foundation\";\nimport { Matrix4, Plane, Ray, XYZ, XYZLike } from \"../math\";\nimport { ICurve, ITrimmedCurve } from \"./curve\";\nimport { EdgeMeshData, IShapeMeshData } from \"./meshData\";\nimport { ShapeType } from \"./shapeType\";\nimport { ISurface } from \"./surface\";\n\nexport enum Orientation {\n    FORWARD,\n    REVERSED,\n    INTERNAL,\n    EXTERNAL,\n}\n\nexport interface IShape extends IDisposable {\n    readonly shapeType: ShapeType;\n    get id(): string;\n    get mesh(): IShapeMeshData;\n    transformed(matrix: Matrix4): IShape;\n    transformedMul(matrix: Matrix4): IShape;\n    edgesMeshPosition(): EdgeMeshData;\n    matrix: Matrix4;\n    isClosed(): boolean;\n    isNull(): boolean;\n    /**\n     * they share the same TShape with the same Locations and Orientations.\n     */\n    isEqual(other: IShape): boolean;\n    /**\n     * they share the same TShape with the same Locations, Orientations may differ.\n     */\n    isSame(other: IShape): boolean;\n    /**\n     * they share the same TShape. Locations and Orientations may differ.\n     */\n    isPartner(other: IShape): boolean;\n    orientation(): Orientation;\n    findAncestor(ancestorType: ShapeType, fromShape: IShape): IShape[];\n    findSubShapes(subshapeType: ShapeType): IShape[];\n    iterShape(): IShape[];\n    section(shape: IShape | Plane): IShape;\n    split(shapes: IShape[]): IShape;\n    reserve(): void;\n    clone(): IShape;\n    hlr(position: XYZLike, direction: XYZLike, xDir: XYZLike): IShape;\n}\n\nexport interface ISubShape extends IShape {\n    index: number;\n    parent: IShape;\n}\n\nexport interface ISubEdgeShape extends ISubShape, IEdge {}\n\nexport interface ISubFaceShape extends ISubShape, IFace {}\n\nexport interface IVertex extends IShape {}\n\nexport interface IEdge extends IShape {\n    update(curve: ICurve): void;\n    intersect(other: IEdge | Ray): { parameter: number; point: XYZ }[];\n    length(): number;\n    get curve(): ITrimmedCurve;\n    offset(distance: number, dir: XYZ): Result<IEdge>;\n    trim(start: number, end: number): IEdge;\n}\n\nexport enum JoinType {\n    arc,\n    tangent,\n    intersection,\n}\n\nexport interface IWire extends IShape {\n    toFace(): Result<IFace>;\n    edgeLoop(): IEdge[];\n    offset(distance: number, joinType: JoinType): Result<IShape>;\n}\n\nexport interface IFace extends IShape {\n    area(): number;\n    normal(u: number, v: number): [point: XYZ, normal: XYZ];\n    outerWire(): IWire;\n    surface(): ISurface;\n    segmentsOfEdgeOnFace(edge: IEdge):\n        | undefined\n        | {\n              start: number;\n              end: number;\n          };\n}\n\nexport interface IShell extends IShape {}\n\nexport interface ISolid extends IShape {\n    volume(): number;\n}\n\nexport interface ICompound extends IShape {}\n\nexport interface ICompoundSolid extends IShape {}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nexport enum ShapeType {\n    Shape = 0b0,\n    Compound = 0b1,\n    CompoundSolid = 0b10,\n    Solid = 0b100,\n    Shell = 0b1000,\n    Face = 0b10000,\n    Wire = 0b100000,\n    Edge = 0b1000000,\n    Vertex = 0b10000000,\n}\n\nexport namespace ShapeType {\n    export function isWhole(type: ShapeType) {\n        return (\n            type === ShapeType.Shape ||\n            type === ShapeType.Compound ||\n            type === ShapeType.CompoundSolid ||\n            type === ShapeType.Solid\n        );\n    }\n\n    export function stringValue(type: ShapeType) {\n        switch (type) {\n            case ShapeType.Shape:\n                return \"Shape\";\n            case ShapeType.Compound:\n                return \"Compound\";\n            case ShapeType.CompoundSolid:\n                return \"CompoundSolid\";\n            case ShapeType.Solid:\n                return \"Solid\";\n            case ShapeType.Shell:\n                return \"Shell\";\n            case ShapeType.Face:\n                return \"Face\";\n            case ShapeType.Wire:\n                return \"Wire\";\n            case ShapeType.Edge:\n                return \"Edge\";\n            case ShapeType.Vertex:\n                return \"Vertex\";\n            default:\n                return \"Unknown\";\n        }\n    }\n\n    export function hasCompound(type: ShapeType): boolean {\n        return (type & ShapeType.Compound) !== 0;\n    }\n    export function hasCompoundSolid(type: ShapeType): boolean {\n        return (type & ShapeType.CompoundSolid) !== 0;\n    }\n    export function hasSolid(type: ShapeType): boolean {\n        return (type & ShapeType.Solid) !== 0;\n    }\n    export function hasShell(type: ShapeType): boolean {\n        return (type & ShapeType.Shell) !== 0;\n    }\n    export function hasFace(type: ShapeType): boolean {\n        return (type & ShapeType.Face) !== 0;\n    }\n    export function hasWire(type: ShapeType): boolean {\n        return (type & ShapeType.Wire) !== 0;\n    }\n    export function hasEdge(type: ShapeType): boolean {\n        return (type & ShapeType.Edge) !== 0;\n    }\n    export function hasVertex(type: ShapeType): boolean {\n        return (type & ShapeType.Vertex) !== 0;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Plane, XYZ } from \"../math\";\nimport { Continuity, ICurve } from \"./curve\";\nimport { IGeometry } from \"./geometry\";\n\nexport enum SurfaceType {\n    Plate,\n    Bezier,\n    BSpline,\n    RectangularTrimmed,\n    Conical,\n    Cylinder,\n    Plane,\n    Spherical,\n    Toroidal,\n    Revolution,\n    Extrusion,\n    Offset,\n    Composite,\n}\n\nexport interface ISurface extends IGeometry {\n    nearestPoint(point: XYZ): [XYZ, number] | undefined;\n    project(point: XYZ): XYZ[];\n    projectCurve(curve: ICurve): ICurve | undefined;\n    parameter(point: XYZ, maxDistance: number): { u: number; v: number } | undefined;\n    continuity(): Continuity;\n    uIso(u: number): ICurve;\n    vIso(v: number): ICurve;\n    isPlanar(): boolean;\n    isUClosed(): boolean;\n    isVClosed(): boolean;\n    isUPreiodic(): boolean;\n    isVPreiodic(): boolean;\n    vPeriod(): number;\n    uPeriod(): number;\n    bounds(): {\n        u1: number;\n        u2: number;\n        v1: number;\n        v2: number;\n    };\n    isCNu(n: number): boolean;\n    isCNv(n: number): boolean;\n    d0(u: number, v: number): XYZ;\n    d1(\n        u: number,\n        v: number,\n    ): {\n        point: XYZ;\n        d1u: XYZ;\n        d1v: XYZ;\n    };\n    d2(\n        u: number,\n        v: number,\n    ): {\n        point: XYZ;\n        d1u: XYZ;\n        d1v: XYZ;\n        d2u: XYZ;\n        d2v: XYZ;\n        d2uv: XYZ;\n    };\n    d3(\n        u: number,\n        v: number,\n    ): {\n        point: XYZ;\n        d1u: XYZ;\n        d1v: XYZ;\n        d2u: XYZ;\n        d2v: XYZ;\n        d2uv: XYZ;\n        d3u: XYZ;\n        d3v: XYZ;\n        d3uuv: XYZ;\n        d3uvv: XYZ;\n    };\n    dn(u: number, v: number, nu: number, nv: number): XYZ;\n    value(u: number, v: number): XYZ;\n}\n\nexport interface IPlateSurface extends ISurface {\n    setBounds(u1: number, u2: number, v1: number, v2: number): void;\n}\n\nexport interface IBoundedSurface extends ISurface {}\n\nexport interface IElementarySurface extends ISurface {\n    axis: XYZ;\n    coordinates: Plane;\n    location: XYZ;\n}\n\nexport interface IOffsetSurface extends ISurface {\n    offset: number;\n    basisSurface: ISurface;\n}\n\nexport interface ISweptSurface extends ISurface {\n    direction(): XYZ;\n    basisCurve(): ICurve;\n}\n\nexport interface ICompositeSurface extends ISurface {}\n\nexport interface IBSplineSurface extends IBoundedSurface {}\n\nexport interface IBezierSurface extends IBoundedSurface {}\n\nexport interface IRectangularTrimmedSurface extends IBoundedSurface {\n    basisSurface(): ISurface;\n    setUTrim(u1: number, u2: number): void;\n    setVTrim(v1: number, v2: number): void;\n    setTrim(u1: number, u2: number, v1: number, v2: number): void;\n}\n\nexport interface IConicalSurface extends IElementarySurface {\n    semiAngle: number;\n    setRadius(value: number): void;\n    apex(): XYZ;\n    refRadius(): number;\n}\n\nexport interface ICylindricalSurface extends IElementarySurface {\n    radius: number;\n}\n\nexport interface IPlaneSurface extends IElementarySurface {\n    plane: Plane;\n}\n\nexport interface ISphericalSurface extends IElementarySurface {\n    radius: number;\n    area(): number;\n    volume(): number;\n}\n\nexport interface IToroidalSurface extends IElementarySurface {\n    area(): number;\n    volume(): number;\n    majorRadius: number;\n    minorRadius: number;\n}\n\nexport interface ISurfaceOfLinearExtrusion extends ISweptSurface {}\n\nexport interface ISurfaceOfRevolution extends ISweptSurface {\n    location: XYZ;\n    referencePlane(): Plane;\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Config } from \"./config\";\n\nexport namespace Navigation3D {\n    export enum Nav3DType {\n        Chili3d = 0,\n        Revit,\n        Blender,\n        Creo,\n        Solidworks,\n    }\n    export const types: string[] = [Nav3DType[0], Nav3DType[1], Nav3DType[2], Nav3DType[3], Nav3DType[4]];\n\n    export function getKey(event: MouseEvent) {\n        let key = \"Middle\";\n        if (event.shiftKey) {\n            key = \"Shift+\" + key;\n        }\n        if (event.ctrlKey) {\n            key = \"Ctrl+\" + key;\n        }\n        if (event.altKey) {\n            key = \"Alt+\" + key;\n        }\n        return key;\n    }\n\n    export function navigationKeyMap(): {\n        pan: string;\n        rotate: string;\n    } {\n        const functionKey = {\n            [Nav3DType.Chili3d]: {\n                pan: \"Middle\",\n                rotate: \"Shift+Middle\",\n            },\n            [Nav3DType.Revit]: {\n                pan: \"Middle\",\n                rotate: \"Shift+Middle\",\n            },\n            [Nav3DType.Blender]: {\n                pan: \"Shift+Middle\",\n                rotate: \"Middle\",\n            },\n            [Nav3DType.Creo]: {\n                pan: \"Shift+Middle\",\n                rotate: \"Middle\",\n            },\n            [Nav3DType.Solidworks]: {\n                pan: \"Ctrl+Middle\",\n                rotate: \"Middle\",\n            },\n        };\n        return functionKey[Config.instance.navigation3DIndex as Nav3DType];\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { I18nKeys } from \"../i18n\";\n\nexport enum ButtonSize {\n    large,\n    small,\n}\n\nexport interface Button {\n    display: I18nKeys;\n    icon: string;\n    size: ButtonSize;\n    onClick: () => void;\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nexport enum DialogResult {\n    ok,\n    cancel,\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IDocument } from \"../document\";\nimport { IDisposable, IPropertyChanged } from \"../foundation\";\nimport { Plane, Ray, XY, XYLike, XYZ, XYZLike } from \"../math\";\nimport { INodeFilter, IShapeFilter } from \"../selectionFilter\";\nimport { ShapeType } from \"../shape\";\nimport { ICameraController } from \"./cameraController\";\nimport { VisualShapeData } from \"./detectedData\";\nimport { IVisualObject } from \"./visualObject\";\n\nexport enum ViewMode {\n    solid,\n    wireframe,\n    solidAndWireframe,\n}\n\nexport type HtmlTextOptions = {\n    hideDelete?: boolean;\n    center?: XYLike;\n    onDispose?: () => void;\n};\n\nexport interface IView extends IPropertyChanged, IDisposable {\n    readonly document: IDocument;\n    readonly cameraController: ICameraController;\n    get isClosed(): boolean;\n    get width(): number;\n    get height(): number;\n    get dom(): HTMLElement | undefined;\n    mode: ViewMode;\n    name: string;\n    workplane: Plane;\n    update(): void;\n    up(): XYZ;\n    toImage(): string;\n    direction(): XYZ;\n    rayAt(mx: number, my: number): Ray;\n    screenToWorld(mx: number, my: number): XYZ;\n    worldToScreen(point: XYZ): XY;\n    resize(width: number, heigth: number): void;\n    setDom(element: HTMLElement): void;\n    htmlText(text: string, point: XYZLike, options?: HtmlTextOptions): IDisposable;\n    close(): void;\n    detectVisual(x: number, y: number, nodeFilter?: INodeFilter): IVisualObject[];\n    detectVisualRect(\n        x1: number,\n        y1: number,\n        x2: number,\n        y2: number,\n        nodeFilter?: INodeFilter,\n    ): IVisualObject[];\n    detectShapes(shapeType: ShapeType, x: number, y: number, shapeFilter?: IShapeFilter, nodeFilter?: INodeFilter): VisualShapeData[];\n    detectShapesRect(\n        shapeType: ShapeType,\n        x1: number,\n        y1: number,\n        x2: number,\n        y2: number,\n        shapeFilter?: IShapeFilter,\n        nodeFilter?: INodeFilter,\n    ): VisualShapeData[];\n}\n\nexport namespace IView {\n    export function screenDistance(view: IView, mx: number, my: number, point: XYZ) {\n        let xy = view.worldToScreen(point);\n        let dx = xy.x - mx;\n        let dy = xy.y - my;\n        return Math.sqrt(dx * dx + dy * dy);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nexport enum VisualState {\n    normal = 0,\n    edgeHighlight = 1,\n    edgeSelected = 1 << 1,\n    faceTransparent = 1 << 2,\n    faceColored = 1 << 3,\n}\n\nexport namespace VisualState {\n    export function addState(origin: VisualState, add: VisualState) {\n        return origin | add;\n    }\n\n    export function removeState(origin: VisualState, remove: VisualState) {\n        return (origin & remove) ^ origin;\n    }\n\n    export function hasState(origin: VisualState, testState: VisualState) {\n        return (origin & testState) === testState;\n    }\n}\n\nexport interface VisualGroup {\n    start: number;\n    count: number;\n    materialIndex?: number;\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nexport class Logger {\n    static debug(message?: any, ...optionalParams: any[]) {\n        console.log(message, ...optionalParams);\n    }\n\n    static info(message?: any, ...optionalParams: any[]) {\n        console.log(message, ...optionalParams);\n    }\n\n    static warn(message?: any, ...optionalParams: any[]) {\n        console.warn(message, ...optionalParams);\n    }\n\n    static error(message?: any, ...optionalParams: any[]) {\n        console.error(message, ...optionalParams);\n    }\n}\n\n// facilitate debugging\nLogger.info = console.log;\nLogger.warn = console.warn;\nLogger.debug = console.log;\nLogger.error = console.error;\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IDocument } from \"../document\";\nimport { ArrayRecord, IHistoryRecord } from \"./history\";\nimport { Logger } from \"./logger\";\n\nexport class Transaction {\n    private static readonly _transactionMap: WeakMap<IDocument, ArrayRecord> = new WeakMap();\n\n    constructor(\n        readonly document: IDocument,\n        readonly name: string,\n    ) {}\n\n    static add(document: IDocument, record: IHistoryRecord) {\n        if (document.history.disabled) return;\n        let arrayRecord = Transaction._transactionMap.get(document);\n        if (arrayRecord !== undefined) {\n            arrayRecord.records.push(record);\n        } else {\n            Transaction.addToHistory(document, record);\n        }\n    }\n\n    static addToHistory(document: IDocument, record: IHistoryRecord) {\n        document.history.add(record);\n        Logger.info(`history added ${record.name}`);\n    }\n\n    static execute(document: IDocument, name: string, action: () => void) {\n        let trans = new Transaction(document, name);\n        trans.start();\n        try {\n            action();\n            trans.commit();\n        } catch (e) {\n            trans.rollback();\n            throw e;\n        }\n    }\n\n    static async executeAsync(document: IDocument, name: string, action: () => Promise<void>) {\n        const trans = new Transaction(document, name);\n        trans.start();\n        try {\n            await action();\n            trans.commit();\n        } catch (e) {\n            trans.rollback();\n            throw e;\n        }\n    }\n\n    start(name?: string) {\n        const transactionName = name ?? this.name;\n        if (Transaction._transactionMap.has(this.document)) {\n            throw new Error(`The document has started a transaction ${this.name}`);\n        }\n        Transaction._transactionMap.set(this.document, new ArrayRecord(transactionName));\n    }\n\n    commit() {\n        const arrayRecord = Transaction._transactionMap.get(this.document);\n        if (!arrayRecord) {\n            throw new Error(\"Transaction has not started\");\n        }\n        if (arrayRecord.records.length > 0) Transaction.addToHistory(this.document, arrayRecord);\n        Transaction._transactionMap.delete(this.document);\n    }\n\n    rollback() {\n        Transaction._transactionMap.get(this.document)?.undo();\n        Transaction._transactionMap.delete(this.document);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IDocument } from \"../document\";\nimport { IDisposable } from \"./disposable\";\nimport { IEqualityComparer } from \"./equalityComparer\";\nimport { PropertyHistoryRecord } from \"./history\";\nimport { Logger } from \"./logger\";\nimport { Transaction } from \"./transaction\";\n\nexport type PropertyChangedHandler<T, K extends keyof T> = (property: K, source: T, oldValue: T[K]) => void;\n\nexport interface IPropertyChanged extends IDisposable {\n    onPropertyChanged<K extends keyof this>(handler: PropertyChangedHandler<this, K>): void;\n    removePropertyChanged<K extends keyof this>(handler: PropertyChangedHandler<this, K>): void;\n    clearPropertyChanged(): void;\n}\n\nexport function isPropertyChanged(obj: object): obj is IPropertyChanged {\n    return (\n        obj &&\n        typeof (obj as IPropertyChanged).onPropertyChanged === \"function\" &&\n        typeof (obj as IPropertyChanged).removePropertyChanged === \"function\"\n    );\n}\n\nexport class Observable implements IPropertyChanged {\n    protected readonly propertyChangedHandlers = new Set<PropertyChangedHandler<any, any>>();\n    protected _isDisposed = false;\n\n    private getPrivateKey<K extends keyof this>(pubKey: K) {\n        return `_${String(pubKey)}`;\n    }\n\n    protected getPrivateValue<K extends keyof this>(pubKey: K, defaultValue?: this[K]): this[K] {\n        const privateKey = this.getPrivateKey(pubKey) as keyof this;\n        return privateKey in this\n            ? (this[privateKey] as this[K])\n            : this.initializeDefaultValue(pubKey, defaultValue);\n    }\n\n    private initializeDefaultValue<K extends keyof this>(pubKey: K, defaultValue?: this[K]): this[K] {\n        if (defaultValue === undefined) {\n            Logger.warn(\n                `${this.constructor.name}: The property \"${String(pubKey)}\" is not initialized, and no default value is provided`,\n            );\n            return undefined as this[K];\n        }\n\n        const privateKey = this.getPrivateKey(pubKey);\n        (this as any)[privateKey] = defaultValue;\n        return defaultValue;\n    }\n\n    protected setPrivateValue<K extends keyof this>(pubKey: K, newValue: this[K]): void {\n        (this as any)[this.getPrivateKey(pubKey)] = newValue;\n    }\n\n    /**\n     * Set the value of a private property, and if successful, execute emitPropertyChanged.\n     *\n     * Note: The private property name must be the public property name with the prefix _, i.e., age->_age(private property name).\n     */\n    protected setProperty<K extends keyof this>(\n        property: K,\n        newValue: this[K],\n        onPropertyChanged?: (property: K, oldValue: this[K]) => void,\n        equals?: IEqualityComparer<this[K]>,\n    ): boolean {\n        const oldValue = this[property];\n        if (this.isEuqals(oldValue, newValue, equals)) return false;\n\n        this.setPrivateValue(property, newValue);\n        onPropertyChanged?.(property, oldValue);\n        this.emitPropertyChanged(property, oldValue);\n        return true;\n    }\n\n    private isEuqals<K extends keyof this>(\n        oldValue: this[K],\n        newValue: this[K],\n        equals?: IEqualityComparer<this[K]>,\n    ): boolean {\n        return equals ? equals.equals(oldValue, newValue) : oldValue === newValue;\n    }\n\n    protected emitPropertyChanged<K extends keyof this>(property: K, oldValue: this[K]) {\n        Array.from(this.propertyChangedHandlers).forEach((cb) => cb(property, this, oldValue));\n    }\n\n    onPropertyChanged<K extends keyof this>(handler: PropertyChangedHandler<this, K>) {\n        this.propertyChangedHandlers.add(handler);\n    }\n\n    removePropertyChanged<K extends keyof this>(handler: PropertyChangedHandler<this, K>) {\n        this.propertyChangedHandlers.delete(handler);\n    }\n\n    clearPropertyChanged(): void {\n        this.propertyChangedHandlers.clear();\n    }\n\n    readonly dispose = () => {\n        if (this._isDisposed) return;\n        this._isDisposed = true;\n        this.disposeInternal();\n    };\n\n    protected disposeInternal() {\n        this.propertyChangedHandlers.clear();\n    }\n}\n\nexport abstract class HistoryObservable extends Observable {\n    private _document: IDocument;\n\n    get document(): IDocument {\n        return this._document;\n    }\n\n    constructor(document: IDocument) {\n        super();\n        this._document = document;\n    }\n\n    protected override setProperty<K extends keyof this>(\n        property: K,\n        newValue: this[K],\n        onPropertyChanged?: (property: K, oldValue: this[K]) => void,\n        equals?: IEqualityComparer<this[K]>,\n    ): boolean {\n        return super.setProperty(\n            property,\n            newValue,\n            (property, oldValue) => {\n                onPropertyChanged?.(property, oldValue);\n                Transaction.add(\n                    this.document,\n                    new PropertyHistoryRecord(this, property, oldValue, newValue),\n                );\n            },\n            equals,\n        );\n    }\n\n    override disposeInternal() {\n        super.disposeInternal();\n        this._document = null as any;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Serializer } from \"../serialize\";\nimport { IEqualityComparer } from \"./equalityComparer\";\nimport { Logger } from \"./logger\";\n\n@Serializer.register([\"isOk\", \"value\", \"error\"])\nexport class Result<T, E = string> {\n    readonly #isOk: boolean;\n    readonly #value: T | undefined;\n    readonly #error: E | undefined;\n\n    @Serializer.serialze()\n    get isOk(): boolean {\n        return this.#isOk;\n    }\n\n    @Serializer.serialze()\n    get value(): T {\n        if (!this.#isOk) Logger.warn(\"Result is error\");\n        return this.#value!;\n    }\n\n    @Serializer.serialze()\n    get error(): E {\n        if (this.#isOk) Logger.warn(\"Result is ok\");\n        return this.#error!;\n    }\n\n    constructor(isOk: boolean, value: T | undefined, error: E | undefined) {\n        this.#isOk = isOk;\n        this.#value = value;\n        this.#error = error;\n    }\n\n    parse<U>(): Result<U, E> {\n        return Result.err(this.#error as E);\n    }\n\n    isOkAnd(predict: (value: T) => boolean): boolean {\n        return this.#isOk && predict(this.#value!);\n    }\n\n    isErrorOr(predict: (value: T) => boolean): boolean {\n        return !this.#isOk || predict(this.#value!);\n    }\n\n    unchecked(): T | undefined {\n        return this.#value;\n    }\n\n    static ok<T>(value: T): Result<T, never> {\n        return new Result(true, value, undefined) as any;\n    }\n\n    static err<E>(error: E): Result<any, E> {\n        return new Result(false, undefined, error) as any;\n    }\n}\n\nexport class ResultEqualityComparer<T> implements IEqualityComparer<Result<T>> {\n    constructor(readonly equal?: (left: T, right: T) => boolean) {}\n\n    equals(left: Result<T>, right: Result<T>): boolean {\n        if (!left.isOk || !right.isOk) return false;\n        return this.equal ? this.equal(left.value, right.value) : left.value === right.value;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IPropertyChanged, isPropertyChanged } from \"./observer\";\nimport { Result } from \"./result\";\n\nexport type DeepPropertyChangedHandler = (path: string, source: IPropertyChanged, oldValue: any) => void;\n\nexport type SourceHandler = {\n    handler: DeepPropertyChangedHandler;\n    sources: {\n        source: IPropertyChanged;\n        prefix: string | undefined;\n    }[];\n};\n\nexport class DeepObserver {\n    private static readonly handlers = new Map<\n        IPropertyChanged,\n        Map<DeepPropertyChangedHandler, SourceHandler>\n    >();\n\n    static getPathValue(instance: IPropertyChanged, path: string): Result<any> {\n        const parts = path.split(\".\");\n\n        let value = instance;\n        for (let i = 0; i < parts.length; i++) {\n            value = (value as any)[parts[i]];\n            if (i < parts.length - 1 && !isPropertyChanged(value)) {\n                return Result.err(`Path ${path} is not valid`);\n            }\n        }\n\n        return Result.ok(value);\n    }\n\n    static addDeepPropertyChangedHandler(instance: IPropertyChanged, handler: DeepPropertyChangedHandler) {\n        const sourceHandler = DeepObserver.getOrInitHandler(instance, handler);\n        this.deepHandlePropertyChanged(sourceHandler, instance);\n    }\n\n    static deepHandlePropertyChanged(\n        sourceHandler: SourceHandler,\n        source: IPropertyChanged,\n        prefix?: string,\n    ) {\n        source.onPropertyChanged(sourceHandler.handler);\n        sourceHandler.sources.push({ source, prefix });\n\n        let keys = Object.keys(Object.getOwnPropertyDescriptors(Object.getPrototypeOf(source)));\n        for (const key of keys) {\n            if (key === \"constructor\" || key.startsWith(\"_\")) {\n                continue;\n            }\n            let subSource = (source as any)[key];\n            if (isPropertyChanged(subSource)) {\n                this.deepHandlePropertyChanged(sourceHandler, subSource, prefix ? `${prefix}.${key}` : key);\n            }\n        }\n    }\n\n    static removeDeepPropertyChangedHandler(\n        instance: IPropertyChanged,\n        handler: DeepPropertyChangedHandler,\n    ) {\n        let handlerMap = this.handlers.get(instance);\n        if (!handlerMap) {\n            return;\n        }\n\n        let sourceHandler = handlerMap.get(handler);\n        if (!sourceHandler) {\n            this.handlers.delete(instance);\n            return;\n        }\n\n        sourceHandler.sources.forEach((item) => {\n            item.source.removePropertyChanged(sourceHandler.handler);\n        });\n\n        handlerMap.delete(handler);\n        if (handlerMap.size === 0) {\n            this.handlers.delete(instance);\n        }\n    }\n\n    private static getOrInitHandler(instance: IPropertyChanged, deepHandler: DeepPropertyChangedHandler) {\n        let handlerMap = DeepObserver.handlers.get(instance);\n        if (!handlerMap) {\n            handlerMap = new Map();\n            DeepObserver.handlers.set(instance, handlerMap);\n        }\n\n        let sourceHandler = handlerMap.get(deepHandler);\n        if (sourceHandler) {\n            sourceHandler.sources.forEach((item) => {\n                item.source.removePropertyChanged(sourceHandler!.handler);\n            });\n        }\n\n        sourceHandler = this.initSourceHandler(instance, deepHandler);\n        handlerMap.set(deepHandler, sourceHandler);\n        return sourceHandler;\n    }\n\n    private static initSourceHandler(instance: IPropertyChanged, deepHandler: DeepPropertyChangedHandler) {\n        const handler = (property: string, target: IPropertyChanged, oldValue: any) => {\n            let sourceHandler = this.handlers.get(instance)?.get(deepHandler);\n            if (!sourceHandler) {\n                return;\n            }\n\n            let source = sourceHandler.sources.find((x) => x.source === target);\n            if (!source) {\n                return;\n            }\n\n            let prefix = source.prefix ? `${source.prefix}.${property}` : property;\n            this.updateHandlers(sourceHandler, target, property, prefix);\n\n            deepHandler(prefix, instance, oldValue);\n        };\n        return {\n            handler,\n            sources: [],\n        };\n    }\n\n    private static updateHandlers(\n        sourceHandler: SourceHandler,\n        target: IPropertyChanged,\n        property: string,\n        prefix: string | undefined,\n    ) {\n        const value = (target as any)[property];\n        if (value === undefined && prefix != undefined) {\n            const sources = [];\n            for (const source of sourceHandler.sources) {\n                if (source.prefix?.startsWith(prefix)) {\n                    source.source.removePropertyChanged(sourceHandler.handler);\n                } else {\n                    sources.push(source);\n                }\n            }\n            sourceHandler.sources = sources;\n            return;\n        }\n\n        if (isPropertyChanged(value)) {\n            this.deepHandlePropertyChanged(sourceHandler, value, prefix);\n        }\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nexport interface IDisposable {\n    dispose(): void;\n}\n\nexport namespace IDisposable {\n    export function isDisposable(value: unknown): value is IDisposable {\n        return (\n            value != null &&\n            typeof value === \"object\" &&\n            \"dispose\" in value &&\n            typeof (value as IDisposable).dispose === \"function\" &&\n            (value as IDisposable).dispose.length === 0\n        );\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IDisposable } from \"./disposable\";\n\nexport interface Deletable {\n    delete(): void;\n}\n\nexport namespace Deletable {\n    export function isDeletable(value: unknown): value is Deletable {\n        return typeof (value as any)?.delete === \"function\" && (value as any).delete.length === 0;\n    }\n}\n\nexport const gc = <R>(action: (collect: <T extends Deletable | IDisposable>(resource: T) => T) => R): R => {\n    const resources = new Set<Deletable | IDisposable>();\n\n    const collectResource = <T extends Deletable | IDisposable>(resource: T) => {\n        resources.add(resource);\n        return resource;\n    };\n\n    try {\n        return action(collectResource);\n    } finally {\n        for (const resource of resources) {\n            if (Deletable.isDeletable(resource)) {\n                resource.delete();\n            } else if (IDisposable.isDisposable(resource)) {\n                resource.dispose();\n            }\n        }\n        resources.clear();\n    }\n};\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\n// Copy from nanoid: https://github.com/ai/nanoid/blob/main/non-secure/index.js\n\n// This alphabet uses `A-Za-z0-9_-` symbols.\n// The order of characters is optimized for better gzip and brotli compression.\n// References to the same file (works both for gzip and brotli):\n// `'use`, `andom`, and `rict'`\n// References to the brotli default dictionary:\n// `-26T`, `1983`, `40px`, `75px`, `bush`, `jack`, `mind`, `very`, and `wolf`\nlet alphabet = \"useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict\";\n\nexport class Id {\n    static generate(size = 21) {\n        let id = \"\";\n        // A compact alternative for `for (var i = 0; i < step; i++)`.\n        let i = size;\n        while (i--) {\n            // `| 0` is more compact and faster than `Math.floor()`.\n            id += alphabet[(Math.random() * 64) | 0];\n        }\n        return id;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nexport class ObjectStorage {\n    static readonly default = new ObjectStorage(\"chili3d\", \"app\");\n\n    private readonly prefix: string;\n\n    constructor(organization: string, application: string) {\n        this.prefix = `${organization}.${application}.`;\n    }\n\n    setValue(key: string, value: object): void {\n        const storageKey = this.prefix + key;\n        try {\n            const stringValue = JSON.stringify(value);\n            localStorage.setItem(storageKey, stringValue);\n        } catch (error) {\n            console.error(`Failed to set setting ${key}:`, error);\n        }\n    }\n\n    value<T>(key: string, defaultValue?: T): T | undefined {\n        const storageKey = this.prefix + key;\n        const item = localStorage.getItem(storageKey);\n        if (!item) {\n            return defaultValue;\n        }\n\n        try {\n            return JSON.parse(item) as T;\n        } catch (error) {\n            console.error(`Failed to get setting ${key}:`, error);\n            return defaultValue;\n        }\n    }\n\n    remove(key: string): void {\n        const storageKey = this.prefix + key;\n        localStorage.removeItem(storageKey);\n    }\n\n    clear(): void {\n        Object.keys(localStorage).forEach((key) => {\n            if (key.startsWith(this.prefix)) {\n                localStorage.removeItem(key);\n            }\n        });\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { CommandKeys, ICommand } from \"../command\";\nimport { IDocument } from \"../document\";\nimport { I18nKeys } from \"../i18n\";\nimport { Material } from \"../material\";\nimport { INode } from \"../model\";\nimport { DialogResult } from \"../ui\";\nimport { CursorType, IView } from \"../visual\";\nimport { AsyncController } from \"./asyncController\";\nimport { IDisposable } from \"./disposable\";\nimport { MessageType } from \"./messageType\";\nimport { Result } from \"./result\";\n\nexport interface PubSubEventMap {\n    activeViewChanged: (view: IView | undefined) => void;\n    clearFloatTip: () => void;\n    clearInput: () => void;\n    clearSelectionControl: () => void;\n    clearStatusBarTip: () => void;\n    closeCommandContext: () => void;\n    displayError: (message: string) => void;\n    displayHome: (show: boolean) => void;\n    documentClosed: (document: IDocument) => void;\n    editMaterial: (document: IDocument, material: Material, callback: (material: Material) => void) => void;\n    executeCommand: (commandName: CommandKeys) => void;\n    modelUpdate: (model: INode) => void;\n    openCommandContext: (command: ICommand) => void;\n    parentVisibleChanged: (model: INode) => void;\n    selectionChanged: (document: IDocument, selected: INode[], unselected: INode[]) => void;\n    showDialog: (title: I18nKeys, content: HTMLElement, callback?: (result: DialogResult) => void) => void;\n    showFloatTip: (level: MessageType, msg: string) => void;\n    showInput: (text: string, handler: (text: string) => Result<string, I18nKeys>) => void;\n    showPermanent: (action: () => Promise<void>, message: I18nKeys, ...args: any[]) => void;\n    showProperties(document: IDocument, nodes: INode[]): void;\n    showSelectionControl: (controller: AsyncController) => void;\n    showToast: (message: I18nKeys, ...args: any[]) => void;\n    statusBarTip: (tip: I18nKeys) => void;\n    viewClosed: (view: IView) => void;\n    viewCursor: (cursor: CursorType) => void;\n    visibleChanged: (model: INode) => void;\n}\n\ntype EventCallback = (...args: any[]) => void;\ntype EventMap = Map<keyof PubSubEventMap, Set<EventCallback>>;\n\nexport class PubSub implements IDisposable {\n    static readonly default = new PubSub();\n    private readonly events: EventMap = new Map();\n\n    dispose(): void {\n        this.events.forEach((callbacks) => callbacks.clear());\n        this.events.clear();\n    }\n\n    sub<K extends keyof PubSubEventMap>(event: K, callback: PubSubEventMap[K]): void {\n        const callbacks = this.events.get(event) ?? new Set<EventCallback>();\n        callbacks.add(callback);\n        this.events.set(event, callbacks);\n    }\n\n    pub<K extends keyof PubSubEventMap>(event: K, ...args: Parameters<PubSubEventMap[K]>): void {\n        this.events.get(event)?.forEach((callback) => callback(...args));\n    }\n\n    remove<K extends keyof PubSubEventMap>(event: K, callback: PubSubEventMap[K]): void {\n        this.events.get(event)?.delete(callback);\n    }\n\n    removeAll<K extends keyof PubSubEventMap>(event: K): void {\n        this.events.get(event)?.clear();\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nexport const debounce = <F extends (...args: any[]) => void, P extends Parameters<F>>(\n    fun: F,\n    ms: number,\n) => {\n    let timeout: number | undefined;\n    return (...args: P) => {\n        if (timeout) {\n            clearTimeout(timeout);\n        }\n        timeout = window.setTimeout(() => {\n            fun(...args);\n            timeout = undefined;\n        }, ms);\n    };\n};\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nexport function download(data: BlobPart[], name: string) {\n    let blob = new Blob(data);\n    const url = URL.createObjectURL(blob);\n    try {\n        let a = document.createElement(\"a\");\n        a.style.visibility = \"hidden\";\n        a.href = url;\n        a.download = name;\n        a.click();\n    } finally {\n        URL.revokeObjectURL(url);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Result } from \"..\";\n\nconst isIOS =\n    /iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase()) ||\n    (navigator.maxTouchPoints > 0 && /(Macintosh)/.test(navigator.userAgent));\n\nexport async function readFilesAsync(accept: string, multiple: boolean): Promise<Result<FileList>> {\n    return new Promise((resolve) => {\n        const input = document.createElement(\"input\");\n        input.type = \"file\";\n        input.multiple = multiple;\n        if (!isIOS) {\n            input.accept = accept;\n        }\n        input.style.visibility = \"hidden\";\n\n        const cleanup = () => document.body.removeChild(input);\n\n        input.onchange = () => {\n            cleanup();\n            resolve(input.files ? Result.ok(input.files) : Result.err(\"no files selected\"));\n        };\n\n        input.oncancel = () => {\n            cleanup();\n            resolve(Result.err(\"cancel\"));\n        };\n\n        document.body.appendChild(input);\n        input.click();\n    });\n}\n\nexport interface FileData {\n    fileName: string;\n    data: string;\n}\n\nexport async function readFileAsync(\n    accept: string,\n    multiple: boolean,\n    method: \"readAsText\" | \"readAsDataURL\" = \"readAsText\",\n): Promise<Result<FileData[]>> {\n    const filesResult = await readFilesAsync(accept, multiple);\n    return filesResult.isOk ? readInputedFiles(filesResult.value, method) : filesResult.parse();\n}\n\nasync function readInputedFiles(\n    files: FileList,\n    method: \"readAsText\" | \"readAsDataURL\",\n): Promise<Result<FileData[]>> {\n    const fileDataPromises = Array.from(files).map(async (file) => {\n        const data = await readFileDataAsync(file, method);\n        if (!data) {\n            throw new Error(`Error occurred reading file: ${file.name}`);\n        }\n        return { fileName: file.name, data };\n    });\n\n    try {\n        const result = await Promise.all(fileDataPromises);\n        return Result.ok(result);\n    } catch (error) {\n        return Result.err((error as Error).message);\n    }\n}\n\nfunction readFileDataAsync(file: File, method: \"readAsText\" | \"readAsDataURL\"): Promise<string | null> {\n    return new Promise((resolve) => {\n        const reader = new FileReader();\n\n        reader.onload = (e) => {\n            if (e.target?.readyState === FileReader.DONE) {\n                resolve(e.target.result as string);\n            }\n        };\n\n        reader.onerror = () => resolve(null);\n        reader[method](file);\n    });\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IConverter } from \"./foundation\";\nimport { I18nKeys } from \"./i18n\";\n\nexport type PropertyType = \"color\" | \"materialId\";\n\nexport interface Property {\n    name: string;\n    display: I18nKeys;\n    converter?: IConverter;\n    group?: I18nKeys;\n    icon?: string;\n    type?: PropertyType;\n    dependencies?: {\n        property: string | number | symbol;\n        value: any;\n    }[];\n}\n\nconst PropertyKeyMap = new Map<Object, Map<string | number | symbol, Property>>();\n\nexport namespace Property {\n    export function define(display: I18nKeys, parameters?: Omit<Property, \"name\" | \"display\">) {\n        return (target: Object, name: string) => {\n            if (!PropertyKeyMap.has(target)) {\n                PropertyKeyMap.set(target, new Map());\n            }\n            PropertyKeyMap.get(target)?.set(name, { display, name, ...parameters });\n        };\n    }\n\n    export function getProperties(target: any, until?: object): Property[] {\n        const result: Property[] = [];\n        getAllKeysOfPrototypeChain(target, result, until);\n        return result;\n    }\n\n    export function getOwnProperties(target: any): Property[] {\n        const properties = PropertyKeyMap.get(target);\n        if (!properties) return [];\n        return [...properties.values()];\n    }\n\n    function getAllKeysOfPrototypeChain(target: any, properties: Property[], until?: object) {\n        if (!target || target === until) return;\n        if (PropertyKeyMap.has(target)) {\n            properties.splice(0, 0, ...PropertyKeyMap.get(target)!.values());\n        }\n        getAllKeysOfPrototypeChain(Object.getPrototypeOf(target), properties, until);\n    }\n\n    export function getProperty<T extends Object>(target: T, property: keyof T): Property | undefined {\n        if (!target) return undefined;\n        let map = PropertyKeyMap.get(target);\n        if (map?.has(property)) return map.get(property);\n        return getProperty(Object.getPrototypeOf(target), property);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IApplication } from \"../application\";\nimport { AsyncController, IDisposable, Observable, PubSub } from \"../foundation\";\nimport { Property } from \"../property\";\n\nexport interface ICommand {\n    execute(application: IApplication): Promise<void>;\n}\n\nexport interface ICanclableCommand extends ICommand, IDisposable {\n    cancel(): Promise<void>;\n}\n\nexport namespace ICommand {\n    export function isCancelableCommand(command: ICommand): command is ICanclableCommand {\n        return \"cancel\" in command;\n    }\n}\n\nexport abstract class CancelableCommand extends Observable implements ICanclableCommand {\n    private static readonly _propertiesCache: Map<string, any> = new Map(); // 所有命令共享\n    protected readonly disposeStack: Set<IDisposable> = new Set();\n\n    private _isCompleted: boolean = false;\n    get isCompleted() {\n        return this._isCompleted;\n    }\n\n    private _isCanceled: boolean = false;\n    get isCanceled() {\n        return this._isCanceled;\n    }\n\n    private _application: IApplication | undefined;\n    get application() {\n        if (!this._application) {\n            throw new Error(\"application is not set\");\n        }\n        return this._application;\n    }\n\n    get document() {\n        return this.application.activeView?.document!;\n    }\n\n    #controller?: AsyncController;\n    protected get controller() {\n        return this.#controller;\n    }\n    protected set controller(value: AsyncController | undefined) {\n        if (this.#controller === value) return;\n        this.#controller?.dispose();\n        this.#controller = value;\n    }\n\n    @Property.define(\"common.cancel\")\n    async cancel() {\n        this._isCanceled = true;\n\n        this.controller?.cancel();\n        while (!this._isCompleted) {\n            await new Promise((r) => setTimeout(r, 30));\n        }\n    }\n\n    @Property.define(\"option.command.repeat\")\n    get repeatOperation() {\n        return this.getPrivateValue(\"repeatOperation\", false);\n    }\n\n    set repeatOperation(value: boolean) {\n        this.setProperty(\"repeatOperation\", value);\n    }\n\n    protected _isRestarting: boolean = false;\n    protected async restart() {\n        this._isRestarting = true;\n        await this.cancel();\n    }\n\n    protected onRestarting() {}\n\n    async execute(application: IApplication): Promise<void> {\n        if (!application.activeView?.document) return;\n        this._application = application;\n        try {\n            this.beforeExecute();\n\n            await this.executeAsync();\n\n            while (this._isRestarting || (!this.checkCanceled() && this.repeatOperation)) {\n                this._isRestarting = false;\n\n                this.onRestarting();\n                await this.executeAsync();\n            }\n        } finally {\n            this.afterExecute();\n        }\n    }\n\n    protected checkCanceled() {\n        if (this.isCanceled) {\n            return true;\n        }\n\n        if (this.controller?.result?.status === \"cancel\") {\n            return true;\n        }\n\n        return false;\n    }\n\n    protected abstract executeAsync(): Promise<void>;\n\n    protected beforeExecute() {\n        this.readProperties();\n        PubSub.default.pub(\"openCommandContext\", this);\n    }\n\n    protected afterExecute() {\n        this.saveProperties();\n        PubSub.default.pub(\"closeCommandContext\");\n        this.controller?.dispose();\n        this.disposeStack.forEach((x) => x.dispose());\n        this.disposeStack.clear();\n        this._isCompleted = true;\n    }\n\n    private readProperties() {\n        Property.getProperties(this).forEach((x) => {\n            let key = this.cacheKeyOfProperty(x);\n            if (CancelableCommand._propertiesCache.has(key)) {\n                this.setPrivateValue(key as keyof this, CancelableCommand._propertiesCache.get(key));\n            }\n        });\n    }\n\n    private saveProperties() {\n        Property.getProperties(this).forEach((x) => {\n            let key = this.cacheKeyOfProperty(x);\n            let prop = (this as any)[key];\n            if (typeof prop === \"function\") return;\n            CancelableCommand._propertiesCache.set(key, prop);\n        });\n    }\n\n    private cacheKeyOfProperty(property: Property) {\n        return property.name;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Locale } from \"./i18n\";\n\nexport default {\n    display: \"English\",\n    code: \"en\",\n    translation: {\n        \"arc.angle\": \"Angle\",\n        \"arc.start\": \"Start\",\n        \"axis.x\": \"X Axis\",\n        \"axis.y\": \"Y Axis\",\n        \"axis.z\": \"Z Axis\",\n        \"body.arc\": \"Arc\",\n        \"body.bolean\": \"Boolean\",\n        \"body.box\": \"Box\",\n        \"body.pyramid\": \"Pyramid\",\n        \"body.cylinder\": \"Cylinder\",\n        \"body.cone\": \"Cone\",\n        \"body.group\": \"Group\",\n        \"body.sphere\": \"Sphere\",\n        \"body.ellipse\": \"Ellipse\",\n        \"body.circle\": \"Circle\",\n        \"body.face\": \"Face\",\n        \"body.fuse\": \"Fuse\",\n        \"body.imported\": \"Imported\",\n        \"body.line\": \"Line\",\n        \"body.polygon\": \"Pline\",\n        \"body.prism\": \"Prism\",\n        \"body.rect\": \"Rectangle\",\n        \"body.revol\": \"Revolve\",\n        \"body.sweep\": \"Sweep\",\n        \"body.wire\": \"Wire\",\n        \"box.dx\": \"Length\",\n        \"box.dy\": \"Width\",\n        \"box.dz\": \"Height\",\n        \"body.editableShape\": \"Editable Shape\",\n        \"body.meshNode\": \"Mesh Node\",\n        \"body.multiShape\": \"Multi Shape\",\n        \"circle.center\": \"Center\",\n        \"circle.radius\": \"Radius\",\n        \"ellipsoid.radiusX\": \"RadiusX\",\n        \"ellipsoid.radiusY\": \"RadiusY\",\n        \"ellipsoid.radiusZ\": \"RadiusZ\",\n        \"ellipse.majorRadius\": \"major Radius\",\n        \"ellipse.minorRadius\": \"minor Radius\",\n        \"command.act.alignCamera\": \"Align Camera\",\n        \"command.boolean.common\": \"Intersect\",\n        \"command.boolean.cut\": \"Cut\",\n        \"command.boolean.join\": \"Join\",\n        \"command.convert.fuse\": \"Fuse\",\n        \"command.convert.revol\": \"Revolve\",\n        \"command.convert.sweep\": \"Sweep\",\n        \"command.convert.toFace\": \"To Face\",\n        \"command.convert.toShell\": \"To Shell\",\n        \"command.convert.toSolid\": \"To Solid\",\n        \"command.convert.toWire\": \"To Wire\",\n        \"command.convert.curveProjection\": \"Projection\",\n        \"command.create.arc\": \"Arc\",\n        \"command.create.bezier\": \"Bezier\",\n        \"command.create.box\": \"Box\",\n        \"command.create.circle\": \"Circle\",\n        \"command.create.cone\": \"Cone\",\n        \"command.create.copyShape\": \"Copy Shape\",\n        \"command.create.cylinder\": \"Cylinder\",\n        \"command.create.ellipse\": \"Ellipse\",\n        \"command.create.ellipsoid\": \"Ellipsoid\",\n        \"command.create.extrude\": \"Extrude\",\n        \"command.create.folder\": \"Folder\",\n        \"command.create.group\": \"Group\",\n        \"command.create.line\": \"Line\",\n        \"command.create.offset\": \"Offset\",\n        \"command.create.polygon\": \"Pline\",\n        \"command.create.pyramid\": \"Pyramid\",\n        \"command.create.rect\": \"Rectangle\",\n        \"command.create.section\": \"Section\",\n        \"command.create.sphere\": \"Sphere\",\n        \"command.create.thickSolid\": \"Thick Solid\",\n        \"command.doc.new\": \"New Document\",\n        \"command.doc.open\": \"Open Document\",\n        \"command.doc.save\": \"Save Document\",\n        \"command.doc.saveToFile\": \"Save To File\",\n        \"command.edit.redo\": \"Redo\",\n        \"command.edit.undo\": \"Undo\",\n        \"command.file.export\": \"Export\",\n        \"command.file.import\": \"Import\",\n        \"command.measure.angle\": \"Angle\",\n        \"command.measure.length\": \"Length\",\n        \"command.measure.select\": \"Select\",\n        \"command.modify.array\": \"Array\",\n        \"command.modify.break\": \"Break\",\n        \"command.modify.brushAdd\": \"Brush Add\",\n        \"command.modify.brushRemove\": \"Brush Remove\",\n        \"command.modify.brushClear\": \"Brush Clear\",\n        \"command.modify.chamfer\": \"Chamfer\",\n        \"command.modify.deleteNode\": \"Delete Node\",\n        \"command.modify.explode\": \"Explode\",\n        \"command.modify.fillet\": \"Fillet\",\n        \"command.modify.mirror\": \"Mirror\",\n        \"command.modify.move\": \"Move\",\n        \"command.modify.removeFeature\": \"Remove Feature\",\n        \"command.modify.removeShapes\": \"Remove Shapes\",\n        \"command.modify.rotate\": \"Rotate\",\n        \"command.modify.split\": \"Split\",\n        \"command.modify.trim\": \"Trim\",\n        \"command.special.last\": \"__Last_COMMAND__\",\n        \"command.test.performance\": \"Performance Test\",\n        \"command.wechat.group\": \"Wechat\",\n        \"command.workingPlane.alignToPlane\": \"Align\",\n        \"command.workingPlane.fromSection\": \"Section\",\n        \"command.workingPlane.set\": \"Set\",\n        \"command.workingPlane.toggleDynamic\": \"Toggle\",\n        \"common.angle\": \"Angle\",\n        \"common.area\": \"Area\",\n        \"common.back\": \"Back\",\n        \"common.isGroup\": \"Group\",\n        \"common.language\": \"Language\",\n        \"common.3DNavigation\": \"3D Navigation\",\n        \"common.theme\": \"Theme\",\n        \"common.theme.light\": \"Light\",\n        \"common.theme.dark\": \"Dark\",\n        \"common.theme.system\": \"System\",\n        \"common.cancel\": \"Cancel\",\n        \"common.clone\": \"Clone\",\n        \"common.color\": \"Color\",\n        \"common.count\": \"Count\",\n        \"common.confirm\": \"Confirm\",\n        \"common.general\": \"General\",\n        \"common.length\": \"Length\",\n        \"common.dir\": \"Direction\",\n        \"common.material\": \"Material\",\n        \"common.matrix\": \"Matrix\",\n        \"common.name\": \"Name\",\n        \"common.normal\": \"Normal\",\n        \"common.numberX\": \"Number X\",\n        \"common.numberY\": \"Number Y\",\n        \"common.numberZ\": \"Number Z\",\n        \"common.opacity\": \"Opacity\",\n        \"common.thickness\": \"Thickness\",\n        \"common.type\": \"Type\",\n        \"common.volume\": \"Volume\",\n        \"dialog.title.selectWorkingPlane\": \"Select Working Plane\",\n        \"entity.editable\": \"Editable Entity\",\n        \"entity.parameter\": \"Parameter Entity\",\n        \"error.default:{0}\": \"error: {0}\",\n        \"error.input.cannotInputANumber\": \"Overlap with reference point, 1 number cannot be entered\",\n        \"error.input.invalidNumber\": \"Please enter a valid number, separated by ,\",\n        \"error.input.threeNumberCanBeInput\": \"Reference point is empty, only 3 numbers can be entered\",\n        \"error.input.unsupportedInputs\": \"Exceeds the maximum number of inputs\",\n        \"error.import.unsupportedFileType:{0}\": \"Unsupported file type: {0}\",\n        \"error.export.noNodeCanBeExported\": \"No node can be exported\",\n        \"file.format\": \"Format\",\n        \"home.recent\": \"Recent\",\n        \"home.welcome\": \"Welcome to chili3d\",\n        \"items.header\": \"Items\",\n        \"items.tool.delete\": \"Delete\",\n        \"items.tool.expandAll\": \"Expand All\",\n        \"items.tool.newFolder\": \"New Folder\",\n        \"items.tool.unexpandAll\": \"Unexpand all\",\n        \"line.end\": \"End\",\n        \"line.start\": \"Start\",\n        \"line.type.line\": \"Line\",\n        \"line.type.xline\": \"XLine\",\n        \"material.texture.image\": \"Image\",\n        \"material.texture.rotation\": \"Rotation\",\n        \"material.texture.wrapS\": \"Wrap S\",\n        \"material.texture.wrapT\": \"Wrap T\",\n        \"material.texture.repeat\": \"Repeat\",\n        \"material.texture.offset\": \"Offset\",\n        \"material.map\": \"Map\",\n        \"material.specular\": \"Specular\",\n        \"material.shininess\": \"Shininess\",\n        \"material.emissive\": \"Emissive\",\n        \"material.specularMap\": \"Specular Map\",\n        \"material.normalMap\": \"Normal Map\",\n        \"material.bumpMap\": \"BumpMap\",\n        \"material.roughnessMap\": \"Roughness Map\",\n        \"material.emissiveMap\": \"Emissive Map\",\n        \"material.metalness\": \"Metalness\",\n        \"material.metalnessMap\": \"Metalness Map\",\n        \"material.roughness\": \"Roughness\",\n        \"model.visible\": \"Visible\",\n        \"option.command.circularPattern\": \"Circular Pattern\",\n        \"option.command.repeat\": \"Repeat\",\n        \"option.command.isFace\": \"Face\",\n        \"option.command.isRoundCorner\": \"Round Corner\",\n        \"option.command.thickness\": \"Thickness\",\n        \"option.command.isConnected\": \"Connected\",\n        \"option.command.isConvertInstance\": \"Convert Instance\",\n        \"option.command.insertPoint\": \"Insert Point\",\n        \"polygon.points\": \"Points\",\n        \"prompt.default{0}{1}\":\n            \"{0} to pan the view, {1} to rotate the view, Mouse wheel to scroll the zoom view\",\n        \"prompt.deleteDocument{0}\": \"Do you want to delete {0}?\",\n        \"prompt.pickCircleCenter\": \"pick center, ESC key to cancel\",\n        \"prompt.pickFistPoint\": \"Pick first point, ESC key to cancel\",\n        \"prompt.pickNextPoint\": \"pick next point, ESC key to cancel\",\n        \"prompt.pickRadius\": \"input radius, ESC key to cancel\",\n        \"prompt.polygon.close\": \"Close\",\n        \"prompt.saveDocument{0}\": \"Do you want to save the changes to {0}?\",\n        \"prompt.select.edges\": \"Please select edges\",\n        \"prompt.select.faces\": \"Please select faces\",\n        \"prompt.select.models\": \"Please select models\",\n        \"prompt.select.noModelSelected\": \"No model selected\",\n        \"prompt.select.section\": \"Please select section\",\n        \"prompt.select.shape\": \"Please select shape\",\n        \"prompt.select.solids\": \"Please select solids\",\n        \"prompt.select.path\": \"Please select path\",\n        \"prompt.select.vertexes\": \"Please select vertexes\",\n        \"prompt.select.wires\": \"Please select wires\",\n        \"toast.snap.notFoundValidPoint\": \"No valid point\",\n        \"properties.group.transform\": \"Transform\",\n        \"properties.header\": \"Properties\",\n        \"properties.multivalue\": \"Multi Value\",\n        \"rect.dx\": \"Length\",\n        \"rect.dy\": \"Width\",\n        \"ribbon.group.2d\": \"2D\",\n        \"ribbon.group.3d\": \"3D\",\n        \"ribbon.group.act\": \"Act\",\n        \"ribbon.group.boolean\": \"Boolean\",\n        \"ribbon.group.converter\": \"Converter\",\n        \"ribbon.group.draw\": \"Sketch\",\n        \"ribbon.group.importExport\": \"Import/Export\",\n        \"ribbon.group.measure\": \"Measure\",\n        \"ribbon.group.modify\": \"Modify\",\n        \"ribbon.group.other\": \"Other\",\n        \"ribbon.group.selection\": \"Selection\",\n        \"ribbon.group.tools\": \"Tools\",\n        \"ribbon.group.workingPlane\": \"Working Plane\",\n        \"ribbon.tab.draw\": \"Sketch\",\n        \"ribbon.tab.file\": \"File\",\n        \"ribbon.tab.tools\": \"Tools\",\n        \"ribbon.tab.startup\": \"Startup\",\n        \"snap.center\": \"Center\",\n        \"snap.end\": \"End\",\n        \"snap.intersection\": \"Intersection\",\n        \"snap.mid\": \"Middle\",\n        \"snap.perpendicular\": \"Perpendicular\",\n        \"snap.nearest\": \"Nearest\",\n        \"statusBar.snap\": \"Snap\",\n        \"statusBar.tracking\": \"Tracking\",\n        \"toast.command.{0}excuting\": \"Command {0} is runing\",\n        \"toast.converter.error\": \"Converter error\",\n        \"toast.converter.invalidColor\": \"The color is invalid\",\n        \"toast.delete{0}Objects\": \"Deleted {0} objects\",\n        \"toast.document.noActivated\": \"No document activated\",\n        \"toast.document.saved\": \"Document saved\",\n        \"toast.downloading\": \"Downloading\",\n        \"toast.excuting{0}\": \"Excuting {0}\",\n        \"toast.fail\": \"Fail\",\n        \"toast.read.error\": \"Read error\",\n        \"toast.select.noSelected\": \"No selected\",\n        \"toast.success\": \"Success\",\n        \"transform.rotation\": \"Rotation\",\n        \"transform.scale\": \"Scale\",\n        \"transform.translation\": \"Translation\",\n        \"vertex.point\": \"Point\",\n        \"viewport.orthographic\": \"Orthographic\",\n        \"viewport.perspective\": \"Perspective\",\n        \"viewport.fitContent\": \"Fit Content\",\n        \"viewport.zoomIn\": \"Zoom In\",\n        \"viewport.zoomOut\": \"Zoom Out\",\n    },\n} satisfies Locale;\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Locale } from \"./i18n\";\n\nexport default {\n    display: \"简体中文\",\n    code: \"zh-CN\",\n    translation: {\n        \"arc.angle\": \"角度\",\n        \"arc.start\": \"起点\",\n        \"axis.x\": \"X 轴\",\n        \"axis.y\": \"Y 轴\",\n        \"axis.z\": \"Z 轴\",\n        \"body.arc\": \"圆弧\",\n        \"body.bolean\": \"布尔\",\n        \"body.box\": \"立方体\",\n        \"body.pyramid\": \"棱锥\",\n        \"body.cylinder\": \"圆柱\",\n        \"body.cone\": \"圆锥\",\n        \"body.group\": \"组\",\n        \"body.sphere\": \"球体\",\n        \"body.ellipse\": \"椭圆\",\n        \"body.circle\": \"圆形\",\n        \"body.face\": \"面\",\n        \"body.fuse\": \"合并\",\n        \"body.imported\": \"导入的模型\",\n        \"body.line\": \"直线\",\n        \"body.polygon\": \"多段线\",\n        \"body.prism\": \"拉伸\",\n        \"body.rect\": \"矩形\",\n        \"body.revol\": \"旋转\",\n        \"body.sweep\": \"扫略\",\n        \"body.wire\": \"线框\",\n        \"body.editableShape\": \"可编辑的形状\",\n        \"body.meshNode\": \"网格节点\",\n        \"body.multiShape\": \"多形状\",\n        \"box.dx\": \"长\",\n        \"box.dy\": \"宽\",\n        \"box.dz\": \"高\",\n        \"circle.center\": \"圆心\",\n        \"circle.radius\": \"半径\",\n        \"ellipsoid.radiusX\": \"半径X\",\n        \"ellipsoid.radiusY\": \"半径Y\",\n        \"ellipsoid.radiusZ\": \"半径Z\",\n        \"ellipse.majorRadius\": \"长轴\",\n        \"ellipse.minorRadius\": \"短轴\",\n        \"command.act.alignCamera\": \"从相机创建\",\n        \"command.boolean.common\": \"交集\",\n        \"command.boolean.cut\": \"减去\",\n        \"command.boolean.join\": \"合并\",\n        \"command.convert.fuse\": \"融合\",\n        \"command.convert.revol\": \"旋转\",\n        \"command.convert.sweep\": \"扫略\",\n        \"command.convert.toFace\": \"转为面\",\n        \"command.convert.toShell\": \"转为壳\",\n        \"command.convert.toSolid\": \"转为体\",\n        \"command.convert.toWire\": \"转多段线\",\n        \"command.convert.curveProjection\": \"曲线投影\",\n        \"command.create.arc\": \"圆弧\",\n        \"command.create.bezier\": \"贝塞尔曲线\",\n        \"command.create.box\": \"立方体\",\n        \"command.create.circle\": \"圆形\",\n        \"command.create.cone\": \"圆锥\",\n        \"command.create.copyShape\": \"复制形状\",\n        \"command.create.cylinder\": \"圆柱\",\n        \"command.create.ellipse\": \"椭圆\",\n        \"command.create.ellipsoid\": \"椭球体\",\n        \"command.create.extrude\": \"拉伸\",\n        \"command.create.folder\": \"文件夹\",\n        \"command.create.group\": \"创建组\",\n        \"command.create.line\": \"直线\",\n        \"command.create.offset\": \"偏移\",\n        \"command.create.polygon\": \"多段线\",\n        \"command.create.pyramid\": \"棱锥\",\n        \"command.create.rect\": \"矩形\",\n        \"command.create.section\": \"相交曲线\",\n        \"command.create.sphere\": \"球体\",\n        \"command.create.thickSolid\": \"加厚实体\",\n        \"command.doc.new\": \"新建文档\",\n        \"command.doc.open\": \"打开文档\",\n        \"command.doc.save\": \"保存文档\",\n        \"command.doc.saveToFile\": \"保存到文件\",\n        \"command.edit.redo\": \"重做\",\n        \"command.edit.undo\": \"撤销\",\n        \"command.file.export\": \"导出\",\n        \"command.file.import\": \"导入\",\n        \"command.measure.angle\": \"角度\",\n        \"command.measure.length\": \"长度\",\n        \"command.measure.select\": \"选择\",\n        \"command.modify.array\": \"阵列\",\n        \"command.modify.break\": \"打断\",\n        \"command.modify.brushAdd\": \"添加画笔\",\n        \"command.modify.brushRemove\": \"删除画笔\",\n        \"command.modify.brushClear\": \"清除画笔\",\n        \"command.modify.chamfer\": \"倒角\",\n        \"command.modify.deleteNode\": \"删除\",\n        \"command.modify.explode\": \"分解\",\n        \"command.modify.fillet\": \"圆角\",\n        \"command.modify.mirror\": \"镜像\",\n        \"command.modify.move\": \"移动\",\n        \"command.modify.removeFeature\": \"删除特征\",\n        \"command.modify.removeShapes\": \"删除子元素\",\n        \"command.modify.rotate\": \"旋转\",\n        \"command.modify.split\": \"分割\",\n        \"command.modify.trim\": \"修剪\",\n        \"command.special.last\": \"__上个命令__\",\n        \"command.test.performance\": \"性能测试\",\n        \"command.wechat.group\": \"微信群\",\n        \"command.workingPlane.alignToPlane\": \"对齐到平面\",\n        \"command.workingPlane.fromSection\": \"从截面创建\",\n        \"command.workingPlane.set\": \"设置工作平面\",\n        \"command.workingPlane.toggleDynamic\": \"动态工作平面\",\n        \"common.angle\": \"角度\",\n        \"common.area\": \"面积\",\n        \"common.back\": \"返回\",\n        \"common.3DNavigation\": \"3D导航\",\n        \"common.isGroup\": \"组\",\n        \"common.language\": \"语言\",\n        \"common.theme\": \"主题\",\n        \"common.theme.light\": \"浅色\",\n        \"common.theme.dark\": \"深色\",\n        \"common.theme.system\": \"系统\",\n        \"common.cancel\": \"取消\",\n        \"common.clone\": \"复制对象\",\n        \"common.color\": \"颜色\",\n        \"common.count\": \"数量\",\n        \"common.confirm\": \"确定\",\n        \"common.general\": \"常规\",\n        \"common.length\": \"长度\",\n        \"common.dir\": \"方向\",\n        \"common.material\": \"材质\",\n        \"common.matrix\": \"矩阵\",\n        \"common.name\": \"名称\",\n        \"common.normal\": \"法向量\",\n        \"common.numberX\": \"X 数量\",\n        \"common.numberY\": \"Y 数量\",\n        \"common.numberZ\": \"Z 数量\",\n        \"common.opacity\": \"不透明度\",\n        \"common.thickness\": \"厚度\",\n        \"common.type\": \"类型\",\n        \"common.volume\": \"体积\",\n        \"dialog.title.selectWorkingPlane\": \"选择工作平面\",\n        \"entity.editable\": \"可编辑实体\",\n        \"entity.parameter\": \"参数化实体\",\n        \"error.default:{0}\": \"错误: {0}\",\n        \"error.input.cannotInputANumber\": \"与参照点重合，无法输入 1 个数\",\n        \"error.input.invalidNumber\": \"输入错误，请输入有效的数字，以,分开\",\n        \"error.input.threeNumberCanBeInput\": \"参照点为空，只能输入 3 个数\",\n        \"error.input.unsupportedInputs\": \"超过最大输入数\",\n        \"error.import.unsupportedFileType:{0}\": \"不支持的文件类型: {0}\",\n        \"error.export.noNodeCanBeExported\": \"没有可导出的节点\",\n        \"file.format\": \"文件格式\",\n        \"home.recent\": \"最近使用\",\n        \"home.welcome\": \"欢迎使用 chili3d\",\n        \"items.header\": \"项目\",\n        \"items.tool.delete\": \"删除\",\n        \"items.tool.expandAll\": \"展开所有\",\n        \"items.tool.newFolder\": \"文件夹\",\n        \"items.tool.unexpandAll\": \"折叠所有\",\n        \"line.end\": \"终点\",\n        \"line.start\": \"起点\",\n        \"line.type.line\": \"直线\",\n        \"line.type.xline\": \"构造线\",\n        \"material.texture.image\": \"图片\",\n        \"material.texture.rotation\": \"旋转\",\n        \"material.texture.wrapS\": \"Wrap S\",\n        \"material.texture.wrapT\": \"Wrap T\",\n        \"material.texture.repeat\": \"重复\",\n        \"material.texture.offset\": \"偏移\",\n        \"material.map\": \"贴图\",\n        \"material.specular\": \"高光\",\n        \"material.shininess\": \"高光强度\",\n        \"material.emissive\": \"自发光\",\n        \"material.specularMap\": \"高光贴图\",\n        \"material.normalMap\": \"法线贴图\",\n        \"material.bumpMap\": \"凹凸贴图\",\n        \"material.roughnessMap\": \"粗糙度贴图\",\n        \"material.emissiveMap\": \"自发光贴图\",\n        \"material.metalness\": \"金属度\",\n        \"material.metalnessMap\": \"金属度贴图\",\n        \"material.roughness\": \"粗糙度\",\n        \"model.visible\": \"可见\",\n        \"option.command.circularPattern\": \"弧形阵列\",\n        \"option.command.repeat\": \"重复\",\n        \"option.command.isFace\": \"面\",\n        \"option.command.thickness\": \"厚度\",\n        \"option.command.isRoundCorner\": \"圆角\",\n        \"option.command.isConnected\": \"相连\",\n        \"option.command.isConvertInstance\": \"转为实例\",\n        \"option.command.insertPoint\": \"插入点\",\n        \"polygon.points\": \"点\",\n        \"prompt.default{0}{1}\": \"{0} 平移视图，{1} 旋转视图，滚轮缩放视图\",\n        \"prompt.deleteDocument{0}\": \"是否删除 {0} ？\",\n        \"prompt.pickCircleCenter\": \"请选择圆心  按 ESC 键取消\",\n        \"prompt.pickFistPoint\": \"请选择第一个点, 按 ESC 键取消\",\n        \"prompt.pickNextPoint\": \"请选择下一个点， 按 ESC 键取消\",\n        \"prompt.pickRadius\": \"请选择半径，按 ESC 键取消\",\n        \"prompt.polygon.close\": \"闭合\",\n        \"prompt.saveDocument{0}\": \"是否保存对 {0} 的更改？\",\n        \"prompt.select.edges\": \"请选择边\",\n        \"prompt.select.faces\": \"请选择面\",\n        \"prompt.select.models\": \"请选择模型\",\n        \"prompt.select.noModelSelected\": \"未选择任何模型\",\n        \"prompt.select.section\": \"请选择截面\",\n        \"prompt.select.shape\": \"选择形状\",\n        \"prompt.select.solids\": \"请选择实体\",\n        \"prompt.select.path\": \"请选择路径\",\n        \"prompt.select.vertexes\": \"请选择点\",\n        \"prompt.select.wires\": \"请选择线\",\n        \"toast.snap.notFoundValidPoint\": \"未找到有效的点\",\n        \"properties.group.transform\": \"转换\",\n        \"properties.header\": \"属性\",\n        \"properties.multivalue\": \"多个值\",\n        \"rect.dx\": \"长\",\n        \"rect.dy\": \"宽\",\n        \"ribbon.group.2d\": \"2D\",\n        \"ribbon.group.3d\": \"3D\",\n        \"ribbon.group.act\": \"场景\",\n        \"ribbon.group.boolean\": \"布尔运算\",\n        \"ribbon.group.converter\": \"转换\",\n        \"ribbon.group.draw\": \"绘制\",\n        \"ribbon.group.importExport\": \"导入/导出\",\n        \"ribbon.group.measure\": \"测量\",\n        \"ribbon.group.modify\": \"修改\",\n        \"ribbon.group.other\": \"其他\",\n        \"ribbon.group.selection\": \"选择\",\n        \"ribbon.group.tools\": \"工具\",\n        \"ribbon.group.workingPlane\": \"工作平面\",\n        \"ribbon.tab.draw\": \"绘图\",\n        \"ribbon.tab.file\": \"文件\",\n        \"ribbon.tab.tools\": \"工具\",\n        \"ribbon.tab.startup\": \"开始\",\n        \"snap.center\": \"圆心\",\n        \"snap.end\": \"端点\",\n        \"snap.intersection\": \"交点\",\n        \"snap.mid\": \"中点\",\n        \"snap.perpendicular\": \"垂点\",\n        \"snap.nearest\": \"最近点\",\n        \"statusBar.snap\": \"捕捉\",\n        \"statusBar.tracking\": \"追踪\",\n        \"toast.command.{0}excuting\": \"{0}命令正在执行\",\n        \"toast.converter.error\": \"转换错误\",\n        \"toast.converter.invalidColor\": \"无效的颜色\",\n        \"toast.delete{0}Objects\": \"删除了 {0} 个对象\",\n        \"toast.document.noActivated\": \"未打开任何文档\",\n        \"toast.document.saved\": \"文档已保存\",\n        \"toast.downloading\": \"正在下载\",\n        \"toast.excuting{0}\": \"正在执行{0}\",\n        \"toast.fail\": \"失败\",\n        \"toast.read.error\": \"读取错误\",\n        \"toast.select.noSelected\": \"未选择任何对象\",\n        \"toast.success\": \"成功\",\n        \"transform.rotation\": \"旋转\",\n        \"transform.scale\": \"缩放\",\n        \"transform.translation\": \"位移\",\n        \"vertex.point\": \"点\",\n        \"viewport.orthographic\": \"正交视图\",\n        \"viewport.perspective\": \"透视视图\",\n        \"viewport.fitContent\": \"适应内容\",\n        \"viewport.zoomIn\": \"放大\",\n        \"viewport.zoomOut\": \"缩小\",\n    },\n} satisfies Locale;\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Locale } from \"./i18n\";\n\nexport default {\n    display: \"Português - Brasil\",\n    code: \"pt-BR\",\n    translation: {\n        \"arc.angle\": \"Ângulo\",\n        \"arc.start\": \"Início\",\n        \"axis.x\": \"Eixo X\",\n        \"axis.y\": \"Eixo Y\",\n        \"axis.z\": \"Eixo Z\",\n        \"body.arc\": \"Arco\",\n        \"body.bolean\": \"Boolean\",\n        \"body.box\": \"Caixa\",\n        \"body.pyramid\": \"Pirâmide\",\n        \"body.cylinder\": \"Cilindro\",\n        \"body.cone\": \"Cone\",\n        \"body.group\": \"Group\",\n        \"body.sphere\": \"Esfera\",\n        \"body.ellipse\": \"Ellipse\",\n        \"body.circle\": \"Circle\",\n        \"body.face\": \"Face\",\n        \"body.fuse\": \"Fuse\",\n        \"body.imported\": \"Imported\",\n        \"body.line\": \"Line\",\n        \"body.polygon\": \"Pline\",\n        \"body.prism\": \"Prisma\",\n        \"body.rect\": \"Retângulo\",\n        \"body.revol\": \"Revolve\",\n        \"body.sweep\": \"Sweep\",\n        \"body.wire\": \"Wire\",\n        \"box.dx\": \"Comprimento\",\n        \"box.dy\": \"Largura\",\n        \"box.dz\": \"Altura\",\n        \"body.editableShape\": \"Forma Editável\",\n        \"body.meshNode\": \"Nó Mesh\",\n        \"body.multiShape\": \"Multi Formas\",\n        \"circle.center\": \"Centro\",\n        \"circle.radius\": \"Raio\",\n        \"ellipsoid.radiusX\": \"RaioX\",\n        \"ellipsoid.radiusY\": \"RaioY\",\n        \"ellipsoid.radiusZ\": \"RaioZ\",\n        \"ellipse.majorRadius\": \"major Radius\",\n        \"ellipse.minorRadius\": \"minor Radius\",\n        \"command.act.alignCamera\": \"Alinhar Câmera\",\n        \"command.boolean.common\": \"Interseção\",\n        \"command.boolean.cut\": \"Cortar\",\n        \"command.boolean.join\": \"Mesclar\",\n        \"command.convert.fuse\": \"Fundir\",\n        \"command.convert.revol\": \"Revolve\",\n        \"command.convert.sweep\": \"Sweep\",\n        \"command.convert.toFace\": \"Para Face\",\n        \"command.convert.toShell\": \"Para Casca\",\n        \"command.convert.toSolid\": \"Para Sólido\",\n        \"command.convert.toWire\": \"Para Wireframe\",\n        \"command.convert.curveProjection\": \"Projeção\",\n        \"command.create.arc\": \"Arco\",\n        \"command.create.bezier\": \"Bezier\",\n        \"command.create.box\": \"Caixa\",\n        \"command.create.circle\": \"Círculo\",\n        \"command.create.cone\": \"Cone\",\n        \"command.create.copyShape\": \"Copiar Forma\",\n        \"command.create.cylinder\": \"Cilindro\",\n        \"command.create.ellipse\": \"Elipse\",\n        \"command.create.ellipsoid\": \"Elipsóide\",\n        \"command.create.extrude\": \"Extrusão\",\n        \"command.create.folder\": \"Criar Pasta\",\n        \"command.create.group\": \"Agrupar\",\n        \"command.create.line\": \"Linha\",\n        \"command.create.offset\": \"Deslocar\",\n        \"command.create.polygon\": \"Polilinha\",\n        \"command.create.pyramid\": \"Piramide\",\n        \"command.create.rect\": \"Retângulo\",\n        \"command.create.section\": \"Criar Seção\",\n        \"command.create.sphere\": \"Esfera\",\n        \"command.create.thickSolid\": \"Thick Solid\",\n        \"command.doc.new\": \"Novo Documento\",\n        \"command.doc.open\": \"Abrir Documento\",\n        \"command.doc.save\": \"Salvar Documento\",\n        \"command.doc.saveToFile\": \"Salvar para Arquivo\",\n        \"command.edit.redo\": \"Refazer\",\n        \"command.edit.undo\": \"Desfazer\",\n        \"command.file.export\": \"Exportar\",\n        \"command.file.import\": \"Importar\",\n        \"command.measure.angle\": \"Angle\",\n        \"command.measure.length\": \"Length\",\n        \"command.measure.select\": \"Select\",\n        \"command.modify.array\": \"Array\",\n        \"command.modify.break\": \"Break\",\n        \"command.modify.brushAdd\": \"Brush Add\",\n        \"command.modify.brushRemove\": \"Brush Remove\",\n        \"command.modify.brushClear\": \"Brush Clear\",\n        \"command.modify.chamfer\": \"Chamfer\",\n        \"command.modify.deleteNode\": \"Delete Node\",\n        \"command.modify.explode\": \"Explode\",\n        \"command.modify.fillet\": \"Fillet\",\n        \"command.modify.mirror\": \"Mirror\",\n        \"command.modify.move\": \"Move\",\n        \"command.modify.removeFeature\": \"Remove Feature\",\n        \"command.modify.removeShapes\": \"Remove Shapes\",\n        \"command.modify.rotate\": \"Rotate\",\n        \"command.modify.split\": \"Split\",\n        \"command.modify.trim\": \"Trim\",\n        \"command.special.last\": \"__Last_COMMAND__\",\n        \"command.test.performance\": \"Performance Test\",\n        \"command.wechat.group\": \"Wechat\",\n        \"command.workingPlane.alignToPlane\": \"Align\",\n        \"command.workingPlane.fromSection\": \"Section\",\n        \"command.workingPlane.set\": \"Set\",\n        \"command.workingPlane.toggleDynamic\": \"Toggle\",\n        \"common.angle\": \"Angle\",\n        \"common.area\": \"Area\",\n        \"common.back\": \"Back\",\n        \"common.language\": \"Language\",\n        \"common.count\": \"Count\",\n        \"common.isGroup\": \"Group\",\n        \"common.numberX\": \"Number X\",\n        \"common.numberY\": \"Number Y\",\n        \"common.numberZ\": \"Number Z\",\n        \"common.3DNavigation\": \"3D Navigation\",\n        \"common.theme\": \"Theme\",\n        \"common.theme.light\": \"Light\",\n        \"common.theme.dark\": \"Dark\",\n        \"common.theme.system\": \"System\",\n        \"common.cancel\": \"Cancel\",\n        \"common.clone\": \"Clone\",\n        \"common.color\": \"Color\",\n        \"common.confirm\": \"Confirm\",\n        \"common.general\": \"General\",\n        \"common.length\": \"Length\",\n        \"common.dir\": \"Direction\",\n        \"common.material\": \"Material\",\n        \"common.matrix\": \"Matrix\",\n        \"common.name\": \"Name\",\n        \"common.normal\": \"Normal\",\n        \"common.opacity\": \"Opacity\",\n        \"common.thickness\": \"Thickness\",\n        \"common.type\": \"Type\",\n        \"common.volume\": \"Volume\",\n        \"dialog.title.selectWorkingPlane\": \"Select Working Plane\",\n        \"entity.editable\": \"Editable Entity\",\n        \"entity.parameter\": \"Parameter Entity\",\n        \"error.default:{0}\": \"error: {0}\",\n        \"error.input.cannotInputANumber\": \"Overlap with reference point, 1 number cannot be entered\",\n        \"error.input.invalidNumber\": \"Please enter a valid number, separated by ,\",\n        \"error.input.threeNumberCanBeInput\": \"Reference point is empty, only 3 numbers can be entered\",\n        \"error.input.unsupportedInputs\": \"Exceeds the maximum number of inputs\",\n        \"error.import.unsupportedFileType:{0}\": \"Unsupported file type: {0}\",\n        \"error.export.noNodeCanBeExported\": \"No node can be exported\",\n        \"file.format\": \"Format\",\n        \"home.recent\": \"Recent\",\n        \"home.welcome\": \"Welcome to chili3d\",\n        \"items.header\": \"Items\",\n        \"items.tool.delete\": \"Delete\",\n        \"items.tool.expandAll\": \"Expand All\",\n        \"items.tool.newFolder\": \"New Folder\",\n        \"items.tool.unexpandAll\": \"Unexpand all\",\n        \"line.end\": \"End\",\n        \"line.start\": \"Start\",\n        \"line.type.line\": \"Line\",\n        \"line.type.xline\": \"XLine\",\n        \"material.texture.image\": \"Image\",\n        \"material.texture.rotation\": \"Rotation\",\n        \"material.texture.wrapS\": \"Wrap S\",\n        \"material.texture.wrapT\": \"Wrap T\",\n        \"material.texture.repeat\": \"Repeat\",\n        \"material.texture.offset\": \"Offset\",\n        \"material.map\": \"Map\",\n        \"material.specular\": \"Specular\",\n        \"material.shininess\": \"Shininess\",\n        \"material.emissive\": \"Emissive\",\n        \"material.specularMap\": \"Specular Map\",\n        \"material.normalMap\": \"Normal Map\",\n        \"material.bumpMap\": \"BumpMap\",\n        \"material.roughnessMap\": \"Roughness Map\",\n        \"material.emissiveMap\": \"Emissive Map\",\n        \"material.metalness\": \"Metalness\",\n        \"material.metalnessMap\": \"Metalness Map\",\n        \"material.roughness\": \"Roughness\",\n        \"model.visible\": \"Visible\",\n        \"option.command.circularPattern\": \"Circular Pattern\",\n        \"option.command.repeat\": \"Repeat\",\n        \"option.command.isFace\": \"Face\",\n        \"option.command.isRoundCorner\": \"Round Corner\",\n        \"option.command.thickness\": \"Thickness\",\n        \"option.command.isConnected\": \"Connected\",\n        \"option.command.isConvertInstance\": \"Convert Instance\",\n        \"option.command.insertPoint\": \"Insert Point\",\n        \"polygon.points\": \"Points\",\n        \"prompt.default{0}{1}\":\n            \"{0} to pan the view, {1} to rotate the view, Mouse wheel to scroll the zoom view\",\n        \"prompt.deleteDocument{0}\": \"Do you want to delete {0}?\",\n        \"prompt.pickCircleCenter\": \"pick center, ESC key to cancel\",\n        \"prompt.pickFistPoint\": \"Pick first point, ESC key to cancel\",\n        \"prompt.pickNextPoint\": \"pick next point, ESC key to cancel\",\n        \"prompt.pickRadius\": \"input radius, ESC key to cancel\",\n        \"prompt.polygon.close\": \"Close\",\n        \"prompt.saveDocument{0}\": \"Do you want to save the changes to {0}?\",\n        \"prompt.select.edges\": \"Please select edges\",\n        \"prompt.select.faces\": \"Please select faces\",\n        \"prompt.select.models\": \"Please select models\",\n        \"prompt.select.noModelSelected\": \"No model selected\",\n        \"prompt.select.section\": \"Please select section\",\n        \"prompt.select.shape\": \"Please select shape\",\n        \"prompt.select.solids\": \"Please select solids\",\n        \"prompt.select.path\": \"Please select path\",\n        \"prompt.select.vertexes\": \"Please select vertexes\",\n        \"prompt.select.wires\": \"Please select wires\",\n        \"toast.snap.notFoundValidPoint\": \"No valid point\",\n        \"properties.group.transform\": \"Transform\",\n        \"properties.header\": \"Properties\",\n        \"properties.multivalue\": \"Multi Value\",\n        \"rect.dx\": \"Length\",\n        \"rect.dy\": \"Width\",\n        \"ribbon.group.2d\": \"2D\",\n        \"ribbon.group.3d\": \"3D\",\n        \"ribbon.group.act\": \"Act\",\n        \"ribbon.group.boolean\": \"Boolean\",\n        \"ribbon.group.converter\": \"Converter\",\n        \"ribbon.group.draw\": \"Sketch\",\n        \"ribbon.group.importExport\": \"Import/Export\",\n        \"ribbon.group.measure\": \"Measure\",\n        \"ribbon.group.modify\": \"Modify\",\n        \"ribbon.group.other\": \"Other\",\n        \"ribbon.group.selection\": \"Selection\",\n        \"ribbon.group.tools\": \"Tools\",\n        \"ribbon.group.workingPlane\": \"Working Plane\",\n        \"ribbon.tab.draw\": \"Sketch\",\n        \"ribbon.tab.file\": \"File\",\n        \"ribbon.tab.tools\": \"Tools\",\n        \"ribbon.tab.startup\": \"Startup\",\n        \"snap.center\": \"Center\",\n        \"snap.end\": \"End\",\n        \"snap.intersection\": \"Intersection\",\n        \"snap.mid\": \"Middle\",\n        \"snap.perpendicular\": \"Perpendicular\",\n        \"snap.nearest\": \"Nearest\",\n        \"statusBar.snap\": \"Snap\",\n        \"statusBar.tracking\": \"Tracking\",\n        \"toast.command.{0}excuting\": \"Command {0} is runing\",\n        \"toast.converter.error\": \"Converter error\",\n        \"toast.converter.invalidColor\": \"The color is invalid\",\n        \"toast.delete{0}Objects\": \"Deleted {0} objects\",\n        \"toast.document.noActivated\": \"No document activated\",\n        \"toast.document.saved\": \"Document saved\",\n        \"toast.downloading\": \"Downloading\",\n        \"toast.excuting{0}\": \"Excuting {0}\",\n        \"toast.fail\": \"Fail\",\n        \"toast.read.error\": \"Read error\",\n        \"toast.select.noSelected\": \"No selected\",\n        \"toast.success\": \"Success\",\n        \"transform.rotation\": \"Rotation\",\n        \"transform.scale\": \"Scale\",\n        \"transform.translation\": \"Translation\",\n        \"vertex.point\": \"Point\",\n        \"viewport.orthographic\": \"Orthographic\",\n        \"viewport.perspective\": \"Perspective\",\n        \"viewport.fitContent\": \"Fit Content\",\n        \"viewport.zoomIn\": \"Zoom In\",\n        \"viewport.zoomOut\": \"Zoom Out\",\n    },\n} satisfies Locale;\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Config } from \"../config\";\nimport en from \"./en\";\nimport { I18nKeys } from \"./keys\";\nimport zh from \"./zh-cn\";\nimport ptBr from \"./pt-br\";\n\nconst I18nId = \"chili18n\";\nconst I18nArgs = new WeakMap<HTMLElement, any[]>();\n\nexport type LanguageCode = \"zh-CN\" | \"en\" | \"pt-BR\";\n\nexport type Locale = {\n    display: string;\n    code: LanguageCode;\n    translation: {\n        [key in I18nKeys]: string;\n    } & {\n        [key: string]: string;\n    };\n};\n\nexport type I18nPath = \"textContent\" | \"title\";\n\nexport class Localize {\n    constructor(readonly key: I18nKeys) {}\n\n    set(e: HTMLElement, path: I18nPath) {\n        I18n.set(e, path, this.key);\n    }\n}\n\nexport type Translation = Record<I18nKeys, string>;\n\nexport namespace I18n {\n    export const languages = new Map<LanguageCode, Locale>([\n        [\"en\", en],\n        [\"zh-CN\", zh],\n        [\"pt-BR\", ptBr],\n    ]);\n\n    let _currentLanguage: LanguageCode | undefined = undefined;\n    export function currentLanguage() {\n        _currentLanguage ??= Array.from(languages.keys())[Config.instance.languageIndex];\n        return _currentLanguage;\n    }\n\n    export function defaultLanguageIndex() {\n        return navigator.language.toLowerCase() === \"zh-cn\" ? 1 : 0;\n    }\n\n    export function combineTranslation(language: LanguageCode, translations: Record<string, string>) {\n        let local = languages.get(language);\n        if (local) {\n            local.translation = {\n                ...local.translation,\n                ...translations,\n            };\n        }\n    }\n\n    export function translate(key: I18nKeys, ...args: any[]) {\n        let language = languages.get(currentLanguage())!;\n        let text = language.translation[key] ?? languages.get(\"zh-CN\")!.translation[key];\n        if (args.length > 0) {\n            text = text.replace(/\\{(\\d+)\\}/g, (_, index) => args[index]);\n        }\n        return text;\n    }\n\n    export function isI18nKey(key: string): key is I18nKeys {\n        return key in languages.get(\"zh-CN\")!.translation;\n    }\n\n    const LINK_KEY = \"_:_\";\n\n    export function set(dom: HTMLElement, path: I18nPath, key: I18nKeys, ...args: any[]) {\n        dom[path] = translate(key, ...args);\n        dom.dataset[I18nId] = `${key}${LINK_KEY}${path}`;\n        if (args.length > 0) {\n            I18nArgs.set(dom, args);\n        }\n    }\n\n    export function changeLanguage(index: number) {\n        if (index < 0 || index >= languages.size) return;\n\n        let newLanguage = Array.from(languages.keys())[index];\n        if (newLanguage === _currentLanguage) return;\n        _currentLanguage = newLanguage;\n\n        document.querySelectorAll(`[data-${I18nId}]`).forEach((e) => {\n            let html = e as HTMLElement;\n            let data = html?.dataset[I18nId]?.split(LINK_KEY);\n            if (data?.length !== 2) return;\n            let args = I18nArgs.get(html) ?? [];\n            html[data[1] as I18nPath] = translate(data[0] as I18nKeys, ...args);\n        });\n\n        Config.instance.languageIndex = index;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { ObjectStorage, Observable } from \"./foundation\";\nimport { I18n } from \"./i18n\";\nimport { SerializedProperties, Serializer } from \"./serialize\";\nimport { ObjectSnapType } from \"./snapType\";\n\nexport class VisualItemConfig extends Observable {\n    defaultFaceColor = 0xdedede;\n    highlightEdgeColor = 0x33ff33;\n    highlightFaceColor = 0x99ff00;\n    selectedEdgeColor = 0x33ff33;\n    selectedFaceColor = 0x33ff33;\n    editVertexSize = 7;\n    editVertexColor = 0x33ff33;\n    hintVertexSize = 5;\n    hintVertexColor = 0x33ff33;\n    trackingVertexSize = 7;\n    trackingVertexColor = 0x33ff33;\n    temporaryVertexSize = 5;\n    temporaryVertexColor = 0x33ff33;\n    temporaryEdgeColor = 0x33ff33;\n\n    get defaultEdgeColor() {\n        return this.getPrivateValue(\"defaultEdgeColor\", 0x333333);\n    }\n    set defaultEdgeColor(value: number) {\n        this.setProperty(\"defaultEdgeColor\", value);\n    }\n\n    setTheme(theme: \"light\" | \"dark\") {\n        this.defaultEdgeColor = theme === \"light\" ? 0x333333 : 0xeeeeee;\n    }\n}\n\nexport const VisualConfig = new VisualItemConfig();\n\nconst CONFIG_STORAGE_KEY = \"config\";\n\nexport class Config extends Observable {\n    static readonly #instance = new Config();\n\n    static get instance() {\n        return this.#instance;\n    }\n\n    readonly SnapDistance: number = 5;\n\n    get snapType() {\n        return this.getPrivateValue(\n            \"snapType\",\n            ObjectSnapType.midPoint |\n                ObjectSnapType.endPoint |\n                ObjectSnapType.center |\n                ObjectSnapType.perpendicular |\n                ObjectSnapType.intersection |\n                ObjectSnapType.nearest,\n        );\n    }\n    set snapType(snapType: ObjectSnapType) {\n        this.setProperty(\"snapType\", snapType);\n    }\n\n    get enableSnapTracking() {\n        return this.getPrivateValue(\"enableSnapTracking\", true);\n    }\n    set enableSnapTracking(value: boolean) {\n        this.setProperty(\"enableSnapTracking\", value);\n    }\n\n    get enableSnap() {\n        return this.getPrivateValue(\"enableSnap\", true);\n    }\n    set enableSnap(value: boolean) {\n        this.setProperty(\"enableSnap\", value);\n    }\n\n    get dynamicWorkplane() {\n        return this.getPrivateValue(\"dynamicWorkplane\", true);\n    }\n    set dynamicWorkplane(value: boolean) {\n        this.setProperty(\"dynamicWorkplane\", value);\n    }\n\n    @Serializer.serialze()\n    get languageIndex() {\n        return this.getPrivateValue(\"languageIndex\");\n    }\n    set languageIndex(value: number) {\n        this.setProperty(\"languageIndex\", value, () => {\n            I18n.changeLanguage(value);\n            this.saveToStorage();\n        });\n    }\n\n    @Serializer.serialze()\n    get navigation3DIndex() {\n        return this.getPrivateValue(\"navigation3DIndex\");\n    }\n    set navigation3DIndex(value: number) {\n        this.setProperty(\"navigation3DIndex\", value, () => {\n            this.saveToStorage();\n        });\n    }\n\n    @Serializer.serialze()\n    get themeMode() {\n        return this.getPrivateValue(\"themeMode\", \"system\");\n    }\n    set themeMode(value: \"light\" | \"dark\" | \"system\") {\n        this.setProperty(\"themeMode\", value, () => {\n            this.applyTheme();\n            this.saveToStorage();\n        });\n    }\n\n    private applyTheme() {\n        const themeMode = this.themeMode;\n        let theme: \"light\" | \"dark\";\n\n        if (themeMode === \"system\") {\n            theme = window.matchMedia?.(\"(prefers-color-scheme: dark)\").matches ? \"dark\" : \"light\";\n        } else {\n            theme = themeMode;\n        }\n\n        document.documentElement.setAttribute(\"theme\", theme);\n        VisualConfig.setTheme(theme);\n    }\n\n    private saveToStorage() {\n        const json = Serializer.serializeProperties(this);\n        ObjectStorage.default.setValue(CONFIG_STORAGE_KEY, json);\n    }\n\n    private constructor() {\n        super();\n        this.init();\n    }\n\n    private init() {\n        const properties = ObjectStorage.default.value<SerializedProperties<Config>>(CONFIG_STORAGE_KEY);\n        if (properties) {\n            for (const key in properties) {\n                const thisKey = key as keyof Config;\n                this.setPrivateValue(thisKey, properties[thisKey]);\n            }\n        } else {\n            this.setPrivateValue(\"languageIndex\", I18n.defaultLanguageIndex());\n            this.setPrivateValue(\"navigation3DIndex\", 0);\n            this.setPrivateValue(\"themeMode\", \"system\");\n        }\n\n        // Apply theme on startup\n        this.applyTheme();\n\n        // Listen for system theme changes\n        window.matchMedia?.(\"(prefers-color-scheme: dark)\").addEventListener(\"change\", () => {\n            if (this.themeMode === \"system\") {\n                this.applyTheme();\n            }\n        });\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nexport class Constants {\n    static readonly DBName = \"chili3d-db\";\n    static readonly DocumentTable = \"documents\";\n    static readonly RecentTable = \"recents\";\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IApplication } from \"./application\";\nimport {\n    History,\n    IDisposable,\n    INodeChangedObserver,\n    IPropertyChanged,\n    NodeRecord,\n    ObservableCollection,\n} from \"./foundation\";\nimport { Material } from \"./material\";\nimport { Component, INode, INodeLinkedList } from \"./model\";\nimport { ISelection } from \"./selection\";\nimport { ISerialize, Serialized } from \"./serialize\";\nimport { Act, IVisual } from \"./visual\";\n\nexport const DOCUMENT_FILE_EXTENSION = \".cd\";\n\nexport interface IDocument extends IPropertyChanged, IDisposable, ISerialize {\n    name: string;\n    currentNode?: INodeLinkedList;\n    rootNode: INodeLinkedList;\n    readonly selection: ISelection;\n    readonly id: string;\n    readonly history: History;\n    readonly visual: IVisual;\n    readonly application: IApplication;\n    readonly components: Array<Component>;\n    materials: ObservableCollection<Material>;\n    acts: ObservableCollection<Act>;\n    addNode(...nodes: INode[]): void;\n    addNodeObserver(observer: INodeChangedObserver): void;\n    removeNodeObserver(observer: INodeChangedObserver): void;\n    notifyNodeChanged(records: NodeRecord[]): void;\n    save(): Promise<void>;\n    close(): Promise<void>;\n    serialize(): Serialized;\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Precision } from \"../foundation\";\nimport { XYZ } from \"./xyz\";\n\nexport class MathUtils {\n    static degToRad(degrees: number) {\n        return degrees * (Math.PI / 180);\n    }\n\n    static radToDeg(radians: number) {\n        return radians * (180 / Math.PI);\n    }\n\n    static anyEqualZero(...values: number[]) {\n        return values.some((value) => Math.abs(value) < Precision.Float);\n    }\n\n    static allEqualZero(...values: number[]) {\n        return values.every((value) => Math.abs(value) < Precision.Float);\n    }\n\n    static almostEqual(a: number, b: number, tolerance = 1e-6) {\n        return Math.abs(a - b) < tolerance;\n    }\n\n    static clamp(value: number, min: number, max: number) {\n        return Math.max(min, Math.min(max, value));\n    }\n\n    static minMax(values: ArrayLike<number>) {\n        if (values.length === 0) return undefined;\n\n        let min = values[0];\n        let max = values[0];\n\n        for (let i = 1; i < values.length; i++) {\n            const value = values[i];\n            if (value < min) min = value;\n            if (value > max) max = value;\n        }\n\n        return { min, max };\n    }\n\n    static computeLineSegmentDistance(seg1Start: XYZ, seg1End: XYZ, seg2Start: XYZ, seg2End: XYZ) {\n        const seg1Dir = seg1End.sub(seg1Start); \n        const seg2Dir = seg2End.sub(seg2Start); \n        const seg1ToSeg2Vec = seg1Start.sub(seg2Start);\n\n        const seg1DirSqLen = seg1Dir.dot(seg1Dir);\n        const seg1Seg2Dot = seg1Dir.dot(seg2Dir);\n        const seg2DirSqLen = seg2Dir.dot(seg2Dir); \n        const seg1DirToSeg1StartDot = seg1Dir.dot(seg1ToSeg2Vec); \n        const seg2DirToSeg1StartDot = seg2Dir.dot(seg1ToSeg2Vec);\n        const determinant = seg1DirSqLen * seg2DirSqLen - seg1Seg2Dot * seg1Seg2Dot;\n\n        let { sNumerator, sDenominator, tNumerator, tDenominator } = computeSTParameters(\n            determinant, seg1Seg2Dot, seg2DirSqLen, seg1DirToSeg1StartDot, seg2DirToSeg1StartDot, seg1DirSqLen\n        );\n        ({ tNumerator, sNumerator, sDenominator } = adjustSTParameters(\n            tNumerator, tDenominator, sNumerator, sDenominator, seg1DirToSeg1StartDot, seg1DirSqLen, seg1Seg2Dot\n        ));\n\n        const sParam = Math.abs(sNumerator) < Precision.Float ? 0 : sNumerator / sDenominator; \n        const tParam = Math.abs(tNumerator) < Precision.Float ? 0 : tNumerator / tDenominator; \n\n        const vecOnSeg1 = seg1Dir.multiply(sParam);\n        const vecOnSeg2 = seg2Dir.multiply(tParam);\n\n        const closestPointDiff = seg1ToSeg2Vec.add(vecOnSeg1).sub(vecOnSeg2);\n        return {\n            distance: closestPointDiff.length(),\n            pointOnSeg1: seg1Start.add(vecOnSeg1),\n            pointOnSeg2: seg2Start.add(vecOnSeg2),\n        }\n    }\n}\n\nfunction computeSTParameters(\n    determinant: number, seg1Seg2Dot: number, seg2DirSqLen: number,\n    seg1DirToSeg1StartDot: number, seg2DirToSeg1StartDot: number, seg1DirSqLen: number\n) {\n    let sNumerator, sDenominator, tNumerator, tDenominator;\n    if (determinant < Precision.Float) {\n        sNumerator = 0;\n        sDenominator = 1;\n        tNumerator = seg2DirToSeg1StartDot;\n        tDenominator = seg2DirSqLen;\n    } else {\n        sNumerator = seg1Seg2Dot * seg2DirToSeg1StartDot - seg2DirSqLen * seg1DirToSeg1StartDot;\n        tNumerator = seg1DirSqLen * seg2DirToSeg1StartDot - seg1Seg2Dot * seg1DirToSeg1StartDot;\n\n        if (sNumerator < 0) {\n            sNumerator = 0;\n            tNumerator = seg2DirToSeg1StartDot;\n            tDenominator = seg2DirSqLen;\n        } else if (sNumerator > determinant) {\n            sNumerator = determinant;\n            tNumerator = seg2DirToSeg1StartDot + seg1Seg2Dot;\n            tDenominator = seg2DirSqLen;\n        } else {\n            sDenominator = determinant;\n            tDenominator = determinant;\n        }\n    }\n    return { sNumerator, sDenominator: sDenominator ?? determinant, tNumerator, tDenominator: tDenominator ?? determinant };\n}\n\nfunction adjustSTParameters(\n    tNumerator: number, tDenominator: number, sNumerator: number, sDenominator: number,\n    seg1DirToSeg1StartDot: number, seg1DirSqLen: number, seg1Seg2Dot: number\n) {\n    if (tNumerator < 0) {\n        tNumerator = 0;\n        if (-seg1DirToSeg1StartDot < 0) {\n            sNumerator = 0;\n        } else if (-seg1DirToSeg1StartDot > seg1DirSqLen) {\n            sNumerator = sDenominator;\n        } else {\n            sNumerator = -seg1DirToSeg1StartDot;\n            sDenominator = seg1DirSqLen;\n        }\n    } else if (tNumerator > tDenominator) {\n        tNumerator = tDenominator;\n        const adjustedValue = -seg1DirToSeg1StartDot + seg1Seg2Dot;\n        if (adjustedValue < 0) {\n            sNumerator = 0;\n        } else if (adjustedValue > seg1DirSqLen) {\n            sNumerator = sDenominator;\n        } else {\n            sNumerator = adjustedValue;\n            sDenominator = seg1DirSqLen;\n        }\n    }\n    return { tNumerator, sNumerator, sDenominator };\n}","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Precision } from \"../foundation\";\nimport { Serializer } from \"../serialize\";\nimport { MathUtils } from \"./mathUtils\";\n\nexport type XYZLike = { x: number; y: number; z: number };\n\n@Serializer.register([\"x\", \"y\", \"z\"])\nexport class XYZ {\n    static readonly zero = new XYZ(0, 0, 0);\n    static readonly unitX = new XYZ(1, 0, 0);\n    static readonly unitY = new XYZ(0, 1, 0);\n    static readonly unitZ = new XYZ(0, 0, 1);\n    static readonly one = new XYZ(1, 1, 1);\n\n    @Serializer.serialze()\n    readonly x: number;\n    @Serializer.serialze()\n    readonly y: number;\n    @Serializer.serialze()\n    readonly z: number;\n\n    constructor(x: number, y: number, z: number) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n    }\n\n    toString() {\n        return `${this.x}, ${this.y}, ${this.z}`;\n    }\n\n    toArray(): number[] {\n        return [this.x, this.y, this.z];\n    }\n\n    cross(right: XYZLike): XYZ {\n        return new XYZ(\n            this.y * right.z - this.z * right.y,\n            this.z * right.x - this.x * right.z,\n            this.x * right.y - this.y * right.x,\n        );\n    }\n\n    dot(right: XYZLike): number {\n        return this.x * right.x + this.y * right.y + this.z * right.z;\n    }\n\n    divided(scalar: number): XYZ | undefined {\n        if (Math.abs(scalar) < Precision.Float) return undefined;\n        return new XYZ(this.x / scalar, this.y / scalar, this.z / scalar);\n    }\n\n    reverse(): XYZ {\n        return new XYZ(-this.x, -this.y, -this.z);\n    }\n\n    multiply(scalar: number): XYZ {\n        return new XYZ(this.x * scalar, this.y * scalar, this.z * scalar);\n    }\n\n    sub(right: XYZLike): XYZ {\n        return new XYZ(this.x - right.x, this.y - right.y, this.z - right.z);\n    }\n\n    add(right: XYZLike): XYZ {\n        return new XYZ(this.x + right.x, this.y + right.y, this.z + right.z);\n    }\n\n    normalize(): XYZ | undefined {\n        const d = this.length();\n        return d < Precision.Float ? undefined : new XYZ(this.x / d, this.y / d, this.z / d);\n    }\n\n    distanceTo(right: XYZLike): number {\n        const dx = this.x - right.x;\n        const dy = this.y - right.y;\n        const dz = this.z - right.z;\n        return Math.sqrt(dx * dx + dy * dy + dz * dz);\n    }\n\n    static center(p1: XYZLike, p2: XYZLike): XYZ {\n        return new XYZ((p1.x + p2.x) / 2, (p1.y + p2.y) / 2, (p1.z + p2.z) / 2);\n    }\n\n    lengthSq(): number {\n        return this.x * this.x + this.y * this.y + this.z * this.z;\n    }\n\n    length(): number {\n        return Math.sqrt(this.lengthSq());\n    }\n\n    /**\n     * Computes the angular value in radians between me and right\n     * @param right vector\n     * @returns [0, PI]\n     */\n    angleTo(right: XYZLike): number | undefined {\n        if (this.isEqualTo(XYZ.zero) || XYZ.zero.isEqualTo(right)) return undefined;\n        let cross = this.cross(right);\n        let dot = this.dot(right);\n        // tan(x) = |a||b|sin(x) / |a||b|cos(x)\n        return Math.atan2(cross.length(), dot);\n    }\n\n    /**\n     * Computes the angular value in radians between me and right on plane\n     * @param right vector\n     * @param normal plane normal\n     * @returns [0, 2PI]\n     */\n    angleOnPlaneTo(right: XYZLike, normal: XYZLike): number | undefined {\n        const angle = this.angleTo(right);\n        if (angle === undefined || XYZ.zero.isEqualTo(normal)) return undefined;\n        const vec = this.cross(right).normalize();\n        return vec?.isOppositeTo(normal) ? Math.PI * 2 - angle : angle;\n    }\n\n    /**\n     *\n     * @param normal rotate axis\n     * @param angle angular value in radians\n     * @returns\n     */\n    rotate(normal: XYZ, angle: number): XYZ | undefined {\n        const n = normal.normalize();\n        if (n === undefined) return undefined;\n        const cos = Math.cos(angle);\n        return this.multiply(cos)\n            .add(n.multiply((1 - cos) * n.dot(this)))\n            .add(n.cross(this).multiply(Math.sin(angle)));\n    }\n\n    isEqualTo(right: XYZLike, tolerance: number = 1e-6) {\n        return (\n            MathUtils.almostEqual(this.x, right.x, tolerance) &&\n            MathUtils.almostEqual(this.y, right.y, tolerance) &&\n            MathUtils.almostEqual(this.z, right.z, tolerance)\n        );\n    }\n\n    isParallelTo(right: XYZLike, tolerance: number = 1e-6): boolean {\n        const angle = this.angleTo(right);\n        if (angle === undefined) return false;\n\n        return Math.abs(angle) < tolerance || Math.abs(Math.PI - angle) < tolerance;\n    }\n\n    isOppositeTo(right: XYZLike, tolerance: number = 1e-6): boolean {\n        const angle = this.angleTo(right);\n        if (angle === undefined) return false;\n\n        return Math.abs(Math.PI - angle) < tolerance;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { EdgeMeshData, LineType } from \"../shape\";\nimport { Matrix4 } from \"./matrix4\";\nimport { XYZ } from \"./xyz\";\n\nexport type PointLike = { x: number; y: number; z: number };\n\nexport class BoundingBox {\n    constructor(\n        readonly min: PointLike,\n        readonly max: PointLike,\n    ) {}\n\n    static readonly zero = new BoundingBox(new XYZ(0, 0, 0), new XYZ(0, 0, 0));\n\n    static transformed(box: BoundingBox, matrix: Matrix4) {\n        const min = matrix.ofPoint(box.min);\n        const max = matrix.ofPoint(box.max);\n\n        return new BoundingBox(min, max);\n    }\n\n    static center(box: BoundingBox | undefined) {\n        if (!box) {\n            return XYZ.zero;\n        }\n\n        const x = (box.min.x + box.max.x) / 2;\n        const y = (box.min.y + box.max.y) / 2;\n        const z = (box.min.z + box.max.z) / 2;\n\n        return new XYZ(x, y, z);\n    }\n\n    static expand(box: BoundingBox, value: number) {\n        const min = {\n            x: box.min.x - value,\n            y: box.min.y - value,\n            z: box.min.z - value,\n        };\n        const max = {\n            x: box.max.x + value,\n            y: box.max.y + value,\n            z: box.max.z + value,\n        };\n\n        return new BoundingBox(min, max);\n    }\n\n    static wireframe(box: BoundingBox): EdgeMeshData {\n        const { min, max } = box;\n        const position = [\n            min.x,\n            min.y,\n            min.z,\n            min.x,\n            min.y,\n            max.z, // z\n            min.x,\n            min.y,\n            max.z,\n            min.x,\n            max.y,\n            max.z, // y\n            min.x,\n            max.y,\n            max.z,\n            min.x,\n            max.y,\n            min.z, // z\n            min.x,\n            max.y,\n            min.z,\n            min.x,\n            min.y,\n            min.z, // y\n            max.x,\n            min.y,\n            min.z,\n            max.x,\n            min.y,\n            max.z, // z\n            max.x,\n            min.y,\n            max.z,\n            max.x,\n            max.y,\n            max.z, // y\n            max.x,\n            max.y,\n            max.z,\n            max.x,\n            max.y,\n            min.z, // z\n            max.x,\n            max.y,\n            min.z,\n            max.x,\n            min.y,\n            min.z, // y\n            min.x,\n            min.y,\n            min.z,\n            max.x,\n            min.y,\n            min.z, // x\n            min.x,\n            min.y,\n            max.z,\n            max.x,\n            min.y,\n            max.z, // x\n            min.x,\n            max.y,\n            max.z,\n            max.x,\n            max.y,\n            max.z, // x\n            min.x,\n            max.y,\n            min.z,\n            max.x,\n            max.y,\n            min.z, // x\n        ];\n        return {\n            position: new Float32Array(position),\n            lineType: LineType.Solid,\n            range: [],\n        };\n    }\n\n    static isValid(box: BoundingBox) {\n        return box.min.x <= box.max.x && box.min.y <= box.max.y && box.min.z <= box.max.z;\n    }\n\n    static isIntersect(box1: BoundingBox, box2: BoundingBox, tolerance = 0.001) {\n        return (\n            box1.min.x < box2.max.x + tolerance &&\n            box1.max.x > box2.min.x - tolerance &&\n            box1.min.y < box2.max.y + tolerance &&\n            box1.max.y > box2.min.y - tolerance &&\n            box1.min.z < box2.max.z + tolerance &&\n            box1.max.z > box2.min.z - tolerance\n        );\n    }\n\n    static expandByPoint(box: BoundingBox, point: PointLike) {\n        const { min, max } = box;\n        min.x = Math.min(min.x, point.x);\n        min.y = Math.min(min.y, point.y);\n        min.z = Math.min(min.z, point.z);\n        max.x = Math.max(max.x, point.x);\n        max.y = Math.max(max.y, point.y);\n        max.z = Math.max(max.z, point.z);\n    }\n\n    static combine(box1: BoundingBox | undefined, box2: BoundingBox | undefined) {\n        if (!box2) {\n            return box1;\n        }\n\n        if (!box1) {\n            return box2;\n        }\n\n        const min = {\n            x: Math.min(box1.min.x, box2.min.x),\n            y: Math.min(box1.min.y, box2.min.y),\n            z: Math.min(box1.min.z, box2.min.z),\n        };\n        const max = {\n            x: Math.max(box1.max.x, box2.max.x),\n            y: Math.max(box1.max.y, box2.max.y),\n            z: Math.max(box1.max.z, box2.max.z),\n        };\n        return new BoundingBox(min, max);\n    }\n\n    static fromNumbers(points: ArrayLike<number>): BoundingBox {\n        const min = { x: Infinity, y: Infinity, z: Infinity };\n        const max = { x: -Infinity, y: -Infinity, z: -Infinity };\n\n        for (let i = 0; i < points.length; i += 3) {\n            const x = points[i];\n            const y = points[i + 1];\n            const z = points[i + 2];\n\n            min.x = Math.min(min.x, x);\n            min.y = Math.min(min.y, y);\n            min.z = Math.min(min.z, z);\n            max.x = Math.max(max.x, x);\n            max.y = Math.max(max.y, y);\n            max.z = Math.max(max.z, z);\n        }\n        return new BoundingBox(min, max);\n    }\n\n    static fromPoints(points: PointLike[]): BoundingBox {\n        const min = { x: Infinity, y: Infinity, z: Infinity };\n        const max = { x: -Infinity, y: -Infinity, z: -Infinity };\n\n        for (const point of points) {\n            min.x = Math.min(min.x, point.x);\n            min.y = Math.min(min.y, point.y);\n            min.z = Math.min(min.z, point.z);\n            max.x = Math.max(max.x, point.x);\n            max.y = Math.max(max.y, point.y);\n            max.z = Math.max(max.z, point.z);\n        }\n        return new BoundingBox(min, max);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Matrix4 } from \"./matrix4\";\nimport { XYZ, XYZLike } from \"./xyz\";\n\nexport class Quaternion {\n    readonly w: number;\n    readonly x: number;\n    readonly y: number;\n    readonly z: number;\n    constructor(w = 1, x = 0, y = 0, z = 0) {\n        this.w = w;\n        this.x = x;\n        this.y = y;\n        this.z = z;\n    }\n\n    static fromAxisAngle(axis: XYZLike, rad: number): Quaternion {\n        const sin = Math.sin(rad * 0.5);\n        const cos = Math.cos(rad * 0.5);\n        return new Quaternion(cos, axis.x * sin, axis.y * sin, axis.z * sin);\n    }\n\n    conjugate(): Quaternion {\n        return new Quaternion(this.w, -this.x, -this.y, -this.z);\n    }\n\n    invert(): Quaternion {\n        return this.conjugate();\n    }\n\n    rotateVector(vec3: XYZLike): XYZ {\n        const q = new Quaternion(0, vec3.x, vec3.y, vec3.z);\n        const r = this.multiply(q).multiply(this.conjugate());\n        return new XYZ(r.x, r.y, r.z);\n    }\n\n    toAxes() {\n        let { x, y, z, w } = this;\n        let x2 = x + x;\n        let y2 = y + y;\n        let z2 = z + z;\n        let xx = x * x2;\n        let xy = x * y2;\n        let xz = x * z2;\n        let yy = y * y2;\n        let yz = y * z2;\n        let zz = z * z2;\n        let wx = w * x2;\n        let wy = w * y2;\n        let wz = w * z2;\n        return [\n            1.0 - (yy + zz),\n            xy + wz,\n            xz - wy,\n            0.0,\n            xy - wz,\n            1.0 - (xx + zz),\n            yz + wx,\n            0.0,\n            xz + wy,\n            yz - wx,\n            1.0 - (xx + yy),\n            0.0,\n        ];\n    }\n\n    add(q: Quaternion): Quaternion {\n        return new Quaternion(this.w + q.w, this.x + q.x, this.y + q.y, this.z + q.z);\n    }\n    subtract(q: Quaternion): Quaternion {\n        return new Quaternion(this.w - q.w, this.x - q.x, this.y - q.y, this.z - q.z);\n    }\n    multiply(q: Quaternion): Quaternion {\n        const { w: w1, x: x1, y: y1, z: z1 } = this;\n        const { w: w2, x: x2, y: y2, z: z2 } = q;\n\n        return new Quaternion(\n            w1 * w2 - x1 * x2 - y1 * y2 - z1 * z2,\n            w1 * x2 + x1 * w2 + y1 * z2 - z1 * y2,\n            w1 * y2 - x1 * z2 + y1 * w2 + z1 * x2,\n            w1 * z2 + x1 * y2 - y1 * x2 + z1 * w2,\n        );\n    }\n    toEuler(): { x: number; y: number; z: number } {\n        let sig = 0.499;\n        let [qw, qx, qy, qz] = [this.w, this.x, this.y, this.z];\n        let [sqw, sqx, sqy, sqz] = [qw * qw, qx * qx, qy * qy, qz * qz];\n        let unit = sqx + sqz + sqy + sqw;\n        let test = qx * qz + qy * qw;\n        if (test > sig * unit) {\n            return {\n                x: 0,\n                y: Math.PI / 4,\n                z: Math.atan2(qx, qw) * 2,\n            };\n        } else if (test < -sig * unit) {\n            return {\n                x: 0,\n                y: -Math.PI / 4,\n                z: Math.atan2(qx, qw) * 2,\n            };\n        } else {\n            return {\n                x: Math.atan2(2 * (-qy * qz + qx * qw), 1 - 2 * (sqx + sqy)),\n                y: Math.asin(2 * (qx * qz + qy * qw)),\n                z: Math.atan2(2 * (-qx * qy + qz * qw), 1 - 2 * (sqy + sqz)),\n            };\n        }\n    }\n    toMatrix4(): Matrix4 {\n        const x2 = this.x * this.x;\n        const y2 = this.y * this.y;\n        const z2 = this.z * this.z;\n\n        const xx2 = x2 * this.x;\n        const xy2 = x2 * this.y;\n        const xz2 = x2 * this.z;\n\n        const yy2 = y2 * this.y;\n        const yz2 = y2 * this.z;\n        const zz2 = z2 * this.z;\n\n        const sy2 = y2 * this.w;\n        const sz2 = z2 * this.w;\n        const sx2 = x2 * this.w;\n\n        return Matrix4.fromArray([\n            1 - yy2 - zz2,\n            xy2 + sz2,\n            xz2 - sy2,\n            0,\n            xy2 - sz2,\n            1 - xx2 - zz2,\n            yz2 + sx2,\n            0,\n            xz2 + sy2,\n            yz2 - sx2,\n            1 - xx2 - yy2,\n            0,\n            0,\n            0,\n            0,\n            1,\n        ]);\n    }\n    static fromEuler(roll: number, pitch: number, yaw: number): Quaternion {\n        const halfRoll = roll * 0.5;\n        const halfPitch = pitch * 0.5;\n        const halfYaw = yaw * 0.5;\n\n        const cr = Math.cos(halfRoll);\n        const sr = Math.sin(halfRoll);\n        const cp = Math.cos(halfPitch);\n        const sp = Math.sin(halfPitch);\n        const cy = Math.cos(halfYaw);\n        const sy = Math.sin(halfYaw);\n\n        return new Quaternion(\n            -sr * sp * sy + cr * cp * cy,\n            sr * cp * cy + cr * sp * sy,\n            -sr * cp * sy + cr * sp * cy,\n            cr * cp * sy + sr * sp * cy,\n        );\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Serializer } from \"../serialize\";\nimport { MathUtils } from \"./mathUtils\";\nimport { Plane } from \"./plane\";\nimport { Quaternion } from \"./quaternion\";\nimport { XYZ, XYZLike } from \"./xyz\";\n\n/**\n * Matrix in column-major order\n */\n@Serializer.register([\"array\"], (array: Float32Array) => {\n    return Matrix4.fromArray(array);\n})\nexport class Matrix4 {\n    private readonly _array: Float32Array = new Float32Array(16);\n    @Serializer.serialze()\n    get array(): ReadonlyArray<number> {\n        return [...this._array];\n    }\n\n    public determinant(): number {\n        let [a00, a01, a02, a03] = [this._array[0], this._array[1], this._array[2], this._array[3]];\n        let [a10, a11, a12, a13] = [this._array[4], this._array[5], this._array[6], this._array[7]];\n        let [a20, a21, a22, a23] = [this._array[8], this._array[9], this._array[10], this._array[11]];\n        let [a30, a31, a32, a33] = [this._array[12], this._array[13], this._array[14], this._array[15]];\n\n        let b0 = a00 * a11 - a01 * a10;\n        let b1 = a00 * a12 - a02 * a10;\n        let b2 = a01 * a12 - a02 * a11;\n        let b3 = a20 * a31 - a21 * a30;\n        let b4 = a20 * a32 - a22 * a30;\n        let b5 = a21 * a32 - a22 * a31;\n        let b6 = a00 * b5 - a01 * b4 + a02 * b3;\n        let b7 = a10 * b5 - a11 * b4 + a12 * b3;\n        let b8 = a20 * b2 - a21 * b1 + a22 * b0;\n        let b9 = a30 * b2 - a31 * b1 + a32 * b0;\n\n        return a13 * b6 - a03 * b7 + a33 * b8 - a23 * b9;\n    }\n\n    public toArray(): readonly number[] {\n        return [...this._array];\n    }\n\n    public add(other: Matrix4): Matrix4 {\n        let result = new Matrix4();\n        for (let index = 0; index < 16; index++) {\n            result._array[index] = this._array[index] + other._array[index];\n        }\n        return result;\n    }\n\n    public invert(): Matrix4 | undefined {\n        let [a00, a01, a02, a03] = [this._array[0], this._array[1], this._array[2], this._array[3]];\n        let [a10, a11, a12, a13] = [this._array[4], this._array[5], this._array[6], this._array[7]];\n        let [a20, a21, a22, a23] = [this._array[8], this._array[9], this._array[10], this._array[11]];\n        let [a30, a31, a32, a33] = [this._array[12], this._array[13], this._array[14], this._array[15]];\n        let b00 = a00 * a11 - a01 * a10;\n        let b01 = a00 * a12 - a02 * a10;\n        let b02 = a00 * a13 - a03 * a10;\n        let b03 = a01 * a12 - a02 * a11;\n        let b04 = a01 * a13 - a03 * a11;\n        let b05 = a02 * a13 - a03 * a12;\n        let b06 = a20 * a31 - a21 * a30;\n        let b07 = a20 * a32 - a22 * a30;\n        let b08 = a20 * a33 - a23 * a30;\n        let b09 = a21 * a32 - a22 * a31;\n        let b10 = a21 * a33 - a23 * a31;\n        let b11 = a22 * a33 - a23 * a32;\n\n        let det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n        if (det === 0) return undefined;\n        det = 1.0 / det;\n\n        return Matrix4.fromArray([\n            (a11 * b11 - a12 * b10 + a13 * b09) * det,\n            (a02 * b10 - a01 * b11 - a03 * b09) * det,\n            (a31 * b05 - a32 * b04 + a33 * b03) * det,\n            (a22 * b04 - a21 * b05 - a23 * b03) * det,\n            (a12 * b08 - a10 * b11 - a13 * b07) * det,\n            (a00 * b11 - a02 * b08 + a03 * b07) * det,\n            (a32 * b02 - a30 * b05 - a33 * b01) * det,\n            (a20 * b05 - a22 * b02 + a23 * b01) * det,\n            (a10 * b10 - a11 * b08 + a13 * b06) * det,\n            (a01 * b08 - a00 * b10 - a03 * b06) * det,\n            (a30 * b04 - a31 * b02 + a33 * b00) * det,\n            (a21 * b02 - a20 * b04 - a23 * b00) * det,\n            (a11 * b07 - a10 * b09 - a12 * b06) * det,\n            (a00 * b09 - a01 * b07 + a02 * b06) * det,\n            (a31 * b01 - a30 * b03 - a32 * b00) * det,\n            (a20 * b03 - a21 * b01 + a22 * b00) * det,\n        ]);\n    }\n\n    public multiply(other: Matrix4): Matrix4 {\n        const array = new Array(16).fill(0);\n        for (let i = 0; i < 4; i++) {\n            for (let j = 0; j < 4; j++) {\n                for (let k = 0; k < 4; k++) {\n                    array[i * 4 + j] += this._array[i * 4 + k] * other._array[k * 4 + j];\n                }\n            }\n        }\n        return Matrix4.fromArray(array);\n    }\n\n    public equals(value: Matrix4): boolean {\n        for (let i = 0; i < 16; i++) {\n            if (!MathUtils.almostEqual(this._array[i], value._array[i])) return false;\n        }\n        return true;\n    }\n\n    public clone(): Matrix4 {\n        return Matrix4.fromArray([...this._array]);\n    }\n\n    public static fromArray(array: ArrayLike<number>): Matrix4 {\n        let result = new Matrix4();\n        for (let index = 0; index < 16; index++) {\n            result._array[index] = array[index];\n        }\n        return result;\n    }\n\n    public static identity(): Matrix4 {\n        return Matrix4.fromArray([\n            1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0,\n        ]);\n    }\n\n    public static zero(): Matrix4 {\n        return Matrix4.fromArray(new Array(16).fill(0));\n    }\n\n    public static fromEuler(x: number, y: number, z: number): Matrix4 {\n        let cx = Math.cos(x);\n        let sx = Math.sin(x);\n        let cy = Math.cos(y);\n        let sy = Math.sin(y);\n        let cz = Math.cos(z);\n        let sz = Math.sin(z);\n        return Matrix4.fromArray([\n            cy * cz,\n            cx * sz + sx * sy * cz,\n            sx * sz - cx * sy * cz,\n            0,\n            -cy * sz,\n            cx * cz - sx * sy * sz,\n            sx * cz + cx * sy * sz,\n            0,\n            sy,\n            -sx * cy,\n            cx * cy,\n            0,\n            0,\n            0,\n            0,\n            1,\n        ]);\n    }\n\n    public static fromAxisRad(position: XYZLike, normal: XYZLike, radians: number): Matrix4 {\n        const axes = Quaternion.fromAxisAngle(normal, radians).toAxes();\n\n        const { x, y, z } = position;\n        return Matrix4.fromTranslation(-x, -y, -z).multiply(Matrix4.fromArray([...axes, x, y, z, 1]));\n    }\n\n    public static fromScale(x: number, y: number, z: number): Matrix4 {\n        return Matrix4.fromArray([x, 0, 0, 0, 0, y, 0, 0, 0, 0, z, 0, 0, 0, 0, 1]);\n    }\n\n    public static fromTranslation(x: number, y: number, z: number): Matrix4 {\n        return Matrix4.fromArray([1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, x, y, z, 1.0]);\n    }\n\n    public static createMirrorWithPlane(plane: Plane): Matrix4 {\n        let d = -plane.origin.dot(plane.normal);\n        const x = plane.normal.x;\n        const y = plane.normal.y;\n        const z = plane.normal.z;\n        const temp = -2 * x;\n        const temp2 = -2 * y;\n        const temp3 = -2 * z;\n        return Matrix4.fromArray([\n            temp * x + 1,\n            temp2 * x,\n            temp3 * x,\n            0.0,\n            temp * y,\n            temp2 * y + 1,\n            temp3 * y,\n            0.0,\n            temp * z,\n            temp2 * z,\n            temp3 * z + 1,\n            0.0,\n            temp * d,\n            temp2 * d,\n            temp3 * d,\n            1.0,\n        ]);\n    }\n\n    public transpose(): Matrix4 {\n        let result = new Matrix4();\n        result._array[0] = this._array[0];\n        result._array[1] = this._array[4];\n        result._array[2] = this._array[8];\n        result._array[3] = this._array[12];\n\n        result._array[4] = this._array[1];\n        result._array[5] = this._array[5];\n        result._array[6] = this._array[9];\n        result._array[7] = this._array[13];\n\n        result._array[8] = this._array[2];\n        result._array[9] = this._array[6];\n        result._array[10] = this._array[10];\n        result._array[11] = this._array[14];\n\n        result._array[12] = this._array[3];\n        result._array[13] = this._array[7];\n        result._array[14] = this._array[11];\n        result._array[15] = this._array[15];\n\n        return result;\n    }\n\n    ofPoints(points: ArrayLike<number>): number[] {\n        let result: number[] = [];\n        for (let i = 0; i < points.length / 3; i++) {\n            let x =\n                points[3 * i] * this._array[0] +\n                points[3 * i + 1] * this._array[4] +\n                points[3 * i + 2] * this._array[8] +\n                this._array[12];\n            let y =\n                points[3 * i] * this._array[1] +\n                points[3 * i + 1] * this._array[5] +\n                points[3 * i + 2] * this._array[9] +\n                this._array[13];\n            let z =\n                points[3 * i] * this._array[2] +\n                points[3 * i + 1] * this._array[6] +\n                points[3 * i + 2] * this._array[10] +\n                this._array[14];\n            let w =\n                points[3 * i] * this._array[3] +\n                points[3 * i + 1] * this._array[7] +\n                points[3 * i + 2] * this._array[11] +\n                this._array[15];\n            result.push(x / w, y / w, z / w);\n        }\n        return result;\n    }\n\n    public ofPoint(point: XYZLike): XYZ {\n        let result = this.ofPoints([point.x, point.y, point.z]);\n        return new XYZ(result[0], result[1], result[2]);\n    }\n\n    public ofVector(vector: XYZLike): XYZ {\n        let result = this.ofVectors([vector.x, vector.y, vector.z]);\n        return new XYZ(result[0], result[1], result[2]);\n    }\n\n    public ofVectors(vectors: ArrayLike<number>): number[] {\n        let result: number[] = [];\n        for (let i = 0; i < vectors.length / 3; i++) {\n            let x =\n                vectors[3 * i] * this._array[0] +\n                vectors[3 * i + 1] * this._array[4] +\n                vectors[3 * i + 2] * this._array[8];\n            let y =\n                vectors[3 * i] * this._array[1] +\n                vectors[3 * i + 1] * this._array[5] +\n                vectors[3 * i + 2] * this._array[9];\n            let z =\n                vectors[3 * i] * this._array[2] +\n                vectors[3 * i + 1] * this._array[6] +\n                vectors[3 * i + 2] * this._array[10];\n            result.push(x, y, z);\n        }\n        return result;\n    }\n\n    public translationPart(): XYZ {\n        return new XYZ(this._array[12], this._array[13], this._array[14]);\n    }\n\n    public getScale(): XYZ {\n        const x = Math.hypot(this._array[0], this._array[1], this._array[2]);\n        const y = Math.hypot(this._array[4], this._array[5], this._array[6]);\n        const z = Math.hypot(this._array[8], this._array[9], this._array[10]);\n        return new XYZ(x, y, z);\n    }\n\n    public getEulerAngles(): { pitch: number; yaw: number; roll: number } {\n        const m = this._array;\n        const m11 = m[0],\n            m12 = m[4],\n            m13 = m[8];\n        const m22 = m[5],\n            m23 = m[9];\n        const m32 = m[6],\n            m33 = m[10];\n\n        let pitch = 0;\n        let yaw = Math.asin(MathUtils.clamp(m13, -1, 1));\n        let roll = 0;\n\n        if (Math.abs(m13) < 0.9999999) {\n            pitch = Math.atan2(-m23, m33);\n            roll = Math.atan2(-m12, m11);\n        } else {\n            pitch = Math.atan2(m32, m22);\n        }\n\n        return { pitch, yaw, roll };\n    }\n\n    public static createFromTRS(\n        position: XYZLike,\n        rotation: { pitch: number; yaw: number; roll: number },\n        scale: XYZLike,\n    ): Matrix4 {\n        const quaternion = Quaternion.fromEuler(rotation.pitch, rotation.yaw, rotation.roll);\n        const te = new Array(16).fill(0);\n\n        const x = quaternion.x,\n            y = quaternion.y,\n            z = quaternion.z,\n            w = quaternion.w;\n        const x2 = x + x,\n            y2 = y + y,\n            z2 = z + z;\n        const xx = x * x2,\n            xy = x * y2,\n            xz = x * z2;\n        const yy = y * y2,\n            yz = y * z2,\n            zz = z * z2;\n        const wx = w * x2,\n            wy = w * y2,\n            wz = w * z2;\n\n        const sx = scale.x,\n            sy = scale.y,\n            sz = scale.z;\n\n        te[0] = (1 - (yy + zz)) * sx;\n        te[1] = (xy + wz) * sx;\n        te[2] = (xz - wy) * sx;\n        te[3] = 0;\n\n        te[4] = (xy - wz) * sy;\n        te[5] = (1 - (xx + zz)) * sy;\n        te[6] = (yz + wx) * sy;\n        te[7] = 0;\n\n        te[8] = (xz + wy) * sz;\n        te[9] = (yz - wx) * sz;\n        te[10] = (1 - (xx + yy)) * sz;\n        te[11] = 0;\n\n        te[12] = position.x;\n        te[13] = position.y;\n        te[14] = position.z;\n        te[15] = 1;\n\n        return Matrix4.fromArray(te);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Serializer } from \"../serialize\";\nimport { MathUtils } from \"./mathUtils\";\nimport { Matrix4 } from \"./matrix4\";\nimport { Ray } from \"./ray\";\nimport { XYZ } from \"./xyz\";\n\n@Serializer.register([\"origin\", \"normal\", \"xvec\"])\nexport class Plane {\n    static readonly XY: Plane = new Plane(XYZ.zero, XYZ.unitZ, XYZ.unitX);\n    static readonly YZ: Plane = new Plane(XYZ.zero, XYZ.unitX, XYZ.unitY);\n    static readonly ZX: Plane = new Plane(XYZ.zero, XYZ.unitY, XYZ.unitZ);\n\n    @Serializer.serialze()\n    readonly origin: XYZ;\n    /**\n     * unit vector\n     */\n    @Serializer.serialze()\n    readonly normal: XYZ;\n    @Serializer.serialze()\n    readonly xvec: XYZ;\n    readonly yvec: XYZ;\n    constructor(origin: XYZ, normal: XYZ, xvec: XYZ) {\n        this.origin = origin;\n        let n = normal.normalize(),\n            x = xvec.normalize();\n        if (n === undefined || n.isEqualTo(XYZ.zero)) {\n            throw new Error(\"normal can not be zero\");\n        }\n        if (x === undefined || x.isEqualTo(XYZ.zero)) {\n            throw new Error(\"xDirector can not be zero\");\n        }\n        if (n.isParallelTo(x)) {\n            throw new Error(\"xDirector can not parallel normal\");\n        }\n        this.normal = n;\n        this.xvec = x;\n        this.yvec = n.cross(x).normalize()!;\n    }\n\n    translateTo(origin: XYZ) {\n        return new Plane(origin, this.normal, this.xvec);\n    }\n\n    project(point: XYZ): XYZ {\n        const vector = point.sub(this.origin);\n        const dot = vector.dot(this.normal);\n        return this.origin.add(vector.sub(this.normal.multiply(dot)));\n    }\n\n    transformed(matrix: Matrix4) {\n        const location = matrix.ofPoint(this.origin);\n        const x = matrix.ofVector(this.xvec);\n        const normal = matrix.ofVector(this.normal);\n        return new Plane(location, normal, x);\n    }\n\n    intersect(ray: Ray, containsExtension: boolean = true): XYZ | undefined {\n        const vec = this.origin.sub(ray.location);\n        if (vec.isEqualTo(XYZ.zero)) return this.origin;\n        const len = vec.dot(this.normal);\n        const dot = ray.direction.dot(this.normal);\n        if (MathUtils.almostEqual(dot, 0)) return MathUtils.almostEqual(len, 0) ? ray.location : undefined;\n        const t = len / dot;\n        if (!containsExtension && t < 0) return undefined;\n        return ray.location.add(ray.direction.multiply(t));\n    }\n\n    projectDistance(p1: XYZ, p2: XYZ) {\n        let dp1 = this.project(p1);\n        let dp2 = this.project(p2);\n        return dp1.distanceTo(dp2);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Precision } from \"../foundation\";\nimport { Plane } from \"./plane\";\nimport { XYZ } from \"./xyz\";\n\nexport class PlaneAngle {\n    private lastX: number = 1;\n    private lastY: number = 0;\n    private isNegativeRotation: boolean = false;\n    private currentAngle: number = 0;\n\n    get angle() {\n        return this.currentAngle;\n    }\n\n    constructor(readonly plane: Plane) {}\n\n    movePoint(point: XYZ) {\n        const vectorToPoint = point.sub(this.plane.origin);\n        const projectionX = vectorToPoint.dot(this.plane.xvec);\n        const projectionY = vectorToPoint.dot(this.plane.yvec);\n\n        if (this.isCrossingPositiveXAxis(projectionX, projectionY)) {\n            this.isNegativeRotation = !this.isNegativeRotation;\n        }\n\n        this.currentAngle = this.calculateAngle(vectorToPoint);\n        this.updateLastProjections(projectionX, projectionY);\n    }\n\n    private calculateAngle(vector: XYZ): number {\n        const angleInRadians = this.plane.xvec.angleOnPlaneTo(vector, this.plane.normal)!;\n        const angleInDegrees = (angleInRadians * 180) / Math.PI;\n        return this.isNegativeRotation ? angleInDegrees - 360 : angleInDegrees;\n    }\n\n    private isCrossingPositiveXAxis(x: number, y: number): boolean {\n        const isMovingUpward = this.lastY < -Precision.Distance && y > Precision.Distance;\n        const isMovingDownward = this.lastY > -Precision.Distance && y < -Precision.Distance;\n        const isCrossingX =\n            (isMovingUpward && this.currentAngle < Precision.Angle) ||\n            (isMovingDownward && this.currentAngle > -Precision.Angle);\n\n        return isCrossingX && this.lastX > 0 && x > 0;\n    }\n\n    private updateLastProjections(x: number, y: number) {\n        if (Math.abs(x) > Precision.Distance) this.lastX = x;\n        if (Math.abs(y) > Precision.Distance) this.lastY = y;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Serializer } from \"../serialize\";\nimport { Plane } from \"./plane\";\nimport { XYZ } from \"./xyz\";\n\n@Serializer.register([\"location\", \"direction\"])\nexport class Ray {\n    @Serializer.serialze()\n    readonly location: XYZ;\n    /**\n     * unit vector\n     */\n    @Serializer.serialze()\n    readonly direction: XYZ;\n\n    constructor(location: XYZ, direction: XYZ) {\n        this.location = location;\n        const n = direction.normalize();\n        if (n === undefined || n.isEqualTo(XYZ.zero)) {\n            throw new Error(\"direction can not be zero\");\n        }\n        this.direction = n;\n    }\n\n    intersect(right: Ray): XYZ | undefined {\n        if (this.direction.isParallelTo(right.direction)) return undefined;\n        const result = this.nearestTo(right);\n        const vec = result.sub(right.location);\n        return vec.isParallelTo(right.direction) ? result : undefined;\n    }\n\n    distanceTo(right: Ray): number {\n        const neareast1 = this.nearestTo(right);\n        const neareast2 = this.nearestToPoint(neareast1);\n        return neareast1.distanceTo(neareast2);\n    }\n\n    nearestTo(right: Ray): XYZ {\n        const n = right.direction.cross(this.direction).normalize();\n        if (n === undefined) return this.nearestToPoint(right.location);\n        const normal = n.cross(right.direction).normalize()!;\n        const plane = new Plane(right.location, normal, n);\n        return plane.intersect(this)!;\n    }\n\n    nearestToPoint(point: XYZ): XYZ {\n        const vec = point.sub(this.location);\n        const dot = vec.dot(this.direction);\n        return this.location.add(this.direction.multiply(dot));\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Precision } from \"../foundation\";\nimport { Serializer } from \"../serialize\";\nimport { MathUtils } from \"./mathUtils\";\n\nexport type XYLike = { x: number; y: number };\n\n@Serializer.register([\"x\", \"y\"])\nexport class XY {\n    static readonly zero = new XY(0, 0);\n    static readonly unitX = new XY(1, 0);\n    static readonly unitY = new XY(0, 1);\n\n    @Serializer.serialze()\n    readonly x: number;\n    @Serializer.serialze()\n    readonly y: number;\n\n    constructor(x: number, y: number) {\n        this.x = x;\n        this.y = y;\n    }\n\n    cross(right: XY): number {\n        return this.x * right.y - this.y * right.x;\n    }\n\n    dot(right: XY): number {\n        return this.x * right.x + this.y * right.y;\n    }\n\n    divided(scalar: number): XY | undefined {\n        return Math.abs(scalar) < Precision.Float ? undefined : new XY(this.x / scalar, this.y / scalar);\n    }\n\n    reverse(): XY {\n        return new XY(-this.x, -this.y);\n    }\n\n    multiply(scalar: number): XY {\n        return new XY(this.x * scalar, this.y * scalar);\n    }\n\n    sub(right: XY): XY {\n        return new XY(this.x - right.x, this.y - right.y);\n    }\n\n    add(right: XY): XY {\n        return new XY(this.x + right.x, this.y + right.y);\n    }\n\n    normalize(): XY | undefined {\n        const d = this.length();\n        return d < Precision.Float ? undefined : new XY(this.x / d, this.y / d);\n    }\n\n    distanceTo(right: XY): number {\n        const dx = this.x - right.x;\n        const dy = this.y - right.y;\n        return Math.sqrt(dx * dx + dy * dy);\n    }\n\n    static center(p1: XY, p2: XY): XY {\n        return new XY((p1.x + p2.x) / 2, (p1.y + p2.y) / 2);\n    }\n\n    lengthSq(): number {\n        return this.x ** 2 + this.y ** 2;\n    }\n\n    length(): number {\n        return Math.sqrt(this.lengthSq());\n    }\n\n    /**\n     * Computes the angular value in radians between me and right\n     * @param right vector\n     * @returns [0, PI]\n     */\n    angleTo(right: XY): number | undefined {\n        if (this.isEqualTo(XY.zero) || right.isEqualTo(XY.zero)) return undefined;\n        // tan(x) = |a||b|sin(x) / |a||b|cos(x)\n        return Math.atan2(this.cross(right), this.dot(right));\n    }\n\n    isEqualTo(right: XY, tolerance: number = 1e-8) {\n        return (\n            MathUtils.almostEqual(this.x, right.x, tolerance) &&\n            MathUtils.almostEqual(this.y, right.y, tolerance)\n        );\n    }\n\n    isParallelTo(right: XY, tolerance: number = 1e-8): boolean | undefined {\n        const angle = this.angleTo(right);\n        return angle === undefined ? undefined : angle <= tolerance || Math.PI - angle <= tolerance;\n    }\n\n    isOppositeTo(right: XY, tolerance: number = 1e-8): boolean | undefined {\n        const angle = this.angleTo(right);\n        return angle === undefined ? undefined : Math.PI - angle <= tolerance;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IDocument } from \"./document\";\nimport { HistoryObservable, Id } from \"./foundation\";\nimport { XY } from \"./math\";\nimport { Property } from \"./property\";\nimport { Serializer } from \"./serialize\";\n\n@Serializer.register([\"document\"])\nexport class Texture extends HistoryObservable {\n    @Serializer.serialze()\n    @Property.define(\"material.texture.image\")\n    get image(): string {\n        return this.getPrivateValue(\"image\", \"\");\n    }\n    set image(value: string) {\n        this.setProperty(\"image\", value);\n    }\n\n    @Serializer.serialze()\n    get wrapS(): number {\n        return this.getPrivateValue(\"wrapS\", 1000);\n    }\n    set wrapS(value: number) {\n        this.setProperty(\"wrapS\", value);\n    }\n\n    @Serializer.serialze()\n    get wrapT(): number {\n        return this.getPrivateValue(\"wrapT\", 1000);\n    }\n    set wrapT(value: number) {\n        this.setProperty(\"wrapT\", value);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"material.texture.rotation\")\n    get rotation(): number {\n        return this.getPrivateValue(\"rotation\", 0);\n    }\n    set rotation(value: number) {\n        this.setProperty(\"rotation\", value);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"material.texture.offset\")\n    get offset(): XY {\n        return this.getPrivateValue(\"offset\", new XY(0, 0));\n    }\n    set offset(value: XY) {\n        this.setProperty(\"offset\", value);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"material.texture.repeat\")\n    get repeat(): XY {\n        return this.getPrivateValue(\"repeat\", new XY(1, 1));\n    }\n    set repeat(value: XY) {\n        this.setProperty(\"repeat\", value);\n    }\n\n    @Serializer.serialze()\n    center: XY = new XY(0.5, 0.5);\n}\n\n@Serializer.register([\"document\", \"name\", \"color\", \"id\"])\nexport class Material extends HistoryObservable {\n    @Serializer.serialze()\n    vertexColors = false;\n\n    @Serializer.serialze()\n    transparent = true;\n\n    @Serializer.serialze()\n    readonly id: string;\n\n    @Serializer.serialze()\n    @Property.define(\"common.name\")\n    get name(): string {\n        return this.getPrivateValue(\"name\");\n    }\n    set name(value: string) {\n        this.setProperty(\"name\", value);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"common.color\", { type: \"color\" })\n    get color(): number | string {\n        return this.getPrivateValue(\"color\");\n    }\n    set color(value: number | string) {\n        this.setProperty(\"color\", value);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"common.opacity\")\n    get opacity(): number {\n        return this.getPrivateValue(\"opacity\", 1);\n    }\n    set opacity(value: number) {\n        this.setProperty(\"opacity\", value);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"material.map\")\n    get map(): Texture {\n        return this.getPrivateValue(\"map\", new Texture(this.document));\n    }\n    set map(value: Texture) {\n        this.setProperty(\"map\", value);\n    }\n\n    constructor(document: IDocument, name: string, color: number | string, id: string = Id.generate()) {\n        super(document);\n        this.id = id;\n        this.setPrivateValue(\"name\", name?.length > 0 ? name : \"unnamed\");\n        this.setPrivateValue(\"color\", color);\n    }\n\n    clone(): Material {\n        let material = new Material(this.document, `${this.name} clone`, this.color);\n        material.setPrivateValue(\"map\", this.map);\n\n        return material;\n    }\n}\n\n@Serializer.register([\"document\", \"name\", \"color\", \"id\"])\nexport class PhongMaterial extends Material {\n    @Serializer.serialze()\n    @Property.define(\"material.specular\", { type: \"color\" })\n    get specular(): number | string {\n        return this.getPrivateValue(\"specular\", 0x111111);\n    }\n    set specular(value: number | string) {\n        this.setProperty(\"specular\", value);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"material.shininess\")\n    get shininess(): number {\n        return this.getPrivateValue(\"shininess\", 30);\n    }\n    set shininess(value: number) {\n        this.setProperty(\"shininess\", value);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"material.emissive\", { type: \"color\" })\n    get emissive(): number | string {\n        return this.getPrivateValue(\"emissive\", 0x000000);\n    }\n    set emissive(value: number | string) {\n        this.setProperty(\"emissive\", value);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"material.specularMap\")\n    get specularMap(): Texture {\n        return this.getPrivateValue(\"specularMap\", new Texture(this.document));\n    }\n    set specularMap(value: Texture) {\n        this.setProperty(\"specularMap\", value);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"material.bumpMap\")\n    get bumpMap(): Texture {\n        return this.getPrivateValue(\"bumpMap\", new Texture(this.document));\n    }\n    set bumpMap(value: Texture) {\n        this.setProperty(\"bumpMap\", value);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"material.normalMap\")\n    get normalMap(): Texture {\n        return this.getPrivateValue(\"normalMap\", new Texture(this.document));\n    }\n    set normalMap(value: Texture) {\n        this.setProperty(\"normalMap\", value);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"material.emissiveMap\")\n    get emissiveMap(): Texture {\n        return this.getPrivateValue(\"emissiveMap\", new Texture(this.document));\n    }\n    set emissiveMap(value: Texture) {\n        this.setProperty(\"emissiveMap\", value);\n    }\n}\n\n@Serializer.register([\"document\", \"name\", \"color\", \"id\"])\nexport class PhysicalMaterial extends Material {\n    @Serializer.serialze()\n    @Property.define(\"material.metalness\")\n    get metalness(): number {\n        return this.getPrivateValue(\"metalness\", 0);\n    }\n    set metalness(value: number) {\n        this.setProperty(\"metalness\", value);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"material.metalnessMap\")\n    get metalnessMap(): Texture {\n        return this.getPrivateValue(\"metalnessMap\", new Texture(this.document));\n    }\n    set metalnessMap(value: Texture) {\n        this.setProperty(\"metalnessMap\", value);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"material.roughness\")\n    get roughness(): number {\n        return this.getPrivateValue(\"roughness\", 1);\n    }\n    set roughness(value: number) {\n        this.setProperty(\"roughness\", value);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"material.roughnessMap\")\n    get roughnessMap(): Texture {\n        return this.getPrivateValue(\"roughnessMap\", new Texture(this.document));\n    }\n    set roughnessMap(value: Texture) {\n        this.setProperty(\"roughnessMap\", value);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"material.emissive\", { type: \"color\" })\n    get emissive(): number | string {\n        return this.getPrivateValue(\"emissive\", 0x000000);\n    }\n    set emissive(value: number | string) {\n        this.setProperty(\"emissive\", value);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"material.bumpMap\")\n    get bumpMap(): Texture {\n        return this.getPrivateValue(\"bumpMap\", new Texture(this.document));\n    }\n    set bumpMap(value: Texture) {\n        this.setProperty(\"bumpMap\", value);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"material.normalMap\")\n    get normalMap(): Texture {\n        return this.getPrivateValue(\"normalMap\", new Texture(this.document));\n    }\n    set normalMap(value: Texture) {\n        this.setProperty(\"normalMap\", value);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"material.emissiveMap\")\n    get emissiveMap(): Texture {\n        return this.getPrivateValue(\"emissiveMap\", new Texture(this.document));\n    }\n    set emissiveMap(value: Texture) {\n        this.setProperty(\"emissiveMap\", value);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IDocument } from \"../document\";\nimport { HistoryObservable, IDisposable, IPropertyChanged, Id } from \"../foundation\";\nimport { Property } from \"../property\";\nimport { Serialized, Serializer } from \"../serialize\";\n\nexport interface INode extends IPropertyChanged, IDisposable {\n    readonly id: string;\n    visible: boolean;\n    parentVisible: boolean;\n    name: string;\n    parent: INodeLinkedList | undefined;\n    previousSibling: INode | undefined;\n    nextSibling: INode | undefined;\n    clone(): this;\n}\n\nexport interface INodeLinkedList extends INode {\n    get firstChild(): INode | undefined;\n    get lastChild(): INode | undefined;\n    add(...items: INode[]): void;\n    remove(...items: INode[]): void;\n    transfer(...items: INode[]): void;\n    size(): number;\n    insertAfter(target: INode | undefined, node: INode): void;\n    insertBefore(target: INode | undefined, node: INode): void;\n    move(child: INode, newParent: this, newPreviousSibling?: INode): void;\n}\n\nexport namespace INode {\n    export function isLinkedListNode(node: INode): node is INodeLinkedList {\n        return (node as INodeLinkedList).add !== undefined;\n    }\n}\n\nexport abstract class Node extends HistoryObservable implements INode {\n    parent: INodeLinkedList | undefined;\n    previousSibling: INode | undefined;\n    nextSibling: INode | undefined;\n\n    @Serializer.serialze()\n    readonly id: string;\n\n    constructor(document: IDocument, name: string, id: string) {\n        super(document);\n        this.id = id;\n        this.setPrivateValue(\"name\", name || \"untitled\");\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"common.name\")\n    get name() {\n        return this.getPrivateValue(\"name\");\n    }\n    set name(value: string) {\n        this.setProperty(\"name\", value);\n    }\n\n    @Serializer.serialze()\n    get visible(): boolean {\n        return this.getPrivateValue(\"visible\", true);\n    }\n    set visible(value: boolean) {\n        this.setProperty(\"visible\", value, () => this.onVisibleChanged());\n    }\n\n    protected abstract onVisibleChanged(): void;\n\n    get parentVisible() {\n        return this.getPrivateValue(\"parentVisible\", true);\n    }\n    set parentVisible(value: boolean) {\n        this.setProperty(\"parentVisible\", value, () => this.onParentVisibleChanged());\n    }\n\n    override disposeInternal(): void {\n        this.document.visual.context.removeNode([this]);\n        super.disposeInternal();\n    }\n\n    clone(): this {\n        const oldValue = this.document.history.disabled;\n        try {\n            this.document.history.disabled = true;\n            let serialized = Serializer.serializeObject(this);\n            serialized.properties[\"id\"] = Id.generate();\n            serialized.properties[\"name\"] = `${this.name}_copy`;\n            return Serializer.deserializeObject(this.document, serialized) as this;\n        } finally {\n            this.document.history.disabled = oldValue;\n        }\n    }\n\n    protected abstract onParentVisibleChanged(): void;\n}\n\nexport namespace INode {\n    export function getNodesBetween(node1: INode, node2: INode): INode[] {\n        if (node1 === node2) return [node1];\n        let nodes: INode[] = [];\n        let prePath = getPathToRoot(node1);\n        let curPath = getPathToRoot(node2);\n        let index = getCommonParentIndex(prePath, curPath);\n        let parent = prePath.at(1 - index) as INodeLinkedList;\n        if (parent === curPath[0] || parent === prePath[0]) {\n            let child = parent === curPath[0] ? prePath[0] : curPath[0];\n            getNodesFromParentToChild(nodes, parent, child);\n        } else if (currentAtBack(prePath.at(-index)!, curPath.at(-index)!)) {\n            getNodesFromPath(nodes, prePath, curPath, index);\n        } else {\n            getNodesFromPath(nodes, curPath, prePath, index);\n        }\n        return nodes;\n    }\n\n    function getNodesFromPath(nodes: INode[], path1: INode[], path2: INode[], commonIndex: number) {\n        nodeOrChildrenAppendToNodes(nodes, path1[0]);\n        path1ToCommonNodes(nodes, path1, commonIndex);\n        commonToPath2Nodes(nodes, path1, path2, commonIndex);\n    }\n\n    function path1ToCommonNodes(nodes: INode[], path1: INode[], commonIndex: number) {\n        for (let i = 0; i < path1.length - commonIndex; i++) {\n            let next = path1[i].nextSibling;\n            while (next !== undefined) {\n                INode.nodeOrChildrenAppendToNodes(nodes, next);\n                next = next.nextSibling;\n            }\n        }\n    }\n\n    function commonToPath2Nodes(nodes: INode[], path1: INode[], path2: INode[], commonIndex: number) {\n        let nextParent = path1.at(-commonIndex)?.nextSibling;\n        while (nextParent) {\n            if (nextParent === path2[0]) {\n                nodes.push(path2[0]);\n                return;\n            }\n            if (INode.isLinkedListNode(nextParent)) {\n                if (getNodesFromParentToChild(nodes, nextParent, path2[0])) {\n                    return;\n                }\n            } else {\n                nodes.push(nextParent);\n            }\n            nextParent = nextParent.nextSibling;\n        }\n    }\n\n    export function nodeOrChildrenAppendToNodes(nodes: INode[], node: INode) {\n        if (INode.isLinkedListNode(node)) {\n            getNodesFromParentToChild(nodes, node);\n        } else {\n            nodes.push(node);\n        }\n    }\n\n    export function findTopLevelNodes(nodes: Set<INode>) {\n        let result: INode[] = [];\n        for (const node of nodes) {\n            if (!containsDescendant(nodes, node)) {\n                result.push(node);\n            }\n        }\n        return result;\n    }\n\n    export function containsDescendant(nodes: Set<INode>, node: INode): boolean {\n        if (node.parent === undefined) return false;\n        if (nodes.has(node.parent)) return true;\n        return containsDescendant(nodes, node.parent);\n    }\n\n    function getNodesFromParentToChild(nodes: INode[], parent: INodeLinkedList, until?: INode): boolean {\n        nodes.push(parent);\n        let node = parent.firstChild;\n        while (node !== undefined) {\n            if (until === node) {\n                nodes.push(node);\n                return true;\n            }\n\n            if (INode.isLinkedListNode(node)) {\n                if (getNodesFromParentToChild(nodes, node, until)) return true;\n            } else {\n                nodes.push(node);\n            }\n            node = node.nextSibling;\n        }\n        return false;\n    }\n\n    function currentAtBack(preNode: INode, curNode: INode) {\n        while (preNode.nextSibling !== undefined) {\n            if (preNode.nextSibling === curNode) return true;\n            preNode = preNode.nextSibling;\n        }\n        return false;\n    }\n\n    function getCommonParentIndex(prePath: INode[], curPath: INode[]) {\n        let index = 1;\n        for (index; index <= Math.min(prePath.length, curPath.length); index++) {\n            if (prePath.at(-index) !== curPath.at(-index)) break;\n        }\n        if (prePath.at(1 - index) !== curPath.at(1 - index)) throw new Error(\"can not find a common parent\");\n        return index;\n    }\n\n    function getPathToRoot(node: INode): INode[] {\n        let path: INode[] = [];\n        let parent: INode | undefined = node;\n        while (parent !== undefined) {\n            path.push(parent);\n            parent = parent.parent;\n        }\n        return path;\n    }\n}\n\nexport namespace NodeSerializer {\n    export function serialize(node: INode) {\n        let nodes: Serialized[] = [];\n        serializeNodeToArray(nodes, node, undefined);\n        return nodes;\n    }\n\n    function serializeNodeToArray(nodes: Serialized[], node: INode, parentId: string | undefined) {\n        let serialized: any = Serializer.serializeObject(node);\n        if (parentId) serialized[\"parentId\"] = parentId;\n        nodes.push(serialized);\n\n        if (INode.isLinkedListNode(node) && node.firstChild) {\n            serializeNodeToArray(nodes, node.firstChild, node.id);\n        }\n        if (node.nextSibling) {\n            serializeNodeToArray(nodes, node.nextSibling, parentId);\n        }\n        return nodes;\n    }\n\n    export async function deserialize(document: IDocument, nodes: Serialized[]) {\n        let nodeMap: Map<string, INodeLinkedList> = new Map();\n        nodes.forEach((n) => {\n            let node = Serializer.deserializeObject(document, n);\n            if (INode.isLinkedListNode(node)) {\n                nodeMap.set(n.properties[\"id\"], node);\n            }\n            let parentId = (n as any)[\"parentId\"];\n            if (!parentId) return;\n            if (nodeMap.has(parentId)) {\n                nodeMap.get(parentId)!.add(node);\n            } else {\n                console.warn(\"parent not found: \" + parentId);\n            }\n        });\n        return Promise.resolve(nodeMap.get(nodes[0].properties[\"id\"]));\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { I18nKeys } from \"../i18n\";\nimport { BoundingBox, Matrix4 } from \"../math\";\nimport { Serializer } from \"../serialize\";\nimport { Node } from \"./node\";\n\nexport abstract class VisualNode extends Node {\n    abstract display(): I18nKeys;\n\n    @Serializer.serialze()\n    get transform(): Matrix4 {\n        return this.getPrivateValue(\"transform\", Matrix4.identity());\n    }\n    set transform(value: Matrix4) {\n        this.setProperty(\"transform\", value, undefined, {\n            equals: (left, right) => left.equals(right),\n        });\n    }\n\n    worldTransform(): Matrix4 {\n        const visual = this.document.visual.context.getVisual(this);\n        if (visual) {\n            return visual.worldTransform();\n        }\n        return this.transform;\n    }\n\n    protected onVisibleChanged(): void {\n        this.document.visual.context.setVisible(this, this.visible && this.parentVisible);\n    }\n\n    protected onParentVisibleChanged(): void {\n        this.document.visual.context.setVisible(this, this.visible && this.parentVisible);\n    }\n\n    abstract boundingBox(): BoundingBox | undefined;\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IDocument } from \"../document\";\nimport { Id } from \"../foundation\";\nimport { I18nKeys } from \"../i18n\";\nimport { BoundingBox } from \"../math\";\nimport { Property } from \"../property\";\nimport { Serializer } from \"../serialize\";\nimport { Mesh } from \"../shape\";\nimport { VisualNode } from \"./visualNode\";\n\n@Serializer.register([\"document\", \"mesh\", \"name\", \"id\"])\nexport class MeshNode extends VisualNode {\n    override display(): I18nKeys {\n        return \"body.meshNode\";\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"common.material\", { type: \"materialId\" })\n    get materialId(): string | string[] {\n        return this.getPrivateValue(\"materialId\");\n    }\n    set materialId(value: string | string[]) {\n        this.setProperty(\"materialId\", value);\n    }\n\n    protected _mesh: Mesh;\n    @Serializer.serialze()\n    get mesh(): Mesh {\n        return this._mesh;\n    }\n    set mesh(value: Mesh) {\n        this.setProperty(\"mesh\", value);\n    }\n\n    constructor(\n        document: IDocument,\n        mesh: Mesh,\n        name: string,\n        materialId?: string | string[],\n        id: string = Id.generate(),\n    ) {\n        super(document, name, id);\n        this._mesh = mesh;\n        this.setPrivateValue(\"materialId\", materialId ?? document.materials.at(0)?.id ?? \"\");\n    }\n\n    override boundingBox(): BoundingBox | undefined {\n        let points = this.transform.ofPoints(this.mesh.position!);\n        return BoundingBox.fromNumbers(points);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { MeshUtils } from \"chili-geo\";\nimport { IDocument } from \"../document\";\nimport { Id, PropertyHistoryRecord, Transaction } from \"../foundation\";\nimport { BoundingBox } from \"../math\";\nimport { Property } from \"../property\";\nimport { Serializer } from \"../serialize\";\nimport { FaceMeshData, IShapeMeshData } from \"../shape\";\nimport { VisualNode } from \"./visualNode\";\n\n@Serializer.register([\"faceIndex\", \"materialIndex\"])\nexport class FaceMaterialPair {\n    @Serializer.serialze()\n    faceIndex: number;\n\n    @Serializer.serialze()\n    materialIndex: number;\n    constructor(faceIndex: number, materialIndex: number) {\n        this.faceIndex = faceIndex;\n        this.materialIndex = materialIndex;\n    }\n}\n\nexport abstract class GeometryNode extends VisualNode {\n    @Serializer.serialze()\n    @Property.define(\"common.material\", { type: \"materialId\" })\n    get materialId(): string | string[] {\n        return this.getPrivateValue(\"materialId\");\n    }\n    set materialId(value: string | string[]) {\n        this.setProperty(\"materialId\", value);\n    }\n\n    protected _originFaceMesh?: FaceMeshData;\n\n    @Serializer.serialze()\n    get faceMaterialPair(): FaceMaterialPair[] {\n        return this.getPrivateValue(\"faceMaterialPair\", []);\n    }\n    set faceMaterialPair(value: FaceMaterialPair[]) {\n        const oldMaterisl = Array.isArray(this.materialId) ? [...this.materialId] : this.materialId;\n        const Face = [...this.faceMaterialPair];\n        this.setProperty(\"faceMaterialPair\", value, () => this.updateVisual(oldMaterisl, Face));\n    }\n\n    constructor(\n        document: IDocument,\n        name: string,\n        materialId?: string | string[],\n        id: string = Id.generate(),\n    ) {\n        super(document, name, id);\n        this.setPrivateValue(\"materialId\", materialId ?? document.materials.at(0)?.id ?? \"\");\n    }\n\n    protected _mesh: IShapeMeshData | undefined;\n    get mesh(): IShapeMeshData {\n        this._mesh ??= this.createMesh();\n        return this._mesh as any;\n    }\n\n    override boundingBox(): BoundingBox | undefined {\n        let points = this.mesh.faces?.position;\n        if (!points || points.length === 0) {\n            points = this.mesh.edges?.position;\n        }\n\n        if (!points || points.length === 0) {\n            return undefined;\n        }\n        return BoundingBox.fromNumbers(this.transform.ofPoints(points));\n    }\n\n    override disposeInternal(): void {\n        super.disposeInternal();\n        this._mesh = undefined;\n    }\n\n    private copyOldValue() {\n        const oldMaterial = Array.isArray(this.materialId) ? [...this.materialId] : this.materialId;\n        const oldFacePair = [...this.faceMaterialPair];\n        return {\n            oldFacePair,\n            oldMaterial,\n        };\n    }\n\n    addFaceMaterial(pairs: { faceIndex: number; materialId: string }[]) {\n        const { oldFacePair, oldMaterial } = this.copyOldValue();\n        pairs.forEach(({ faceIndex, materialId }) => {\n            if (this.materialId === materialId) {\n                return;\n            }\n\n            if (this._mesh?.faces?.range.length === 1) {\n                this.setPrivateValue(\"materialId\", materialId);\n                return;\n            }\n\n            if (typeof this.materialId === \"string\") {\n                this.setPrivateValue(\"materialId\", [this.materialId, materialId]);\n            }\n\n            const index = this.materialId.indexOf(materialId);\n            if (index === -1) {\n                (this.materialId as string[]).push(materialId);\n                this.faceMaterialPair.push(new FaceMaterialPair(faceIndex, this.materialId.length - 1));\n            } else {\n                this.faceMaterialPair.push(new FaceMaterialPair(faceIndex, index));\n            }\n        });\n        this.updateVisual(oldMaterial, oldFacePair);\n    }\n\n    removeFaceMaterial(faceIndexs: number[]) {\n        const { oldFacePair, oldMaterial } = this.copyOldValue();\n        const toDelete = this.faceMaterialPair.filter((x) => faceIndexs.includes(x.faceIndex));\n        this.setPrivateValue(\n            \"faceMaterialPair\",\n            this.faceMaterialPair.filter((x) => !faceIndexs.includes(x.faceIndex)),\n        );\n        toDelete.forEach((pair) => {\n            const hasSameMaterial = this.faceMaterialPair.some(\n                (x) => x.materialIndex === pair.materialIndex,\n            );\n            if (hasSameMaterial || !Array.isArray(this.materialId)) {\n                return;\n            }\n            this.materialId.splice(pair.materialIndex, 1);\n            if (this.materialId.length === 1) {\n                this.setPrivateValue(\"materialId\", this.materialId[0]);\n            } else if (this.materialId.length > 1) {\n                this.faceMaterialPair.forEach((x) => {\n                    if (x.materialIndex > pair.materialIndex) {\n                        x.materialIndex--;\n                    }\n                });\n            }\n        });\n\n        this.updateVisual(oldMaterial, oldFacePair);\n    }\n\n    clearFaceMaterial() {\n        const { oldFacePair, oldMaterial } = this.copyOldValue();\n\n        if (Array.isArray(this.materialId)) {\n            this.setPrivateValue(\"materialId\", this.materialId[0]);\n        }\n        this.setPrivateValue(\"faceMaterialPair\", []);\n\n        this.updateVisual(oldMaterial, oldFacePair);\n    }\n\n    private readonly updateVisual = (oldMaterisl: string | string[], oldFacePair: FaceMaterialPair[]) => {\n        if (!this._originFaceMesh) return;\n        if (this.faceMaterialPair.length === 0) {\n            this._mesh!.faces = this._originFaceMesh;\n        } else {\n            this._mesh!.faces = MeshUtils.mergeFaceMesh(\n                this._originFaceMesh,\n                this.faceMaterialPair.map((x) => [x.faceIndex, x.materialIndex] as [number, number]),\n            );\n            if (this._mesh!.faces.groups.length === 1) {\n                this.setPrivateValue(\"materialId\", this.materialId[this.faceMaterialPair[0].materialIndex]);\n            }\n        }\n\n        this.emitPropertyChanged(\"materialId\", oldMaterisl);\n        this.emitPropertyChanged(\"faceMaterialPair\", oldFacePair);\n        const newMaterisl = Array.isArray(this.materialId) ? [...this.materialId] : this.materialId;\n        Transaction.add(\n            this.document,\n            new PropertyHistoryRecord(this, \"materialId\", oldMaterisl, newMaterisl),\n        );\n        Transaction.add(\n            this.document,\n            new PropertyHistoryRecord(this, \"faceMaterialPair\", oldFacePair, [...this.faceMaterialPair]),\n        );\n\n        this.document.visual.context.redrawNode([this]);\n    };\n\n    protected abstract createMesh(): IShapeMeshData;\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { MeshUtils } from \"chili-geo\";\nimport { VisualConfig } from \"../config\";\nimport { IDocument } from \"../document\";\nimport { Id, IEqualityComparer, PubSub, Result } from \"../foundation\";\nimport { I18n, I18nKeys } from \"../i18n\";\nimport { Matrix4 } from \"../math\";\nimport { Serializer } from \"../serialize\";\nimport { EdgeMeshData, FaceMeshData, IShape, IShapeMeshData, LineType } from \"../shape\";\nimport { GeometryNode } from \"./geometryNode\";\n\nexport abstract class ShapeNode extends GeometryNode {\n    protected _shape: Result<IShape> = Result.err(SHAPE_UNDEFINED);\n    get shape(): Result<IShape> {\n        return this._shape;\n    }\n\n    protected setShape(shape: Result<IShape>) {\n        if (this._shape.isOk && this._shape.value.isEqual(shape.value)) {\n            return;\n        }\n\n        if (!shape.isOk) {\n            PubSub.default.pub(\"displayError\", shape.error);\n            return;\n        }\n\n        let oldShape = this._shape;\n        this._shape = shape;\n        this._mesh = undefined;\n\n        this.emitPropertyChanged(\"shape\", oldShape);\n\n        oldShape.unchecked()?.dispose();\n    }\n\n    protected override createMesh(): IShapeMeshData {\n        if (!this.shape.isOk) {\n            throw new Error(this.shape.error);\n        }\n        const mesh = this.shape.value.mesh;\n        this._originFaceMesh = mesh.faces;\n        if (mesh.faces)\n            mesh.faces = MeshUtils.mergeFaceMesh(\n                mesh.faces,\n                this.faceMaterialPair.map((x) => [x.faceIndex, x.materialIndex]),\n            );\n        return mesh;\n    }\n\n    override disposeInternal(): void {\n        super.disposeInternal();\n        this._shape.unchecked()?.dispose();\n        this._shape = null as any;\n    }\n}\n\nexport class MultiShapeMesh implements IShapeMeshData {\n    private readonly _edges: EdgeMeshData;\n    private readonly _faces: FaceMeshData;\n\n    get edges() {\n        return this._edges.position.length > 0 ? this._edges : undefined;\n    }\n\n    get faces() {\n        return this._faces.position.length > 0 ? this._faces : undefined;\n    }\n\n    constructor() {\n        this._edges = {\n            lineType: LineType.Solid,\n            position: new Float32Array(),\n            range: [],\n            color: VisualConfig.defaultEdgeColor,\n        };\n\n        this._faces = {\n            index: new Uint32Array(),\n            normal: new Float32Array(),\n            position: new Float32Array(),\n            uv: new Float32Array(),\n            range: [],\n            groups: [],\n            color: VisualConfig.defaultFaceColor,\n        };\n    }\n\n    public addShape(shape: IShape, matrix: Matrix4) {\n        const mesh = shape.mesh;\n        const totleMatrix = shape.matrix.multiply(matrix);\n        if (mesh.faces) {\n            MeshUtils.combineFaceMeshData(this._faces, mesh.faces, totleMatrix);\n        }\n        if (mesh.edges) {\n            MeshUtils.combineEdgeMeshData(this._edges, mesh.edges, totleMatrix);\n        }\n    }\n}\n\n@Serializer.register([\"document\", \"name\", \"shapes\", \"materialId\", \"id\"])\nexport class MultiShapeNode extends GeometryNode {\n    private readonly _shapes: IShape[];\n    @Serializer.serialze()\n    get shapes(): ReadonlyArray<IShape> {\n        return this._shapes;\n    }\n\n    constructor(\n        document: IDocument,\n        name: string,\n        shapes: IShape[],\n        materialId?: string,\n        id: string = Id.generate(),\n    ) {\n        super(document, name, materialId, id);\n        this._shapes = shapes;\n    }\n\n    protected override createMesh(): IShapeMeshData {\n        const meshes = new MultiShapeMesh();\n\n        this._shapes.forEach((shape) => {\n            meshes.addShape(shape, Matrix4.identity());\n        });\n\n        return meshes;\n    }\n\n    override display(): I18nKeys {\n        return \"body.multiShape\";\n    }\n}\n\nconst SHAPE_UNDEFINED = \"Shape not initialized\";\nexport abstract class ParameterShapeNode extends ShapeNode {\n    override get shape(): Result<IShape> {\n        if (!this._shape.isOk && this._shape.error === SHAPE_UNDEFINED) {\n            this._shape = this.generateShape();\n        }\n        return this._shape;\n    }\n\n    protected setPropertyEmitShapeChanged<K extends keyof this>(\n        property: K,\n        newValue: this[K],\n        onPropertyChanged?: (property: K, oldValue: this[K]) => void,\n        equals?: IEqualityComparer<this[K]> | undefined,\n    ): boolean {\n        if (this.setProperty(property, newValue, onPropertyChanged, equals)) {\n            this.setShape(this.generateShape());\n            return true;\n        }\n\n        return false;\n    }\n\n    constructor(document: IDocument, materialId?: string, id?: string) {\n        super(document, undefined as any, materialId, id);\n        this.setPrivateValue(\"name\", I18n.translate(this.display()));\n    }\n\n    protected abstract generateShape(): Result<IShape>;\n}\n\n@Serializer.register([\"document\", \"name\", \"shape\", \"materialId\", \"id\"])\nexport class EditableShapeNode extends ShapeNode {\n    override display(): I18nKeys {\n        return \"body.editableShape\";\n    }\n\n    @Serializer.serialze()\n    override get shape() {\n        return this._shape;\n    }\n\n    override set shape(shape: Result<IShape>) {\n        this.setShape(shape);\n    }\n\n    constructor(\n        document: IDocument,\n        name: string,\n        shape: IShape | Result<IShape>,\n        materialId?: string | string[],\n        id?: string,\n    ) {\n        super(document, name, materialId, id);\n        this._shape = shape instanceof Result ? shape : Result.ok(shape);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 Licensettt.\n// See LICENSE file in the project root for full license information.\n\nimport { MeshUtils } from \"chili-geo\";\nimport { IDocument } from \"../document\";\nimport { Id } from \"../foundation\";\nimport { I18nKeys } from \"../i18n\";\nimport { BoundingBox, Matrix4, XYZ } from \"../math\";\nimport { Property } from \"../property\";\nimport { Serializer } from \"../serialize\";\nimport { EdgeMeshData, FaceMeshData, LineType, Mesh } from \"../shape\";\nimport { MeshNode } from \"./meshNode\";\nimport { INode } from \"./node\";\nimport { ShapeNode } from \"./shapeNode\";\nimport { VisualNode } from \"./visualNode\";\n\nexport type ComponentMesh = {\n    faceMaterials: string[];\n    edge: EdgeMeshData;\n    face: FaceMeshData;\n    linesegments: Mesh;\n    surfaceMaterials: string[];\n    surface: Mesh;\n};\n\nexport function createComponentMesh(size: ComponentSize): ComponentMesh {\n    return {\n        faceMaterials: [],\n        edge: {\n            lineType: LineType.Solid,\n            position: new Float32Array(size.edge * 3),\n            range: [],\n        },\n        face: {\n            index: new Uint32Array(size.faceIndex),\n            normal: new Float32Array(size.facePosition * 3),\n            position: new Float32Array(size.facePosition * 3),\n            uv: new Float32Array(size.facePosition * 2),\n            range: [],\n            groups: [],\n        },\n        linesegments: Mesh.createLineSegments(size.lineSegment),\n        surfaceMaterials: [],\n        surface: Mesh.createSurface(size.meshPosition, size.meshIndex > 0 ? size.meshIndex : size.meshPosition * 3),\n    };\n}\n\nexport type ComponentSize = {\n    facePosition: number;\n    faceIndex: number;\n    edge: number;\n    lineSegment: number;\n    meshPosition: number;\n    meshIndex: number;\n};\n\nexport function createComponentSize(): ComponentSize {\n    return {\n        facePosition: 0,\n        faceIndex: 0,\n        edge: 0,\n        lineSegment: 0,\n        meshIndex: 0,\n        meshPosition: 0,\n    };\n}\n\n@Serializer.register([\"name\", \"nodes\", \"origin\", \"id\"])\nexport class Component {\n    private readonly _nodes: ReadonlyArray<VisualNode>;\n    @Serializer.serialze()\n    get nodes(): ReadonlyArray<VisualNode> {\n        return this._nodes;\n    }\n\n    private readonly _name: string;\n    @Serializer.serialze()\n    get name(): string {\n        return this._name;\n    }\n\n    @Serializer.serialze()\n    readonly id: string;\n\n    private _origin: XYZ;\n    @Serializer.serialze()\n    get origin(): XYZ {\n        return this._origin;\n    }\n    set origin(value: XYZ) {\n        this._origin = value;\n    }\n\n    private _boundingBox?: BoundingBox;\n    get boundingBox(): BoundingBox | undefined {\n        this._boundingBox ??= this.computeBoundingBox();\n        return this._boundingBox;\n    }\n\n    private _mesh?: ComponentMesh;\n    get mesh(): ComponentMesh {\n        this._mesh ??= this.mergeMesh();\n        return this._mesh;\n    }\n\n    public instances: ComponentNode[] = [];\n\n    constructor(name: string, nodes: ReadonlyArray<VisualNode>, origin?: XYZ, id = Id.generate()) {\n        this._name = name;\n        this._nodes = nodes;\n        this.id = id;\n        this._origin = origin ?? BoundingBox.center(this.boundingBox);\n    }\n\n    toString(): string {\n        return this.name;\n    }\n\n    private mergeMesh() {\n        const size: ComponentSize = createComponentSize();\n        this.getSize(this._nodes, size);\n        const mesh = createComponentMesh(size);\n\n        const offset: ComponentSize = createComponentSize();\n        const faceMaterialPair: [number, number][] = [];\n        this.mergeNodesMesh(mesh, faceMaterialPair, this._nodes, Matrix4.identity(), offset);\n        mesh.face = MeshUtils.mergeFaceMesh(mesh.face, faceMaterialPair);\n\n        return mesh;\n    }\n\n    private getSize(nodes: Iterable<INode>, size: ComponentSize) {\n        for (const node of nodes) {\n            if (node instanceof ShapeNode && node.shape.isOk) {\n                const mesh = node.shape.value.mesh;\n                if (mesh.faces) {\n                    size.facePosition += mesh.faces.position.length / 3;\n                    size.faceIndex += mesh.faces.index.length;\n                }\n                if (mesh.edges) size.edge += mesh.edges.position.length / 3;\n            } else if (node instanceof MeshNode) {\n                size.meshPosition += node.mesh.position!.length / 3;\n                if (node.mesh.meshType === \"surface\") {\n                    size.meshIndex += node.mesh.index?.length ?? 0;\n                }\n            } else if (node instanceof ComponentNode) {\n                this.getSize(node.component.nodes, size);\n            }\n        }\n    }\n\n    private readonly mergeNodesMesh = (\n        visual: ComponentMesh,\n        faceMaterialPair: [number, number][],\n        nodes: Iterable<VisualNode>,\n        transform: Matrix4,\n        offset: ComponentSize,\n    ) => {\n        for (const node of nodes) {\n            const totleTransform = node.transform.multiply(transform);\n            if (node instanceof ShapeNode && node.shape.isOk) {\n                this.mergeShapeNode(visual, faceMaterialPair, node, totleTransform, offset);\n            } else if (node instanceof ComponentNode) {\n                this.mergeNodesMesh(visual, faceMaterialPair, node.component.nodes, totleTransform, offset);\n            } else if (node instanceof MeshNode) {\n                this.mergeMeshNode(visual, node, totleTransform, offset);\n            } else {\n                console.log(`****** to do merge MeshNode ******: ${Object.prototype.toString.call(node)}`);\n            }\n        }\n    };\n\n    private mergeShapeNode(\n        visual: ComponentMesh,\n        faceMaterialPair: [number, number][],\n        node: ShapeNode,\n        transform: Matrix4,\n        offset: ComponentSize,\n    ) {\n        const mesh = node.shape.value.mesh;\n        if (mesh.edges) {\n            MeshUtils.setEdgeMeshData(visual.edge, mesh.edges, transform, offset.edge);\n            offset.edge += mesh.edges.position.length / 3;\n        }\n        if (mesh.faces) {\n            this.mergeFaceMaterial(node, visual, faceMaterialPair);\n            MeshUtils.setFaceMeshData(visual.face, mesh.faces, transform, offset);\n            offset.facePosition += mesh.faces.position.length / 3;\n            offset.faceIndex += mesh.faces.index.length;\n        }\n    }\n\n    private mergeFaceMaterial(node: ShapeNode, visual: ComponentMesh, faceMaterialPair: [number, number][]) {\n        const materialIndexMap = this.mapOldNewMaterialIndex(node.materialId, visual.faceMaterials);\n\n        const map = new Map<number, number>(\n            node.faceMaterialPair.map((pair) => [pair.faceIndex, pair.materialIndex]),\n        );\n        node.mesh.faces?.range.forEach((range, i) => {\n            if (!map.has(i)) {\n                faceMaterialPair.push([i + visual.face.range.length, materialIndexMap.get(0)!]);\n            }\n        });\n        node.faceMaterialPair.forEach((pair) => {\n            faceMaterialPair.push([\n                pair.faceIndex + visual.face.range.length,\n                materialIndexMap.get(pair.materialIndex)!,\n            ]);\n        });\n    }\n\n    private mergeMeshNode(\n        visual: ComponentMesh,\n        node: MeshNode,\n        transform: Matrix4,\n        offset: ComponentSize\n    ) {\n        if (node.mesh.meshType === \"surface\") {\n            const materialONMap = this.mapOldNewMaterialIndex(node.materialId, visual.surfaceMaterials);\n            MeshUtils.setSurfaceMeshData(visual.surface, node.mesh, transform, offset, materialONMap);\n            offset.meshPosition += node.mesh.position!.length / 3;\n            if (node.mesh.index?.length) {\n                offset.meshIndex += node.mesh.index.length;\n            }\n        } else if (node.mesh.meshType === \"linesegments\") {\n            visual.linesegments.position?.set(transform.ofPoints(node.mesh.position!), offset.lineSegment * 3);\n            offset.lineSegment += node.mesh.position!.length / 3;\n        }\n    }\n\n    private mapOldNewMaterialIndex(materialId: string | string[], materialIds: string[]) {\n        const materialIndexMap = new Map<number, number>();\n        const materials = Array.isArray(materialId) ? materialId : [materialId];\n        for (let i = 0; i < materials.length; i++) {\n            const index = materialIds.indexOf(materials[i]);\n            if (index === -1) {\n                materialIds.push(materials[i]);\n                materialIndexMap.set(i, materialIds.length - 1);\n            } else {\n                materialIndexMap.set(i, index);\n            }\n        }\n\n        return materialIndexMap;\n    }\n\n    private computeBoundingBox() {\n        if (this._nodes.length === 0) {\n            return undefined;\n        }\n\n        let box = this._nodes[0].boundingBox();\n        for (let i = 1; i < this._nodes.length; i++) {\n            box = BoundingBox.combine(box, this._nodes[i].boundingBox());\n        }\n        return box;\n    }\n}\n\n@Serializer.register([\"document\", \"name\", \"componentId\", \"insert\", \"id\"])\nexport class ComponentNode extends VisualNode {\n    override display(): I18nKeys {\n        return \"body.group\";\n    }\n\n    override boundingBox(): BoundingBox | undefined {\n        if (!this.component.boundingBox) {\n            return undefined;\n        }\n\n        return BoundingBox.transformed(this.component.boundingBox, this.transform);\n    }\n\n    private _component?: Component;\n    @Property.define(\"body.group\")\n    get component() {\n        if (!this._component) {\n            this._component = this.document.components.find((c) => c.id === this.componentId);\n            if (!this._component) {\n                throw new Error(`Component ${this.componentId} not found`);\n            }\n            this._component.instances.push(this);\n        }\n        return this._component;\n    }\n\n    @Serializer.serialze()\n    readonly componentId: string;\n\n    @Serializer.serialze()\n    readonly insert: XYZ;\n\n    constructor(\n        document: IDocument,\n        name: string,\n        componentId: string,\n        insert: XYZ,\n        id: string = Id.generate(),\n    ) {\n        super(document, name, id);\n        this.componentId = componentId;\n        this.insert = insert;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Property } from \"../property\";\nimport { Serializer } from \"../serialize\";\nimport { ParameterShapeNode } from \"./shapeNode\";\n\nexport abstract class FacebaseNode extends ParameterShapeNode {\n    @Serializer.serialze()\n    @Property.define(\"option.command.isFace\")\n    get isFace() {\n        return this.getPrivateValue(\"isFace\", false);\n    }\n    set isFace(value: boolean) {\n        this.setProperty(\"isFace\", value);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IDocument } from \"../document\";\nimport { Id, Logger, NodeAction } from \"../foundation\";\nimport { Serializer } from \"../serialize\";\nimport { INode, INodeLinkedList, Node } from \"./node\";\n\n@Serializer.register([\"document\", \"name\", \"id\"])\nexport class FolderNode extends Node implements INodeLinkedList {\n    private _count: number = 0;\n    private _firstChild: INode | undefined;\n    private _lastChild: INode | undefined;\n\n    get firstChild() {\n        return this._firstChild;\n    }\n    get lastChild() {\n        return this._lastChild;\n    }\n    get count() {\n        return this._count;\n    }\n    size(): number {\n        return this._count;\n    }\n\n    constructor(document: IDocument, name: string, id: string = Id.generate()) {\n        super(document, name, id);\n    }\n\n    add(...items: INode[]): void {\n        const records = items.map((item) => ({\n            action: NodeAction.add,\n            node: item,\n            oldParent: undefined,\n            oldPrevious: undefined,\n            newParent: this,\n            newPrevious: this._lastChild,\n        }));\n\n        items.forEach((item) => {\n            if (this.initNode(item)) {\n                this.addToLast(item);\n            }\n            this._count++;\n        });\n\n        this.document.notifyNodeChanged(records);\n    }\n\n    private initNode(node: INode): boolean {\n        node.parent = this;\n        node.parentVisible = this.visible && this.parentVisible;\n        if (!this._firstChild) {\n            this._firstChild = this._lastChild = node;\n            node.previousSibling = node.nextSibling = undefined;\n            return false;\n        }\n        return true;\n    }\n\n    private addToLast(item: INode) {\n        this._lastChild!.nextSibling = item;\n        item.previousSibling = this._lastChild;\n        item.nextSibling = undefined;\n        this._lastChild = item;\n    }\n\n    children(): INode[] {\n        const result: INode[] = [];\n        let node = this._firstChild;\n        while (node) {\n            result.push(node);\n            node = node.nextSibling;\n        }\n        return result;\n    }\n\n    remove(...items: INode[]): void {\n        const records = items\n            .filter((item) => this.validateChild(item))\n            .map((item) => ({\n                action: NodeAction.remove,\n                node: item,\n                newParent: undefined,\n                newPrevious: undefined,\n                oldParent: this,\n                oldPrevious: item.previousSibling,\n            }));\n\n        records.forEach((record) => this.removeNode(record.node, true));\n        this.document.notifyNodeChanged(records);\n    }\n\n    transfer(...items: INode[]): void {\n        const records = items\n            .filter((item) => this.validateChild(item))\n            .map((item) => ({\n                action: NodeAction.transfer,\n                node: item,\n                newParent: undefined,\n                newPrevious: undefined,\n                oldParent: this,\n                oldPrevious: item.previousSibling,\n            }));\n\n        records.forEach((record) => this.removeNode(record.node, true));\n        this.document.notifyNodeChanged(records);\n    }\n\n    private validateChild(item: INode): boolean {\n        if (item.parent !== this) {\n            Logger.warn(`${item.name} is not a child node of the ${this.name} node`);\n            return false;\n        }\n        return true;\n    }\n\n    private removeNode(node: INode, nullifyParent: boolean) {\n        if (nullifyParent) {\n            node.parent = undefined;\n            node.parentVisible = true;\n        }\n\n        if (node === this._firstChild) {\n            this.removeFirstNode(node);\n        } else if (node === this._lastChild) {\n            this.removeLastNode(node);\n        } else {\n            this.removeMiddleNode(node);\n        }\n        this._count--;\n    }\n\n    private removeFirstNode(node: INode) {\n        if (node === this._lastChild) {\n            this._firstChild = this._lastChild = undefined;\n        } else {\n            this._firstChild = node.nextSibling;\n            this._firstChild!.previousSibling = undefined;\n            node.nextSibling = undefined;\n        }\n    }\n\n    private removeLastNode(node: INode) {\n        this._lastChild = node.previousSibling;\n        this._lastChild!.nextSibling = undefined;\n        node.previousSibling = undefined;\n    }\n\n    private removeMiddleNode(node: INode) {\n        node.previousSibling!.nextSibling = node.nextSibling;\n        node.nextSibling!.previousSibling = node.previousSibling;\n        node.previousSibling = node.nextSibling = undefined;\n    }\n\n    insertBefore(target: INode | undefined, node: INode): void {\n        if (target && !this.validateChild(target)) return;\n\n        const record = {\n            action: NodeAction.insertBefore,\n            node,\n            oldParent: undefined,\n            oldPrevious: undefined,\n            newParent: this,\n            newPrevious: target?.previousSibling,\n        };\n\n        if (this.initNode(node)) {\n            if (!target || target === this._firstChild) {\n                this.insertAsFirst(node);\n            } else {\n                this.insertBetweenNodes(target.previousSibling!, node, target);\n            }\n        }\n        this._count++;\n        this.document.notifyNodeChanged([record]);\n    }\n\n    private insertAsFirst(node: INode) {\n        this._firstChild!.previousSibling = node;\n        node.nextSibling = this._firstChild;\n        this._firstChild = node;\n    }\n\n    private insertBetweenNodes(prev: INode, node: INode, next: INode) {\n        prev.nextSibling = node;\n        node.previousSibling = prev;\n        node.nextSibling = next;\n        next.previousSibling = node;\n    }\n\n    insertAfter(target: INode | undefined, node: INode): void {\n        if (target && !this.validateChild(target)) return;\n\n        const record = {\n            action: NodeAction.insertAfter,\n            oldParent: undefined,\n            oldPrevious: undefined,\n            newParent: this,\n            newPrevious: target,\n            node,\n        };\n\n        if (this.initNode(node)) {\n            if (!target) {\n                this.insertAsFirst(node);\n            } else if (target === this._lastChild) {\n                this.addToLast(node);\n            } else {\n                this.insertBetweenNodes(target, node, target.nextSibling!);\n            }\n        }\n        this._count++;\n        this.document.notifyNodeChanged([record]);\n    }\n\n    move(child: INode, newParent: FolderNode, previousSibling?: INode): void {\n        if (previousSibling && previousSibling.parent !== newParent) {\n            Logger.warn(`${previousSibling.name} is not a child node of the ${newParent.name} node`);\n            return;\n        }\n\n        const record = {\n            action: NodeAction.move,\n            oldParent: child.parent,\n            oldPrevious: child.previousSibling,\n            newParent: newParent,\n            newPrevious: previousSibling,\n            node: child,\n        };\n\n        this.removeNode(child, false);\n\n        if (newParent.initNode(child)) {\n            if (!previousSibling) {\n                newParent.insertAsFirst(child);\n            } else if (previousSibling === newParent._lastChild) {\n                newParent.addToLast(child);\n            } else {\n                newParent.insertBetweenNodes(previousSibling, child, previousSibling.nextSibling!);\n            }\n        }\n        newParent._count++;\n\n        this.document.notifyNodeChanged([record]);\n    }\n\n    override disposeInternal(): void {\n        this.disposeNodes(this._firstChild);\n        super.disposeInternal();\n    }\n\n    private readonly disposeNodes = (node: INode | undefined) => {\n        if (node instanceof FolderNode) {\n            this.disposeNodes(node.firstChild);\n        }\n\n        let next = node?.nextSibling;\n        if (node) {\n            node.nextSibling = null as any;\n        }\n        while (next) {\n            let cache = next.nextSibling;\n            next.previousSibling = null as any;\n            next.nextSibling = null as any;\n            next.dispose();\n            next = cache;\n        }\n        node?.dispose();\n    };\n\n    protected onVisibleChanged() {\n        this.setChildrenParentVisible();\n    }\n\n    protected onParentVisibleChanged() {\n        this.setChildrenParentVisible();\n    }\n\n    private setChildrenParentVisible() {\n        let child = this._firstChild;\n        while (child !== undefined) {\n            child.parentVisible = this.visible && this.parentVisible;\n            child = child.nextSibling;\n        }\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Matrix4 } from \"../math\";\nimport { Serializer } from \"../serialize\";\nimport { FolderNode } from \"./folderNode\";\n\n@Serializer.register([\"document\", \"name\", \"id\"])\nexport class GroupNode extends FolderNode {\n    @Serializer.serialze()\n    get transform(): Matrix4 {\n        return this.getPrivateValue(\"transform\", Matrix4.identity());\n    }\n    set transform(value: Matrix4) {\n        this.setProperty(\"transform\", value, undefined, {\n            equals: (left, right) => left.equals(right),\n        });\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { INode, ShapeNode } from \"./model\";\nimport { IShape } from \"./shape\";\n\nexport interface IShapeFilter {\n    allow(shape: IShape): boolean;\n}\n\nexport interface INodeFilter {\n    allow(node: INode): boolean;\n}\n\nexport class ShapeNodeFilter implements INodeFilter {\n    constructor(readonly shapeFilter?: IShapeFilter) {}\n\n    allow(node: INode): boolean {\n        if (node instanceof ShapeNode) {\n            if (this.shapeFilter && node.shape.isOk) {\n                return this.shapeFilter.allow(node.shape.value);\n            }\n            return true;\n        }\n\n        return false;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IConverter, Observable, ObservableCollection } from \"../foundation\";\n\nexport class Combobox<T> extends Observable {\n    constructor(readonly converter?: IConverter<T>) {\n        super();\n    }\n\n    get selectedIndex(): number {\n        return this.getPrivateValue(\"selectedIndex\", 0);\n    }\n    set selectedIndex(value: number) {\n        if (value < 0 || value >= this.items.length) {\n            return;\n        }\n\n        this.setProperty(\"selectedIndex\", value);\n    }\n\n    get selectedItem(): T | undefined {\n        return this.items.at(this.selectedIndex);\n    }\n\n    readonly items = new ObservableCollection<T>();\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Observable } from \"../foundation\";\nimport { XYZ } from \"../math\";\nimport { Serializer } from \"../serialize\";\nimport { IView } from \"./view\";\n\n@Serializer.register([\"name\", \"cameraPosition\", \"cameraTarget\", \"cameraUp\"])\nexport class Act extends Observable {\n    @Serializer.serialze()\n    public get name() {\n        return this.getPrivateValue(\"name\");\n    }\n    public set name(value: string) {\n        this.setProperty(\"name\", value);\n    }\n\n    @Serializer.serialze()\n    public get cameraPosition() {\n        return this.getPrivateValue(\"cameraPosition\");\n    }\n    public set cameraPosition(value: XYZ) {\n        this.setProperty(\"cameraPosition\", value);\n    }\n\n    @Serializer.serialze()\n    public get cameraTarget() {\n        return this.getPrivateValue(\"cameraTarget\");\n    }\n    public set cameraTarget(value: XYZ) {\n        this.setProperty(\"cameraTarget\", value);\n    }\n\n    @Serializer.serialze()\n    public get cameraUp() {\n        return this.getPrivateValue(\"cameraUp\");\n    }\n    public set cameraUp(value: XYZ) {\n        this.setProperty(\"cameraUp\", value);\n    }\n\n    static fromView(view: IView, name: string) {\n        return new Act(\n            name,\n            view.cameraController.cameraPosition,\n            view.cameraController.cameraTarget,\n            view.cameraController.cameraUp,\n        );\n    }\n\n    constructor(name: string, cameraPosition: XYZ, cameraTarget: XYZ, cameraUp: XYZ) {\n        super();\n        this.setPrivateValue(\"name\", name);\n        this.setPrivateValue(\"cameraPosition\", cameraPosition);\n        this.setPrivateValue(\"cameraTarget\", cameraTarget);\n        this.setPrivateValue(\"cameraUp\", cameraUp);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { BoundingBox, GeometryNode, IDisposable, Matrix4, VisualNode } from \"chili-core\";\n\nexport interface IVisualObject extends IDisposable {\n    visible: boolean;\n    transform: Matrix4;\n    worldTransform(): Matrix4;\n    boundingBox(): BoundingBox | undefined;\n}\n\nexport interface INodeVisual extends IVisualObject {\n    get node(): VisualNode;\n}\n\nexport interface IVisualGeometry extends IVisualObject {\n    get geometryNode(): GeometryNode;\n}\n\nexport namespace IVisualObject {\n    export function isGeometry(obj: IVisualObject): obj is IVisualGeometry {\n        return (obj as IVisualGeometry).geometryNode !== undefined;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { concatTypedArrays, EdgeMeshData, FaceMeshData, MathUtils, Matrix4, Mesh } from \"chili-core\";\n\nexport class MeshUtils {\n    static setFaceMeshData(\n        data: FaceMeshData,\n        other: FaceMeshData | undefined,\n        matrix: Matrix4,\n        offset: { facePosition: number; faceIndex: number },\n    ) {\n        if (!other) {\n            return;\n        }\n\n        data.range = data.range.concat(\n            other.range.map((g) => {\n                return {\n                    start: g.start + offset.faceIndex,\n                    shape: g.shape,\n                    count: g.count,\n                    transform: matrix,\n                };\n            }),\n        );\n        data.index.set(\n            other.index.map((x) => x + offset.facePosition),\n            offset.faceIndex,\n        );\n        data.position.set(matrix.ofPoints(other.position), offset.facePosition * 3);\n        data.normal.set(matrix.ofVectors(other.normal), offset.facePosition * 3);\n        data.uv.set(other.uv, offset.facePosition * 2);\n    }\n\n    static setSurfaceMeshData(\n        data: Mesh, \n        other: Mesh, \n        matrix: Matrix4,\n        offset: { meshPosition: number; meshIndex: number },\n        materialMap: Map<number, number>,\n    ) {\n        other.groups.forEach((g) => {\n            data.groups.push({\n                start: g.start + offset.meshIndex,\n                count: g.count,\n                materialIndex: materialMap.get(g.materialIndex)!,\n            })\n        })\n        if (data.index && other.index) {\n            data.index.set(other.index.map((x) => x + offset.meshPosition), offset.meshIndex);\n        }\n        if (data.position && other.position) {\n            data.position.set(matrix.ofPoints(other.position), offset.meshPosition * 3);\n        }\n        if (data.normal && other.normal) {\n            data.normal.set(matrix.ofVectors(other.normal), offset.meshPosition * 3);\n        }\n        if (data.uv && other.uv) {\n            data.uv.set(other.uv, offset.meshPosition * 2);\n        }\n    }\n\n    static combineFaceMeshData(data: FaceMeshData, other: FaceMeshData | undefined, matrix: Matrix4) {\n        if (!other) {\n            return;\n        }\n\n        data.range = data.range.concat(\n            other.range.map((g) => {\n                return {\n                    start: g.start + data.index.length,\n                    shape: g.shape,\n                    count: g.count,\n                    transform: matrix,\n                };\n            }),\n        );\n        data.index = concatTypedArrays([data.index, other.index.map((x) => x + data.position.length / 3)]);\n        data.position = this.concatFloat32Array(data.position, matrix.ofPoints(other.position));\n        data.normal = this.concatFloat32Array(data.normal, matrix.ofVectors(other.normal));\n        data.uv = this.concatFloat32Array(data.uv, other.uv);\n    }\n\n    static concatFloat32Array(arr1: ArrayLike<number>, arr2: ArrayLike<number>) {\n        let arr = new Float32Array(arr1.length + arr2.length);\n        arr.set(arr1);\n        arr.set(arr2, arr1.length);\n        return arr;\n    }\n\n    static setEdgeMeshData(\n        data: EdgeMeshData,\n        other: EdgeMeshData | undefined,\n        matrix: Matrix4,\n        offset: number,\n    ) {\n        if (!other) {\n            return;\n        }\n\n        data.position.set(matrix.ofPoints(other.position), offset * 3);\n        data.range = data.range.concat(\n            other.range.map((g) => {\n                return {\n                    transform: matrix,\n                    start: g.start + offset,\n                    shape: g.shape,\n                    count: g.count,\n                };\n            }),\n        );\n    }\n\n    static combineEdgeMeshData(data: EdgeMeshData, other: EdgeMeshData | undefined, matrix: Matrix4) {\n        if (!other) {\n            return;\n        }\n\n        let start = data.position.length / 3;\n        data.position = this.concatFloat32Array(data.position, matrix.ofPoints(other.position));\n        data.range = data.range.concat(\n            other.range.map((g) => {\n                return {\n                    start: g.start + start,\n                    shape: g.shape,\n                    count: g.count,\n                    transform: matrix,\n                };\n            }),\n        );\n    }\n\n    static mergeFaceMesh(mesh: FaceMeshData, materialMap: [number, number][]): FaceMeshData {\n        if (materialMap.length === 0) {\n            return mesh;\n        }\n\n        const materialIndexMap = new Map<number, number>(materialMap);\n        for (let i = 0; i < mesh.range.length; i++) {\n            if (!materialIndexMap.has(i)) {\n                materialIndexMap.set(i, 0);\n            }\n        }\n\n        return this.mergeFaceMeshWithMap(mesh, materialIndexMap);\n    }\n\n    private static mergeFaceMeshWithMap(mesh: FaceMeshData, materialMap: Map<number, number>): FaceMeshData {\n        const result: FaceMeshData = {\n            position: new Float32Array(mesh.position.length),\n            normal: new Float32Array(mesh.normal.length),\n            uv: new Float32Array(mesh.uv.length),\n            index: new Uint32Array(mesh.index.length),\n            range: [],\n            color: mesh.color,\n            groups: [],\n        };\n\n        let offset = { facePosition: 0, faceIndex: 0 };\n        const grouped = Object.groupBy(materialMap, (x) => x[1]);\n\n        for (const key of Object.keys(grouped)) {\n            const i = parseInt(key);\n            const groupStart = offset.faceIndex;\n            MeshUtils.mergeSameGroup(grouped[i]!, mesh, result, offset);\n            result.groups.push({\n                start: groupStart,\n                count: offset.faceIndex - groupStart,\n                materialIndex: i,\n            });\n        }\n        return result;\n    }\n\n    private static mergeSameGroup(\n        group: [number, number][],\n        mesh: FaceMeshData,\n        result: FaceMeshData,\n        offset: { facePosition: number; faceIndex: number },\n    ) {\n        for (const index of group) {\n            const { start, count, shape, transform: worldTransform } = mesh.range[index[0]];\n\n            const oldIndex = mesh.index.slice(start, start + count);\n            const { min, max } = MathUtils.minMax(oldIndex)!;\n            result.position.set(mesh.position.slice(min * 3, (max + 1) * 3), offset.facePosition * 3);\n            result.normal.set(mesh.normal.slice(min * 3, (max + 1) * 3), offset.facePosition * 3);\n            result.uv.set(mesh.uv.slice(min * 2, (max + 1) * 2), offset.facePosition * 2);\n            result.index.set(\n                oldIndex.map((x) => x - min + offset.facePosition),\n                offset.faceIndex,\n            );\n            result.range.push({\n                start: offset.faceIndex,\n                count,\n                shape,\n                transform: worldTransform,\n            });\n            offset.facePosition += max - min + 1;\n            offset.faceIndex += oldIndex.length;\n        }\n    }\n\n    static subFace(mesh: FaceMeshData, index: number): FaceMeshData | undefined {\n        const group = mesh?.range[index];\n        if (!group) return undefined;\n\n        const indices = mesh.index.slice(group.start, group.start + group.count);\n        const { min, max } = MathUtils.minMax(indices)!;\n        const [indiceStart, indiceEnd] = [min, max + 1];\n\n        return {\n            position: mesh.position.slice(indiceStart * 3, indiceEnd * 3),\n            normal: mesh.normal.slice(indiceStart * 3, indiceEnd * 3),\n            index: indices.map((i) => i - indiceStart),\n            uv: mesh.uv.slice(indiceStart * 2, indiceEnd * 2),\n            range: [],\n            color: mesh.color,\n            groups: [],\n        };\n    }\n\n    static subFaceOutlines(face: FaceMeshData, index: number) {\n        const mesh = this.subFace(face, index);\n        if (!mesh) return undefined;\n\n        return this.faceOutline(mesh);\n    }\n\n    static addEdge(\n        pointsMap: Map<string, { count: number; points: number[] }>,\n        face: { position: Float32Array },\n        i: number,\n        j: number,\n    ) {\n        const key = i < j ? `${i}_${j}` : `${j}_${i}`;\n        const entry = pointsMap.get(key);\n        if (entry) {\n            entry.count++;\n        } else {\n            const points = [\n                ...face.position.slice(i * 3, i * 3 + 3),\n                ...face.position.slice(j * 3, j * 3 + 3),\n            ];\n            pointsMap.set(key, { count: 1, points });\n        }\n    }\n\n    static faceOutline(face: { position: Float32Array; index: Uint32Array }) {\n        const pointsMap = new Map<string, { count: number; points: number[] }>();\n\n        for (let i = 0; i < face.index.length; i += 3) {\n            this.addEdge(pointsMap, face, face.index[i], face.index[i + 1]);\n            this.addEdge(pointsMap, face, face.index[i + 1], face.index[i + 2]);\n            this.addEdge(pointsMap, face, face.index[i + 2], face.index[i]);\n        }\n\n        return new Float32Array(\n            Array.from(pointsMap.values())\n                .filter((v) => v.count === 1)\n                .flatMap((entry) => entry.points),\n        );\n    }\n\n    static subEdge(mesh: EdgeMeshData, index: number) {\n        const group = mesh?.range[index];\n        if (!group) return undefined;\n\n        return mesh.position.slice(group.start * 3, (group.start + group.count) * 3);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { ICurve, IEdge, IFace, IWire, Orientation, Precision, Result, ShapeType, XYZ } from \"chili-core\";\n\nexport class GeoUtils {\n    static nearestPoint(wire: IWire, point: XYZ): { edge: IEdge; point: XYZ } {\n        let minDistance = Number.MAX_VALUE;\n        let nearest: { edge: IEdge; point: XYZ } | undefined;\n\n        for (const edge of wire.findSubShapes(ShapeType.Edge) as IEdge[]) {\n            const tempPoint = edge.curve.nearestFromPoint(point);\n            if (tempPoint.distance < minDistance) {\n                nearest = { edge, point: tempPoint.point };\n                minDistance = tempPoint.distance;\n            }\n        }\n        return nearest!;\n    }\n\n    static curveNormal(curve: ICurve) {\n        if (ICurve.isTrimmed(curve)) {\n            curve = curve.basisCurve;\n        }\n\n        if (ICurve.isConic(curve)) {\n            return curve.axis;\n        }\n        let vec = curve.dn(0, 1);\n        if (vec.isParallelTo(XYZ.unitX)) return XYZ.unitZ;\n        return vec.cross(XYZ.unitX).normalize()!;\n    }\n\n    private static wireNormal(wire: IWire): XYZ {\n        const edges = wire.findSubShapes(ShapeType.Edge) as IEdge[];\n        if (edges.length === 0) {\n            console.warn(\"Empty wire\");\n            return XYZ.unitZ;\n        } else if (edges.length === 1) {\n            return this.curveNormal(edges[0].curve);\n        } else {\n            const curve1 = edges[0].curve;\n            const curve2 = edges[1].curve;\n            const p1 = curve1.value(curve1.firstParameter());\n            const p2 = curve1.value(curve1.lastParameter());\n            const p3 = curve2.value(curve2.firstParameter());\n            const p4 = curve2.value(curve2.lastParameter());\n            const v1 = p2.sub(p1);\n            const v2 = p4.sub(p3);\n            const normal = v1.cross(v2).normalize()!;\n            if (wire.orientation() === Orientation.REVERSED) {\n                return normal.reverse();\n            }\n            return normal;\n        }\n    }\n\n    static isCCW(normal: XYZ, wire: IWire): boolean {\n        const testNormal = this.wireNormal(wire);\n        return testNormal.dot(normal) > 0.001;\n    }\n\n    static findNextEdge(wire: IWire, edge: IEdge): Result<IEdge> {\n        const curve = edge.curve;\n        const point = curve.value(curve.lastParameter());\n\n        for (const e of wire.findSubShapes(ShapeType.Edge)) {\n            if (e.isEqual(edge)) continue;\n            const testCurve = (e as IEdge).curve;\n            if (\n                point.distanceTo(testCurve.value(testCurve.firstParameter())) < Precision.Distance ||\n                point.distanceTo(testCurve.value(testCurve.lastParameter())) < Precision.Distance\n            ) {\n                return Result.ok(e as IEdge);\n            }\n        }\n        return Result.err(\"Cannot find next edge\");\n    }\n\n    static normal(shape: IFace | IWire | IEdge): XYZ {\n        if (shape.shapeType === ShapeType.Face) {\n            return (shape as IFace).normal(0, 0)[1];\n        }\n\n        if (shape.shapeType === ShapeType.Edge) {\n            let curve = (shape as IEdge).curve;\n            return this.curveNormal(curve);\n        }\n\n        return this.wireNormal(shape as IWire);\n    }\n\n    static intersects(edge: IEdge, otherEdges: IEdge[]): { point: XYZ; parameter: number }[] {\n        let result: { point: XYZ; parameter: number }[] = [];\n        otherEdges.forEach((e) => {\n            let intersect = edge.intersect(e);\n            if (intersect.length > 0) {\n                result.push(...intersect);\n            }\n        });\n        return result;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { AsyncController, IDocument, IEventHandler, IView } from \"chili-core\";\n\nconst MOUSE_MIDDLE = 4;\n\nconst SelectionRectStyle = `\n    border: 1px solid var(--primary-color);\n    background-color: rgba(74, 158, 255, 0.3);\n    position: absolute;\n    pointer-events: none;\n    display: none;\n    left: 0px;\n    right: 0px;\n    width: 0px;\n    height: 0px;\n`;\n\ninterface SelectionRect {\n    element: HTMLElement;\n    clientX: number;\n    clientY: number;\n}\n\nexport abstract class SelectionHandler implements IEventHandler {\n    protected rect?: SelectionRect;\n    protected showRect = true;\n    protected mouse = { isDown: false, x: 0, y: 0 };\n    protected readonly pointerEventMap: Map<number, PointerEvent> = new Map();\n\n    constructor(\n        readonly document: IDocument,\n        readonly multiMode: boolean,\n        readonly controller?: AsyncController,\n    ) {\n        controller?.onCancelled((s) => {\n            this.clearSelected(document);\n            this.cleanHighlights();\n        });\n    }\n\n    #disposed = false;\n    readonly dispose = () => {\n        if (!this.#disposed) {\n            this.#disposed = true;\n\n            this.disposeInternal();\n        }\n    };\n\n    protected disposeInternal() {\n        this.pointerEventMap.clear();\n    }\n\n    pointerMove(view: IView, event: PointerEvent): void {\n        if (event.buttons === MOUSE_MIDDLE) return;\n        if (this.rect) this.updateRect(this.rect, event);\n\n        this.setHighlight(view, event);\n    }\n\n    protected abstract setHighlight(view: IView, event: PointerEvent): void;\n\n    protected abstract cleanHighlights(): void;\n\n    protected abstract clearSelected(document: IDocument): void;\n\n    protected abstract select(view: IView, event: PointerEvent): number;\n\n    protected abstract highlightNext(view: IView): void;\n\n    pointerDown(view: IView, event: PointerEvent): void {\n        event.preventDefault();\n        if (event.button === 0 && event.isPrimary) {\n            this.mouse = { isDown: true, x: event.offsetX, y: event.offsetY };\n            if (this.multiMode && this.showRect) {\n                this.rect = this.initRect(event);\n            }\n        }\n        this.pointerEventMap.set(event.pointerId, event);\n    }\n\n    private initRect(event: PointerEvent): SelectionRect {\n        const rect = document.createElement(\"div\");\n        rect.style.cssText = SelectionRectStyle;\n        document.body.appendChild(rect);\n        return { element: rect, clientX: event.clientX, clientY: event.clientY };\n    }\n\n    protected updateRect(rect: SelectionRect, event: PointerEvent) {\n        if (this.pointerEventMap.size !== 1) return;\n        rect.element.style.display = \"block\";\n        const [x1, y1] = [Math.min(rect.clientX, event.clientX), Math.min(rect.clientY, event.clientY)];\n        const [x2, y2] = [Math.max(rect.clientX, event.clientX), Math.max(rect.clientY, event.clientY)];\n        Object.assign(rect.element.style, {\n            left: `${x1}px`,\n            top: `${y1}px`,\n            width: `${x2 - x1}px`,\n            height: `${y2 - y1}px`,\n        });\n    }\n\n    pointerOut(view: IView, event: PointerEvent): void {\n        if (event.isPrimary) {\n            this.mouse.isDown = false;\n            this.removeRect(view);\n            this.cleanHighlights();\n        }\n        this.pointerEventMap.delete(event.pointerId);\n    }\n\n    pointerUp(view: IView, event: PointerEvent): void {\n        event.preventDefault();\n        if (this.mouse.isDown && event.button === 0 && event.isPrimary) {\n            this.mouse.isDown = false;\n            this.removeRect(view);\n            const count = this.select(view, event);\n            this.cleanHighlights();\n            view.update();\n            if (count > 0 && !this.multiMode) this.controller?.success();\n        }\n        this.pointerEventMap.delete(event.pointerId);\n    }\n\n    private removeRect(view: IView) {\n        this.rect?.element.remove();\n        this.rect = undefined;\n    }\n\n    keyDown(view: IView, event: KeyboardEvent): void {\n        if (event.key === \"Escape\") {\n            this.controller ? this.controller.cancel() : this.clearSelected(view.document.visual.document);\n            this.cleanHighlights();\n        } else if (event.key === \"Enter\") {\n            this.cleanHighlights();\n            this.controller?.success();\n        } else if (event.key === \"Tab\") {\n            event.preventDefault();\n            this.highlightNext(view);\n        }\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    AsyncController,\n    IDocument,\n    INode,\n    INodeFilter,\n    IView,\n    IVisualObject,\n    ShapeType,\n    VisualNode,\n    VisualState,\n} from \"chili-core\";\nimport { SelectionHandler } from \"./selectionEventHandler\";\n\nexport class NodeSelectionHandler extends SelectionHandler {\n    private _highlights: IVisualObject[] | undefined;\n    private _detectAtMouse: IVisualObject[] | undefined;\n    private _lockDetected: IVisualObject | undefined; // 用于切换捕获的对象\n    protected highlighState = VisualState.edgeHighlight;\n\n    nodes(): VisualNode[] {\n        return this.document.selection.getSelectedNodes() as VisualNode[];\n    }\n\n    constructor(\n        document: IDocument,\n        multiMode: boolean,\n        controller?: AsyncController,\n        readonly filter?: INodeFilter,\n    ) {\n        super(document, multiMode, controller);\n    }\n\n    protected override select(view: IView, event: PointerEvent): number {\n        if (!this._highlights?.length) {\n            this.clearSelected(this.document);\n            return 0;\n        }\n        const models = this._highlights\n            .map((x) => view.document.visual.context.getNode(x))\n            .filter((x): x is INode => x !== undefined);\n        this.document.selection.setSelection(models, event.shiftKey);\n        return models.length;\n    }\n\n    getDetecteds(view: IView, event: PointerEvent) {\n        if (\n            this.rect &&\n            Math.abs(this.mouse.x - event.offsetX) > 3 &&\n            Math.abs(this.mouse.y - event.offsetY) > 3\n        ) {\n            return view.detectVisualRect(\n                this.mouse.x,\n                this.mouse.y,\n                event.offsetX,\n                event.offsetY,\n                this.filter,\n            );\n        }\n        this._detectAtMouse = view.detectVisual(event.offsetX, event.offsetY, this.filter);\n        const detected = this.getDetecting();\n        return detected ? [detected] : [];\n    }\n\n    private getDetecting() {\n        if (!this._detectAtMouse) return undefined;\n        const index = this._lockDetected ? this.getDetcedtingIndex() : 0;\n        return this._detectAtMouse[index] || undefined;\n    }\n\n    private getDetcedtingIndex() {\n        if (!this._detectAtMouse) return -1;\n        for (let i = 0; i < this._detectAtMouse.length; i++) {\n            if (this._lockDetected === this._detectAtMouse[i]) {\n                return i;\n            }\n        }\n        return -1;\n    }\n\n    protected override setHighlight(view: IView, event: PointerEvent) {\n        let detecteds = this.getDetecteds(view, event);\n        this.highlightDetecteds(view, detecteds);\n    }\n\n    private highlightDetecteds(view: IView, detecteds: IVisualObject[]) {\n        this.cleanHighlights();\n        detecteds.forEach((x) => {\n            view.document.visual.highlighter.addState(x, this.highlighState, ShapeType.Shape);\n        });\n        this._highlights = detecteds;\n        view.update();\n    }\n\n    protected override cleanHighlights(): void {\n        this._highlights?.forEach((x) => {\n            this.document.visual.highlighter.removeState(x, this.highlighState, ShapeType.Shape);\n        });\n        this._highlights = undefined;\n    }\n\n    protected override highlightNext(view: IView): void {\n        if (this._detectAtMouse && this._detectAtMouse.length > 1) {\n            const index = this._lockDetected\n                ? (this.getDetcedtingIndex() + 1) % this._detectAtMouse.length\n                : 1;\n            this._lockDetected = this._detectAtMouse[index];\n            const detected = this.getDetecting();\n            if (detected) this.highlightDetecteds(view, [detected]);\n        }\n    }\n\n    override clearSelected(document: IDocument): void {\n        document.selection.clearSelection();\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    AsyncController,\n    IDocument,\n    INodeFilter,\n    IShape,\n    IShapeFilter,\n    IView,\n    ShapeType,\n    VisualShapeData,\n    VisualState,\n} from \"chili-core\";\nimport { SelectionHandler } from \"./selectionEventHandler\";\n\nexport abstract class ShapeSelectionHandler extends SelectionHandler {\n    protected _highlights: VisualShapeData[] | undefined;\n    private _detectAtMouse: VisualShapeData[] | undefined;\n    private _lockDetected: IShape | undefined;\n\n    highlightState = VisualState.edgeHighlight\n\n    constructor(\n        document: IDocument,\n        readonly shapeType: ShapeType,\n        multiMode: boolean,\n        controller?: AsyncController,\n        readonly shapefilter?: IShapeFilter,\n        readonly nodeFilter?: INodeFilter,\n    ) {\n        super(document, multiMode, controller);\n    }\n\n    private getDetecteds(view: IView, event: PointerEvent) {\n        if (\n            this.rect &&\n            Math.abs(this.mouse.x - event.offsetX) > 3 &&\n            Math.abs(this.mouse.y - event.offsetY) > 3\n        ) {\n            return view.detectShapesRect(\n                this.shapeType,\n                this.mouse.x,\n                this.mouse.y,\n                event.offsetX,\n                event.offsetY,\n                this.shapefilter,\n                this.nodeFilter,\n            );\n        }\n        this._detectAtMouse = view.detectShapes(this.shapeType, event.offsetX, event.offsetY, this.shapefilter, this.nodeFilter);\n        const detected = this.getDetecting();\n        return detected ? [detected] : [];\n    }\n\n    protected override setHighlight(view: IView, event: PointerEvent) {\n        let detecteds = this.getDetecteds(view, event);\n        this.highlightDetecteds(view, detecteds);\n    }\n\n    protected highlightDetecteds(view: IView, detecteds: VisualShapeData[]) {\n        this.cleanHighlights();\n        detecteds.forEach((x) => {\n            view.document.visual.highlighter.addState(\n                x.owner,\n                this.highlightState,\n                this.shapeType,\n                ...x.indexes,\n            );\n        });\n        this._highlights = detecteds;\n        view.update();\n    }\n\n    protected cleanHighlights() {\n        this._highlights?.forEach((x) => {\n            x.owner.node.document.visual.highlighter.removeState(\n                x.owner,\n                this.highlightState,\n                this.shapeType,\n                ...x.indexes,\n            );\n        });\n        this._highlights = undefined;\n    }\n\n    protected highlightNext(view: IView) {\n        if (this._detectAtMouse && this._detectAtMouse.length > 1) {\n            let index = this._lockDetected\n                ? (this.getDetcedtingIndex() + 1) % this._detectAtMouse.length\n                : 1;\n            this._lockDetected = this._detectAtMouse[index].shape;\n            const detected = this.getDetecting();\n            if (detected) this.highlightDetecteds(view, [detected]);\n        }\n    }\n\n    private getDetecting() {\n        if (this._detectAtMouse) {\n            const index = this._lockDetected ? this.getDetcedtingIndex() : 0;\n            return this._detectAtMouse[index];\n        }\n        return undefined;\n    }\n\n    private getDetcedtingIndex() {\n        return this._detectAtMouse?.findIndex((x) => this._lockDetected === x.shape) ?? -1;\n    }\n}\n\nexport class SubshapeSelectionHandler extends ShapeSelectionHandler {\n    private readonly _shapes: Map<IShape, VisualShapeData> = new Map();\n    selectedState: VisualState = VisualState.edgeSelected;\n\n    constructor(\n        document: IDocument,\n        shapeType: ShapeType,\n        multiMode: boolean,\n        controller?: AsyncController,\n        filter?: IShapeFilter,\n        nodeFilter?: INodeFilter,\n    ) {\n        super(document, shapeType, multiMode, controller, filter, nodeFilter);\n        this.showRect = false;\n    }\n\n    shapes(): VisualShapeData[] {\n        return [...this._shapes.values()];\n    }\n\n    override clearSelected(document: IDocument): void {\n        for (const shape of this._shapes.values()) {\n            this.removeSelected(shape);\n        }\n        this._shapes.clear();\n    }\n\n    protected override select(view: IView, event: PointerEvent): number {\n        const document = view.document.visual.document;\n        if (this.multiMode) {\n            this._highlights?.forEach((x) =>\n                this._shapes.has(x.shape) ? this.removeSelected(x) : this.addSelected(x),\n            );\n        } else {\n            this.clearSelected(document);\n            this._highlights?.forEach(this.addSelected.bind(this));\n        }\n        return this._shapes.size;\n    }\n\n    private removeSelected(shape: VisualShapeData) {\n        this._shapes.delete(shape.shape);\n        shape.owner.node.document.visual.highlighter.removeState(\n            shape.owner,\n            this.selectedState,\n            shape.shape.shapeType,\n            ...shape.indexes,\n        );\n    }\n\n    private addSelected(shape: VisualShapeData) {\n        shape.owner.node.document.visual.highlighter.addState(\n            shape.owner,\n            this.selectedState,\n            this.shapeType,\n            ...shape.indexes,\n        );\n        this._shapes.set(shape.shape, shape);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IView, Plane, Precision, Ray, XYZ } from \"chili-core\";\n\nexport class ViewUtils {\n    static rayFromEye(view: IView, point: XYZ) {\n        const cameraPosition = view.cameraController.cameraPosition;\n        const vector = point.sub(cameraPosition);\n        if (view.cameraController.cameraType === \"orthographic\") {\n            const direction = view.direction();\n            const dot = vector.dot(direction);\n            const location = point.sub(direction.multiply(dot));\n            return new Ray(location, direction);\n        } else {\n            return new Ray(cameraPosition, vector);\n        }\n    }\n\n    static directionAt(view: IView, point: XYZ) {\n        if (view.cameraController.cameraType === \"orthographic\") {\n            return view.direction();\n        } else {\n            const cameraPosition = view.cameraController.cameraPosition;\n            return point.sub(cameraPosition);\n        }\n    }\n\n    static ensurePlane(view: IView, plane: Plane) {\n        const direction = view.direction();\n        if (Math.abs(direction.dot(plane.normal)) < Precision.Float) {\n            const left = direction.cross(view.up());\n            return new Plane(plane.origin, direction, left);\n        }\n        return plane;\n    }\n\n    static raycastClosestPlane(view: IView, start: XYZ, end: XYZ): Plane {\n        const direction = view.direction();\n        if (Math.abs(direction.dot(view.workplane.normal)) < Precision.Float) {\n            const left = direction.cross(view.up());\n            return new Plane(start, direction, left);\n        }\n\n        const ray = ViewUtils.rayFromEye(view, end);\n        const planes = [\n            new Plane(start, XYZ.unitZ, XYZ.unitX),\n            new Plane(start, XYZ.unitX, XYZ.unitY),\n            new Plane(start, XYZ.unitY, XYZ.unitZ),\n        ];\n\n        const distances = planes.map((p) => p.intersect(ray)?.distanceTo(start));\n        let result: [Plane, number | undefined] = [planes[0], distances[0]];\n        for (let i = 1; i < distances.length; i++) {\n            if (distances[i] === undefined) continue;\n\n            if (result[1] === undefined || Math.abs(distances[i]!) < Math.abs(result[1])) {\n                result = [planes[i], distances[i]];\n            }\n        }\n\n        return result[0];\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nexport enum Dimension {\n    None = 0,\n    D1 = 1,\n    D2 = 2,\n    D3 = 4,\n\n    D1D2 = 1 | 2,\n    D1D2D3 = 1 | 2 | 4,\n}\n\nexport namespace Dimension {\n    export function contains(d1: Dimension, d2: Dimension): boolean {\n        if (d2 === Dimension.None) return false;\n        return (d1 & d2) === d2;\n    }\n\n    /**\n     *\n     * @param value 1: D1, 2: D2, 3: D3, other: None\n     * @returns\n     */\n    export function from(value: number): Dimension {\n        const mapping: { [key: number]: Dimension } = {\n            1: Dimension.D1,\n            2: Dimension.D2,\n            3: Dimension.D3,\n        };\n        return mapping[value] || Dimension.None;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    AsyncController,\n    CursorType,\n    I18nKeys,\n    IDisposable,\n    IDocument,\n    IEventHandler,\n    INode,\n    INodeFilter,\n    ISelection,\n    IShapeFilter,\n    Logger,\n    PubSub,\n    ShapeNode,\n    ShapeType,\n    VisualNode,\n    VisualState,\n} from \"chili-core\";\nimport { NodeSelectionHandler, SubshapeSelectionHandler } from \"chili-vis\";\n\nexport class Selection implements ISelection, IDisposable {\n    private _selectedNodes: INode[] = [];\n    private _unselectedNodes: INode[] = [];\n\n    shapeType: ShapeType = ShapeType.Shape;\n    shapeFilter?: IShapeFilter;\n    nodeFilter?: INodeFilter;\n\n    constructor(readonly document: IDocument) {}\n\n    async pickShape(\n        prompt: I18nKeys,\n        controller: AsyncController,\n        multiMode: boolean,\n        selectedState: VisualState = VisualState.edgeSelected,\n        highlightState: VisualState = VisualState.edgeHighlight,\n    ) {\n        const handler = new SubshapeSelectionHandler(\n            this.document,\n            this.shapeType,\n            multiMode,\n            controller,\n            this.shapeFilter,\n            this.nodeFilter,\n        );\n        handler.selectedState = selectedState;\n        handler.highlightState = highlightState;\n        await this.pickAsync(handler, prompt, controller, multiMode);\n        return handler.shapes();\n    }\n\n    async pickNode(prompt: I18nKeys, controller: AsyncController, multiMode: boolean) {\n        const handler = new NodeSelectionHandler(this.document, multiMode, controller, this.nodeFilter);\n        await this.pickAsync(handler, prompt, controller, multiMode);\n        return handler.nodes();\n    }\n\n    async pickAsync(\n        handler: IEventHandler,\n        prompt: I18nKeys,\n        controller: AsyncController,\n        showControl: boolean,\n        cursor: CursorType = \"select.default\",\n    ) {\n        const oldHandler = this.document.visual.eventHandler;\n        this.document.visual.eventHandler = handler;\n        PubSub.default.pub(\"viewCursor\", cursor);\n        PubSub.default.pub(\"statusBarTip\", prompt);\n        if (showControl) PubSub.default.pub(\"showSelectionControl\", controller);\n\n        try {\n            await new Promise((resolve, reject) => {\n                controller.onCompleted(resolve);\n                controller.onCancelled(reject);\n            });\n        } catch (e) {\n            Logger.debug(\"pick status: \", e);\n        } finally {\n            if (showControl) PubSub.default.pub(\"clearSelectionControl\");\n            PubSub.default.pub(\"clearStatusBarTip\");\n            this.document.visual.eventHandler = oldHandler;\n            PubSub.default.pub(\"viewCursor\", \"default\");\n        }\n    }\n\n    dispose(): void {\n        this._selectedNodes.length = 0;\n        this._unselectedNodes.length = 0;\n    }\n\n    getSelectedNodes(): INode[] {\n        return this._selectedNodes;\n    }\n\n    setSelection(nodes: INode[], toggle: boolean) {\n        nodes = nodes.filter(this.shapeNodeFilter);\n        if (toggle) {\n            this.toggleSelectPublish(nodes, true);\n        } else {\n            this.removeSelectedPublish(this._selectedNodes, false);\n            this.addSelectPublish(nodes, true);\n        }\n        return this._selectedNodes.length;\n    }\n\n    private readonly shapeNodeFilter = (x: INode) => {\n        if (x instanceof ShapeNode) {\n            let shape = x.shape.value;\n            if (!shape || !this.shapeFilter) return true;\n            return this.shapeFilter.allow(shape);\n        }\n\n        if (this.nodeFilter) {\n            return this.nodeFilter.allow(x);\n        }\n\n        return true;\n    };\n\n    deselect(nodes: INode[]) {\n        this.removeSelectedPublish(nodes, true);\n    }\n\n    clearSelection() {\n        this.removeSelectedPublish(this._selectedNodes, true);\n    }\n\n    private updateSelection() {\n        this.document.visual.update();\n        PubSub.default.pub(\"selectionChanged\", this.document, this._selectedNodes, this._unselectedNodes);\n    }\n\n    private toggleSelectPublish(nodes: INode[], publish: boolean) {\n        const selected = nodes.filter((m) => this._selectedNodes.includes(m));\n        const unSelected = nodes.filter((m) => !this._selectedNodes.includes(m));\n        this.removeSelectedPublish(selected, false);\n        this.addSelectPublish(unSelected, publish);\n    }\n\n    private addSelectPublish(nodes: INode[], publish: boolean) {\n        nodes.forEach((m) => {\n            if (m instanceof VisualNode) {\n                const visual = this.document.visual.context.getVisual(m);\n                if (visual)\n                    this.document.visual.highlighter.addState(\n                        visual,\n                        VisualState.edgeSelected,\n                        ShapeType.Shape,\n                    );\n            }\n        });\n        this._selectedNodes.push(...nodes);\n        if (publish) this.updateSelection();\n    }\n\n    private removeSelectedPublish(nodes: INode[], publish: boolean) {\n        for (const node of nodes) {\n            if (node instanceof VisualNode) {\n                let visual = this.document.visual.context.getVisual(node);\n                if (visual)\n                    this.document.visual.highlighter.removeState(\n                        visual,\n                        VisualState.edgeSelected,\n                        ShapeType.Shape,\n                    );\n            }\n        }\n        this._selectedNodes = this._selectedNodes.filter((m) => !nodes.includes(m));\n        this._unselectedNodes = nodes;\n        if (publish) this.updateSelection();\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    Act,\n    CollectionAction,\n    CollectionChangedArgs,\n    Component,\n    Constants,\n    FolderNode,\n    History,\n    I18n,\n    IApplication,\n    IDocument,\n    INode,\n    INodeChangedObserver,\n    INodeLinkedList,\n    ISelection,\n    IVisual,\n    Id,\n    Logger,\n    Material,\n    NodeLinkedListHistoryRecord,\n    NodeRecord,\n    NodeSerializer,\n    Observable,\n    ObservableCollection,\n    PubSub,\n    Serialized,\n    Serializer,\n    Transaction,\n} from \"chili-core\";\nimport { Selection } from \"./selection\";\n\nexport class Document extends Observable implements IDocument {\n    readonly components: Component[] = [];\n    readonly visual: IVisual;\n    readonly history: History;\n    readonly selection: ISelection;\n    readonly acts = new ObservableCollection<Act>();\n    readonly materials: ObservableCollection<Material> = new ObservableCollection();\n\n    private readonly _nodeChangedObservers = new Set<INodeChangedObserver>();\n\n    static readonly version = __DOCUMENT_VERSION__;\n\n    get name(): string {\n        return this.getPrivateValue(\"name\");\n    }\n    set name(name: string) {\n        if (this.name === name) return;\n        this.setProperty(\"name\", name);\n        if (this._rootNode) this._rootNode.name = name;\n    }\n\n    private _rootNode: INodeLinkedList | undefined;\n    @Serializer.serialze()\n    get rootNode(): INodeLinkedList {\n        if (this._rootNode === undefined) {\n            this.setRootNode(this.initRootNode());\n        }\n        return this._rootNode!;\n    }\n    set rootNode(value: INodeLinkedList) {\n        this.setRootNode(value);\n    }\n\n    private setRootNode(value?: INodeLinkedList) {\n        if (this._rootNode === value) return;\n        this._rootNode?.removePropertyChanged(this.handleRootNodeNameChanged);\n        this._rootNode = value ?? new FolderNode(this, this.name);\n        this._rootNode.onPropertyChanged(this.handleRootNodeNameChanged);\n    }\n\n    private _currentNode?: INodeLinkedList;\n    get currentNode(): INodeLinkedList | undefined {\n        return this._currentNode;\n    }\n    set currentNode(value: INodeLinkedList | undefined) {\n        this.setProperty(\"currentNode\", value);\n    }\n\n    constructor(\n        readonly application: IApplication,\n        name: string,\n        readonly id: string = Id.generate(),\n    ) {\n        super();\n        this.setPrivateValue(\"name\", name);\n        this.history = new History();\n        this.visual = application.visualFactory.create(this);\n        this.selection = new Selection(this);\n        this.materials.onCollectionChanged(this.handleMaterialChanged);\n        application.documents.add(this);\n\n        Logger.info(`new document: ${name}`);\n    }\n\n    private readonly handleRootNodeNameChanged = (prop: string) => {\n        if (prop === \"name\") {\n            this.name = this.rootNode.name;\n        }\n    };\n\n    initRootNode() {\n        return new FolderNode(this, this.name);\n    }\n\n    serialize(): Serialized {\n        let serialized = {\n            classKey: \"Document\",\n            version: __DOCUMENT_VERSION__,\n            properties: {\n                id: this.id,\n                name: this.name,\n                components: this.components.map((x) => Serializer.serializeObject(x)),\n                nodes: NodeSerializer.serialize(this.rootNode),\n                materials: this.materials.map((x) => Serializer.serializeObject(x)),\n                acts: this.acts.map((x) => Serializer.serializeObject(x)),\n            },\n        };\n        return serialized;\n    }\n\n    override disposeInternal(): void {\n        super.disposeInternal();\n        this._nodeChangedObservers.clear();\n        this._rootNode?.removePropertyChanged(this.handleRootNodeNameChanged);\n        this._rootNode?.dispose();\n        this.visual.dispose();\n        this.history.dispose();\n        this.selection.dispose();\n        this.materials.forEach((x) => x.dispose());\n        this.materials.clear();\n        this.acts.forEach((x) => x.dispose());\n        this.acts.clear();\n\n        this._rootNode = undefined;\n        this._currentNode = undefined;\n    }\n\n    async save() {\n        const data = this.serialize();\n        await this.application.storage.put(Constants.DBName, Constants.DocumentTable, this.id, data);\n        const image = this.application.activeView?.toImage();\n        await this.application.storage.put(Constants.DBName, Constants.RecentTable, this.id, {\n            id: this.id,\n            name: this.name,\n            date: Date.now(),\n            image,\n        });\n    }\n\n    async close() {\n        if (window.confirm(I18n.translate(\"prompt.saveDocument{0}\", this.name))) {\n            await this.save();\n        }\n\n        let views = this.application.views.filter((x) => x.document === this);\n        this.application.views.remove(...views);\n        this.application.activeView = this.application.views.at(0);\n        this.application.documents.delete(this);\n        this.materials.removeCollectionChanged(this.handleMaterialChanged);\n        PubSub.default.pub(\"documentClosed\", this);\n\n        Logger.info(`document: ${this.name} closed`);\n        this.dispose();\n    }\n\n    static async open(application: IApplication, id: string) {\n        let data = (await application.storage.get(\n            Constants.DBName,\n            Constants.DocumentTable,\n            id,\n        )) as Serialized;\n        if (data === undefined) {\n            Logger.warn(`document: ${id} not find`);\n            return;\n        }\n        let document = await this.load(application, data);\n        if (document !== undefined) {\n            Logger.info(`document: ${document.name} opened`);\n        }\n        return document;\n    }\n\n    static async load(app: IApplication, data: Serialized): Promise<IDocument | undefined> {\n        if ((data as any).version !== __DOCUMENT_VERSION__) {\n            alert(\n                \"The file version has been upgraded, no compatibility treatment was done in the development phase\",\n            );\n            return undefined;\n        }\n        let document = new Document(app, data.properties[\"name\"], data.properties[\"id\"]);\n        document.history.disabled = true;\n        document.materials.push(\n            ...data.properties[\"materials\"].map((x: Serialized) =>\n                Serializer.deserializeObject(document, x),\n            ),\n        );\n        document.acts.push(\n            ...data.properties[\"acts\"].map((x: Serialized) => Serializer.deserializeObject(document, x)),\n        );\n        document.components.push(\n            ...data.properties[\"components\"].map((x: Serialized) =>\n                Serializer.deserializeObject(document, x),\n            ),\n        );\n\n        const rootNode = await NodeSerializer.deserialize(document, data.properties[\"nodes\"]);\n        document.setRootNode(rootNode);\n        document.history.disabled = false;\n        return document;\n    }\n\n    private readonly handleMaterialChanged = (args: CollectionChangedArgs) => {\n        if (args.action === CollectionAction.add) {\n            Transaction.add(this, {\n                name: \"MaterialChanged\",\n                dispose() {},\n                undo: () => this.materials.remove(...args.items),\n                redo: () => this.materials.push(...args.items),\n            });\n        } else if (args.action === CollectionAction.remove) {\n            Transaction.add(this, {\n                name: \"MaterialChanged\",\n                dispose() {},\n                undo: () => this.materials.push(...args.items),\n                redo: () => this.materials.remove(...args.items),\n            });\n        }\n    };\n\n    addNodeObserver(observer: INodeChangedObserver) {\n        this._nodeChangedObservers.add(observer);\n    }\n\n    removeNodeObserver(observer: INodeChangedObserver) {\n        this._nodeChangedObservers.delete(observer);\n    }\n\n    notifyNodeChanged(records: NodeRecord[]) {\n        Transaction.add(this, new NodeLinkedListHistoryRecord(records));\n        this._nodeChangedObservers.forEach((x) => x.handleNodeChanged(records));\n    }\n\n    addNode(...nodes: INode[]): void {\n        (this.currentNode ?? this.rootNode).add(...nodes);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { I18n, IApplication, PubSub, Transaction } from \"chili-core\";\n\nexport async function importFiles(application: IApplication, files: File[] | FileList) {\n    let document = application.activeView?.document ?? (await application.newDocument(\"Untitled\"));\n    PubSub.default.pub(\n        \"showPermanent\",\n        async () => {\n            await Transaction.executeAsync(document, \"import model\", async () => {\n                await document.application.dataExchange.import(document, files);\n            });\n            document.application.activeView?.cameraController.fitContent();\n        },\n        \"toast.excuting{0}\",\n        I18n.translate(\"command.file.import\"),\n    );\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    DOCUMENT_FILE_EXTENSION,\n    getCurrentApplication,\n    I18n,\n    IApplication,\n    ICommand,\n    IDataExchange,\n    IDocument,\n    IService,\n    IShapeFactory,\n    IStorage,\n    IView,\n    IVisualFactory,\n    IWindow,\n    Material,\n    ObservableCollection,\n    Plane,\n    PubSub,\n    Serialized,\n    setCurrentApplication,\n} from \"chili-core\";\nimport { Document } from \"./document\";\nimport { importFiles } from \"./utils\";\n\nexport interface ApplicationOptions {\n    visualFactory: IVisualFactory;\n    shapeFactory: IShapeFactory;\n    services: IService[];\n    storage: IStorage;\n    dataExchange: IDataExchange;\n    mainWindow?: IWindow;\n}\n\nexport class Application implements IApplication {\n    readonly dataExchange: IDataExchange;\n    readonly visualFactory: IVisualFactory;\n    readonly shapeFactory: IShapeFactory;\n    readonly services: IService[];\n    readonly storage: IStorage;\n    readonly mainWindow?: IWindow;\n\n    readonly views = new ObservableCollection<IView>();\n    readonly documents: Set<IDocument> = new Set<IDocument>();\n\n    executingCommand: ICommand | undefined;\n\n    private _activeView: IView | undefined;\n    get activeView(): IView | undefined {\n        return this._activeView;\n    }\n    set activeView(value: IView | undefined) {\n        if (this._activeView === value) return;\n        this._activeView = value;\n        PubSub.default.pub(\"activeViewChanged\", value);\n    }\n\n    constructor(option: ApplicationOptions) {\n        if (getCurrentApplication() !== undefined) {\n            throw new Error(\"Only one application can be created\");\n        }\n        setCurrentApplication(this);\n        this.visualFactory = option.visualFactory;\n        this.shapeFactory = option.shapeFactory;\n        this.services = option.services;\n        this.storage = option.storage;\n        this.dataExchange = option.dataExchange;\n        this.mainWindow = option.mainWindow;\n\n        this.services.forEach((x) => x.register(this));\n        this.services.forEach((x) => x.start());\n\n        this.initWindowEvents();\n    }\n\n    private initWindowEvents() {\n        window.onbeforeunload = this.handleWindowUnload;\n        window.addEventListener(\n            \"dragstart\",\n            (ev) => {\n                ev.preventDefault();\n            },\n            false,\n        );\n        window.addEventListener(\n            \"dragover\",\n            (ev) => {\n                ev.stopPropagation();\n                ev.preventDefault();\n                ev.dataTransfer!.dropEffect = \"copy\";\n            },\n            false,\n        );\n        window.addEventListener(\n            \"drop\",\n            (ev) => {\n                ev.stopPropagation();\n                ev.preventDefault();\n                this.importFiles(ev.dataTransfer?.files);\n            },\n            false,\n        );\n    }\n\n    private readonly handleWindowUnload = (event: BeforeUnloadEvent) => {\n        if (this.activeView) {\n            // Cancel the event as stated by the standard.\n            event.preventDefault();\n            // Chrome requires returnValue to be set.\n            event.returnValue = \"\";\n        }\n    };\n\n    async importFiles(files: FileList | undefined) {\n        if (!files || files.length === 0) {\n            return;\n        }\n        const { opens, imports } = this.groupFiles(files);\n        this.loadDocumentsWithLoading(opens);\n        importFiles(this, imports);\n    }\n\n    private loadDocumentsWithLoading(opens: File[]) {\n        PubSub.default.pub(\n            \"showPermanent\",\n            async () => {\n                for (const file of opens) {\n                    let json: Serialized = JSON.parse(await file.text());\n                    await this.loadDocument(json);\n                    this.activeView?.cameraController.fitContent();\n                }\n            },\n            \"toast.excuting{0}\",\n            I18n.translate(\"command.doc.open\"),\n        );\n    }\n\n    private groupFiles(files: FileList) {\n        const opens: File[] = [];\n        const imports: File[] = [];\n        for (const element of files) {\n            if (element.name.endsWith(DOCUMENT_FILE_EXTENSION)) {\n                opens.push(element);\n            } else {\n                imports.push(element);\n            }\n        }\n        return { opens, imports };\n    }\n\n    async openDocument(id: string): Promise<IDocument | undefined> {\n        const document = await Document.open(this, id);\n        await this.createActiveView(document);\n        return document;\n    }\n\n    async newDocument(name: string): Promise<IDocument> {\n        const document = new Document(this, name);\n        const lightGray = new Material(document, \"LightGray\", 0xdedede);\n        const deepGray = new Material(document, \"DeepGray\", 0x898989);\n        document.materials.push(lightGray, deepGray);\n        await this.createActiveView(document);\n        return document;\n    }\n\n    async loadDocument(data: Serialized): Promise<IDocument | undefined> {\n        const document = await Document.load(this, data);\n        await this.createActiveView(document);\n        return document;\n    }\n\n    protected async createActiveView(document: IDocument | undefined) {\n        if (document === undefined) return undefined;\n        const view = document.visual.createView(\"3d\", Plane.XY);\n        this.activeView = view;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    I18nKeys,\n    IDocument,\n    IShape,\n    ParameterShapeNode,\n    Plane,\n    Property,\n    Result,\n    Serializer,\n} from \"chili-core\";\n\n@Serializer.register([\"document\", \"plane\", \"dx\", \"dy\", \"dz\"])\nexport class BoxNode extends ParameterShapeNode {\n    override display(): I18nKeys {\n        return \"body.box\";\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"box.dx\")\n    get dx() {\n        return this.getPrivateValue(\"dx\");\n    }\n    set dx(dx: number) {\n        this.setPropertyEmitShapeChanged(\"dx\", dx);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"box.dy\")\n    get dy() {\n        return this.getPrivateValue(\"dy\");\n    }\n    set dy(dy: number) {\n        this.setPropertyEmitShapeChanged(\"dy\", dy);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"box.dz\")\n    get dz() {\n        return this.getPrivateValue(\"dz\");\n    }\n    set dz(dz: number) {\n        this.setPropertyEmitShapeChanged(\"dz\", dz);\n    }\n\n    @Serializer.serialze()\n    get plane(): Plane {\n        return this.getPrivateValue(\"plane\");\n    }\n\n    constructor(document: IDocument, plane: Plane, dx: number, dy: number, dz: number) {\n        super(document);\n        this.setPrivateValue(\"plane\", plane);\n        this.setPrivateValue(\"dx\", dx);\n        this.setPrivateValue(\"dy\", dy);\n        this.setPrivateValue(\"dz\", dz);\n    }\n\n    generateShape(): Result<IShape> {\n        return this.document.application.shapeFactory.box(this.plane, this.dx, this.dy, this.dz);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { FacebaseNode, I18nKeys, IDocument, IShape, Property, Result, Serializer, XYZ } from \"chili-core\";\n\n@Serializer.register([\"document\", \"normal\", \"center\", \"radius\"])\nexport class CircleNode extends FacebaseNode {\n    override display(): I18nKeys {\n        return \"body.circle\";\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"circle.center\")\n    get center() {\n        return this.getPrivateValue(\"center\");\n    }\n    set center(center: XYZ) {\n        this.setPropertyEmitShapeChanged(\"center\", center);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"circle.radius\")\n    get radius() {\n        return this.getPrivateValue(\"radius\");\n    }\n    set radius(radius: number) {\n        this.setPropertyEmitShapeChanged(\"radius\", radius);\n    }\n\n    @Serializer.serialze()\n    get normal(): XYZ {\n        return this.getPrivateValue(\"normal\");\n    }\n\n    constructor(document: IDocument, normal: XYZ, center: XYZ, radius: number) {\n        super(document);\n        this.setPrivateValue(\"normal\", normal);\n        this.setPrivateValue(\"center\", center);\n        this.setPrivateValue(\"radius\", radius);\n    }\n\n    generateShape(): Result<IShape, string> {\n        let circle = this.document.application.shapeFactory.circle(this.normal, this.center, this.radius);\n        if (!circle.isOk || !this.isFace) return circle;\n        let wire = this.document.application.shapeFactory.wire([circle.value]);\n        return wire.isOk ? wire.value.toFace() : circle;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    I18nKeys,\n    IDocument,\n    IShape,\n    ParameterShapeNode,\n    Property,\n    Result,\n    Serializer,\n    XYZ,\n} from \"chili-core\";\n\n@Serializer.register([\"document\", \"normal\", \"center\", \"radius\", \"dz\"])\nexport class ConeNode extends ParameterShapeNode {\n    override display(): I18nKeys {\n        return \"body.cone\";\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"circle.center\")\n    get center() {\n        return this.getPrivateValue(\"center\");\n    }\n    set center(center: XYZ) {\n        this.setPropertyEmitShapeChanged(\"center\", center);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"circle.radius\")\n    get radius() {\n        return this.getPrivateValue(\"radius\");\n    }\n    set radius(dy: number) {\n        this.setPropertyEmitShapeChanged(\"radius\", dy);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"box.dz\")\n    get dz() {\n        return this.getPrivateValue(\"dz\");\n    }\n    set dz(dz: number) {\n        this.setPropertyEmitShapeChanged(\"dz\", dz);\n    }\n\n    @Serializer.serialze()\n    get normal(): XYZ {\n        return this.getPrivateValue(\"normal\");\n    }\n\n    constructor(document: IDocument, normal: XYZ, center: XYZ, radius: number, dz: number) {\n        super(document);\n        this.setPrivateValue(\"normal\", normal);\n        this.setPrivateValue(\"center\", center);\n        this.setPrivateValue(\"radius\", radius);\n        this.setPrivateValue(\"dz\", dz);\n    }\n\n    generateShape(): Result<IShape> {\n        return this.document.application.shapeFactory.cone(\n            this.normal,\n            this.center,\n            this.radius,\n            0,\n            this.dz,\n        );\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    I18nKeys,\n    IDocument,\n    IShape,\n    ParameterShapeNode,\n    Property,\n    Result,\n    Serializer,\n    XYZ,\n} from \"chili-core\";\n\n@Serializer.register([\"document\", \"normal\", \"center\", \"radius\", \"dz\"])\nexport class CylinderNode extends ParameterShapeNode {\n    override display(): I18nKeys {\n        return \"body.cylinder\";\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"circle.center\")\n    get center() {\n        return this.getPrivateValue(\"center\");\n    }\n    set center(center: XYZ) {\n        this.setPropertyEmitShapeChanged(\"center\", center);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"circle.radius\")\n    get radius() {\n        return this.getPrivateValue(\"radius\");\n    }\n    set radius(dy: number) {\n        this.setPropertyEmitShapeChanged(\"radius\", dy);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"box.dz\")\n    get dz() {\n        return this.getPrivateValue(\"dz\");\n    }\n    set dz(dz: number) {\n        this.setPropertyEmitShapeChanged(\"dz\", dz);\n    }\n\n    @Serializer.serialze()\n    get normal(): XYZ {\n        return this.getPrivateValue(\"normal\");\n    }\n\n    constructor(document: IDocument, normal: XYZ, center: XYZ, radius: number, dz: number) {\n        super(document);\n        this.setPrivateValue(\"normal\", normal);\n        this.setPrivateValue(\"center\", center);\n        this.setPrivateValue(\"radius\", radius);\n        this.setPrivateValue(\"dz\", dz);\n    }\n\n    generateShape(): Result<IShape> {\n        return this.document.application.shapeFactory.cylinder(\n            this.normal,\n            this.center,\n            this.radius,\n            this.dz,\n        );\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { FacebaseNode, I18nKeys, IDocument, IShape, Property, Result, Serializer, XYZ } from \"chili-core\";\n\n@Serializer.register([\"document\", \"normal\", \"center\", \"xvec\", \"majorRadius\", \"minorRadius\"])\nexport class EllipseNode extends FacebaseNode {\n    override display(): I18nKeys {\n        return \"body.ellipse\";\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"circle.center\")\n    get center() {\n        return this.getPrivateValue(\"center\");\n    }\n    set center(center: XYZ) {\n        this.setPropertyEmitShapeChanged(\"center\", center);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"ellipse.majorRadius\")\n    get majorRadius() {\n        return this.getPrivateValue(\"majorRadius\");\n    }\n    set majorRadius(radius: number) {\n        this.setPropertyEmitShapeChanged(\"majorRadius\", radius);\n    }\n    @Serializer.serialze()\n    @Property.define(\"ellipse.minorRadius\")\n    get minorRadius() {\n        return this.getPrivateValue(\"minorRadius\");\n    }\n    set minorRadius(radius: number) {\n        this.setPropertyEmitShapeChanged(\"minorRadius\", radius);\n    }\n\n    @Serializer.serialze()\n    get normal(): XYZ {\n        return this.getPrivateValue(\"normal\");\n    }\n\n    @Serializer.serialze()\n    get xvec(): XYZ {\n        return this.getPrivateValue(\"xvec\");\n    }\n\n    constructor(\n        document: IDocument,\n        normal: XYZ,\n        center: XYZ,\n        xvec: XYZ,\n        majorRadius: number,\n        minorRadius: number,\n    ) {\n        super(document);\n        this.setPrivateValue(\"normal\", normal);\n        this.setPrivateValue(\"center\", center);\n        this.setPrivateValue(\"xvec\", xvec);\n        this.setPrivateValue(\"majorRadius\", majorRadius);\n        this.setPrivateValue(\"minorRadius\", minorRadius);\n    }\n\n    generateShape(): Result<IShape, string> {\n        let circle = this.document.application.shapeFactory.ellipse(\n            this.normal,\n            this.center,\n            this.xvec,\n            this.majorRadius,\n            this.minorRadius,\n        );\n        if (!circle.isOk || !this.isFace) return circle;\n        let wire = this.document.application.shapeFactory.wire([circle.value]);\n        return wire.isOk ? wire.value.toFace() : circle;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    I18nKeys,\n    IDocument,\n    IShape,\n    ParameterShapeNode,\n    Property,\n    Result,\n    Serializer,\n    XYZ,\n} from \"chili-core\";\n\n@Serializer.register([\"document\", \"start\", \"end\"])\nexport class LineNode extends ParameterShapeNode {\n    override display(): I18nKeys {\n        return \"body.line\";\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"line.start\")\n    get start() {\n        return this.getPrivateValue(\"start\");\n    }\n    set start(pnt: XYZ) {\n        this.setPropertyEmitShapeChanged(\"start\", pnt);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"line.end\")\n    get end() {\n        return this.getPrivateValue(\"end\");\n    }\n    set end(pnt: XYZ) {\n        this.setPropertyEmitShapeChanged(\"end\", pnt);\n    }\n\n    constructor(document: IDocument, start: XYZ, end: XYZ) {\n        super(document);\n        this.setPrivateValue(\"start\", start);\n        this.setPrivateValue(\"end\", end);\n    }\n\n    generateShape(): Result<IShape, string> {\n        return this.document.application.shapeFactory.line(this.start, this.end);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { FacebaseNode, I18nKeys, IDocument, IShape, Property, Result, Serializer, XYZ } from \"chili-core\";\n\n@Serializer.register([\"document\", \"points\"])\nexport class PolygonNode extends FacebaseNode {\n    override display(): I18nKeys {\n        return \"body.polygon\";\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"polygon.points\")\n    get points() {\n        return this.getPrivateValue(\"points\");\n    }\n    set points(value: XYZ[]) {\n        this.setPropertyEmitShapeChanged(\"points\", value);\n    }\n\n    constructor(document: IDocument, points: XYZ[]) {\n        super(document);\n        this.setPrivateValue(\"points\", points);\n    }\n\n    generateShape(): Result<IShape, string> {\n        let wire = this.document.application.shapeFactory.polygon(this.points);\n        if (!wire.isOk || !this.isFace) return wire;\n        return wire.value.toFace();\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { I18nKeys, IDocument, IShape, ParameterShapeNode, Property, Result, Serializer } from \"chili-core\";\nimport { GeoUtils } from \"chili-geo\";\n\n@Serializer.register([\"document\", \"section\", \"length\"])\nexport class PrismNode extends ParameterShapeNode {\n    override display(): I18nKeys {\n        return \"body.prism\";\n    }\n\n    @Serializer.serialze()\n    get section(): IShape {\n        return this.getPrivateValue(\"section\");\n    }\n    set section(value: IShape) {\n        this.setPropertyEmitShapeChanged(\"section\", value);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"common.length\")\n    get length(): number {\n        return this.getPrivateValue(\"length\");\n    }\n    set length(value: number) {\n        this.setPropertyEmitShapeChanged(\"length\", value);\n    }\n\n    constructor(document: IDocument, face: IShape, length: number) {\n        super(document);\n        this.setPrivateValue(\"section\", face);\n        this.setPrivateValue(\"length\", length);\n    }\n\n    override generateShape(): Result<IShape> {\n        let normal = GeoUtils.normal(this.section as any);\n        let vec = normal.multiply(this.length);\n        return this.document.application.shapeFactory.prism(this.section, vec);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    I18nKeys,\n    IDocument,\n    IShape,\n    ParameterShapeNode,\n    Plane,\n    Property,\n    Result,\n    Serializer,\n} from \"chili-core\";\n\n@Serializer.register([\"document\", \"plane\", \"dx\", \"dy\", \"dz\"])\nexport class PyramidNode extends ParameterShapeNode {\n    override display(): I18nKeys {\n        return \"body.pyramid\";\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"box.dx\")\n    get dx() {\n        return this.getPrivateValue(\"dx\");\n    }\n    set dx(dx: number) {\n        this.setPropertyEmitShapeChanged(\"dx\", dx);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"box.dy\")\n    get dy() {\n        return this.getPrivateValue(\"dy\");\n    }\n    set dy(dy: number) {\n        this.setPropertyEmitShapeChanged(\"dy\", dy);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"box.dz\")\n    get dz() {\n        return this.getPrivateValue(\"dz\");\n    }\n    set dz(dz: number) {\n        this.setPropertyEmitShapeChanged(\"dz\", dz);\n    }\n\n    @Serializer.serialze()\n    get plane(): Plane {\n        return this.getPrivateValue(\"plane\");\n    }\n\n    constructor(document: IDocument, plane: Plane, dx: number, dy: number, dz: number) {\n        super(document);\n        this.setPrivateValue(\"plane\", plane);\n        this.setPrivateValue(\"dx\", dx);\n        this.setPrivateValue(\"dy\", dy);\n        this.setPrivateValue(\"dz\", dz);\n    }\n\n    generateShape(): Result<IShape> {\n        return this.document.application.shapeFactory.pyramid(this.plane, this.dx, this.dy, this.dz);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    FacebaseNode,\n    I18nKeys,\n    IDocument,\n    IShape,\n    Plane,\n    Property,\n    Result,\n    Serializer,\n    XYZ,\n} from \"chili-core\";\n\n@Serializer.register([\"document\", \"plane\", \"dx\", \"dy\"])\nexport class RectNode extends FacebaseNode {\n    override display(): I18nKeys {\n        return \"body.rect\";\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"rect.dx\")\n    get dx() {\n        return this.getPrivateValue(\"dx\");\n    }\n    set dx(dx: number) {\n        this.setPropertyEmitShapeChanged(\"dx\", dx);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"rect.dy\")\n    get dy() {\n        return this.getPrivateValue(\"dy\");\n    }\n    set dy(dy: number) {\n        this.setPropertyEmitShapeChanged(\"dy\", dy);\n    }\n\n    @Serializer.serialze()\n    get plane(): Plane {\n        return this.getPrivateValue(\"plane\");\n    }\n\n    constructor(document: IDocument, plane: Plane, dx: number, dy: number) {\n        super(document);\n        this.setPrivateValue(\"plane\", plane);\n        this.setPrivateValue(\"dx\", dx);\n        this.setPrivateValue(\"dy\", dy);\n    }\n\n    generateShape(): Result<IShape, string> {\n        let points = RectNode.points(this.plane, this.dx, this.dy);\n        let wire = this.document.application.shapeFactory.polygon(points);\n        if (!wire.isOk || !this.isFace) return wire;\n        return wire.value.toFace();\n    }\n\n    static points(plane: Plane, dx: number, dy: number): XYZ[] {\n        let start = plane.origin;\n        return [\n            start,\n            start.add(plane.xvec.multiply(dx)),\n            start.add(plane.xvec.multiply(dx)).add(plane.yvec.multiply(dy)),\n            start.add(plane.yvec.multiply(dy)),\n            start,\n        ];\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { I18nKeys, IDocument, IShape, ParameterShapeNode, Ray, Result, Serializer } from \"chili-core\";\n\n@Serializer.register([\"document\", \"profile\", \"axis\", \"angle\"])\nexport class RevolvedNode extends ParameterShapeNode {\n    override display(): I18nKeys {\n        return \"body.revol\";\n    }\n\n    @Serializer.serialze()\n    get profile() {\n        return this.getPrivateValue(\"profile\");\n    }\n    set profile(value: IShape) {\n        this.setPropertyEmitShapeChanged(\"profile\", value);\n    }\n\n    @Serializer.serialze()\n    get axis() {\n        return this.getPrivateValue(\"axis\");\n    }\n    set axis(value: Ray) {\n        this.setPropertyEmitShapeChanged(\"axis\", value);\n    }\n\n    @Serializer.serialze()\n    get angle() {\n        return this.getPrivateValue(\"angle\");\n    }\n    set angle(value: number) {\n        this.setPropertyEmitShapeChanged(\"angle\", value);\n    }\n\n    constructor(document: IDocument, profile: IShape, axis: Ray, angle: number) {\n        super(document);\n        this.setPrivateValue(\"profile\", profile);\n        this.setPrivateValue(\"axis\", axis);\n        this.setPrivateValue(\"angle\", angle);\n    }\n\n    override generateShape(): Result<IShape> {\n        return this.document.application.shapeFactory.revolve(this.profile, this.axis, this.angle);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    I18nKeys,\n    IDocument,\n    IShape,\n    ParameterShapeNode,\n    Property,\n    Result,\n    Serializer,\n    XYZ,\n} from \"chili-core\";\n\n@Serializer.register([\"document\", \"center\", \"radius\"])\nexport class SphereNode extends ParameterShapeNode {\n    override display(): I18nKeys {\n        return \"body.sphere\";\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"circle.center\")\n    get center() {\n        return this.getPrivateValue(\"center\");\n    }\n    set center(center: XYZ) {\n        this.setPropertyEmitShapeChanged(\"center\", center);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"circle.radius\")\n    get radius() {\n        return this.getPrivateValue(\"radius\");\n    }\n    set radius(value: number) {\n        this.setPropertyEmitShapeChanged(\"radius\", value);\n    }\n\n    constructor(document: IDocument, center: XYZ, radius: number) {\n        super(document);\n        this.setPrivateValue(\"center\", center);\n        this.setPrivateValue(\"radius\", radius);\n    }\n\n    generateShape(): Result<IShape> {\n        return this.document.application.shapeFactory.sphere(this.center, this.radius);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    I18nKeys,\n    IDocument,\n    IEdge,\n    IShape,\n    IWire,\n    ParameterShapeNode,\n    Result,\n    Serializer,\n    ShapeType,\n} from \"chili-core\";\n\n@Serializer.register([\"document\", \"profile\", \"path\", \"round\"])\nexport class SweepedNode extends ParameterShapeNode {\n    override display(): I18nKeys {\n        return \"body.sweep\";\n    }\n\n    @Serializer.serialze()\n    get profile() {\n        return this.getPrivateValue(\"profile\");\n    }\n    set profile(value: IShape[]) {\n        this.setPropertyEmitShapeChanged(\"profile\", value);\n    }\n\n    @Serializer.serialze()\n    get path() {\n        return this.getPrivateValue(\"path\");\n    }\n    set path(value: IWire) {\n        this.setPropertyEmitShapeChanged(\"path\", value);\n    }\n\n    @Serializer.serialze()\n    get round() {\n        return this.getPrivateValue(\"round\");\n    }\n    set round(value: boolean) {\n        this.setPropertyEmitShapeChanged(\"round\", value);\n    }\n\n    constructor(document: IDocument, profile: (IWire | IEdge)[], path: IWire | IEdge, round: boolean) {\n        super(document);\n        this.setPrivateValue(\n            \"profile\",\n            profile.map((p) => this.ensureWire(p)),\n        );\n        this.setPrivateValue(\"path\", this.ensureWire(path));\n        this.setPrivateValue(\"round\", round);\n    }\n\n    private ensureWire(path: IEdge | IWire) {\n        let wire = path as IWire;\n        if (path.shapeType !== ShapeType.Wire) {\n            wire = this.document.application.shapeFactory.wire([path as unknown as IEdge]).value;\n        }\n        return wire;\n    }\n\n    override generateShape(): Result<IShape> {\n        return this.document.application.shapeFactory.sweep(this.profile, this.path, this.round);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IApplication, ICommand, command } from \"chili-core\";\n\nlet count = 1;\n\n@command({\n    key: \"doc.new\",\n    icon: \"icon-new\",\n    isApplicationCommand: true,\n})\nexport class NewDocument implements ICommand {\n    async execute(app: IApplication): Promise<void> {\n        await app.newDocument(`undefined ${count++}`);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { I18n, IApplication, ICommand, PubSub, Serialized, command, readFileAsync } from \"chili-core\";\n\n@command({\n    key: \"doc.open\",\n    icon: \"icon-open\",\n    isApplicationCommand: true,\n})\nexport class OpenDocument implements ICommand {\n    async execute(app: IApplication): Promise<void> {\n        PubSub.default.pub(\n            \"showPermanent\",\n            async () => {\n                let files = await readFileAsync(\".cd\", false);\n                if (files.isOk) {\n                    let json: Serialized = JSON.parse(files.value[0].data);\n                    let document = await app.loadDocument(json);\n                    document?.application.activeView?.cameraController.fitContent();\n                }\n            },\n            \"toast.excuting{0}\",\n            I18n.translate(\"command.doc.open\"),\n        );\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    EditableShapeNode,\n    IApplication,\n    ICommand,\n    IDocument,\n    Material,\n    Plane,\n    XYZ,\n    command,\n} from \"chili-core\";\n\nexport abstract class PerformanceTestCommand implements ICommand {\n    protected size = 10;\n    protected gap = 1;\n    protected rowCols = 20;\n\n    async execute(app: IApplication): Promise<void> {\n        let document = await app.newDocument(\"OCC Performace Test\");\n\n        const start = performance.now();\n        const distance = this.gap + this.size;\n        for (let x = 0; x < this.rowCols; x++) {\n            for (let y = 0; y < this.rowCols; y++) {\n                for (let z = 0; z < this.rowCols; z++) {\n                    let position = XYZ.zero\n                        .add(XYZ.unitX.multiply(x * distance))\n                        .add(XYZ.unitY.multiply(y * distance))\n                        .add(XYZ.unitZ.multiply(z * distance));\n                    this.createShape(document, document.materials.at(0)!, position);\n                }\n            }\n        }\n        document.visual.update();\n        alert(\n            `Create ${this.rowCols * this.rowCols * this.rowCols} shapes, Time: ${performance.now() - start} ms`,\n        );\n    }\n\n    protected abstract createShape(document: IDocument, material: Material, position: XYZ): void;\n}\n\n@command({\n    key: \"test.performance\",\n    icon: \"icon-performance\",\n})\nexport class OccPerformanceTestCommand extends PerformanceTestCommand {\n    private index = 1;\n    shapes: any[] = [];\n\n    protected override createShape(document: IDocument, material: Material, position: XYZ): void {\n        let plane = Plane.XY.translateTo(position);\n        let box = document.application.shapeFactory.box(\n            plane,\n            this.size * Math.random(),\n            this.size * Math.random(),\n            this.size * Math.random(),\n        ).value;\n        let node = new EditableShapeNode(document, `box ${this.index++}`, box, material.id);\n        document.addNode(node);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { command, I18n, IApplication, ICommand, PubSub } from \"chili-core\";\n\n@command({\n    key: \"doc.save\",\n    icon: \"icon-save\",\n    isApplicationCommand: true,\n})\nexport class SaveDocument implements ICommand {\n    async execute(app: IApplication): Promise<void> {\n        if (!app.activeView?.document) return;\n        PubSub.default.pub(\n            \"showPermanent\",\n            async () => {\n                await app.activeView?.document!.save();\n                PubSub.default.pub(\"showToast\", \"toast.document.saved\");\n            },\n            \"toast.excuting{0}\",\n            I18n.translate(\"command.doc.save\"),\n        );\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    command,\n    DOCUMENT_FILE_EXTENSION,\n    download,\n    I18n,\n    IApplication,\n    ICommand,\n    PubSub,\n} from \"chili-core\";\n\n@command({\n    key: \"doc.saveToFile\",\n    icon: \"icon-download\",\n})\nexport class SaveDocumentToFile implements ICommand {\n    async execute(app: IApplication): Promise<void> {\n        if (!app.activeView?.document) return;\n        PubSub.default.pub(\n            \"showPermanent\",\n            async () => {\n                await new Promise((r, j) => {\n                    setTimeout(r, 100);\n                });\n                let s = app.activeView?.document!.serialize();\n                PubSub.default.pub(\"showToast\", \"toast.downloading\");\n                download([JSON.stringify(s)], `${app.activeView?.document!.name}${DOCUMENT_FILE_EXTENSION}`);\n            },\n            \"toast.excuting{0}\",\n            I18n.translate(\"command.doc.saveToFile\"),\n        );\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Binding, Config, IApplication, ICommand, command } from \"chili-core\";\n\n@command({\n    key: \"workingPlane.toggleDynamic\",\n    toggle: new Binding(Config.instance, \"dynamicWorkplane\"),\n    icon: \"icon-dynamicPlane\",\n})\nexport class ToggleDynamicWorkplaneCommand implements ICommand {\n    async execute(app: IApplication): Promise<void> {\n        Config.instance.dynamicWorkplane = !Config.instance.dynamicWorkplane;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { br, div, img, label } from \"chili-controls\";\nimport { IApplication, ICommand, PubSub, command } from \"chili-core\";\n\n@command({\n    key: \"wechat.group\",\n    icon: \"icon-qrcode\",\n    isApplicationCommand: true,\n})\nexport class WeChatGroup implements ICommand {\n    async execute(app: IApplication): Promise<void> {\n        PubSub.default.pub(\"showDialog\", \"command.wechat.group\", this.ui());\n    }\n\n    private ui() {\n        return div(\n            label(\n                {\n                    style: {\n                        fontSize: \"14px\",\n                        display: \"block\",\n                        textAlign: \"center\",\n                        marginBottom: \"10px\",\n                        opacity: \"0.75\",\n                    },\n                },\n                \"群聊人数已超过200人，只可通过邀请进入群聊\",\n                br(),\n                \"入群请先添加个人微信：oOxianOo\",\n            ),\n            img({\n                width: 360,\n                src: \"images/wechat.jpg\",\n                style: {\n                    borderRadius: \"10px\",\n                },\n            }),\n        );\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { I18nKeys, IDocument, IShape, ParameterShapeNode, Result, Serializer } from \"chili-core\";\n\n@Serializer.register([\"document\", \"booleanShape\"])\nexport class BooleanNode extends ParameterShapeNode {\n    override display(): I18nKeys {\n        return \"body.bolean\";\n    }\n\n    @Serializer.serialze()\n    get booleanShape(): IShape {\n        return this.getPrivateValue(\"booleanShape\");\n    }\n\n    constructor(document: IDocument, shape: IShape) {\n        super(document);\n        this.setPrivateValue(\"booleanShape\", shape);\n    }\n\n    override generateShape(): Result<IShape> {\n        return Result.ok(this.booleanShape);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { EdgeMeshData, IView, LineType, Plane, VisualConfig, XYZ } from \"chili-core\";\nimport { ISnap, MouseAndDetected, SnapResult } from \"../snap\";\n\nexport class AxisSnap implements ISnap {\n    private _tempLines?: [IView, number];\n\n    constructor(\n        readonly point: XYZ,\n        readonly direction: XYZ,\n    ) {}\n\n    snap(data: MouseAndDetected): SnapResult | undefined {\n        const right = data.view.up().cross(data.view.direction()).normalize();\n        const normal = right?.cross(this.direction).normalize();\n        if (!normal) return undefined;\n\n        const plane = new Plane(this.point, normal, right!);\n        const ray = data.view.rayAt(data.mx, data.my);\n        const intersect = plane.intersect(ray, false);\n        if (!intersect) return undefined;\n\n        const vector = intersect.sub(this.point);\n        const dot = vector.dot(this.direction);\n        const point = this.point.add(this.direction.multiply(dot));\n        this.showTempLine(data.view, dot);\n\n        return {\n            view: data.view,\n            point,\n            distance: dot,\n            shapes: [],\n        };\n    }\n\n    private showTempLine(view: IView, dot: number) {\n        const dist = Math.abs(dot) < 0.000001 ? 1e15 : 1e15 * dot;\n        const lineDats = EdgeMeshData.from(\n            this.point,\n            this.point.add(this.direction.multiply(dist)),\n            VisualConfig.temporaryEdgeColor,\n            LineType.Dash,\n        );\n        const id = view.document.visual.context.displayMesh([lineDats]);\n        this._tempLines = [view, id];\n    }\n\n    removeDynamicObject(): void {\n        this._tempLines?.[0].document.visual.context.removeMesh(this._tempLines[1]);\n    }\n\n    clear(): void {\n        this.removeDynamicObject();\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IView, VisualShapeData, VisualState, XYZ } from \"chili-core\";\nimport { ISnap, MouseAndDetected, SnapResult } from \"../snap\";\n\nexport abstract class BaseSnap implements ISnap {\n    protected _tempMeshIds: Map<IView, number[]> = new Map();\n    protected _highlightedShapes: VisualShapeData[] = [];\n\n    constructor(readonly referencePoint?: () => XYZ) {}\n\n    abstract snap(data: MouseAndDetected): SnapResult | undefined;\n\n    removeDynamicObject(): void {\n        this.clearTempMeshes();\n        this.unhighlight();\n    }\n\n    clear(): void {\n        this.removeDynamicObject();\n    }\n\n    protected clearTempMeshes(): void {\n        this._tempMeshIds.forEach((ids, view) => {\n            ids.forEach((id) => view.document.visual.context.removeMesh(id));\n        });\n        this._tempMeshIds.clear();\n    }\n\n    protected addTempMesh(view: IView, meshId: number): void {\n        let ids = this._tempMeshIds.get(view);\n        if (!ids) {\n            ids = [];\n            this._tempMeshIds.set(view, ids);\n        }\n        ids.push(meshId);\n    }\n\n    protected highlight(shapes: VisualShapeData[]): void {\n        shapes.forEach((shape) => {\n            const highlighter = shape.owner.node.document.visual.highlighter;\n            highlighter.addState(\n                shape.owner,\n                VisualState.edgeHighlight,\n                shape.shape.shapeType,\n                ...shape.indexes,\n            );\n        });\n        this._highlightedShapes.push(...shapes);\n    }\n\n    protected unhighlight(): void {\n        this._highlightedShapes.forEach((shape) => {\n            const highlighter = shape.owner.node.document.visual.highlighter;\n            highlighter.removeState(\n                shape.owner,\n                VisualState.edgeHighlight,\n                shape.shape.shapeType,\n                ...shape.indexes,\n            );\n        });\n        this._highlightedShapes.length = 0;\n    }\n\n    protected calculateDistance(point: XYZ): number | undefined {\n        return this.referencePoint ? this.referencePoint().distanceTo(point) : undefined;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { I18n, IEdge, IView, ObjectSnapType, ShapeType, VisualShapeData, XYZ } from \"chili-core\";\nimport { SnapResult } from \"../snap\";\n\nexport class FeaturePointStrategy {\n    private readonly _featureInfos: Map<VisualShapeData, SnapResult[]> = new Map();\n\n    constructor(private _snapType: ObjectSnapType) {}\n\n    getFeaturePoints(view: IView, shape: VisualShapeData): SnapResult[] {\n        if (this._featureInfos.has(shape)) {\n            return this._featureInfos.get(shape)!;\n        }\n\n        const infos: SnapResult[] = [];\n        if (shape.shape.shapeType === ShapeType.Edge) {\n            this.getEdgeFeaturePoints(view, shape, infos);\n        }\n        this._featureInfos.set(shape, infos);\n        return infos;\n    }\n\n    private getEdgeFeaturePoints(view: IView, shape: VisualShapeData, infos: SnapResult[]) {\n        const curve = (shape.shape as IEdge).curve;\n        const start = curve.value(curve.firstParameter());\n        const end = curve.value(curve.lastParameter());\n\n        const addPoint = (point: XYZ, info: string) =>\n            infos.push({\n                view,\n                point: shape.transform.ofPoint(point),\n                info,\n                shapes: [shape],\n            });\n\n        if (ObjectSnapType.has(this._snapType, ObjectSnapType.endPoint)) {\n            addPoint(start, I18n.translate(\"snap.end\"));\n            addPoint(end, I18n.translate(\"snap.end\"));\n        }\n        if (ObjectSnapType.has(this._snapType, ObjectSnapType.midPoint)) {\n            const mid = curve.value((curve.firstParameter() + curve.lastParameter()) * 0.5);\n            addPoint(mid, I18n.translate(\"snap.mid\"));\n        }\n    }\n\n    clear(): void {\n        this._featureInfos.clear();\n    }\n\n    updateSnapType(snapType: ObjectSnapType): void {\n        this._snapType = snapType;\n        this.clear();\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    Config,\n    I18n,\n    ICircle,\n    ICurve,\n    IDocument,\n    IEdge,\n    IView,\n    IVisualContext,\n    ObjectSnapType,\n    ShapeType,\n    VertexMeshData,\n    VisualConfig,\n    VisualShapeData,\n    XYZ,\n} from \"chili-core\";\nimport { MouseAndDetected, SnapResult } from \"../snap\";\nimport { BaseSnap } from \"./baseSnap\";\nimport { FeaturePointStrategy } from \"./featurePointStrategy\";\n\ninterface InvisibleSnapInfo {\n    view: IView;\n    snaps: SnapResult[];\n    displays: number[];\n}\n\nexport class ObjectSnap extends BaseSnap {\n    private readonly _featureStrategy: FeaturePointStrategy;\n    private readonly _intersectionInfos: Map<string, SnapResult[]>;\n    private readonly _invisibleInfos: Map<VisualShapeData, InvisibleSnapInfo>;\n    private _lastDetected?: [IView, SnapResult];\n    private _hintVertex?: [IVisualContext, number];\n\n    constructor(\n        private _snapType: ObjectSnapType,\n        referencePoint?: () => XYZ,\n    ) {\n        super(referencePoint);\n        this._featureStrategy = new FeaturePointStrategy(_snapType);\n        this._intersectionInfos = new Map();\n        this._invisibleInfos = new Map();\n        Config.instance.onPropertyChanged(this.onSnapTypeChanged);\n    }\n\n    override clear() {\n        super.clear();\n        this._invisibleInfos.forEach((info) => {\n            info.displays.forEach((x) => info.view.document.visual.context.removeMesh(x));\n        });\n        this.removeHint();\n        this._featureStrategy.clear();\n        Config.instance.removePropertyChanged(this.onSnapTypeChanged);\n    }\n\n    readonly handleSnaped = (document: IDocument, snaped?: SnapResult | undefined) => {\n        if (snaped?.shapes.length === 0 && this._lastDetected) {\n            this.displayHint(this._lastDetected[0], this._lastDetected[1]);\n            this._lastDetected = undefined;\n        }\n    };\n\n    private readonly onSnapTypeChanged = (property: keyof Config) => {\n        if (property === \"snapType\" || property === \"enableSnap\") {\n            this._snapType = Config.instance.snapType;\n            this._featureStrategy.updateSnapType(this._snapType);\n            this._intersectionInfos.clear();\n        }\n    };\n\n    override removeDynamicObject(): void {\n        super.removeDynamicObject();\n        this.removeHint();\n    }\n\n    private removeHint() {\n        if (this._hintVertex !== undefined) {\n            this._hintVertex[0].removeMesh(this._hintVertex[1]);\n            this._hintVertex = undefined;\n        }\n    }\n\n    snap(data: MouseAndDetected): SnapResult | undefined {\n        if (!Config.instance.enableSnap) return undefined;\n\n        let snap: SnapResult | undefined;\n        if (data.shapes.length > 0) {\n            this.showInvisibleSnaps(data.view, data.shapes[0]);\n            snap = this.snapOnShape(data.view, data.mx, data.my, data.shapes);\n        } else {\n            snap = this.snapeInvisible(data.view, data.mx, data.my);\n        }\n        if (this.referencePoint && snap?.point) {\n            snap.distance = this.referencePoint().distanceTo(snap.point);\n        }\n        return snap;\n    }\n\n    private snapOnShape(view: IView, x: number, y: number, shapes: VisualShapeData[]) {\n        const featurePoints = this._featureStrategy.getFeaturePoints(view, shapes[0]);\n        const perpendiculars = this.findPerpendicular(view, shapes[0]);\n        const intersections = this.getIntersections(view, shapes[0], shapes);\n        const ordered = [...featurePoints, ...perpendiculars, ...intersections].sort((a, b) =>\n            this.sortSnaps(view, x, y, a, b),\n        );\n\n        if (ordered.length === 0) return undefined;\n\n        const dist = IView.screenDistance(view, x, y, ordered[0].point!);\n        if (dist < Config.instance.SnapDistance) {\n            this.hilighted(view, ordered[0].shapes);\n            return ordered[0];\n        } else {\n            this._lastDetected = [view, ordered[0]];\n            return undefined;\n        }\n    }\n\n    private displayHint(view: IView, shape: SnapResult) {\n        this.hilighted(view, shape.shapes);\n        let data = VertexMeshData.from(\n            shape.point!,\n            VisualConfig.hintVertexSize,\n            VisualConfig.hintVertexColor,\n        );\n        this._hintVertex = [view.document.visual.context, view.document.visual.context.displayMesh([data])];\n    }\n\n    private snapeInvisible(view: IView, x: number, y: number): SnapResult | undefined {\n        const { minDistance, snap } = this.getNearestInvisibleSnap(view, x, y);\n        if (minDistance < Config.instance.SnapDistance) {\n            this.hilighted(view, snap!.shapes);\n            return snap;\n        }\n        return undefined;\n    }\n\n    private getNearestInvisibleSnap(\n        view: IView,\n        x: number,\n        y: number,\n    ): { minDistance: number; snap?: SnapResult } {\n        let snap: SnapResult | undefined;\n        let minDistance = Number.MAX_VALUE;\n\n        this._invisibleInfos.forEach((info) => {\n            info.snaps.forEach((s) => {\n                const dist = IView.screenDistance(view, x, y, s.point!);\n                if (dist < minDistance) {\n                    minDistance = dist;\n                    snap = s;\n                }\n            });\n        });\n        return { minDistance, snap };\n    }\n\n    private showInvisibleSnaps(view: IView, shape: VisualShapeData) {\n        if (shape.shape.shapeType === ShapeType.Edge) {\n            if (this._invisibleInfos.has(shape)) return;\n            let curve = (shape.shape as IEdge).curve;\n            let basisCurve = curve.basisCurve;\n            if (ICurve.isCircle(basisCurve)) {\n                this.showCircleCenter(basisCurve, view, shape);\n            }\n        }\n    }\n\n    private showCircleCenter(curve: ICircle, view: IView, shape: VisualShapeData) {\n        const center = shape.transform.ofPoint(curve.center);\n        let temporary = VertexMeshData.from(\n            center,\n            VisualConfig.hintVertexSize,\n            VisualConfig.hintVertexColor,\n        );\n        let id = view.document.visual.context.displayMesh([temporary]);\n        this._invisibleInfos.set(shape, {\n            view,\n            snaps: [\n                {\n                    view,\n                    point: center,\n                    info: I18n.translate(\"snap.center\"),\n                    shapes: [shape],\n                },\n            ],\n            displays: [id],\n        });\n    }\n\n    private hilighted(view: IView, shapes: VisualShapeData[]) {\n        this.highlight(shapes);\n    }\n\n    private sortSnaps(view: IView, x: number, y: number, a: SnapResult, b: SnapResult): number {\n        return IView.screenDistance(view, x, y, a.point!) - IView.screenDistance(view, x, y, b.point!);\n    }\n\n    private findPerpendicular(view: IView, shape: VisualShapeData): SnapResult[] {\n        let result: SnapResult[] = [];\n        if (\n            !ObjectSnapType.has(this._snapType, ObjectSnapType.perpendicular) ||\n            this.referencePoint === undefined\n        ) {\n            return result;\n        }\n\n        let curve = (shape.shape as IEdge).curve;\n        const transform = shape.transform;\n        let point = curve.project(transform.invert()!.ofPoint(this.referencePoint())).at(0);\n        if (point === undefined) return result;\n        result.push({\n            view,\n            point: transform.ofPoint(point),\n            info: I18n.translate(\"snap.perpendicular\"),\n            shapes: [shape],\n        });\n\n        return result;\n    }\n\n    private getIntersections(view: IView, current: VisualShapeData, shapes: VisualShapeData[]) {\n        let result = new Array<SnapResult>();\n        if (\n            !ObjectSnapType.has(this._snapType, ObjectSnapType.intersection) ||\n            current.shape.shapeType !== ShapeType.Edge\n        ) {\n            return result;\n        }\n        shapes.forEach((x) => {\n            if (x === current || x.shape.shapeType !== ShapeType.Edge) return;\n            let key = this.getIntersectionKey(current, x);\n            let arr = this._intersectionInfos.get(key);\n            if (arr === undefined) {\n                arr = this.findIntersections(view, current, x);\n                this._intersectionInfos.set(key, arr);\n            }\n            result.push(...arr);\n        });\n        return result;\n    }\n\n    private getIntersectionKey(s1: VisualShapeData, s2: VisualShapeData) {\n        return s1.shape.id < s2.shape.id ? `${s1.shape.id}:${s2.shape.id}` : `${s2.shape.id}:${s1.shape.id}`;\n    }\n\n    private findIntersections(view: IView, s1: VisualShapeData, s2: VisualShapeData): SnapResult[] {\n        const e1 = s1.shape.transformedMul(s1.transform) as IEdge;\n        const e2 = s2.shape.transformedMul(s2.transform) as IEdge;\n        let intersections = e1.intersect(e2);\n        e1.dispose();\n        e2.dispose();\n        return intersections.map((point) => {\n            return {\n                view,\n                point: point.point,\n                info: I18n.translate(\"snap.intersection\"),\n                shapes: [s1, s2],\n            };\n        });\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Plane, XYZ } from \"chili-core\";\nimport { ViewUtils } from \"chili-vis\";\nimport { ISnap, MouseAndDetected, SnapResult } from \"../snap\";\n\nexport abstract class PlaneSnapBase implements ISnap {\n    removeDynamicObject(): void {}\n    clear(): void {}\n    abstract snap(data: MouseAndDetected): SnapResult | undefined;\n\n    constructor(readonly refPoint?: () => XYZ) {}\n\n    protected snapAtPlane(plane: Plane, data: MouseAndDetected): SnapResult | undefined {\n        plane = ViewUtils.ensurePlane(data.view, plane);\n        const ray = data.view.rayAt(data.mx, data.my);\n        const point = plane.intersect(ray);\n        if (!point) return undefined;\n\n        const distance = this.refPoint ? this.refPoint().distanceTo(point) : undefined;\n\n        return {\n            view: data.view,\n            point,\n            distance,\n            shapes: [],\n        };\n    }\n}\n\nexport class WorkplaneSnap extends PlaneSnapBase {\n    snap(data: MouseAndDetected): SnapResult | undefined {\n        return this.snapAtPlane(data.view.workplane, data);\n    }\n}\n\nexport class PlaneSnap extends PlaneSnapBase {\n    constructor(\n        readonly plane: (point: XYZ) => Plane,\n        refPoint?: () => XYZ,\n    ) {\n        super(refPoint);\n    }\n\n    snap(data: MouseAndDetected): SnapResult | undefined {\n        let point = data.view.screenToWorld(data.mx, data.my);\n        const plane = this.plane(point);\n        const result = this.snapAtPlane(plane, data);\n        if (result) {\n            result.plane = plane;\n        }\n        return result;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { SnapPointOnCurveData } from \"../handlers\";\nimport { ISnap, MouseAndDetected, SnapResult } from \"../snap\";\n\nexport class PointOnCurveSnap implements ISnap {\n    constructor(readonly pointData: SnapPointOnCurveData) {}\n\n    snap(data: MouseAndDetected): SnapResult | undefined {\n        const ray = data.view.rayAt(data.mx, data.my);\n        const curve = this.pointData.curve;\n        const nearest = curve.nearestExtrema(ray);\n        if (!nearest) return undefined;\n        return {\n            view: data.view,\n            point: nearest.p1,\n            shapes: [],\n        };\n    }\n\n    removeDynamicObject(): void {}\n    clear(): void {}\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { I18n, I18nKeys, Plane, Ray, XYZ } from \"chili-core\";\n\nexport class Axis extends Ray {\n    constructor(\n        location: XYZ,\n        direction: XYZ,\n        readonly name: string,\n    ) {\n        super(location, direction);\n    }\n\n    static getAxiesAtPlane(location: XYZ, plane: Plane, containsZ: boolean) {\n        const createAxis = (direction: XYZ, name: I18nKeys) =>\n            new Axis(location, direction, I18n.translate(name));\n\n        const axies = [\n            createAxis(plane.xvec, \"axis.x\"),\n            createAxis(plane.xvec.reverse(), \"axis.x\"),\n            createAxis(plane.yvec, \"axis.y\"),\n            createAxis(plane.yvec.reverse(), \"axis.y\"),\n        ];\n\n        if (containsZ) {\n            axies.push(createAxis(plane.normal, \"axis.z\"), createAxis(plane.normal.reverse(), \"axis.z\"));\n        }\n\n        return axies;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IDocument, VertexMeshData } from \"chili-core\";\nimport { SnapResult } from \"..\";\n\nexport abstract class TrackingBase {\n    protected readonly tempMeshes: Map<IDocument, number[]> = new Map();\n    protected isCleared: boolean = false;\n\n    constructor(readonly trackingZ: boolean) {}\n\n    clear(): void {\n        this.clearTempMeshes();\n        this.isCleared = true;\n    }\n\n    protected clearTempMeshes(): void {\n        this.tempMeshes.forEach((ids, document) => {\n            ids.forEach((id) => document.visual.context.removeMesh(id));\n        });\n        this.tempMeshes.clear();\n    }\n\n    protected addTempMesh(document: IDocument, meshId: number): void {\n        let ids = this.tempMeshes.get(document);\n        if (!ids) {\n            ids = [];\n            this.tempMeshes.set(document, ids);\n        }\n        ids.push(meshId);\n    }\n\n    protected displayPoint(document: IDocument, point: SnapResult, size: number, color: number): number {\n        const data = VertexMeshData.from(point.point!, size, color);\n        const id = document.visual.context.displayMesh([data]);\n        this.addTempMesh(document, id);\n        return id;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { I18n, IView, Plane, XYZ } from \"chili-core\";\nimport { Axis } from \"./axis\";\nimport { TrackingBase } from \"./trackingBase\";\n\nexport class AxisTracking extends TrackingBase {\n    private readonly axies: Map<IView, Axis[]> = new Map();\n\n    constructor(trackingZ: boolean) {\n        super(trackingZ);\n    }\n\n    getAxes(view: IView, referencePoint: XYZ, angle: number | undefined = undefined) {\n        if (!this.axies.has(view)) {\n            this.axies.set(view, this.initAxes(view.workplane, referencePoint, angle));\n        }\n        return this.axies.get(view)!;\n    }\n\n    private initAxes(plane: Plane, referencePoint: XYZ, angle: number | undefined): Axis[] {\n        if (angle === undefined) {\n            return Axis.getAxiesAtPlane(referencePoint, plane, this.trackingZ);\n        }\n\n        const result: Axis[] = [];\n        let testAngle = 0;\n        while (testAngle < 360) {\n            let direction = plane.xvec.rotate(plane.normal, (testAngle / 180) * Math.PI)!;\n            result.push(new Axis(referencePoint, direction, `${testAngle} °`));\n            testAngle += angle;\n        }\n        if (this.trackingZ) {\n            result.push(new Axis(referencePoint, plane.normal, I18n.translate(\"axis.z\")));\n            result.push(new Axis(referencePoint, plane.normal.reverse(), I18n.translate(\"axis.z\")));\n        }\n\n        return result;\n    }\n\n    override clear(): void {\n        super.clear();\n        this.axies.clear();\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IDocument, IView, VisualConfig } from \"chili-core\";\nimport { ViewUtils } from \"chili-vis\";\nimport { SnapResult } from \"..\";\nimport { Axis } from \"./axis\";\nimport { TrackingBase } from \"./trackingBase\";\n\nexport interface ObjectTrackingAxis {\n    axes: Axis[];\n    objectName: string | undefined;\n}\n\ninterface SnapeInfo {\n    snap: SnapResult;\n    shapeId: number;\n}\n\nexport class ObjectTracking extends TrackingBase {\n    private timer?: number;\n    private snapping?: SnapResult;\n    private readonly trackings: Map<IDocument, SnapeInfo[]> = new Map();\n\n    constructor(trackingZ: boolean) {\n        super(trackingZ);\n    }\n\n    override clear(): void {\n        this.clearTimer();\n        super.clear();\n        this.trackings.clear();\n    }\n\n    getTrackingRays(view: IView) {\n        const result: ObjectTrackingAxis[] = [];\n        this.trackings.get(view.document)?.map((x) => {\n            let plane = ViewUtils.ensurePlane(view, view.workplane);\n            let axes = Axis.getAxiesAtPlane(x.snap.point!, plane, this.trackingZ);\n            result.push({ axes, objectName: x.snap.info });\n        });\n        return result;\n    }\n\n    showTrackingAtTimeout(document: IDocument, snap?: SnapResult) {\n        if (snap !== undefined && this.snapping === snap) return;\n        this.snapping = snap;\n        this.clearTimer();\n        if (!snap) return;\n        this.timer = window.setTimeout(() => this.switchTrackingPoint(document, snap), 600);\n    }\n\n    private clearTimer() {\n        if (this.timer !== undefined) {\n            clearTimeout(this.timer);\n            this.timer = undefined;\n        }\n    }\n\n    private switchTrackingPoint(document: IDocument, snap: SnapResult) {\n        if (this.isCleared || snap.shapes.length === 0) return;\n        if (!this.trackings.has(document)) {\n            this.trackings.set(document, []);\n        }\n        const currentTrackings = this.trackings.get(document)!;\n        const existingTracking = currentTrackings.find((x) => x.snap.point!.isEqualTo(snap.point!));\n        existingTracking\n            ? this.removeTrackingPoint(document, existingTracking, currentTrackings)\n            : this.addTrackingPoint(snap, document, currentTrackings);\n        document.visual.update();\n    }\n\n    private removeTrackingPoint(document: IDocument, s: SnapeInfo, snaps: SnapeInfo[]) {\n        document.visual.context.removeMesh(s.shapeId);\n        this.trackings.set(\n            document,\n            snaps.filter((x) => x !== s),\n        );\n    }\n\n    private addTrackingPoint(snap: SnapResult, document: IDocument, snaps: SnapeInfo[]) {\n        const pointId = this.displayPoint(\n            document,\n            snap,\n            VisualConfig.trackingVertexSize,\n            VisualConfig.trackingVertexColor,\n        );\n        snaps.push({ shapeId: pointId, snap });\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    Config,\n    EdgeMeshData,\n    I18n,\n    IDocument,\n    ISubEdgeShape,\n    IView,\n    LineType,\n    Precision,\n    Ray,\n    ShapeType,\n    VisualConfig,\n    XY,\n    XYZ,\n} from \"chili-core\";\nimport { ISnap, MouseAndDetected, SnapResult } from \"../\";\nimport { Axis } from \"./axis\";\nimport { AxisTracking } from \"./axisTracking\";\nimport { ObjectTracking } from \"./objectTracking\";\n\nexport interface TrackingData {\n    axis: Axis;\n    point: XYZ;\n    isObjectTracking: boolean;\n    distance: number;\n    info: string;\n}\n\nexport class TrackingSnap implements ISnap {\n    private readonly _axisTracking: AxisTracking;\n    private readonly _objectTracking: ObjectTracking;\n    private readonly _tempLines: Map<IView, number[]> = new Map();\n\n    constructor(\n        readonly referencePoint: (() => XYZ) | undefined,\n        trackingAxisZ: boolean,\n    ) {\n        this._axisTracking = new AxisTracking(trackingAxisZ);\n        this._objectTracking = new ObjectTracking(trackingAxisZ);\n        Config.instance.onPropertyChanged(this.onSnapTypeChanged);\n    }\n\n    readonly handleSnaped = (document: IDocument, snaped?: SnapResult) => {\n        if (Config.instance.enableSnapTracking) {\n            this._objectTracking.showTrackingAtTimeout(document, snaped);\n        }\n    };\n\n    snap(data: MouseAndDetected): SnapResult | undefined {\n        if (!Config.instance.enableSnapTracking) return undefined;\n\n        const trackingDatas = this.detectTracking(data.view, data.mx, data.my);\n        if (trackingDatas.length === 0) return undefined;\n        trackingDatas.sort((x) => x.distance);\n        let snaped = this.shapeIntersectTracking(data, trackingDatas);\n        if (snaped !== undefined) return snaped;\n        if (trackingDatas.length === 1) {\n            return this.getSnapedAndShowTracking(data.view, trackingDatas[0].point, [trackingDatas[0]]);\n        }\n        return (\n            this.trackingIntersectTracking(data.view, trackingDatas) ??\n            this.getSnapedAndShowTracking(data.view, trackingDatas[0].point, [trackingDatas[0]])\n        );\n    }\n\n    private trackingIntersectTracking(view: IView, trackingDatas: TrackingData[]) {\n        const point = trackingDatas[0].axis.intersect(trackingDatas[1].axis);\n        return point\n            ? this.getSnapedAndShowTracking(view, point, [trackingDatas[0], trackingDatas[1]])\n            : undefined;\n    }\n\n    private getSnapedAndShowTracking(view: IView, point: XYZ, trackingDatas: TrackingData[]): SnapResult {\n        const lines: number[] = trackingDatas\n            .map((x) => this.showTempLine(view, x.axis.location, point))\n            .filter((id) => id !== undefined);\n        this._tempLines.set(view, lines);\n\n        let info: string | undefined = undefined;\n        let distance: number | undefined = undefined;\n        if (trackingDatas.length === 1) {\n            distance = point.distanceTo(trackingDatas[0].axis.location);\n            info = trackingDatas[0].axis.name;\n        } else if (trackingDatas.length === 2) {\n            info = I18n.translate(\"snap.intersection\");\n        }\n        const refPoint = trackingDatas[0].axis.location;\n        return { view, point, info, shapes: [], refPoint, distance };\n    }\n\n    private showTempLine(view: IView, start: XYZ, end: XYZ): number | undefined {\n        const vector = end.sub(start);\n        const normal = vector.normalize();\n        if (!normal) return undefined;\n        const distance = Math.min(vector.length() * 1e10, 1e20);\n        const newEnd = start.add(normal.multiply(distance));\n        const lineDats = EdgeMeshData.from(start, newEnd, VisualConfig.temporaryEdgeColor, LineType.Dash);\n        return view.document.visual.context.displayMesh([lineDats]);\n    }\n\n    private shapeIntersectTracking(\n        data: MouseAndDetected,\n        trackingDatas: TrackingData[],\n    ): SnapResult | undefined {\n        if (data.shapes.length === 0 || data.shapes[0].shape.shapeType !== ShapeType.Edge) return undefined;\n        const point = this.findIntersection(data, trackingDatas);\n        if (!point) return undefined;\n        const id = this.showTempLine(data.view, point.location, point.intersect);\n        if (id === undefined) return undefined;\n        this._tempLines.set(data.view, [id]);\n        return {\n            view: data.view,\n            point: point.intersect,\n            info: I18n.translate(\"snap.intersection\"),\n            shapes: [data.shapes[0]],\n        };\n    }\n\n    private findIntersection(data: MouseAndDetected, trackingDatas: TrackingData[]) {\n        const edge = data.shapes[0].shape as ISubEdgeShape;\n        const points: { intersect: XYZ; location: XYZ }[] = [];\n        trackingDatas.forEach((x) => {\n            edge.intersect(x.axis).forEach((p) => {\n                points.push({ intersect: p.point, location: x.axis.location });\n            });\n        });\n        points.sort((p) => IView.screenDistance(data.view, data.mx, data.my, p.intersect));\n        return points.at(0);\n    }\n\n    private detectTracking(view: IView, x: number, y: number) {\n        const data: TrackingData[] = [];\n        if (this.referencePoint) {\n            const axies = this._axisTracking.getAxes(view, this.referencePoint());\n            data.push(...this.getSnapedFromAxes(axies, view, x, y));\n        }\n        const objectTrackingRays = this._objectTracking.getTrackingRays(view);\n        objectTrackingRays.forEach((a) => {\n            data.push(...this.getSnapedFromAxes(a.axes, view, x, y, a.objectName));\n        });\n        return data;\n    }\n\n    private getSnapedFromAxes(axes: Axis[], view: IView, x: number, y: number, snapedName?: string) {\n        let result: TrackingData[] = [];\n        for (const axis of axes) {\n            let distance = this.rayDistanceAtScreen(view, x, y, axis);\n            if (distance < Config.instance.SnapDistance) {\n                let ray = view.rayAt(x, y);\n                let point = axis.nearestTo(ray);\n                if (point.sub(axis.location).dot(axis.direction) < 0) continue;\n                result.push({\n                    axis,\n                    distance,\n                    point,\n                    info: snapedName ?? axis.name,\n                    isObjectTracking: snapedName !== undefined,\n                });\n            }\n        }\n        return result;\n    }\n\n    private rayDistanceAtScreen(view: IView, x: number, y: number, axis: Ray): number {\n        const start = view.worldToScreen(axis.location);\n        const vector = new XY(x - start.x, y - start.y);\n        if (vector.isEqualTo(XY.zero)) return 0;\n        const end = view.worldToScreen(axis.location.add(axis.direction.multiply(100000)));\n        if (start.distanceTo(end) < Precision.Float) return vector.length();\n        const dir = end.sub(start).normalize()!;\n        const dot = vector.dot(dir);\n        return Math.sqrt(vector.lengthSq() - dot * dot);\n    }\n\n    removeDynamicObject(): void {\n        this._tempLines.forEach((v, k) => {\n            v.forEach((id) => {\n                k.document.visual.context.removeMesh(id);\n            });\n        });\n        this._tempLines.clear();\n    }\n\n    private readonly onSnapTypeChanged = (property: keyof Config): void => {\n        if (property === \"snapType\" || property === \"enableSnapTracking\" || property === \"enableSnap\") {\n            this.removeDynamicObject();\n            this._objectTracking.clear();\n            this._axisTracking.clear();\n        }\n    };\n\n    clear(): void {\n        this.removeDynamicObject();\n        this._axisTracking.clear();\n        this._objectTracking.clear();\n        Config.instance.removePropertyChanged(this.onSnapTypeChanged);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    AsyncController,\n    Config,\n    I18nKeys,\n    IDocument,\n    IEventHandler,\n    IView,\n    MessageType,\n    PubSub,\n    Result,\n    ShapeType,\n    VertexMeshData,\n    VisualConfig,\n    XYZ,\n} from \"chili-core\";\nimport { ISnap, MouseAndDetected, SnapData, SnapResult } from \"../snap\";\n\nenum SnapState {\n    Idle,\n    Snapping,\n    InputMode,\n    Cancelled,\n}\n\nexport abstract class SnapEventHandler<D extends SnapData = SnapData> implements IEventHandler {\n    private _tempPoint?: number;\n    private _tempShapes?: number[];\n    protected showTempPoint: boolean = true;\n    protected _snaped?: SnapResult;\n    private _state: SnapState = SnapState.Idle;\n\n    constructor(\n        readonly document: IDocument,\n        readonly controller: AsyncController,\n        readonly snaps: ISnap[],\n        readonly data: D,\n    ) {\n        this.showTempShape(undefined);\n        controller.onCancelled(() => this.handleCancel());\n    }\n\n    get snaped() {\n        return this._snaped;\n    }\n    get state() {\n        return this._state;\n    }\n\n    dispose() {\n        this._snaped = undefined;\n        this._state = SnapState.Idle;\n    }\n\n    private handleSuccess() {\n        this._state = SnapState.Idle;\n        this.controller.success();\n        this.cleanupResources();\n    }\n\n    private handleCancel() {\n        if (this._state === SnapState.Cancelled) return;\n        this._state = SnapState.Cancelled;\n        this.controller.cancel();\n        this.cleanupResources();\n    }\n\n    private cleanupResources() {\n        this.clearSnapTip();\n        this.clearInput();\n        this.removeTempVisuals();\n        this.snaps.forEach((snap) => snap.clear());\n    }\n\n    private clearInput() {\n        PubSub.default.pub(\"clearInput\");\n    }\n\n    pointerMove(view: IView, event: PointerEvent): void {\n        this._state = SnapState.Snapping;\n        this.removeTempVisuals();\n        this.updateSnapPoint(view, event);\n        this.updateVisualFeedback(view);\n    }\n\n    private updateSnapPoint(view: IView, event: PointerEvent) {\n        this.setSnaped(view, event);\n        if (this._snaped) {\n            this.showSnapPrompt(this.formatPrompt(this._snaped));\n        } else {\n            this.clearSnapTip();\n        }\n    }\n\n    private updateVisualFeedback(view: IView) {\n        this.showTempShape(this._snaped?.point);\n        view.document.visual.update();\n    }\n\n    private formatPrompt(snaped: SnapResult) {\n        let prompt = this.data.prompt?.(snaped);\n        if (!prompt) {\n            let distance = snaped.distance ?? snaped.refPoint?.distanceTo(snaped.point!);\n            if (distance) {\n                prompt = `${distance.toFixed(2)}`;\n            }\n        }\n\n        return [snaped.info, prompt].filter((x) => x !== undefined).join(\" -> \");\n    }\n\n    protected setSnaped(view: IView, event: PointerEvent) {\n        this.findSnapPoint(ShapeType.Edge, view, event);\n        \n        this.snaps.forEach((snap) => snap.handleSnaped?.(view.document.visual.document, this._snaped));\n    }\n\n    private findNearestFeaturePoint(view: IView, event: PointerEvent) {\n        let minDist = Number.MAX_VALUE;\n        let nearest;\n\n        for (const point of this.data.featurePoints || []) {\n            if (point.when && !point.when()) continue;\n\n            const dist = IView.screenDistance(view, event.offsetX, event.offsetY, point.point);\n            if (dist < minDist) {\n                minDist = dist;\n                nearest = point;\n            }\n        }\n\n        return minDist < Config.instance.SnapDistance ? nearest : undefined;\n    }\n\n    protected findSnapPoint(shapeType: ShapeType, view: IView, event: PointerEvent) {\n        const featurePoint = this.findNearestFeaturePoint(view, event);\n        if (featurePoint) {\n            this._snaped = {\n                view,\n                point: featurePoint.point,\n                info: featurePoint.prompt,\n                shapes: [],\n            };\n        } else {\n            const detected = this.detectShapes(shapeType, view, event);\n            for (const snap of this.snaps) {\n                const snaped = snap.snap(detected);\n                if (snaped && this.validateSnapPoint(snaped)) {\n                    this._snaped = snaped\n                    return;\n                };\n            }\n        }\n    }\n\n    private validateSnapPoint(snaped: SnapResult) {\n        return !this.data.validator || this.data.validator(snaped.point!);\n    }\n\n    private detectShapes(shapeType: ShapeType, view: IView, event: MouseEvent): MouseAndDetected {\n        const shapes = view.detectShapes(shapeType, event.offsetX, event.offsetY, this.data.filter);\n        return { shapes, view, mx: event.offsetX, my: event.offsetY };\n    }\n\n    private clearSnapTip() {\n        PubSub.default.pub(\"clearFloatTip\");\n    }\n\n    private showSnapPrompt(msg: string | undefined) {\n        if (!msg) {\n            this.clearSnapTip();\n            return;\n        }\n        PubSub.default.pub(\"showFloatTip\", MessageType.info, msg);\n    }\n\n    private removeTempVisuals() {\n        this.removeTempShapes();\n        this.snaps.forEach((snap) => snap.removeDynamicObject());\n    }\n\n    private showTempShape(point: XYZ | undefined) {\n        if (point && this.showTempPoint) {\n            const data = VertexMeshData.from(\n                point,\n                VisualConfig.temporaryVertexSize,\n                VisualConfig.temporaryVertexColor,\n            );\n            this._tempPoint = this.document.visual.context.displayMesh([data]);\n        }\n\n        this._tempShapes = this.data\n            .preview?.(point)\n            ?.map((shape) => this.document.visual.context.displayMesh([shape]));\n    }\n\n    private removeTempShapes() {\n        if (this._tempPoint) {\n            this.document.visual.context.removeMesh(this._tempPoint);\n            this._tempPoint = undefined;\n        }\n        this._tempShapes?.forEach((id) => {\n            this.document.visual.context.removeMesh(id);\n        });\n        this.document.visual.update();\n        this._tempShapes = undefined;\n    }\n\n    pointerDown(view: IView, event: PointerEvent): void {\n        if (event.pointerType === \"mouse\" && event.button === 0) {\n            if (this._snaped) {\n                this.handleSuccess();\n            } else {\n                PubSub.default.pub(\"showToast\", \"toast.snap.notFoundValidPoint\");\n            }\n        }\n    }\n\n    pointerUp(view: IView, event: PointerEvent): void {\n        if (event.pointerType !== \"mouse\" && event.isPrimary && this._snaped) {\n            this.handleSuccess();\n        }\n    }\n\n    mouseWheel(view: IView, event: WheelEvent): void {\n        view.update();\n    }\n\n    keyDown(view: IView, event: KeyboardEvent): void {\n        switch (event.key) {\n            case \"Escape\":\n                this._snaped = undefined;\n                this.handleCancel();\n                break;\n            case \"Enter\":\n                this._snaped = undefined;\n                this.handleSuccess();\n                break;\n            default:\n                this.handleNumericInput(view, event);\n        }\n    }\n\n    private handleNumericInput(view: IView, event: KeyboardEvent) {\n        if (![\"#\", \"-\", \"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\"].includes(event.key)) return;\n\n        this._state = SnapState.InputMode;\n        PubSub.default.pub(\"showInput\", event.key, (text: string) => {\n            const error = this.inputError(text);\n            if (error) return Result.err(error);\n\n            this._snaped = this.getPointFromInput(view, text);\n            this.handleSuccess();\n            return Result.ok(text);\n        });\n    }\n\n    protected abstract getPointFromInput(view: IView, text: string): SnapResult;\n    protected abstract inputError(text: string): I18nKeys | undefined;\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { AsyncController, Config, IDocument, IView, Plane, PlaneAngle, XYZ } from \"chili-core\";\nimport { SnapResult } from \"../snap\";\nimport { ObjectSnap, PlaneSnap } from \"../snaps\";\nimport { TrackingSnap } from \"../tracking\";\nimport { PointSnapData } from \"./pointSnapEventHandler\";\nimport { SnapEventHandler } from \"./snapEventHandler\";\n\nexport class AngleSnapEventHandler extends SnapEventHandler<PointSnapData> {\n    private readonly planeAngle: PlaneAngle;\n    private readonly plane: Plane;\n\n    constructor(\n        document: IDocument,\n        controller: AsyncController,\n        private readonly center: () => XYZ,\n        p1: XYZ,\n        snapPointData: PointSnapData,\n    ) {\n        if (!snapPointData.plane) throw new Error(\"AngleSnapEventHandler: no plane\");\n\n        const objectSnap = new ObjectSnap(Config.instance.snapType, snapPointData.refPoint);\n        const workplaneSnap = new PlaneSnap(snapPointData.plane, center);\n        const trackingSnap = new TrackingSnap(center, false);\n        super(document, controller, [objectSnap, trackingSnap, workplaneSnap], snapPointData);\n\n        const xvec = p1.sub(center()).normalize()!;\n        this.plane = new Plane(center(), snapPointData.plane().normal, xvec);\n        this.planeAngle = new PlaneAngle(this.plane);\n        snapPointData.prompt ??= this.formatAnglePrompt;\n    }\n\n    private readonly formatAnglePrompt = (snaped?: SnapResult) => {\n        if (!snaped?.point) return \"\";\n        this.planeAngle.movePoint(snaped.point);\n        return `${this.planeAngle.angle.toFixed(2)} °`;\n    };\n\n    protected override inputError(text: string) {\n        const angle = Number.parseFloat(text);\n        return isNaN(angle) ? \"error.input.invalidNumber\" : undefined;\n    }\n\n    protected override getPointFromInput(view: IView, text: string): SnapResult {\n        const angle = (Number.parseFloat(text) * Math.PI) / 180;\n        const vec = this.plane.xvec.rotate(this.plane.normal, angle)!;\n        const point = this.center().add(vec);\n        return { point, view, shapes: [], plane: this.plane };\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { AsyncController, Config, I18nKeys, IDocument, IView, Plane, Precision, XYZ } from \"chili-core\";\nimport { SnapData, SnapResult } from \"../snap\";\nimport { AxisSnap, ObjectSnap, PlaneSnap } from \"../snaps\";\nimport { TrackingSnap } from \"../tracking\";\nimport { SnapEventHandler } from \"./snapEventHandler\";\n\nexport interface LengthAtAxisSnapData extends SnapData {\n    point: XYZ;\n    direction: XYZ;\n}\n\nexport interface SnapLengthAtPlaneData extends SnapData {\n    point: () => XYZ;\n    plane: (point: XYZ | undefined) => Plane;\n}\n\nexport class SnapLengthAtAxisHandler extends SnapEventHandler<LengthAtAxisSnapData> {\n    constructor(document: IDocument, controller: AsyncController, lengthData: LengthAtAxisSnapData) {\n        const objectSnap = new ObjectSnap(Config.instance.snapType, () => lengthData.point);\n        const axisSnap = new AxisSnap(lengthData.point, lengthData.direction);\n        super(document, controller, [objectSnap, axisSnap], lengthData);\n    }\n\n    protected getPointFromInput(view: IView, text: string): SnapResult {\n        const dist = this.calculateDistance(Number(text));\n        const point = this.calculatePoint(dist);\n        return { view, point, distance: dist, shapes: [] };\n    }\n\n    private calculateDistance(inputValue: number): number {\n        return this.shouldReverse() ? -inputValue : inputValue;\n    }\n\n    private calculatePoint(distance: number): XYZ {\n        return this.data.point.add(this.data.direction.multiply(distance));\n    }\n\n    private shouldReverse() {\n        return (\n            this._snaped?.point &&\n            this._snaped.point.sub(this.data.point).dot(this.data.direction) < -Precision.Distance\n        );\n    }\n\n    protected inputError(text: string): I18nKeys | undefined {\n        return Number.isNaN(Number(text)) ? \"error.input.invalidNumber\" : undefined;\n    }\n}\n\nexport class SnapLengthAtPlaneHandler extends SnapEventHandler<SnapLengthAtPlaneData> {\n    private workplane: Plane | undefined;\n\n    constructor(\n        document: IDocument,\n        controller: AsyncController,\n        readonly lengthData: SnapLengthAtPlaneData,\n    ) {\n        const objectSnap = new ObjectSnap(Config.instance.snapType, lengthData.point);\n        const trackingSnap = new TrackingSnap(lengthData.point, false);\n        const planeSnap = new PlaneSnap(lengthData.plane, lengthData.point);\n        super(document, controller, [objectSnap, trackingSnap, planeSnap], lengthData);\n    }\n\n    protected override setSnaped(view: IView, event: PointerEvent): void {\n        super.setSnaped(view, event);\n        this.updateWorkplane();\n    }\n\n    private updateWorkplane() {\n        if (this._snaped) {\n            this.workplane = this.lengthData.plane(this._snaped.point);\n            this._snaped.plane = this.workplane;\n        }\n    }\n\n    protected getPointFromInput(view: IView, text: string): SnapResult {\n        const plane = this.workplane ?? view.workplane;\n        const point = this.calculatePoint(text, plane);\n        return { point, view, shapes: [], plane };\n    }\n\n    private calculatePoint(text: string, plane: Plane): XYZ {\n        const numbers = text.split(\",\").map(Number);\n        return numbers.length === 1\n            ? this.calculatePointFromDistance(numbers[0])\n            : this.calculatePointFromCoordinates(numbers, plane);\n    }\n\n    private calculatePointFromDistance(distance: number): XYZ {\n        const vector = this._snaped?.point!.sub(this.data.point()).normalize();\n        return this.data.point().add(vector!.multiply(distance));\n    }\n\n    private calculatePointFromCoordinates(coords: number[], plane: Plane): XYZ {\n        return this.data.point().add(plane.xvec.multiply(coords[0])).add(plane.yvec.multiply(coords[1]));\n    }\n\n    protected inputError(text: string): I18nKeys | undefined {\n        const numbers = text.split(\",\").map(Number);\n        if (numbers.some(Number.isNaN) || (numbers.length !== 1 && numbers.length !== 2)) {\n            return \"error.input.invalidNumber\";\n        }\n        return undefined;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    AsyncController,\n    Config,\n    I18nKeys,\n    ICurve,\n    IDocument,\n    IView,\n    Plane,\n    Ray,\n    ShapeType,\n    XYZ\n} from \"chili-core\";\nimport { Dimension } from \"../dimension\";\nimport { ISnap, SnapData, SnapResult } from \"../snap\";\nimport { AxisSnap, ObjectSnap, PlaneSnap, PointOnCurveSnap, WorkplaneSnap } from \"../snaps\";\nimport { TrackingSnap } from \"../tracking\";\nimport { SnapEventHandler } from \"./snapEventHandler\";\n\nexport interface PointSnapData extends SnapData {\n    dimension?: Dimension;\n    refPoint?: () => XYZ;\n    plane?: () => Plane;\n}\n\nexport interface SnapPointOnCurveData extends PointSnapData {\n    curve: ICurve;\n}\n\nexport interface SnapPointOnAxisData extends PointSnapData {\n    ray: Ray\n}\n\nexport class PointSnapEventHandler extends SnapEventHandler<PointSnapData> {\n    constructor(document: IDocument, controller: AsyncController, pointData: PointSnapData) {\n        super(document, controller, [], pointData);\n        this.snaps.push(...this.getInitSnaps(pointData));\n    }\n\n    protected getInitSnaps(pointData: PointSnapData): ISnap[] {\n        const objectSnap = new ObjectSnap(Config.instance.snapType, pointData.refPoint);\n        const workplaneSnap = pointData.plane\n            ? new PlaneSnap(pointData.plane, pointData.refPoint)\n            : new WorkplaneSnap(pointData.refPoint);\n        const trackingSnap = new TrackingSnap(pointData.refPoint, true);\n        return [objectSnap, trackingSnap, workplaneSnap]\n    }\n\n    protected getPointFromInput(view: IView, text: string): SnapResult {\n        const [dims, isAbsolute] = this.parseInputDimensions(text);\n        const refPoint = this.getRefPoint() ?? XYZ.zero;\n        const result = { point: refPoint, view, shapes: [] };\n\n        if (isAbsolute) {\n            result.point = new XYZ(dims[0], dims[1], dims[2]);\n        } else if (dims.length === 1 && this._snaped?.point) {\n            result.point = this.calculatePointFromDistance(refPoint, dims[0]);\n        } else if (dims.length > 1) {\n            result.point = this.calculatePointFromCoordinates(refPoint, dims);\n        }\n\n        return result;\n    }\n\n    private parseInputDimensions(text: string): [number[], boolean] {\n        const isAbsolute = text.startsWith(\"#\");\n        if (isAbsolute) {\n            text = text.slice(1);\n        }\n        return [text.split(\",\").map(Number), isAbsolute];\n    }\n\n    private calculatePointFromDistance(refPoint: XYZ, distance: number): XYZ {\n        const vector = this._snaped!.point!.sub(refPoint).normalize()!;\n        return refPoint.add(vector.multiply(distance));\n    }\n\n    private calculatePointFromCoordinates(refPoint: XYZ, dims: number[]): XYZ {\n        const plane = this.data.plane?.() ?? this.snaped!.view.workplane;\n        let point = refPoint.add(plane.xvec.multiply(dims[0])).add(plane.yvec.multiply(dims[1]));\n        if (dims.length === 3) {\n            point = point.add(plane.normal.multiply(dims[2]));\n        }\n        return point;\n    }\n\n    protected inputError(text: string): I18nKeys | undefined {\n        const [dims, isAbsolute] = this.parseInputDimensions(text);\n        const dimension = Dimension.from(dims.length);\n\n        if (isAbsolute && dims.length !== 3) return \"error.input.threeNumberCanBeInput\";\n        if (!this.isValidDimension(dimension)) return \"error.input.unsupportedInputs\";\n        if (this.hasInvalidNumbers(dims)) return \"error.input.invalidNumber\";\n        if (this.requiresThreeNumbers(dims)) return \"error.input.threeNumberCanBeInput\";\n        if (this.isInvalidSingleNumber(dims)) return \"error.input.cannotInputANumber\";\n\n        return undefined;\n    }\n\n    private isValidDimension(dimension: Dimension): boolean {\n        return Dimension.contains(this.data.dimension!, dimension);\n    }\n\n    private hasInvalidNumbers(dims: number[]): boolean {\n        return dims.some(Number.isNaN);\n    }\n\n    private requiresThreeNumbers(dims: number[]): boolean {\n        const refPoint = this.getRefPoint();\n        return refPoint === undefined && dims.length !== 3;\n    }\n\n    private isInvalidSingleNumber(dims: number[]): boolean {\n        const refPoint = this.getRefPoint();\n        return dims.length === 1 && refPoint! && (!this._snaped || this._snaped.point!.isEqualTo(refPoint));\n    }\n\n    private getRefPoint(): XYZ | undefined {\n        return this.data.refPoint?.() ?? this._snaped?.refPoint;\n    }\n}\n\nexport class SnapPointOnCurveEventHandler extends SnapEventHandler<SnapPointOnCurveData> {\n    constructor(document: IDocument, controller: AsyncController, pointData: SnapPointOnCurveData) {\n        const objectSnap = new ObjectSnap(Config.instance.snapType);\n        const snap = new PointOnCurveSnap(pointData);\n        const workplaneSnap = new WorkplaneSnap();\n        super(document, controller, [objectSnap, snap, workplaneSnap], pointData);\n    }\n\n    protected override getPointFromInput(view: IView, text: string): SnapResult {\n        const length = this.data.curve.length();\n        const parameter = Number(text) / length;\n        return { point: this.data.curve.value(parameter), view, shapes: [] };\n    }\n\n    protected override inputError(text: string) {\n        return Number.isNaN(Number(text)) ? \"error.input.invalidNumber\" : undefined;\n    }\n}\n\nexport class SnapPointOnAxisEventHandler extends SnapEventHandler<SnapPointOnAxisData> {\n    constructor(document: IDocument, controller: AsyncController, pointData: SnapPointOnAxisData) {\n        const objectSnap = new ObjectSnap(Config.instance.snapType);\n        const snap = new AxisSnap(pointData.ray.location, pointData.ray.direction);\n        super(document, controller, [objectSnap, snap], pointData);\n    }\n\n    protected override getPointFromInput(view: IView, text: string): SnapResult {\n        const parameter = Number(text);\n        const point = this.data.ray.location.add(this.data.ray.direction.multiply(parameter));\n        return { point, view, shapes: [] };\n    }\n\n    protected override inputError(text: string) {\n        return Number.isNaN(Number(text)) ? \"error.input.invalidNumber\" : undefined;\n    }\n}\n\nexport class SnapPointPlaneEventHandler extends PointSnapEventHandler {\n    protected override getInitSnaps(pointData: PointSnapData): ISnap[] {\n        if (!pointData.plane) throw new Error(\"plane is required\");\n\n        return [\n            new ObjectSnap(Config.instance.snapType),\n            new PlaneSnap(pointData.plane)\n        ]\n    }\n\n    protected override findSnapPoint(shapeType: ShapeType, view: IView, event: PointerEvent): void {\n        super.findSnapPoint(shapeType, view, event);\n        \n        if (this._snaped?.point) {\n            this._snaped.point = this.data.plane!().project(this._snaped.point)\n        }\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { AsyncController, CursorType, I18nKeys, IDocument, XYZ } from \"chili-core\";\nimport { SnapData, SnapEventHandler, SnapResult } from \"../snap\";\n\nexport interface IStep {\n    execute(document: IDocument, controller: AsyncController): Promise<SnapResult | undefined>;\n}\n\nexport abstract class SnapStep<D extends SnapData> implements IStep {\n    protected cursor: CursorType = \"draw\";\n\n    constructor(\n        readonly tip: I18nKeys,\n        private readonly handleStepData: () => D,\n        private readonly keepSelected: boolean = false,\n    ) {}\n\n    async execute(document: IDocument, controller: AsyncController): Promise<SnapResult | undefined> {\n        if (!this.keepSelected) {\n            document.selection.clearSelection();\n            document.visual.highlighter.clear();\n        }\n\n        const data = this.handleStepData();\n        this.setValidator(data);\n\n        const executorHandler = this.getEventHandler(document, controller, data);\n        await document.selection.pickAsync(executorHandler, this.tip, controller, false, this.cursor);\n        const snaped = executorHandler.snaped;\n        \n        executorHandler.dispose();\n\n        return controller.result?.status === \"success\" ? snaped : undefined;\n    }\n\n    private setValidator(data: D) {\n        const oldValidator = data.validator;\n        data.validator = (point) => {\n            if (oldValidator) {\n                return oldValidator(point) && this.validator(data, point);\n            }\n            return this.validator(data, point);\n        };\n    }\n\n    protected abstract getEventHandler(\n        document: IDocument,\n        controller: AsyncController,\n        data: D,\n    ): SnapEventHandler;\n\n    protected abstract validator(data: D, point: XYZ): boolean;\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { AsyncController, I18nKeys, IDocument, Precision, XYZ } from \"chili-core\";\n\nimport { AngleSnapEventHandler, Dimension, PointSnapData } from \"../snap\";\nimport { SnapStep } from \"./step\";\n\nfunction defaultSnapedData(): PointSnapData {\n    return {\n        dimension: Dimension.D1D2D3,\n    };\n}\n\nexport class AngleStep extends SnapStep<PointSnapData> {\n    constructor(\n        tip: I18nKeys,\n        private readonly handleCenter: () => XYZ,\n        private readonly handleP1: () => XYZ,\n        handleP2Data: () => PointSnapData = defaultSnapedData,\n        keepSelected = false,\n    ) {\n        super(tip, handleP2Data, keepSelected);\n    }\n\n    protected getEventHandler(document: IDocument, controller: AsyncController, data: PointSnapData) {\n        return new AngleSnapEventHandler(document, controller, this.handleCenter, this.handleP1(), data);\n    }\n\n    protected validator(data: PointSnapData, point: XYZ): boolean {\n        return data.refPoint === undefined || data.refPoint().distanceTo(point) > Precision.Distance;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { AsyncController, IDocument, Precision, XYZ } from \"chili-core\";\nimport {\n    LengthAtAxisSnapData,\n    SnapLengthAtAxisHandler,\n    SnapLengthAtPlaneData,\n    SnapLengthAtPlaneHandler,\n} from \"../snap\";\nimport { SnapStep } from \"./step\";\n\nexport class LengthAtAxisStep extends SnapStep<LengthAtAxisSnapData> {\n    protected getEventHandler(document: IDocument, controller: AsyncController, data: LengthAtAxisSnapData) {\n        return new SnapLengthAtAxisHandler(document, controller, data);\n    }\n\n    protected validator(data: LengthAtAxisSnapData, point: XYZ): boolean {\n        return Math.abs(point.sub(data.point).dot(data.direction)) > Precision.Distance;\n    }\n}\n\nexport class LengthAtPlaneStep extends SnapStep<SnapLengthAtPlaneData> {\n    protected getEventHandler(\n        document: IDocument,\n        controller: AsyncController,\n        data: SnapLengthAtPlaneData,\n    ) {\n        return new SnapLengthAtPlaneHandler(document, controller, data);\n    }\n\n    protected validator(data: SnapLengthAtPlaneData, point: XYZ): boolean {\n        const pointAtPlane = data.plane(point).project(point);\n        return pointAtPlane.distanceTo(data.point()) > Precision.Distance;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { AsyncController, I18nKeys, IDocument, Precision, XYZ } from \"chili-core\";\nimport {\n    Dimension,\n    PointSnapData,\n    PointSnapEventHandler,\n    SnapPointOnAxisData,\n    SnapPointOnAxisEventHandler,\n    SnapPointOnCurveData,\n    SnapPointOnCurveEventHandler,\n    SnapPointPlaneEventHandler,\n} from \"../snap\";\nimport { SnapStep } from \"./step\";\n\nfunction defaultSnapedData(): PointSnapData {\n    return { dimension: Dimension.D1 | Dimension.D1D2D3 };\n}\n\nexport class PointStep extends SnapStep<PointSnapData> {\n    constructor(tip: I18nKeys, handleData: () => PointSnapData = defaultSnapedData, keepSelected = false) {\n        super(tip, handleData, keepSelected);\n    }\n\n    protected getEventHandler(document: IDocument, controller: AsyncController, data: PointSnapData) {\n        return new PointSnapEventHandler(document, controller, data);\n    }\n\n    protected validator(data: PointSnapData, point: XYZ): boolean {\n        return data.refPoint === undefined || data.refPoint().distanceTo(point) > Precision.Distance;\n    }\n}\n\nexport class PointOnCurveStep extends SnapStep<SnapPointOnCurveData> {\n    constructor(tip: I18nKeys, handleData: () => SnapPointOnCurveData, keepSelected = false) {\n        super(tip, handleData, keepSelected);\n    }\n\n    protected override validator(data: SnapPointOnCurveData, point: XYZ): boolean {\n        return true;\n    }\n\n    protected override getEventHandler(\n        document: IDocument,\n        controller: AsyncController,\n        data: SnapPointOnCurveData,\n    ) {\n        return new SnapPointOnCurveEventHandler(document, controller, data);\n    }\n}\n\nexport class PointOnAxisStep extends SnapStep<SnapPointOnAxisData> {\n    constructor(tip: I18nKeys, handleData: () => SnapPointOnAxisData, keepSelected = false) {\n        super(tip, handleData, keepSelected);\n    }\n\n    protected override validator(data: SnapPointOnAxisData, point: XYZ): boolean {\n        return true;\n    }\n\n    protected override getEventHandler(\n        document: IDocument,\n        controller: AsyncController,\n        data: SnapPointOnAxisData,\n    ) {\n        return new SnapPointOnAxisEventHandler(document, controller, data);\n    }\n}\n\nexport class PointOnPlaneStep extends SnapStep<PointSnapData> {\n    constructor(tip: I18nKeys, handleData: () => PointSnapData, keepSelected = false) {\n        super(tip, handleData, keepSelected);\n    }\n\n    protected override validator(data: PointSnapData, point: XYZ): boolean {\n        return true;\n    }\n\n    protected override getEventHandler(\n        document: IDocument,\n        controller: AsyncController,\n        data: SnapPointOnCurveData,\n    ) {\n        return new SnapPointPlaneEventHandler(document, controller, data);\n    }\n}","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    AsyncController,\n    I18nKeys,\n    IDocument,\n    INodeFilter,\n    IShapeFilter,\n    ShapeNode,\n    ShapeType,\n    VisualState,\n} from \"chili-core\";\nimport { SnapResult } from \"../snap\";\nimport { IStep } from \"./step\";\n\nexport interface SelectShapeOptions {\n    multiple?: boolean;\n    nodeFilter?: INodeFilter;\n    shapeFilter?: IShapeFilter;\n    selectedState?: VisualState;\n    highlightState?: VisualState;\n    keepSelection?: boolean;\n}\n\nexport interface SelectNodeOptions {\n    multiple?: boolean;\n    filter?: INodeFilter;\n    keepSelection?: boolean;\n}\n\nexport abstract class SelectStep implements IStep {\n    constructor(\n        readonly snapeType: ShapeType,\n        readonly prompt: I18nKeys,\n        readonly options?: SelectShapeOptions,\n    ) {}\n\n    async execute(document: IDocument, controller: AsyncController): Promise<SnapResult | undefined> {\n        const { shapeType, shapeFilter, nodeFilter } = document.selection;\n        document.selection.shapeType = this.snapeType;\n        document.selection.shapeFilter = this.options?.shapeFilter;\n        document.selection.nodeFilter = this.options?.nodeFilter;\n        if (!this.options?.keepSelection) {\n            document.selection.clearSelection();\n            document.visual.highlighter.clear();\n        }\n        try {\n            return await this.select(document, controller);\n        } finally {\n            document.selection.shapeType = shapeType;\n            document.selection.shapeFilter = shapeFilter;\n            document.selection.nodeFilter = nodeFilter;\n        }\n    }\n\n    abstract select(document: IDocument, controller: AsyncController): Promise<SnapResult | undefined>;\n}\n\nexport class SelectShapeStep extends SelectStep {\n    override async select(\n        document: IDocument,\n        controller: AsyncController,\n    ): Promise<SnapResult | undefined> {\n        const shapes = await document.selection.pickShape(\n            this.prompt,\n            controller,\n            this.options?.multiple === true,\n            this.options?.selectedState,\n            this.options?.highlightState,\n        );\n        if (shapes.length === 0) return undefined;\n        return {\n            view: document.application.activeView!,\n            shapes,\n            nodes: shapes.map((x) => x.owner.node),\n        };\n    }\n}\n\nexport class SelectNodeStep implements IStep {\n    constructor(\n        readonly prompt: I18nKeys,\n        readonly options?: SelectNodeOptions,\n    ) {}\n\n    async execute(document: IDocument, controller: AsyncController): Promise<SnapResult | undefined> {\n        const { nodeFilter } = document.selection;\n        document.selection.nodeFilter = this.options?.filter;\n        if (!this.options?.keepSelection) {\n            document.selection.clearSelection();\n            document.visual.highlighter.clear();\n        }\n        try {\n            const nodes = await document.selection.pickNode(\n                this.prompt,\n                controller,\n                this.options?.multiple === true,\n            );\n            if (nodes.length === 0) return undefined;\n            return {\n                view: document.application.activeView!,\n                shapes: [],\n                nodes,\n            };\n        } finally {\n            document.selection.nodeFilter = nodeFilter;\n        }\n    }\n}\n\nexport class GetOrSelectNodeStep extends SelectNodeStep {\n    override execute(document: IDocument, controller: AsyncController): Promise<SnapResult | undefined> {\n        const selected = document.selection.getSelectedNodes().filter((x) => {\n            if (this.options?.filter?.allow) {\n                return this.options.filter.allow(x);\n            }\n\n            return true;\n        });\n\n        if (selected.length > 0) {\n            controller.success();\n            return Promise.resolve({\n                view: document.application.activeView!,\n                shapes: [],\n                nodes: selected as ShapeNode[],\n            });\n        }\n\n        return super.execute(document, controller);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    AsyncController,\n    CancelableCommand,\n    Config,\n    EdgeMeshData,\n    IShape,\n    IShapeFactory,\n    IView,\n    LineType,\n    Result,\n    VertexMeshData,\n    VisualConfig,\n    XYZ,\n} from \"chili-core\";\nimport { ViewUtils } from \"chili-vis\";\nimport { SnapResult } from \"../snap\";\nimport { IStep } from \"../step\";\n\nexport abstract class MultistepCommand extends CancelableCommand {\n    protected stepDatas: SnapResult[] = [];\n\n    protected canExcute(): Promise<boolean> {\n        return Promise.resolve(true);\n    }\n\n    protected override onRestarting(): void {\n        this.resetStepDatas();\n    }\n\n    protected async executeAsync(): Promise<void> {\n        if (!(await this.canExcute()) || !(await this.executeSteps())) {\n            return;\n        }\n\n        this.executeMainTask();\n    }\n\n    protected async executeSteps(): Promise<boolean> {\n        let steps = this.getSteps();\n        try {\n            while (this.stepDatas.length < steps.length) {\n                this.controller = new AsyncController();\n                let data = await steps[this.stepDatas.length].execute(this.document, this.controller);\n                if (data === undefined || this.controller.result?.status !== \"success\") {\n                    return false;\n                }\n                this.stepDatas.push(data);\n            }\n            return true;\n        } finally {\n            if (!this._isRestarting) {\n                this.document.selection.clearSelection();\n                this.document.visual.highlighter.clear();\n            }\n        }\n    }\n\n    protected resetStepDatas() {\n        this.stepDatas.length = 0;\n    }\n\n    protected meshPoint(point: XYZ) {\n        return VertexMeshData.from(point, VisualConfig.editVertexSize, VisualConfig.editVertexColor);\n    }\n\n    protected meshLine(start: XYZ, end: XYZ, color = VisualConfig.defaultEdgeColor, lineWith?: number) {\n        const data = EdgeMeshData.from(start, end, color, LineType.Solid);\n        if (lineWith !== undefined) {\n            data.lineWidth = lineWith;\n        }\n        return data;\n    }\n\n    protected meshCreatedShape<K extends keyof IShapeFactory>(\n        method: K,\n        ...args: Parameters<IShapeFactory[K] extends (...args: any) => any ? IShapeFactory[K] : never>\n    ) {\n        const shape = (this.application.shapeFactory as any)[method](...args);\n        return this.meshShape(shape);\n    }\n\n    protected meshShape(shape: IShape | Result<IShape>, disposeShape = true) {\n        if (shape instanceof Result && !shape.isOk) {\n            throw shape.error;\n        }\n\n        const s = shape instanceof Result ? shape.value : shape;\n        const edgeMesh = s.edgesMeshPosition();\n        if (disposeShape) {\n            s.dispose();\n        }\n\n        return edgeMesh;\n    }\n\n    protected readonly findPlane = (view: IView, origin: XYZ, point: XYZ | undefined) => {\n        if (point === undefined || !Config.instance.dynamicWorkplane) {\n            return view.workplane.translateTo(origin);\n        }\n\n        return ViewUtils.raycastClosestPlane(view, origin, point);\n    };\n\n    protected transformdFirstShape(step: SnapResult, shouldDispose = true) {\n        const shape = step.shapes[0].shape.transformedMul(step.shapes[0].transform);\n        if (shouldDispose) this.disposeStack.add(shape);\n        return shape;\n    }\n\n    protected transformdShapes(step: SnapResult, shouldDispose = true) {\n        return step.shapes.map((s) => {\n            const shape = s.shape.transformedMul(s.transform);\n            if (shouldDispose) this.disposeStack.add(shape);\n            return shape;\n        });\n    }\n\n    protected abstract getSteps(): IStep[];\n\n    protected abstract executeMainTask(): void;\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IShape, PubSub, Result, ShapeNode, ShapeType, Transaction, VisualState, command } from \"chili-core\";\nimport { BooleanNode } from \"../bodys/boolean\";\nimport { IStep, SelectShapeStep } from \"../step\";\nimport { MultistepCommand } from \"./multistepCommand\";\n\nexport abstract class BooleanOperate extends MultistepCommand {\n    protected override executeMainTask() {\n        Transaction.execute(this.document, \"boolean\", () => {\n            const shape1 = this.transformdFirstShape(this.stepDatas[0]);\n            const shape2 = this.transformdShapes(this.stepDatas[1]);\n            const booleanType = this.getBooleanOperateType();\n\n            const booleanShape = this.getBooleanShape(booleanType, shape1, shape2);\n            if (!booleanShape.isOk) {\n                PubSub.default.pub(\"showToast\", \"error.default:{0}\", \"boolean failed\");\n                return;\n            }\n            const node = new BooleanNode(this.document, booleanShape.value);\n            this.document.rootNode.add(node);\n            this.stepDatas.forEach((x) => {\n                x.nodes?.forEach((n) => n.parent?.remove(n));\n            });\n            this.document.visual.update();\n        });\n    }\n\n    private getBooleanShape(\n        type: \"common\" | \"cut\" | \"fuse\",\n        shape1: IShape,\n        tools: IShape[],\n    ): Result<IShape> {\n        switch (type) {\n            case \"common\":\n                return this.application.shapeFactory.booleanCommon([shape1], tools);\n            case \"cut\":\n                return this.application.shapeFactory.booleanCut([shape1], tools);\n            default:\n                return this.application.shapeFactory.booleanFuse([shape1], tools);\n        }\n    }\n\n    protected abstract getBooleanOperateType(): \"common\" | \"cut\" | \"fuse\";\n\n    protected override getSteps(): IStep[] {\n        return [\n            new SelectShapeStep(ShapeType.Shape, \"prompt.select.shape\", {\n                nodeFilter: { allow: (node) => node instanceof ShapeNode },\n            }),\n            new SelectShapeStep(ShapeType.Shape, \"prompt.select.shape\", {\n                nodeFilter: {\n                    allow: (node) => {\n                        if (!(node instanceof ShapeNode)) {\n                            return false;\n                        }\n\n                        return !this.stepDatas[0].nodes\n                            ?.map((x) => (x as ShapeNode).shape.value)\n                            .includes(node.shape.value);\n                    },\n                },\n                multiple: true,\n                keepSelection: true,\n                selectedState: VisualState.faceTransparent,\n            }),\n        ];\n    }\n}\n\n@command({\n    key: \"boolean.common\",\n    icon: \"icon-booleanCommon\",\n})\nexport class BooleanCommon extends BooleanOperate {\n    protected override getBooleanOperateType(): \"common\" | \"cut\" | \"fuse\" {\n        return \"common\";\n    }\n}\n\n@command({\n    key: \"boolean.cut\",\n    icon: \"icon-booleanCut\",\n})\nexport class BooleanCut extends BooleanOperate {\n    protected override getBooleanOperateType(): \"common\" | \"cut\" | \"fuse\" {\n        return \"cut\";\n    }\n}\n\n@command({\n    key: \"boolean.join\",\n    icon: \"icon-booleanFuse\",\n})\nexport class BooleanFuse extends BooleanOperate {\n    protected override getBooleanOperateType(): \"common\" | \"cut\" | \"fuse\" {\n        return \"fuse\";\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    I18nKeys,\n    IDocument,\n    IShape,\n    ParameterShapeNode,\n    Property,\n    Result,\n    Serializer,\n    XYZ,\n} from \"chili-core\";\n\n@Serializer.register([\"document\", \"normal\", \"center\", \"start\", \"angle\"])\nexport class ArcNode extends ParameterShapeNode {\n    override display(): I18nKeys {\n        return \"body.arc\";\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"circle.center\")\n    get center() {\n        return this.getPrivateValue(\"center\");\n    }\n    set center(center: XYZ) {\n        this.setPropertyEmitShapeChanged(\"center\", center);\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"arc.start\")\n    get start(): XYZ {\n        return this.getPrivateValue(\"start\");\n    }\n\n    @Serializer.serialze()\n    get normal(): XYZ {\n        return this.getPrivateValue(\"normal\");\n    }\n\n    @Serializer.serialze()\n    @Property.define(\"arc.angle\")\n    get angle() {\n        return this.getPrivateValue(\"angle\");\n    }\n    set angle(value: number) {\n        this.setPropertyEmitShapeChanged(\"angle\", value);\n    }\n\n    constructor(document: IDocument, normal: XYZ, center: XYZ, start: XYZ, angle: number) {\n        super(document);\n        this.setPrivateValue(\"normal\", normal);\n        this.setPrivateValue(\"center\", center);\n        this.setPrivateValue(\"start\", start);\n        this.setPrivateValue(\"angle\", angle);\n    }\n\n    generateShape(): Result<IShape, string> {\n        return this.document.application.shapeFactory.arc(this.normal, this.center, this.start, this.angle);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { GeometryNode, Property, Transaction } from \"chili-core\";\nimport { MultistepCommand } from \"./multistepCommand\";\n\nlet count = 1;\n\nexport abstract class CreateCommand extends MultistepCommand {\n    protected override executeMainTask() {\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\n            let node = this.geometryNode();\n            this.document.addNode(node);\n            this.document.visual.update();\n        });\n    }\n\n    protected abstract geometryNode(): GeometryNode;\n}\n\nexport abstract class CreateNodeCommand extends MultistepCommand {\n    protected override executeMainTask() {\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\n            this.document.addNode(this.getNode());\n            this.document.visual.update();\n        });\n    }\n\n    protected abstract getNode(): GeometryNode;\n}\n\nexport abstract class CreateFaceableCommand extends CreateCommand {\n    protected _isFace: boolean = false;\n    @Property.define(\"option.command.isFace\")\n    public get isFace() {\n        return this._isFace;\n    }\n    public set isFace(value: boolean) {\n        this.setProperty(\"isFace\", value);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { GeometryNode, Plane, PlaneAngle, Precision, ShapeMeshData, XYZ, command } from \"chili-core\";\nimport { ArcNode } from \"../../bodys/arc\";\nimport { Dimension, SnapLengthAtPlaneData } from \"../../snap\";\nimport { AngleStep, IStep, LengthAtPlaneStep, PointStep } from \"../../step\";\nimport { CreateCommand } from \"../createCommand\";\n\n@command({\n    key: \"create.arc\",\n    icon: \"icon-arc\",\n})\nexport class Arc extends CreateCommand {\n    private _planeAngle: PlaneAngle | undefined;\n\n    getSteps(): IStep[] {\n        return [\n            new PointStep(\"prompt.pickCircleCenter\"),\n            new LengthAtPlaneStep(\"prompt.pickRadius\", this.getRadiusData),\n            new AngleStep(\n                \"prompt.pickNextPoint\",\n                () => this.stepDatas[0].point!,\n                () => this.stepDatas[1].point!,\n                this.getAngleData,\n            ),\n        ];\n    }\n\n    private readonly getRadiusData = (): SnapLengthAtPlaneData => {\n        const { point, view } = this.stepDatas[0];\n        return {\n            point: () => point!,\n            preview: this.circlePreview,\n            plane: (p: XYZ | undefined) => this.findPlane(view, point!, p),\n            validator: (p: XYZ) => {\n                if (p.distanceTo(point!) < Precision.Distance) return false;\n                return p.sub(point!).isParallelTo(this.stepDatas[0].view.workplane.normal) === false;\n            },\n        };\n    };\n\n    private readonly getAngleData = () => {\n        const [center, p1] = [this.stepDatas[0].point!, this.stepDatas[1].point!];\n        const plane = this.stepDatas[1].plane ?? this.findPlane(this.stepDatas[1].view, center, p1);\n        const points: ShapeMeshData[] = [this.meshPoint(center), this.meshPoint(p1)];\n        this._planeAngle = new PlaneAngle(new Plane(center, plane.normal, p1.sub(center)));\n        return {\n            dimension: Dimension.D1D2,\n            preview: (point: XYZ | undefined) => this.anglePreview(point, center, p1, points),\n            plane: () => plane,\n            validators: [this.angleValidator(center, plane)],\n        };\n    };\n\n    private anglePreview(\n        point: XYZ | undefined,\n        center: XYZ,\n        p1: XYZ,\n        points: ShapeMeshData[],\n    ): ShapeMeshData[] {\n        point = point ?? p1;\n        this._planeAngle!.movePoint(point);\n        const result = [...points];\n        if (Math.abs(this._planeAngle!.angle) > Precision.Angle) {\n            result.push(\n                this.meshCreatedShape(\n                    \"arc\",\n                    this._planeAngle!.plane.normal,\n                    center,\n                    p1,\n                    this._planeAngle!.angle,\n                ),\n            );\n        }\n        return result;\n    }\n\n    private angleValidator(center: XYZ, plane: Plane) {\n        return (p: XYZ) =>\n            p.distanceTo(center) >= Precision.Distance && !p.sub(center).isParallelTo(plane.normal);\n    }\n\n    protected override geometryNode(): GeometryNode {\n        const [p0, p1] = [this.stepDatas[0].point!, this.stepDatas[1].point!];\n        const plane = this.stepDatas[1].plane ?? this.findPlane(this.stepDatas[1].view, p0, p1);\n        this._planeAngle?.movePoint(this.stepDatas[2].point!);\n        return new ArcNode(this.document, plane.normal, p0, p1, this._planeAngle!.angle);\n    }\n\n    private readonly circlePreview = (end: XYZ | undefined) => {\n        const visualCenter = this.meshPoint(this.stepDatas[0].point!);\n        if (!end) return [visualCenter];\n        const { point, view } = this.stepDatas[0];\n        const plane = this.findPlane(view, point!, end);\n        return [\n            visualCenter,\n            this.meshLine(this.stepDatas[0].point!, end),\n            this.meshCreatedShape(\"circle\", plane.normal, point!, plane.projectDistance(point!, end)),\n        ];\n    };\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    AsyncController,\n    EdgeMeshData,\n    EditableShapeNode,\n    GeometryNode,\n    I18n,\n    LineType,\n    Precision,\n    ShapeMeshData,\n    VisualConfig,\n    XYZ,\n    command,\n} from \"chili-core\";\nimport { Dimension, PointSnapData, SnapResult } from \"../../snap\";\nimport { IStep, PointStep } from \"../../step\";\nimport { CreateCommand } from \"../createCommand\";\n\n@command({\n    key: \"create.bezier\",\n    icon: \"icon-bezier\",\n})\nexport class BezierCommand extends CreateCommand {\n    protected override geometryNode(): GeometryNode {\n        let bezier = this.application.shapeFactory.bezier(this.stepDatas.map((x) => x.point!));\n        return new EditableShapeNode(this.document, I18n.translate(\"command.create.bezier\"), bezier.value);\n    }\n\n    protected override async executeSteps() {\n        const steps = this.getSteps();\n        let firstStep = true;\n        while (true) {\n            const step = firstStep ? steps[0] : steps[1];\n            if (firstStep) firstStep = false;\n            this.controller = new AsyncController();\n            const data = await step.execute(this.document, this.controller);\n            if (data === undefined) {\n                return this.controller.result?.status === \"success\";\n            }\n            this.stepDatas.push(data);\n            if (this.isClose(data)) {\n                return true;\n            }\n        }\n    }\n\n    private isClose(data: SnapResult) {\n        console.log(this.stepDatas[0].point!.distanceTo(data.point!));\n        return (\n            this.stepDatas.length > 1 &&\n            this.stepDatas[0].point!.distanceTo(data.point!) <= Precision.Distance\n        );\n    }\n\n    protected override getSteps(): IStep[] {\n        let firstStep = new PointStep(\"prompt.pickFistPoint\");\n        let secondStep = new PointStep(\"prompt.pickNextPoint\", this.getNextData);\n        return [firstStep, secondStep];\n    }\n\n    private readonly getNextData = (): PointSnapData => {\n        return {\n            refPoint: () => this.stepDatas.at(-1)!.point!,\n            dimension: Dimension.D1D2D3,\n            validator: this.validator,\n            preview: this.preview,\n            featurePoints: [\n                {\n                    point: this.stepDatas.at(0)!.point!,\n                    prompt: I18n.translate(\"prompt.polygon.close\"),\n                    when: () => this.stepDatas.length > 2,\n                },\n            ],\n        };\n    };\n\n    private readonly preview = (point: XYZ | undefined): ShapeMeshData[] => {\n        let ps: ShapeMeshData[] = this.stepDatas.map((data) => this.meshPoint(data.point!));\n        let points = this.stepDatas.map((data) => data.point) as XYZ[];\n        if (point) {\n            points.push(point);\n        }\n        if (points.length > 1) {\n            ps.push(...this.previewLines(points));\n            ps.push(this.meshCreatedShape(\"bezier\", points));\n        }\n\n        return ps;\n    };\n\n    private readonly previewLines = (points: XYZ[]): ShapeMeshData[] => {\n        if (points.length < 2) {\n            return [];\n        }\n        let res: ShapeMeshData[] = [];\n        for (let i = 1; i < points.length; i++) {\n            res.push(this.meshHandle(points[i - 1], points[i]));\n        }\n        return res;\n    };\n\n    protected meshHandle(start: XYZ, end: XYZ) {\n        return EdgeMeshData.from(start, end, VisualConfig.temporaryEdgeColor, LineType.Dash);\n    }\n\n    private readonly validator = (point: XYZ): boolean => {\n        for (const data of this.stepDatas) {\n            if (point.distanceTo(data.point!) < 0.001) {\n                return false;\n            }\n        }\n        return true;\n    };\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Config, GeometryNode, MathUtils, Plane, Property, XYZ, command } from \"chili-core\";\nimport { ViewUtils } from \"chili-vis\";\nimport { RectNode } from \"../../bodys\";\nimport { SnapLengthAtPlaneData, SnapResult } from \"../../snap\";\nimport { IStep, LengthAtPlaneStep, PointStep } from \"../../step\";\nimport { CreateCommand } from \"../createCommand\";\n\nexport interface RectData {\n    plane: Plane;\n    dx: number;\n    dy: number;\n    p1: XYZ;\n    p2: XYZ;\n}\n\nexport namespace RectData {\n    export function get(atPlane: Plane, start: XYZ, end: XYZ): RectData {\n        let plane = new Plane(start, atPlane.normal, atPlane.xvec);\n        let vector = end.sub(start);\n        let dx = vector.dot(plane.xvec);\n        let dy = vector.dot(plane.yvec);\n        return { plane, dx, dy, p1: start, p2: end };\n    }\n}\n\nexport abstract class RectCommandBase extends CreateCommand {\n    protected getSteps(): IStep[] {\n        return [\n            new PointStep(\"prompt.pickFistPoint\"),\n            new LengthAtPlaneStep(\"prompt.pickNextPoint\", this.nextSnapData),\n        ];\n    }\n\n    private readonly nextSnapData = (): SnapLengthAtPlaneData => {\n        const { point, view } = this.stepDatas[0];\n        return {\n            point: () => point!,\n            preview: this.previewRect,\n            plane: (tmp: XYZ | undefined) => this.findPlane(view, point!, tmp),\n            validator: this.handleValid,\n            prompt: (snaped: SnapResult) => {\n                let data = this.rectDataFromTemp(snaped.point!);\n                return `${data.dx.toFixed(2)}, ${data.dy.toFixed(2)}`;\n            },\n        };\n    };\n\n    private readonly handleValid = (end: XYZ) => {\n        const data = this.rectDataFromTemp(end);\n        return data !== undefined && !MathUtils.anyEqualZero(data.dx, data.dy);\n    };\n\n    protected previewRect = (end: XYZ | undefined) => {\n        if (end === undefined) return [this.meshPoint(this.stepDatas[0].point!)];\n        const { plane, dx, dy } = this.rectDataFromTemp(end);\n\n        return [\n            this.meshPoint(this.stepDatas[0].point!),\n            this.meshPoint(end),\n            this.meshCreatedShape(\"rect\", plane, dx, dy),\n        ];\n    };\n\n    protected rectDataFromTemp(tmp: XYZ): RectData {\n        const { view, point } = this.stepDatas[0];\n        const plane = Config.instance.dynamicWorkplane\n            ? ViewUtils.raycastClosestPlane(view, point!, tmp)\n            : this.stepDatas[0].view.workplane.translateTo(point!);\n        return RectData.get(plane, point!, tmp);\n    }\n\n    protected rectDataFromTwoSteps() {\n        let rect: RectData;\n        if (this.stepDatas[1].plane) {\n            rect = RectData.get(this.stepDatas[1].plane, this.stepDatas[0].point!, this.stepDatas[1].point!);\n        } else {\n            rect = this.rectDataFromTemp(this.stepDatas[1].point!);\n        }\n        return rect;\n    }\n}\n\n@command({\n    key: \"create.rect\",\n    icon: \"icon-rect\",\n})\nexport class Rect extends RectCommandBase {\n    @Property.define(\"option.command.isFace\")\n    public get isFace() {\n        return this.getPrivateValue(\"isFace\", false);\n    }\n    public set isFace(value: boolean) {\n        this.setProperty(\"isFace\", value);\n    }\n\n    protected override geometryNode(): GeometryNode {\n        const { plane, dx, dy } = this.rectDataFromTwoSteps();\n        const node = new RectNode(this.document, plane, dx, dy);\n        node.isFace = this.isFace;\n        return node;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { GeometryNode, Plane, Precision, XYZ, command } from \"chili-core\";\nimport { BoxNode } from \"../../bodys\";\nimport { LengthAtAxisSnapData } from \"../../snap\";\nimport { IStep, LengthAtAxisStep } from \"../../step\";\nimport { RectCommandBase } from \"./rect\";\n\n@command({\n    key: \"create.box\",\n    icon: \"icon-box\",\n})\nexport class Box extends RectCommandBase {\n    protected override getSteps(): IStep[] {\n        let steps = super.getSteps();\n        let third = new LengthAtAxisStep(\"prompt.pickNextPoint\", this.getHeightStepData);\n        return [...steps, third];\n    }\n\n    private readonly getHeightStepData = (): LengthAtAxisSnapData => {\n        const plane = this.stepDatas[1].plane;\n        if (plane === undefined) {\n            throw new Error(\"plane is undefined, please report bug\");\n        }\n        return {\n            point: this.stepDatas[1].point!,\n            direction: plane.normal,\n            preview: this.previewBox,\n        };\n    };\n\n    private readonly previewBox = (end: XYZ | undefined) => {\n        if (!end) {\n            return this.previewRect(this.stepDatas[1].point);\n        }\n\n        const { plane, dx, dy } = this.rectDataFromTwoSteps();\n        return [\n            this.meshPoint(this.stepDatas[0].point!),\n            this.meshPoint(this.stepDatas[1].point!),\n            this.meshCreatedShape(\"box\", plane, dx, dy, this.getHeight(plane, end)),\n        ];\n    };\n\n    protected override geometryNode(): GeometryNode {\n        const rect = this.rectDataFromTwoSteps();\n        const dz = this.getHeight(rect.plane, this.stepDatas[2].point!);\n        return new BoxNode(this.document, rect.plane, rect.dx, rect.dy, dz);\n    }\n\n    private getHeight(plane: Plane, point: XYZ): number {\n        const h = point.sub(this.stepDatas[1].point!).dot(plane.normal);\n        if (Math.abs(h) < Precision.Distance) {\n            return h < 0 ? -0.00001 : 0.00001;\n        }\n        return h;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { GeometryNode, Precision, XYZ, command } from \"chili-core\";\nimport { CircleNode } from \"../../bodys\";\nimport { SnapLengthAtPlaneData } from \"../../snap\";\nimport { IStep, LengthAtPlaneStep, PointStep } from \"../../step\";\nimport { CreateFaceableCommand } from \"../createCommand\";\n\n@command({\n    key: \"create.circle\",\n    icon: \"icon-circle\",\n})\nexport class Circle extends CreateFaceableCommand {\n    getSteps(): IStep[] {\n        let centerStep = new PointStep(\"prompt.pickCircleCenter\");\n        let radiusStep = new LengthAtPlaneStep(\"prompt.pickRadius\", this.getRadiusData);\n        return [centerStep, radiusStep];\n    }\n\n    private readonly getRadiusData = (): SnapLengthAtPlaneData => {\n        const { point, view } = this.stepDatas[0];\n        return {\n            point: () => point!,\n            preview: this.circlePreview,\n            plane: (tmp: XYZ | undefined) => this.findPlane(view, point!, tmp),\n            validator: (p: XYZ) => {\n                if (p.distanceTo(point!) < Precision.Distance) return false;\n                const plane = this.findPlane(view, point!, p);\n                return p.sub(point!).isParallelTo(plane.normal) === false;\n            },\n        };\n    };\n\n    protected override geometryNode(): GeometryNode {\n        const [p1, p2] = [this.stepDatas[0].point!, this.stepDatas[1].point!];\n        const plane = this.stepDatas[1].plane ?? this.findPlane(this.stepDatas[1].view, p1, p2);\n        const body = new CircleNode(this.document, plane.normal, p1, plane.projectDistance(p1, p2));\n        body.isFace = this.isFace;\n        return body;\n    }\n\n    private readonly circlePreview = (end: XYZ | undefined) => {\n        if (!end) return [this.meshPoint(this.stepDatas[0].point!)];\n\n        const { point, view } = this.stepDatas[0];\n        const plane = this.findPlane(view, point!, end);\n        return [\n            this.meshPoint(this.stepDatas[0].point!),\n            this.meshLine(point!, end),\n            this.meshCreatedShape(\"circle\", plane.normal, point!, plane.projectDistance(point!, end)),\n        ];\n    };\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    EdgeMeshData,\n    GeometryNode,\n    LineType,\n    Plane,\n    Precision,\n    VisualConfig,\n    XYZ,\n    command,\n} from \"chili-core\";\nimport { ConeNode } from \"../../bodys\";\nimport { LengthAtAxisSnapData, SnapLengthAtPlaneData } from \"../../snap\";\nimport { IStep, LengthAtAxisStep, LengthAtPlaneStep, PointStep } from \"../../step\";\nimport { CreateCommand } from \"../createCommand\";\n\n@command({\n    key: \"create.cone\",\n    icon: \"icon-cone\",\n})\nexport class Cone extends CreateCommand {\n    protected override getSteps(): IStep[] {\n        let centerStep = new PointStep(\"prompt.pickCircleCenter\");\n        let radiusStep = new LengthAtPlaneStep(\"prompt.pickRadius\", this.getRadiusData);\n        let third = new LengthAtAxisStep(\"prompt.pickNextPoint\", this.getHeightStepData);\n        return [centerStep, radiusStep, third];\n    }\n\n    private readonly getRadiusData = (): SnapLengthAtPlaneData => {\n        const point = this.stepDatas[0].point!;\n        return {\n            point: () => point,\n            preview: this.circlePreview,\n            plane: (p: XYZ | undefined) => this.findPlane(this.stepDatas[0].view, point, p),\n            validator: (p: XYZ) => {\n                if (p.distanceTo(point) < Precision.Distance) return false;\n                const plane = this.findPlane(this.stepDatas[0].view, point, p);\n                return p.sub(point).isParallelTo(plane.normal) === false;\n            },\n        };\n    };\n\n    private readonly circlePreview = (point: XYZ | undefined) => {\n        if (!point) return [this.meshPoint(this.stepDatas[0].point!)];\n\n        const start = this.stepDatas[0].point!;\n        const plane = this.findPlane(this.stepDatas[0].view, start, point);\n        return [\n            this.meshPoint(this.stepDatas[0].point!),\n            this.meshLine(start, point),\n            this.meshCreatedShape(\"circle\", plane.normal, start, plane.projectDistance(start, point)),\n        ];\n    };\n\n    private readonly getHeightStepData = (): LengthAtAxisSnapData => {\n        return {\n            point: this.stepDatas[0].point!,\n            direction: this.stepDatas[1].plane!.normal,\n            preview: this.previewCone,\n        };\n    };\n\n    private readonly previewCone = (end: XYZ | undefined) => {\n        if (!end) {\n            return this.circlePreview(this.stepDatas[1].point);\n        }\n        const center = this.stepDatas[0].point!;\n        const p1Visual = this.meshPoint(center);\n        const plane = this.stepDatas[1].plane!;\n        const radius = plane.projectDistance(center, this.stepDatas[1].point!);\n        const up = center.add(plane.normal.multiply(this.getHeight(plane, end)));\n        return [\n            p1Visual,\n            this.meshCreatedShape(\"circle\", plane.normal, center, radius),\n            this.meshLine(center.add(plane.xvec.multiply(radius)), up),\n            this.meshLine(center.add(plane.xvec.multiply(-radius)), up),\n            this.meshLine(center.add(plane.yvec.multiply(radius)), up),\n            this.meshLine(center.add(plane.yvec.multiply(-radius)), up),\n        ];\n    };\n\n    protected override meshLine(start: XYZ, end: XYZ) {\n        return EdgeMeshData.from(start, end, VisualConfig.defaultEdgeColor, LineType.Solid);\n    }\n\n    protected override geometryNode(): GeometryNode {\n        const plane = this.stepDatas[1].plane!;\n        const radius = plane.projectDistance(this.stepDatas[0].point!, this.stepDatas[1].point!);\n        const height = this.getHeight(plane, this.stepDatas[2].point!);\n        return new ConeNode(\n            this.document,\n            height < 0 ? plane.normal.reverse() : plane.normal,\n            this.stepDatas[0].point!,\n            radius,\n            Math.abs(height),\n        );\n    }\n\n    private getHeight(plane: Plane, point: XYZ): number {\n        return point.sub(this.stepDatas[0].point!).dot(plane.normal);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    I18nKeys,\n    IDocument,\n    IEdge,\n    IShape,\n    IWire,\n    ParameterShapeNode,\n    Result,\n    Serializer,\n    ShapeType,\n} from \"chili-core\";\n\n@Serializer.register([\"document\", \"shapes\"])\nexport class FaceNode extends ParameterShapeNode {\n    override display(): I18nKeys {\n        return \"body.face\";\n    }\n\n    @Serializer.serialze()\n    get shapes(): IEdge[] | IWire[] {\n        return this.getPrivateValue(\"shapes\");\n    }\n    set shapes(values: IEdge[] | IWire[]) {\n        this.setPropertyEmitShapeChanged(\"shapes\", values);\n    }\n\n    constructor(document: IDocument, shapes: IEdge[] | IWire[]) {\n        super(document);\n        this.setPrivateValue(\"shapes\", shapes);\n    }\n\n    private isAllClosed(): boolean {\n        return this.shapes.every((shape) => shape.isClosed() || shape.shapeType === ShapeType.Wire);\n    }\n\n    private getWires(): IWire[] {\n        let wires: IWire[] = [];\n        if (this.isAllClosed()) {\n            this.addClosedEdges(wires, this.shapes as IEdge[]);\n        } else {\n            this.addUnclosedEdges(wires, this.shapes as IEdge[]);\n        }\n\n        return wires;\n    }\n\n    private addClosedEdges(wires: IWire[], edges: IEdge[]): void {\n        for (const shape of this.shapes) {\n            if (shape.shapeType === ShapeType.Wire) {\n                wires.push(shape as IWire);\n            } else {\n                this.addUnclosedEdges(wires, [shape as IEdge]);\n            }\n        }\n    }\n\n    private addUnclosedEdges(wires: IWire[], edges: IEdge[]): void {\n        let wire = this.document.application.shapeFactory.wire(edges);\n        if (!wire.isOk) throw new Error(\"Cannot create wire from open shapes\");\n        wires.push(wire.value);\n    }\n\n    override generateShape(): Result<IShape> {\n        if (this.shapes.length === 0) return Result.err(\"No shapes to create face\");\n\n        let wires = this.getWires();\n        return this.document.application.shapeFactory.face(wires);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { I18nKeys, IDocument, IEdge, IShape, ParameterShapeNode, Result, Serializer } from \"chili-core\";\n\n@Serializer.register([\"document\", \"edges\"])\nexport class WireNode extends ParameterShapeNode {\n    override display(): I18nKeys {\n        return \"body.wire\";\n    }\n\n    @Serializer.serialze()\n    get edges(): IEdge[] {\n        return this.getPrivateValue(\"edges\");\n    }\n    set edges(values: IEdge[]) {\n        this.setPropertyEmitShapeChanged(\"edges\", values);\n    }\n\n    constructor(document: IDocument, edges: IEdge[]) {\n        super(document);\n        this.setPrivateValue(\"edges\", edges);\n    }\n\n    override generateShape(): Result<IShape> {\n        return this.document.application.shapeFactory.wire(this.edges);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    AsyncController,\n    CancelableCommand,\n    EditableShapeNode,\n    GeometryNode,\n    IDocument,\n    IEdge,\n    IFace,\n    INode,\n    IShape,\n    IShapeFilter,\n    IShell,\n    PubSub,\n    Result,\n    ShapeNode,\n    ShapeNodeFilter,\n    ShapeType,\n    Transaction,\n    command,\n} from \"chili-core\";\nimport { FaceNode } from \"../../bodys/face\";\nimport { WireNode } from \"../../bodys/wire\";\nimport { SelectNodeStep } from \"../../step\";\n\nabstract class ConvertCommand extends CancelableCommand {\n    async executeAsync(): Promise<void> {\n        const models = await this.getOrPickModels(this.document);\n        if (!models) {\n            PubSub.default.pub(\"showToast\", \"toast.select.noSelected\");\n            return;\n        }\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\n            const node = this.create(this.document, models);\n            if (!node.isOk) {\n                PubSub.default.pub(\"showToast\", \"toast.converter.error\");\n            } else {\n                this.document.rootNode.add(node.value);\n                this.document.visual.update();\n                PubSub.default.pub(\"showToast\", \"toast.success\");\n            }\n\n            models.forEach((x) => x.parent?.remove(x));\n        });\n    }\n\n    protected abstract create(document: IDocument, models: INode[]): Result<GeometryNode>;\n    protected shapeFilter(): IShapeFilter {\n        return {\n            allow: (shape: IShape) =>\n                shape.shapeType === ShapeType.Edge || shape.shapeType === ShapeType.Wire,\n        };\n    }\n\n    async getOrPickModels(document: IDocument) {\n        const filter = this.shapeFilter();\n        let models = this._getSelectedModels(document, filter);\n        document.selection.clearSelection();\n        if (models.length > 0) return models;\n\n        const step = new SelectNodeStep(\"prompt.select.models\", {\n            filter: new ShapeNodeFilter(filter),\n            multiple: true,\n        });\n        this.controller = new AsyncController();\n        const data = await step.execute(document, this.controller);\n        document.selection.clearSelection();\n        return data?.nodes;\n    }\n\n    private _getSelectedModels(document: IDocument, filter?: IShapeFilter) {\n        return document.selection\n            .getSelectedNodes()\n            .map((x) => x as ShapeNode)\n            .filter((x) => {\n                if (x === undefined) return false;\n                let shape = x.shape.value;\n                if (shape === undefined) return false;\n                if (filter !== undefined && !filter.allow(shape)) return false;\n                return true;\n            });\n    }\n}\n\n@command({\n    key: \"convert.toWire\",\n    icon: \"icon-toPoly\",\n})\nexport class ConvertToWire extends ConvertCommand {\n    protected override create(document: IDocument, models: ShapeNode[]): Result<GeometryNode> {\n        const edges = models.map((x) => x.shape.value.transformedMul(x.worldTransform())) as IEdge[];\n        const wireBody = new WireNode(document, edges);\n        const shape = wireBody.generateShape();\n        if (!shape.isOk) return Result.err(shape.error);\n\n        return Result.ok(wireBody);\n    }\n}\n\n@command({\n    key: \"convert.toFace\",\n    icon: \"icon-toFace\",\n})\nexport class ConvertToFace extends ConvertCommand {\n    protected override create(document: IDocument, models: ShapeNode[]): Result<GeometryNode> {\n        const edges = models.map((x) => x.shape.value.transformedMul(x.worldTransform())) as IEdge[];\n        const wireBody = new FaceNode(document, edges);\n        const shape = wireBody.generateShape();\n        if (!shape.isOk) return Result.err(shape.error);\n\n        return Result.ok(wireBody);\n    }\n}\n\n@command({\n    key: \"convert.toShell\",\n    icon: \"icon-toShell\",\n})\nexport class ConvertToShell extends ConvertCommand {\n    protected override shapeFilter(): IShapeFilter {\n        return {\n            allow: (shape: IShape) => shape.shapeType === ShapeType.Face,\n        };\n    }\n\n    protected override create(document: IDocument, models: ShapeNode[]): Result<GeometryNode> {\n        const faces = models.map((x) => x.shape.value.transformedMul(x.worldTransform())) as IFace[];\n        const shape = this.application.shapeFactory.shell(faces);\n        faces.forEach((x) => x.dispose());\n        if (!shape.isOk) return Result.err(shape.error);\n\n        const shell = new EditableShapeNode(document, \"shell\", shape);\n        return Result.ok(shell);\n    }\n}\n\n@command({\n    key: \"convert.toSolid\",\n    icon: \"icon-toSolid\",\n})\nexport class ConvertToSolid extends ConvertCommand {\n    protected override shapeFilter(): IShapeFilter {\n        return {\n            allow: (shape: IShape) => shape.shapeType === ShapeType.Shell,\n        };\n    }\n\n    protected override create(document: IDocument, models: ShapeNode[]): Result<GeometryNode> {\n        const faces = models.map((x) => x.shape.value.transformedMul(x.worldTransform())) as IShell[];\n        const shape = this.application.shapeFactory.solid(faces);\n        faces.forEach((x) => x.dispose());\n        if (!shape.isOk) return Result.err(shape.error);\n\n        const solid = new EditableShapeNode(document, \"solid\", shape);\n        return Result.ok(solid);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { EditableShapeNode, PubSub, ShapeType, Transaction, command } from \"chili-core\";\nimport { SelectShapeStep } from \"../../step/selectStep\";\nimport { MultistepCommand } from \"../multistepCommand\";\n\n@command({\n    key: \"create.copyShape\",\n    icon: \"icon-subShape\",\n})\nexport class CopySubShapeCommand extends MultistepCommand {\n    protected override executeMainTask() {\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\n            this.stepDatas[0].shapes.forEach((x) => {\n                const subShape = x.shape.clone();\n                const model = new EditableShapeNode(\n                    this.document,\n                    ShapeType.stringValue(subShape.shapeType),\n                    subShape,\n                );\n\n                const node = x.owner.node;\n                model.transform = node.transform;\n                node.parent!.insertAfter(node, model);\n            });\n            this.document.visual.update();\n            PubSub.default.pub(\"showToast\", \"toast.success\");\n        });\n    }\n\n    protected override getSteps() {\n        return [\n            new SelectShapeStep(ShapeType.Edge | ShapeType.Face, \"prompt.select.shape\", { multiple: true }),\n        ];\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { command, EditableShapeNode, I18n, IEdge, IFace, IWire, Property, ShapeType, XYZ } from \"chili-core\";\nimport { IStep, SelectShapeStep } from \"../../step\";\nimport { CreateCommand } from \"../createCommand\";\n\n@command({\n    key: \"convert.curveProjection\",\n    icon: \"icon-curveProject\",\n})\nexport class CurveProjectionCommand extends CreateCommand {\n    @Property.define(\"common.dir\")\n    get dir() {\n        return this.getPrivateValue(\"dir\", \"0,0,-1\");\n    }\n\n    set dir(value: string) {\n        const nums = this.dir\n            .split(\",\")\n            .map(Number)\n            .filter((n) => !isNaN(n));\n        if (nums.length !== 3) {\n            alert(I18n.translate(\"error.input.threeNumberCanBeInput\"));\n\n            return;\n        }\n        this.setProperty(\"dir\", value);\n    }\n\n    protected override geometryNode() {\n        const shape = this.transformdFirstShape(this.stepDatas[0]) as IEdge | IWire;\n        const face = this.transformdFirstShape(this.stepDatas[1]) as IFace;\n        const [x, y, z] = this.dir.split(\",\").map(Number);\n        const dir = new XYZ(x, y, z).normalize() as XYZ;\n\n        const curveProjection = this.application.shapeFactory.curveProjection(shape, face, dir);\n        return new EditableShapeNode(\n            this.document,\n            I18n.translate(\"command.convert.curveProjection\"),\n            curveProjection.value,\n        );\n    }\n\n    protected override getSteps(): IStep[] {\n        return [\n            new SelectShapeStep(ShapeType.Edge | ShapeType.Wire, \"prompt.select.shape\"),\n            new SelectShapeStep(ShapeType.Face, \"prompt.select.faces\", { keepSelection: true }),\n        ];\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { GeometryNode, Plane, Precision, XYZ, command } from \"chili-core\";\nimport { CylinderNode } from \"../../bodys\";\nimport { LengthAtAxisSnapData, SnapLengthAtPlaneData } from \"../../snap\";\nimport { IStep, LengthAtAxisStep, LengthAtPlaneStep, PointStep } from \"../../step\";\nimport { CreateCommand } from \"../createCommand\";\n\n@command({\n    key: \"create.cylinder\",\n    icon: \"icon-cylinder\",\n})\nexport class Cylinder extends CreateCommand {\n    protected override getSteps(): IStep[] {\n        let centerStep = new PointStep(\"prompt.pickCircleCenter\");\n        let radiusStep = new LengthAtPlaneStep(\"prompt.pickRadius\", this.getRadiusData);\n        let third = new LengthAtAxisStep(\"prompt.pickNextPoint\", this.getHeightStepData);\n        return [centerStep, radiusStep, third];\n    }\n\n    private readonly getRadiusData = (): SnapLengthAtPlaneData => {\n        const { point, view } = this.stepDatas[0];\n        return {\n            point: () => point!,\n            preview: this.circlePreview,\n            plane: (tmp: XYZ | undefined) => this.findPlane(view, point!, tmp),\n            validator: (p: XYZ) => {\n                if (p.distanceTo(point!) < Precision.Distance) return false;\n                const plane = this.findPlane(view, point!, p);\n                return p.sub(point!).isParallelTo(plane.normal) === false;\n            },\n        };\n    };\n\n    private readonly circlePreview = (point: XYZ | undefined) => {\n        if (!point) return [this.meshPoint(this.stepDatas[0].point!)];\n\n        const start = this.stepDatas[0].point!;\n        const plane = this.findPlane(this.stepDatas[0].view, start, point);\n        return [\n            this.meshPoint(this.stepDatas[0].point!),\n            this.meshLine(start, point),\n            this.meshCreatedShape(\"circle\", plane.normal, start, plane.projectDistance(start, point)),\n        ];\n    };\n\n    private readonly getHeightStepData = (): LengthAtAxisSnapData => {\n        return {\n            point: this.stepDatas[0].point!,\n            direction: this.stepDatas[1].plane!.normal,\n            preview: this.previewCylinder,\n            validator: (p: XYZ) => {\n                return Math.abs(this.getHeight(this.stepDatas[1].plane!, p)) > 0.001;\n            },\n        };\n    };\n\n    private readonly previewCylinder = (end: XYZ | undefined) => {\n        if (!end) {\n            return this.circlePreview(this.stepDatas[1].point);\n        }\n\n        const plane = this.stepDatas[1].plane!;\n        const radius = plane.projectDistance(this.stepDatas[0].point!, this.stepDatas[1].point!);\n        const height = this.getHeight(plane, end);\n\n        return [\n            this.meshPoint(this.stepDatas[0].point!),\n            this.meshCreatedShape(\n                \"cylinder\",\n                height < 0 ? plane.normal.reverse() : plane.normal,\n                this.stepDatas[0].point!,\n                radius,\n                Math.abs(height),\n            ),\n        ];\n    };\n\n    protected override geometryNode(): GeometryNode {\n        const plane = this.stepDatas[1].plane!;\n        const radius = plane.projectDistance(this.stepDatas[0].point!, this.stepDatas[1].point!);\n        const dz = this.getHeight(plane, this.stepDatas[2].point!);\n        return new CylinderNode(\n            this.document,\n            dz < 0 ? plane.normal.reverse() : plane.normal,\n            this.stepDatas[0].point!,\n            radius,\n            Math.abs(dz),\n        );\n    }\n\n    private getHeight(plane: Plane, point: XYZ): number {\n        return point.sub(this.stepDatas[0].point!).dot(plane.normal);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { GeometryNode, Precision, XYZ, command } from \"chili-core\";\nimport { EllipseNode } from \"../../bodys/ellipse\";\nimport { LengthAtAxisSnapData, SnapLengthAtPlaneData } from \"../../snap\";\nimport { IStep, LengthAtAxisStep, LengthAtPlaneStep, PointStep } from \"../../step\";\nimport { CreateFaceableCommand } from \"../createCommand\";\n\n@command({\n    key: \"create.ellipse\",\n    icon: \"icon-ellipse\",\n})\nexport class Ellipse extends CreateFaceableCommand {\n    getSteps(): IStep[] {\n        let centerStep = new PointStep(\"prompt.pickCircleCenter\");\n        let radiusStepX = new LengthAtPlaneStep(\"prompt.pickRadius\", this.getRadius1Data);\n        let radiusStepY = new LengthAtAxisStep(\"prompt.pickRadius\", this.getRadius2Data);\n        return [centerStep, radiusStepX, radiusStepY];\n    }\n\n    private readonly getRadius1Data = (): SnapLengthAtPlaneData => {\n        const point = this.stepDatas[0].point!;\n        return {\n            point: () => point,\n            preview: this.previewCircle,\n            plane: (tmp: XYZ | undefined) => this.findPlane(this.stepDatas[0].view, point, tmp),\n            validator: this.validatePoint,\n        };\n    };\n\n    private readonly validatePoint = (point: XYZ) => {\n        const center = this.stepDatas[0].point!;\n        if (point.distanceTo(center) < Precision.Distance) return false;\n        const plane = this.findPlane(this.stepDatas[0].view, center, point);\n        return point.sub(center).isParallelTo(plane.normal) === false;\n    };\n\n    protected previewCircle = (end: XYZ | undefined) => {\n        if (end === undefined) return [this.meshPoint(this.stepDatas[0].point!)];\n\n        const plane = this.findPlane(this.stepDatas[0].view, this.stepDatas[0].point!, end);\n        return [\n            this.meshPoint(this.stepDatas[0].point!),\n            this.meshPoint(end),\n            this.meshCreatedShape(\n                \"circle\",\n                plane.normal,\n                this.stepDatas[0].point!,\n                end.distanceTo(this.stepDatas[0].point!),\n            ),\n        ];\n    };\n\n    private readonly getRadius2Data = (): LengthAtAxisSnapData => {\n        const point = this.stepDatas[0].point!;\n        const plane = this.stepDatas[1].plane!;\n        const direction = plane.normal.cross(this.stepDatas[1].point!.sub(point)).normalize()!;\n        return {\n            point: point,\n            preview: this.ellipsePreview,\n            direction,\n            validator: this.validatePoint,\n        };\n    };\n\n    protected override geometryNode(): GeometryNode {\n        const [p0, p1, p2] = [this.stepDatas[0].point!, this.stepDatas[1].point!, this.stepDatas[2].point!];\n        const plane = this.stepDatas[1].plane!;\n        const d1 = plane.projectDistance(p0, p1);\n        const d2 = plane.projectDistance(p0, p2);\n        const body = new EllipseNode(this.document, plane.normal, p0, p1.sub(p0), d1, d2 > d1 ? d1 : d2);\n        return body;\n    }\n\n    private readonly ellipsePreview = (point: XYZ | undefined) => {\n        if (!point) return this.previewCircle(this.stepDatas[1].point);\n\n        return [\n            this.meshPoint(this.stepDatas[0].point!),\n            this.meshPoint(this.stepDatas[1].point!),\n            this.createEllipse(point),\n        ];\n    };\n\n    private createEllipse(p2: XYZ) {\n        const p0 = this.stepDatas[0].point!;\n        const p1 = this.stepDatas[1].point!;\n        const plane = this.stepDatas[1].plane!;\n\n        const d1 = plane.projectDistance(p0, p1);\n        const d2 = plane.projectDistance(p0, p2);\n        return this.meshCreatedShape(\"ellipse\", plane.normal, p0, p1.sub(p0), d1, d2 > d1 ? d1 : d2);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { GeometryNode, IFace, Precision, ShapeType, command } from \"chili-core\";\nimport { PrismNode } from \"../../bodys\";\nimport { LengthAtAxisSnapData } from \"../../snap\";\nimport { IStep, LengthAtAxisStep } from \"../../step\";\nimport { SelectShapeStep } from \"../../step/selectStep\";\nimport { CreateCommand } from \"../createCommand\";\n\n@command({\n    key: \"convert.fuse\",\n    icon: \"icon-circle\",\n})\nexport class Fuse extends CreateCommand {\n    protected override geometryNode(): GeometryNode {\n        let shape = this.stepDatas[0].shapes[0].shape as IFace; // todo assert\n        let [point, normal] = shape.normal(0, 0);\n        let dist = this.stepDatas[1].point!.sub(point).dot(normal);\n        return new PrismNode(this.document, shape, dist);\n    }\n\n    protected override getSteps(): IStep[] {\n        return [\n            new SelectShapeStep(ShapeType.Face, \"prompt.select.faces\"),\n            new LengthAtAxisStep(\"prompt.pickNextPoint\", this.getLengthStepData),\n        ];\n    }\n\n    private getLengthStepData = (): LengthAtAxisSnapData => {\n        let shape = this.stepDatas[0].shapes[0].shape as IFace; // todo assert\n        let [point, normal] = shape.normal(0, 0);\n        return {\n            point,\n            direction: normal,\n            preview: (p) => {\n                if (!p) return [];\n                let dist = p.sub(point).dot(normal);\n                if (Math.abs(dist) < Precision.Float) return [];\n                let vec = normal.multiply(dist);\n                return [this.application.shapeFactory.prism(shape, vec).value.mesh.edges!];\n            },\n        };\n    };\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { button, div, input, label, XYZConverter } from \"chili-controls\";\nimport {\n    AsyncController,\n    Binding,\n    command,\n    Component,\n    ComponentNode,\n    DialogResult,\n    IApplication,\n    ICommand,\n    IDocument,\n    Localize,\n    Observable,\n    PubSub,\n    Transaction,\n    VisualNode,\n    XYZ,\n} from \"chili-core\";\nimport { GetOrSelectNodeStep, IStep, PointStep } from \"../../step\";\nimport { MultistepCommand } from \"../multistepCommand\";\n\nclass GroupDefinition extends Observable {\n    get name() {\n        return this.getPrivateValue(\"name\", \"unnamed\");\n    }\n    set name(value: string) {\n        this.setProperty(\"name\", value);\n    }\n\n    get insert() {\n        return this.getPrivateValue(\"insert\", XYZ.zero);\n    }\n    set insert(value: XYZ) {\n        this.setProperty(\"insert\", value);\n    }\n\n    get convertInstance() {\n        return this.getPrivateValue(\"convertInstance\", true);\n    }\n    set convertInstance(value: boolean) {\n        this.setProperty(\"convertInstance\", value);\n    }\n}\n\n@command({\n    key: \"create.group\",\n    icon: \"icon-group\",\n})\nexport class GroupCommand extends MultistepCommand {\n    protected override getSteps(): IStep[] {\n        return [new GetOrSelectNodeStep(\"prompt.select.shape\", { multiple: true })];\n    }\n\n    protected override executeMainTask(): void {\n        const nodes = this.stepDatas[0].nodes?.filter((node) => node instanceof VisualNode);\n        if (!nodes || nodes.length === 0) {\n            PubSub.default.pub(\"showToast\", \"toast.select.noSelected\");\n            return;\n        }\n\n        let definition = new GroupDefinition();\n\n        PubSub.default.pub(\"showDialog\", \"command.create.group\", this.dialog(definition), (r) => {\n            if (r === DialogResult.ok) this.createGroup(definition, nodes);\n        });\n    }\n\n    private createGroup(definition: GroupDefinition, nodes: VisualNode[]) {\n        Transaction.execute(this.document, \"create group\", () => {\n            for (const node of nodes) {\n                const worldTransform = node.worldTransform();\n                node.parent?.transfer(node);\n                node.transform = worldTransform;\n            }\n\n            const component = new Component(definition.name, this.stepDatas[0].nodes!, definition.insert);\n            this.document.components.push(component);\n\n            if (definition.convertInstance) {\n                const group = new ComponentNode(\n                    this.document,\n                    definition.name,\n                    component.id,\n                    component.origin,\n                );\n                this.document.rootNode.add(group);\n            }\n        });\n    }\n\n    private readonly pickInsertPoint = async (definition: GroupDefinition, e: MouseEvent) => {\n        const dialog = this.findDialog(e.target as HTMLElement);\n        if (!dialog) return;\n        dialog.close();\n\n        const command = new PickInsertPointCommand(this.document, definition);\n        try {\n            if (this.document.application.executingCommand) {\n                throw new Error(\"Command is executing\");\n            }\n            this.document.application.executingCommand = command;\n            await command.execute(this.document.application);\n        } finally {\n            dialog.showModal();\n            this.document.application.executingCommand = undefined;\n        }\n    };\n\n    private readonly findDialog = (e: HTMLElement): HTMLDialogElement | undefined => {\n        if (e instanceof HTMLDialogElement) return e;\n        if (!e.parentElement) return undefined;\n\n        return this.findDialog(e.parentElement);\n    };\n\n    private dialog(definition: GroupDefinition) {\n        return div(\n            {\n                style: {\n                    display: \"flex\",\n                    flexDirection: \"column\",\n                    gap: \"10px\",\n                },\n            },\n            label(\n                {\n                    textContent: new Localize(\"common.name\"),\n                },\n                \": \",\n            ),\n            input({\n                value: new Binding(definition, \"name\"),\n                onkeydown: (e) => {\n                    e.stopPropagation();\n                },\n                onblur: (e) => {\n                    definition.name = (e.target as HTMLInputElement).value;\n                },\n            }),\n            label(\n                {\n                    textContent: new Localize(\"option.command.insertPoint\"),\n                },\n                \": \",\n            ),\n            div(\n                {\n                    style: {\n                        display: \"inline-flex\",\n                        flexDirection: \"row\",\n                        padding: \"10px\",\n                        borderRadius: \"5px\",\n                        border: \"1px solid var(--border-color)\",\n                        gap: \"6px\",\n                    },\n                },\n                input({\n                    value: new Binding(definition, \"insert\", new XYZConverter()),\n                    onkeydown: (e) => {\n                        e.stopPropagation();\n                    },\n                }),\n                button({\n                    textContent: new Localize(\"option.command.insertPoint\"),\n                    onclick: (e) => this.pickInsertPoint(definition, e),\n                }),\n            ),\n            div(\n                input({\n                    type: \"checkbox\",\n                    id: \"instanceID\",\n                    checked: new Binding(definition, \"convertInstance\"),\n                    onchange: (e) => {\n                        definition.convertInstance = (e.target as HTMLInputElement).checked;\n                    },\n                }),\n                \" \",\n                label({\n                    textContent: new Localize(\"option.command.isConvertInstance\"),\n                    htmlFor: \"instanceID\",\n                }),\n            ),\n        );\n    }\n}\n\nclass PickInsertPointCommand implements ICommand {\n    constructor(\n        readonly document: IDocument,\n        readonly defination: GroupDefinition,\n    ) {}\n\n    async execute(application: IApplication): Promise<void> {\n        const pickPointStep = new PointStep(\"option.command.insertPoint\");\n        const controller = new AsyncController();\n        const result = await pickPointStep.execute(this.document, controller);\n\n        if (result?.point) {\n            this.defination.insert = result.point;\n        }\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { GeometryNode, Precision, Property, XYZ, command } from \"chili-core\";\nimport { LineNode } from \"../../bodys\";\nimport { Dimension, PointSnapData } from \"../../snap\";\nimport { IStep, PointStep } from \"../../step\";\nimport { CreateCommand } from \"../createCommand\";\n\n@command({\n    key: \"create.line\",\n    icon: \"icon-line\",\n})\nexport class Line extends CreateCommand {\n    @Property.define(\"option.command.isConnected\", {\n        dependencies: [{ property: \"repeatOperation\", value: true }],\n    })\n    get isContinue() {\n        return this.getPrivateValue(\"isContinue\", false);\n    }\n    set isContinue(value: boolean) {\n        this.setProperty(\"isContinue\", value);\n    }\n\n    protected override geometryNode(): GeometryNode {\n        return new LineNode(this.document, this.stepDatas[0].point!, this.stepDatas[1].point!);\n    }\n\n    getSteps(): IStep[] {\n        let firstStep = new PointStep(\"prompt.pickFistPoint\");\n        let secondStep = new PointStep(\"prompt.pickNextPoint\", this.getSecondPointData);\n        return [firstStep, secondStep];\n    }\n\n    protected override resetStepDatas() {\n        if (this.isContinue) {\n            this.stepDatas[0] = this.stepDatas[1];\n            this.stepDatas.length = 1;\n        } else {\n            this.stepDatas.length = 0;\n        }\n    }\n\n    private readonly getSecondPointData = (): PointSnapData => {\n        return {\n            refPoint: () => this.stepDatas[0].point!,\n            dimension: Dimension.D1D2D3,\n            validator: (point: XYZ) => {\n                return this.stepDatas[0].point!.distanceTo(point) > Precision.Distance;\n            },\n            preview: this.linePreview,\n        };\n    };\n\n    private readonly linePreview = (point: XYZ | undefined) => {\n        if (!point) {\n            return [this.meshPoint(this.stepDatas[0].point!)];\n        }\n        return [this.meshPoint(this.stepDatas[0].point!), this.meshLine(this.stepDatas[0].point!, point)];\n    };\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    EditableShapeNode,\n    I18n,\n    IEdge,\n    IFace,\n    IShape,\n    IWire,\n    JoinType,\n    ShapeMeshData,\n    ShapeType,\n    XYZ,\n    command,\n} from \"chili-core\";\nimport { GeoUtils } from \"chili-geo\";\nimport { IStep, LengthAtAxisStep, SelectShapeStep } from \"../../step\";\nimport { MultistepCommand } from \"../multistepCommand\";\n\n@command({\n    key: \"create.offset\",\n    icon: \"icon-offset\",\n})\nexport class OffsetCommand extends MultistepCommand {\n    protected override executeMainTask() {\n        const normal = this.getAxis().normal;\n        const shape = this.createOffsetShape(normal, this.stepDatas[1].distance!);\n        const node = new EditableShapeNode(\n            this.document,\n            I18n.translate(\"command.create.offset\"),\n            shape.value,\n        );\n        this.document.rootNode.add(node);\n        this.document.visual.update();\n    }\n\n    protected override getSteps(): IStep[] {\n        return [\n            new SelectShapeStep(ShapeType.Edge | ShapeType.Wire | ShapeType.Face, \"prompt.select.shape\"),\n            new LengthAtAxisStep(\"common.length\", () => {\n                let ax = this.getAxis();\n                return {\n                    point: ax.point,\n                    direction: ax.direction,\n                    preview: (point: XYZ | undefined) => this.preview(ax, point),\n                };\n            }),\n        ];\n    }\n\n    private preview(\n        ax: { point: XYZ; direction: XYZ; normal: XYZ },\n        point: XYZ | undefined,\n    ): ShapeMeshData[] {\n        let res: ShapeMeshData[] = [this.meshPoint(ax.point)];\n        if (point !== undefined) {\n            res.push(this.meshLine(ax.point, point));\n            let distance = point.sub(ax.point).dot(ax.direction);\n            let shape = this.createOffsetShape(ax.normal, distance);\n            if (shape.isOk) {\n                res.push(shape.value.edgesMeshPosition());\n            }\n        }\n        return res;\n    }\n\n    private getAxis(): { direction: XYZ; point: XYZ; normal: XYZ } {\n        let start = this.stepDatas[0].shapes[0].point!;\n        let shape = this.transformdFirstShape(this.stepDatas[0]);\n        if (shape.shapeType === ShapeType.Edge) {\n            return this.getEdgeAxis(shape as IEdge, start);\n        }\n\n        return this.getFaceOrWireAxis(shape, start);\n    }\n\n    private getFaceOrWireAxis(shape: IShape, start: XYZ) {\n        let face = shape as IFace;\n        if (shape.shapeType === ShapeType.Wire) {\n            face = (shape as IWire).toFace().value;\n        }\n        const normal = face.normal(0, 0)[1];\n        const { nearest, direction } = this.getNearstPointAndDirection(shape, start, normal);\n        return {\n            point: nearest.point,\n            normal,\n            direction: direction.cross(normal).normalize()!,\n        };\n    }\n\n    private getEdgeAxis(edge: IEdge, start: XYZ) {\n        const curve = edge.curve;\n        const direction = curve.dn(curve.parameter(start, 1e-3)!, 1);\n        const normal = GeoUtils.normal(edge);\n        return {\n            point: start,\n            normal,\n            direction: direction.cross(normal).normalize()!,\n        };\n    }\n\n    private getNearstPointAndDirection(shape: IShape, start: XYZ, normal: XYZ) {\n        let wire = shape as IWire;\n        if (shape.shapeType === ShapeType.Face) {\n            wire = (shape as IFace).outerWire();\n        }\n        const nearest = GeoUtils.nearestPoint(wire, start);\n        const nextEdge = GeoUtils.findNextEdge(wire, nearest.edge).value;\n        let direction = nearest.edge.curve.dn(0, 1);\n        const scale = nearest.edge.orientation() === nextEdge.orientation() ? 1 : -1;\n        const nextDirection = nextEdge.curve.dn(0, 1).multiply(scale);\n        if (direction.cross(nextDirection).normalize()?.isOppositeTo(normal)) {\n            direction = direction.multiply(-1);\n        }\n        return { nearest, direction };\n    }\n\n    private createOffsetShape(normal: XYZ, distance: number) {\n        let shape = this.transformdFirstShape(this.stepDatas[0]);\n        if (shape.shapeType === ShapeType.Edge) {\n            return (shape as IEdge).offset(distance, normal);\n        }\n\n        let wire = shape as IWire;\n        if (shape.shapeType === ShapeType.Face) {\n            wire = (shape as IFace).outerWire();\n        }\n        return wire.offset(distance, JoinType.intersection);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    AsyncController,\n    EdgeMeshDataBuilder,\n    GeometryNode,\n    I18n,\n    Precision,\n    ShapeMeshData,\n    XYZ,\n    command,\n} from \"chili-core\";\nimport { PolygonNode } from \"../../bodys\";\nimport { Dimension, PointSnapData, SnapResult } from \"../../snap\";\nimport { IStep, PointStep } from \"../../step\";\nimport { CreateFaceableCommand } from \"../createCommand\";\n\n@command({\n    key: \"create.polygon\",\n    icon: \"icon-toPoly\",\n})\nexport class Polygon extends CreateFaceableCommand {\n    protected override geometryNode(): GeometryNode {\n        let node = new PolygonNode(\n            this.document,\n            this.stepDatas.map((step) => step.point!),\n        );\n        node.isFace = this.isFace;\n        return node;\n    }\n\n    protected override async executeSteps(): Promise<boolean> {\n        let steps = this.getSteps();\n        let firstStep = true;\n        while (true) {\n            let step = firstStep ? steps[0] : steps[1];\n            if (firstStep) firstStep = false;\n            this.controller = new AsyncController();\n            let data = await step.execute(this.document, this.controller);\n            if (data === undefined) {\n                return this.controller.result?.status === \"success\";\n            }\n            this.stepDatas.push(data);\n            if (this.isClose(data)) {\n                return true;\n            }\n        }\n    }\n\n    private isClose(data: SnapResult) {\n        return (\n            this.stepDatas.length > 1 &&\n            this.stepDatas[0].point!.distanceTo(data.point!) <= Precision.Distance\n        );\n    }\n\n    protected override getSteps(): IStep[] {\n        let firstStep = new PointStep(\"prompt.pickFistPoint\");\n        let secondStep = new PointStep(\"prompt.pickNextPoint\", this.getNextData);\n        return [firstStep, secondStep];\n    }\n\n    private readonly getNextData = (): PointSnapData => {\n        return {\n            refPoint: () => this.stepDatas.at(-1)!.point!,\n            dimension: Dimension.D1D2D3,\n            validator: this.validator,\n            preview: this.preview,\n            featurePoints: [\n                {\n                    point: this.stepDatas.at(0)!.point!,\n                    prompt: I18n.translate(\"prompt.polygon.close\"),\n                    when: () => this.stepDatas.length > 2,\n                },\n            ],\n        };\n    };\n\n    private readonly preview = (point: XYZ | undefined): ShapeMeshData[] => {\n        let ps = this.stepDatas.map((data) => this.meshPoint(data.point!));\n        let edges = new EdgeMeshDataBuilder();\n        this.stepDatas.forEach((data) => edges.addPosition(data.point!.x, data.point!.y, data.point!.z));\n        if (point) {\n            edges.addPosition(point.x, point.y, point.z);\n        }\n        return [...ps, edges.build()];\n    };\n\n    private readonly validator = (point: XYZ): boolean => {\n        for (const data of this.stepDatas) {\n            if (point.distanceTo(data.point!) < 0.001) {\n                return false;\n            }\n        }\n        return true;\n    };\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { GeometryNode, IShape, Precision, ShapeType, command } from \"chili-core\";\nimport { GeoUtils } from \"chili-geo\";\nimport { PrismNode } from \"../../bodys\";\nimport { LengthAtAxisSnapData } from \"../../snap\";\nimport { IStep, LengthAtAxisStep } from \"../../step\";\nimport { SelectShapeStep } from \"../../step/selectStep\";\nimport { CreateCommand } from \"../createCommand\";\n\n@command({\n    key: \"create.extrude\",\n    icon: \"icon-prism\",\n})\nexport class Prism extends CreateCommand {\n    protected override geometryNode(): GeometryNode {\n        const shape = this.transformdFirstShape(this.stepDatas[0], false);\n        const { point, normal } = this.getAxis(shape);\n        const dist = this.stepDatas[1].point!.sub(point).dot(normal);\n        return new PrismNode(this.document, shape, dist);\n    }\n\n    protected override getSteps(): IStep[] {\n        return [\n            new SelectShapeStep(ShapeType.Face | ShapeType.Edge | ShapeType.Wire, \"prompt.select.shape\"),\n            new LengthAtAxisStep(\"prompt.pickNextPoint\", this.getLengthStepData, true),\n        ];\n    }\n\n    private readonly getLengthStepData = (): LengthAtAxisSnapData => {\n        const shape = this.transformdFirstShape(this.stepDatas[0]);\n        const { point, normal } = this.getAxis(shape);\n        return {\n            point,\n            direction: normal,\n            preview: (p) => {\n                if (!p) return [];\n                const dist = p.sub(point).dot(normal);\n                if (Math.abs(dist) < Precision.Float) return [];\n                const vec = normal.multiply(dist);\n                return [this.meshCreatedShape(\"prism\", shape, vec)];\n            },\n        };\n    };\n\n    private getAxis(shape: IShape) {\n        const point = this.stepDatas[0].shapes[0].point!;\n        const normal = GeoUtils.normal(shape as any);\n        return { point, normal };\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { GeometryNode, Plane, XYZ, command } from \"chili-core\";\nimport { PyramidNode } from \"../../bodys\";\nimport { LengthAtAxisSnapData } from \"../../snap\";\nimport { IStep, LengthAtAxisStep } from \"../../step\";\nimport { RectCommandBase } from \"./rect\";\n\n@command({\n    key: \"create.pyramid\",\n    icon: \"icon-pyramid\",\n})\nexport class Pyramid extends RectCommandBase {\n    protected override getSteps(): IStep[] {\n        let steps = super.getSteps();\n        let third = new LengthAtAxisStep(\"prompt.pickNextPoint\", this.getHeightStepData);\n        return [...steps, third];\n    }\n\n    private readonly getHeightStepData = (): LengthAtAxisSnapData => {\n        const plane = this.stepDatas[1].plane;\n        if (plane === undefined) {\n            throw new Error(\"plane is undefined, please report bug\");\n        }\n        const point = this.stepDatas[1].point!.add(this.stepDatas[0].point!).multiply(0.5);\n        return {\n            point,\n            direction: plane.normal,\n            preview: this.previewPyramid,\n        };\n    };\n\n    private readonly previewPyramid = (end: XYZ | undefined) => {\n        if (!end) {\n            return this.previewRect(this.stepDatas[1].point);\n        }\n\n        const data = this.rectDataFromTwoSteps();\n        return [\n            this.meshPoint(this.stepDatas[0].point!),\n            this.meshPoint(this.stepDatas[1].point!),\n            this.meshCreatedShape(\"pyramid\", data.plane, data.dx, data.dy, this.getHeight(data.plane, end)),\n        ];\n    };\n\n    protected override geometryNode(): GeometryNode {\n        const rect = this.rectDataFromTwoSteps();\n        const dz = this.getHeight(rect.plane, this.stepDatas[2].point!);\n        return new PyramidNode(this.document, rect.plane, rect.dx, rect.dy, dz);\n    }\n\n    private getHeight(plane: Plane, point: XYZ): number {\n        return point.sub(plane.origin).dot(plane.normal);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    GeometryNode,\n    ICurve,\n    IEdge,\n    ILine,\n    IShape,\n    IShapeFilter,\n    Property,\n    Ray,\n    ShapeType,\n    command,\n} from \"chili-core\";\nimport { RevolvedNode } from \"../../bodys\";\nimport { IStep } from \"../../step\";\nimport { SelectShapeStep } from \"../../step/selectStep\";\nimport { CreateCommand } from \"../createCommand\";\n\n@command({\n    key: \"convert.revol\",\n    icon: \"icon-revolve\",\n})\nexport class Revolve extends CreateCommand {\n    @Property.define(\"common.angle\")\n    public get angle() {\n        return this.getPrivateValue(\"angle\", 360);\n    }\n    public set angle(value: number) {\n        this.setProperty(\"angle\", value);\n    }\n\n    protected override geometryNode(): GeometryNode {\n        const shape = this.transformdFirstShape(this.stepDatas[0], false);\n        const edge = (this.stepDatas[1].shapes[0].shape as IEdge).curve.basisCurve as ILine;\n        const transform = this.stepDatas[1].shapes[0].transform;\n        const axis = new Ray(transform.ofPoint(edge.value(0)), transform.ofVector(edge.direction));\n        return new RevolvedNode(this.document, shape, axis, this.angle);\n    }\n\n    protected override getSteps(): IStep[] {\n        return [\n            new SelectShapeStep(ShapeType.Edge | ShapeType.Face | ShapeType.Wire, \"prompt.select.shape\"),\n            new SelectShapeStep(ShapeType.Edge, \"prompt.select.edges\", {\n                shapeFilter: new LineFilter(),\n                keepSelection: true,\n            }),\n        ];\n    }\n}\n\nclass LineFilter implements IShapeFilter {\n    allow(shape: IShape): boolean {\n        if (shape.shapeType === ShapeType.Edge) {\n            let edge = shape as IEdge;\n            let curve = edge.curve.basisCurve;\n            return ICurve.isLine(curve);\n        }\n        return false;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { EditableShapeNode, I18n, ShapeType, VisualState, command } from \"chili-core\";\nimport { IStep } from \"../../step\";\nimport { SelectShapeStep } from \"../../step/selectStep\";\nimport { MultistepCommand } from \"../multistepCommand\";\n\n@command({\n    key: \"create.section\",\n    icon: \"icon-section\",\n})\nexport class Section extends MultistepCommand {\n    protected override executeMainTask() {\n        let shape = this.transformdFirstShape(this.stepDatas[0]);\n        let path = this.transformdFirstShape(this.stepDatas[1]);\n        let section = shape.section(path);\n        const node = new EditableShapeNode(this.document, I18n.translate(\"command.create.section\"), section);\n        this.document.rootNode.add(node);\n        this.document.visual.update();\n    }\n\n    protected override getSteps(): IStep[] {\n        return [\n            new SelectShapeStep(ShapeType.Shape, \"prompt.select.shape\", {\n                selectedState: VisualState.faceTransparent,\n            }),\n            new SelectShapeStep(ShapeType.Shape, \"prompt.select.shape\", { keepSelection: true }),\n        ];\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { GeometryNode, Precision, XYZ, command } from \"chili-core\";\nimport { SphereNode } from \"../../bodys\";\nimport { SnapLengthAtPlaneData } from \"../../snap\";\nimport { IStep, LengthAtPlaneStep, PointStep } from \"../../step\";\nimport { CreateCommand } from \"../createCommand\";\n\n@command({\n    key: \"create.sphere\",\n    icon: \"icon-sphere\",\n})\nexport class Sphere extends CreateCommand {\n    protected override getSteps(): IStep[] {\n        let centerStep = new PointStep(\"prompt.pickCircleCenter\");\n        let radiusStep = new LengthAtPlaneStep(\"prompt.pickRadius\", this.getRadiusData);\n        return [centerStep, radiusStep];\n    }\n\n    private readonly getRadiusData = (): SnapLengthAtPlaneData => {\n        const point = this.stepDatas[0].point!;\n        return {\n            point: () => point,\n            preview: this.previewSphere,\n            plane: () => this.stepDatas[0].view.workplane.translateTo(point),\n            validator: (p: XYZ) => p.distanceTo(point) > Precision.Distance,\n        };\n    };\n\n    private readonly previewSphere = (end: XYZ | undefined) => {\n        if (!end) {\n            return [this.meshPoint(this.stepDatas[0].point!)];\n        }\n\n        const radius = this.stepDatas[0].point?.distanceTo(end)!;\n        return [\n            this.meshPoint(this.stepDatas[0].point!),\n            this.meshCreatedShape(\"circle\", XYZ.unitZ, this.stepDatas[0].point!, radius),\n            this.meshCreatedShape(\"circle\", XYZ.unitY, this.stepDatas[0].point!, radius),\n        ];\n    };\n\n    protected override geometryNode(): GeometryNode {\n        const radius = this.stepDatas[0].point!.distanceTo(this.stepDatas[1].point!);\n        return new SphereNode(this.document, this.stepDatas[0].point!, radius);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { GeometryNode, IWire, Property, ShapeType, command } from \"chili-core\";\nimport { SweepedNode } from \"../../bodys\";\nimport { IStep } from \"../../step\";\nimport { SelectShapeStep } from \"../../step/selectStep\";\nimport { CreateCommand } from \"../createCommand\";\n\n@command({\n    key: \"convert.sweep\",\n    icon: \"icon-sweep\",\n})\nexport class Sweep extends CreateCommand {\n    @Property.define(\"option.command.isRoundCorner\")\n    get round() {\n        return this.getPrivateValue(\"round\", false);\n    }\n\n    set round(value: boolean) {\n        this.setProperty(\"round\", value);\n    }\n\n    protected override geometryNode(): GeometryNode {\n        const path = this.transformdFirstShape(this.stepDatas[0], false) as IWire;\n        const shapes = this.transformdShapes(this.stepDatas[1], false) as IWire[];\n        return new SweepedNode(this.document, shapes, path, this.round);\n    }\n\n    protected override getSteps(): IStep[] {\n        return [\n            new SelectShapeStep(ShapeType.Edge | ShapeType.Wire, \"prompt.select.path\"),\n            new SelectShapeStep(ShapeType.Edge | ShapeType.Wire, \"prompt.select.section\", {\n                keepSelection: true,\n                multiple: true,\n            }),\n        ];\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { EditableShapeNode, I18n, Property, PubSub, ShapeType, Transaction, command } from \"chili-core\";\nimport { IStep, SelectShapeStep } from \"../../step\";\nimport { MultistepCommand } from \"../multistepCommand\";\n\n@command({\n    key: \"create.thickSolid\",\n    icon: \"icon-thickSolid\",\n})\nexport class ThickSolidCommand extends MultistepCommand {\n    @Property.define(\"option.command.thickness\")\n    get thickness() {\n        return this.getPrivateValue(\"thickness\", 10);\n    }\n    set thickness(value: number) {\n        this.setProperty(\"thickness\", value);\n    }\n\n    protected override executeMainTask(): void {\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\n            this.stepDatas[0].shapes.forEach((x) => {\n                const subShape = this.application.shapeFactory.makeThickSolidBySimple(\n                    x.shape,\n                    this.thickness,\n                );\n                if (!subShape.isOk) {\n                    PubSub.default.pub(\"showToast\", \"toast.converter.error\");\n                    return;\n                }\n                const model = new EditableShapeNode(\n                    this.document,\n                    I18n.translate(\"command.create.thickSolid\"),\n                    subShape,\n                );\n\n                const node = x.owner.node;\n                model.transform = node.transform;\n                node.parent!.insertAfter(node, model);\n            });\n            this.document.visual.update();\n            PubSub.default.pub(\"showToast\", \"toast.success\");\n        });\n    }\n\n    protected override getSteps(): IStep[] {\n        return [new SelectShapeStep(ShapeType.Face, \"prompt.select.faces\", { multiple: true })];\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Act, I18n, IApplication, ICommand, command } from \"chili-core\";\n\nlet index = 0;\n\n@command({\n    key: \"act.alignCamera\",\n    icon: \"icon-act\",\n})\nexport class ActAlignCameraCommand implements ICommand {\n    async execute(application: IApplication): Promise<void> {\n        const view = application.activeView;\n        if (!view) return;\n\n        view.document.acts.push(\n            new Act(\n                `${I18n.translate(\"ribbon.group.act\")} ${index++}`,\n                view.cameraController.cameraPosition,\n                view.cameraController.cameraTarget,\n                view.cameraController.cameraUp,\n            ),\n        );\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { command, INode, PubSub, Transaction } from \"chili-core\";\nimport { GetOrSelectNodeStep, IStep } from \"../step\";\nimport { MultistepCommand } from \"./multistepCommand\";\n\n@command({\n    key: \"modify.deleteNode\",\n    icon: \"icon-delete\",\n})\nexport class Delete extends MultistepCommand {\n    protected override executeMainTask(): void {\n        const nodes: INode[] | undefined = this.stepDatas[0].nodes;\n        if (!nodes || nodes.length === 0) {\n            PubSub.default.pub(\"showToast\", \"toast.select.noSelected\");\n            return;\n        }\n\n        if (this.document.currentNode && nodes.includes(this.document.currentNode)) {\n            this.document.currentNode = this.document.rootNode;\n        }\n\n        this.document.selection.clearSelection();\n        Transaction.execute(this.document, \"delete\", () => {\n            nodes.forEach((model) => model.parent?.remove(model));\n        });\n        this.document.visual.update();\n        PubSub.default.pub(\"showToast\", \"toast.delete{0}Objects\", nodes.length);\n    }\n\n    protected override getSteps(): IStep[] {\n        return [new GetOrSelectNodeStep(\"prompt.select.models\", { multiple: true })];\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { command, FolderNode, IApplication, ICommand } from \"chili-core\";\n\nlet index = 1;\n\n@command({\n    key: \"create.folder\",\n    icon: \"icon-folder-plus\",\n})\nexport class NewFolder implements ICommand {\n    async execute(app: IApplication): Promise<void> {\n        const document = app.activeView?.document!;\n        const folder = new FolderNode(document, `Folder${index++}`);\n        document.addNode(folder);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    AsyncController,\n    CancelableCommand,\n    Combobox,\n    command,\n    download,\n    I18n,\n    IApplication,\n    ICommand,\n    Property,\n    PubSub,\n    readFilesAsync,\n} from \"chili-core\";\nimport { SelectNodeStep } from \"../step\";\nimport { importFiles } from \"../utils\";\n\n@command({\n    key: \"file.import\",\n    icon: \"icon-import\",\n})\nexport class Import implements ICommand {\n    async execute(application: IApplication): Promise<void> {\n        const extenstions = application.dataExchange.importFormats().join(\",\");\n        const files = await readFilesAsync(extenstions, true);\n        if (!files.isOk || files.value.length === 0) {\n            alert(files.error);\n            return;\n        }\n        importFiles(application, files.value);\n    }\n}\n\n@command({\n    key: \"file.export\",\n    icon: \"icon-export\",\n})\nexport class Export extends CancelableCommand {\n    @Property.define(\"file.format\")\n    public get formats() {\n        return this.getPrivateValue(\"formats\", this.initCombobox());\n    }\n    public set formats(value: Combobox<string>) {\n        this.setProperty(\"formats\", value);\n    }\n\n    private initCombobox() {\n        const box = new Combobox<string>();\n        box.items.push(...this.application.dataExchange.exportFormats());\n        return box;\n    }\n\n    protected async executeAsync() {\n        const nodes = await this.selectNodesAsync();\n        if (!nodes || nodes.length === 0) {\n            PubSub.default.pub(\"showToast\", \"toast.select.noSelected\");\n            return;\n        }\n\n        PubSub.default.pub(\n            \"showPermanent\",\n            async () => {\n                const format = this.formats.selectedItem;\n                if (format === undefined) return;\n\n                const data = await this.application.dataExchange.export(format, nodes);\n                if (!data) return;\n\n                let suffix = format;\n\n                if (suffix == \".stl binary\") {\n                    suffix = \".stl\";\n                } else if (suffix == \".ply binary\") {\n                    suffix = \".ply\";\n                }\n\n                PubSub.default.pub(\"showToast\", \"toast.downloading\");\n                download(data, `${nodes[0].name}${suffix}`);\n            },\n            \"toast.excuting{0}\",\n            I18n.translate(\"command.file.export\"),\n        );\n    }\n\n    private async selectNodesAsync() {\n        this.controller = new AsyncController();\n        const step = new SelectNodeStep(\"prompt.select.models\", { multiple: true, keepSelection: true });\n        const data = await step.execute(this.application.activeView?.document!, this.controller);\n        if (!data?.nodes) {\n            PubSub.default.pub(\"showToast\", \"prompt.select.noModelSelected\");\n            return undefined;\n        }\n        return data.nodes;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { command, Precision, ShapeMeshData, VisualConfig, XYZ } from \"chili-core\";\nimport { Dimension, PointSnapData, SnapResult } from \"../../snap\";\nimport { IStep, PointStep } from \"../../step\";\nimport { MultistepCommand } from \"../multistepCommand\";\n\nconst ARC_POSITION = 0.5;\n\n@command({\n    key: \"measure.angle\",\n    icon: \"icon-measureAngle\",\n})\nexport class AngleMeasure extends MultistepCommand {\n    protected override getSteps(): IStep[] {\n        const firstStep = new PointStep(\"prompt.pickFistPoint\");\n        const secondStep = new PointStep(\"prompt.pickNextPoint\", this.getSecondPointData);\n        const thirdStep = new PointStep(\"prompt.pickNextPoint\", this.getThirdPointData);\n        return [firstStep, secondStep, thirdStep];\n    }\n\n    private readonly getSecondPointData = (): PointSnapData => {\n        return {\n            refPoint: () => this.stepDatas[0].point!,\n            dimension: Dimension.D1D2D3,\n            validator: (point: XYZ) => {\n                return this.stepDatas[0].point!.distanceTo(point) > Precision.Distance;\n            },\n            preview: this.linePreview,\n        };\n    };\n\n    private readonly linePreview = (point: XYZ | undefined) => {\n        if (!point) {\n            return [this.meshPoint(this.stepDatas[0].point!)];\n        }\n        return [this.meshPoint(this.stepDatas[0].point!), this.meshLine(this.stepDatas[0].point!, point)];\n    };\n\n    private readonly getThirdPointData = (): PointSnapData => {\n        return {\n            refPoint: () => this.stepDatas[0].point!,\n            dimension: Dimension.D1D2D3,\n            prompt: (result: SnapResult) => this.anglePrompt(result.point!),\n            validator: (point: XYZ) => {\n                return (\n                    this.stepDatas[0].point!.distanceTo(point) > Precision.Distance &&\n                    this.stepDatas[1].point!.distanceTo(point) > Precision.Distance\n                );\n            },\n            preview: this.arcPreview,\n        };\n    };\n\n    private readonly anglePrompt = (point: XYZ) => {\n        const { rad } = this.arcInfo(point);\n        return ((rad * 180) / Math.PI).toFixed(2) + \"°\";\n    };\n\n    private readonly arcPreview = (point: XYZ | undefined) => {\n        const meshes: ShapeMeshData[] = [\n            this.meshPoint(this.stepDatas[0].point!),\n            this.meshPoint(this.stepDatas[1].point!),\n            this.meshLine(\n                this.stepDatas[0].point!,\n                this.stepDatas[1].point!,\n                VisualConfig.highlightEdgeColor,\n                3,\n            ),\n        ];\n        if (!point) return meshes;\n\n        const { v1, rad, normal } = this.arcInfo(point);\n        const angle = (rad * 180) / Math.PI;\n        if (angle < Precision.Angle) return meshes;\n\n        const line2 = this.meshLine(this.stepDatas[0].point!, point, VisualConfig.highlightEdgeColor, 3);\n        const arc = this.application.shapeFactory\n            .arc(\n                normal,\n                this.stepDatas[0].point!,\n                this.stepDatas[0].point!.add(v1.multiply(this.lineLength(point) * ARC_POSITION)),\n                angle,\n            )\n            .unchecked()?.mesh.edges!;\n        arc.lineWidth = 3;\n        arc.color = VisualConfig.highlightEdgeColor;\n        return [line2, arc, ...meshes];\n    };\n\n    private lineLength(point: XYZ | undefined) {\n        const d1 = this.stepDatas[0].point!.distanceTo(this.stepDatas[1].point!);\n        if (!point) {\n            return d1;\n        }\n        const d2 = this.stepDatas[0].point!.distanceTo(point);\n        return Math.min(d1, d2);\n    }\n\n    private arcInfo(point: XYZ) {\n        const v1 = this.stepDatas[1].point!.sub(this.stepDatas[0].point!).normalize()!;\n        const v2 = point.sub(this.stepDatas[0].point!).normalize()!;\n        const rad = v1.angleTo(v2)!;\n        const normal = v1.cross(v2).normalize()!;\n        return {\n            v1,\n            v2,\n            rad,\n            normal,\n        };\n    }\n\n    protected override executeMainTask(): void {\n        const { v1, rad, normal } = this.arcInfo(this.stepDatas[2].point!);\n        const arcMid = v1\n            .rotate(normal, rad * 0.5)!\n            .multiply(this.lineLength(this.stepDatas[2].point) * ARC_POSITION)\n            .add(this.stepDatas[0].point!);\n        const visualId = this.document.visual.context.displayMesh([\n            this.meshPoint(this.stepDatas[2].point!),\n            ...this.arcPreview(this.stepDatas[2].point),\n       ]);\n        this.application.activeView?.htmlText(((rad * 180) / Math.PI).toFixed(2) + \"°\", arcMid, {\n            onDispose: () => {\n                this.document.visual.context.removeMesh(visualId);\n            },\n        });\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { command, Precision, VisualConfig, XYZ } from \"chili-core\";\nimport { Dimension, PointSnapData } from \"../../snap\";\nimport { IStep, PointStep } from \"../../step\";\nimport { MultistepCommand } from \"../multistepCommand\";\n\n@command({\n    key: \"measure.length\",\n    icon: \"icon-measureLength\",\n})\nexport class LengthMeasure extends MultistepCommand {\n    protected override getSteps(): IStep[] {\n        let firstStep = new PointStep(\"prompt.pickFistPoint\");\n        let secondStep = new PointStep(\"prompt.pickNextPoint\", this.getSecondPointData);\n        return [firstStep, secondStep];\n    }\n\n    private readonly getSecondPointData = (): PointSnapData => {\n        return {\n            refPoint: () => this.stepDatas[0].point!,\n            dimension: Dimension.D1D2D3,\n            validator: (point: XYZ) => {\n                return this.stepDatas[0].point!.distanceTo(point) > Precision.Distance;\n            },\n            preview: this.linePreview,\n        };\n    };\n\n    private readonly linePreview = (point: XYZ | undefined) => {\n        if (!point) {\n            return [this.meshPoint(this.stepDatas[0].point!)];\n        }\n        return [this.meshPoint(this.stepDatas[0].point!), this.meshLine(this.stepDatas[0].point!, point)];\n    };\n\n    protected override executeMainTask(): void {\n        const firstPoint = this.stepDatas[0].point!;\n        const secondPoint = this.stepDatas[1].point!;\n        const distance = firstPoint.distanceTo(secondPoint);\n        const visualId = this.document.visual.context.displayMesh([\n            this.meshPoint(firstPoint),\n            this.meshLine(firstPoint, secondPoint, VisualConfig.highlightEdgeColor, 3),\n            this.meshPoint(secondPoint),\n        ]);\n        this.application.activeView?.htmlText(\n            distance.toFixed(2),\n            firstPoint.add(secondPoint).multiply(0.5),\n            {\n                onDispose: () => {\n                    this.document.visual.context.removeMesh(visualId);\n                },\n            },\n        );\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { div, h1, h2, span, ul } from \"chili-controls\";\nimport {\n    AsyncController,\n    BoundingBox,\n    CancelableCommand,\n    Combobox,\n    command,\n    I18nKeys,\n    IDisposable,\n    IEdge,\n    IFace,\n    ISolid,\n    Localize,\n    Matrix4,\n    Property,\n    ShapeType,\n    VisualConfig,\n    VisualShapeData,\n    XYZ,\n} from \"chili-core\";\nimport { SelectShapeStep } from \"../../step\";\nimport style from \"./select.module.css\";\n\n@command({\n    key: \"measure.select\",\n    icon: \"icon-measureSelect\",\n})\nexport class SelectMeasure extends CancelableCommand {\n    #isChangedType = false;\n    #sum = 0;\n    #sumUI?: {\n        container: HTMLDivElement;\n        header: HTMLHeadingElement;\n        list: HTMLUListElement;\n        value: HTMLSpanElement;\n    };\n    readonly #disposeSet: Set<IDisposable> = new Set();\n\n    #category?: Combobox<I18nKeys>;\n    @Property.define(\"common.type\")\n    public get category(): Combobox<I18nKeys> {\n        if (!this.#category) {\n            this.#category = this.initCombobox();\n        }\n        return this.#category;\n    }\n    public set category(value: Combobox<I18nKeys>) {\n        this.#category?.clearPropertyChanged();\n        this.#category = value;\n        this.#category.onPropertyChanged(this.onTypeChange);\n    }\n\n    private initCombobox() {\n        const box = new Combobox<I18nKeys>();\n        box.items.push(\"common.length\", \"common.area\", \"common.volume\");\n        box.onPropertyChanged(this.onTypeChange);\n        return box;\n    }\n\n    private readonly onTypeChange = () => {\n        this.#isChangedType = true;\n        this.controller?.cancel();\n        this.#sumUI?.container.remove();\n        this.#sumUI = undefined;\n        this.#disposeSet.forEach((d) => d.dispose());\n        this.#disposeSet.clear();\n        this.#sum = 0;\n    };\n\n    private initSumUI() {\n        if (this.#sumUI) {\n            this.#sumUI.container.remove();\n        }\n        this.#sumUI = {\n            container: div({\n                className: style.selectSum,\n            }),\n            header: h1({ textContent: new Localize(this.#category!.selectedItem!) }),\n            list: ul(),\n            value: span({\n                textContent: \"0.00\",\n            }),\n        };\n        this.#sumUI.container.append(this.#sumUI.header, this.#sumUI.list, h2(this.#sumUI.value));\n\n        this.application.activeView?.dom?.append(this.#sumUI.container);\n    }\n\n    private addSumItem(item: number) {\n        this.#sum += item;\n        if (!this.#sumUI) {\n            this.initSumUI();\n        }\n\n        const li = document.createElement(\"li\");\n        li.textContent = item.toFixed(2);\n        this.#sumUI!.list.append(li);\n        this.#sumUI!.value.textContent = this.#sum.toFixed(2);\n    }\n\n    protected override afterExecute(): void {\n        super.afterExecute();\n        this.category?.clearPropertyChanged();\n        this.#disposeSet.forEach((d) => d.dispose());\n        this.#disposeSet.clear();\n        this.#sumUI?.container.remove();\n    }\n\n    protected override async executeAsync(): Promise<void> {\n        while (true) {\n            this.controller = new AsyncController();\n            let type: [ShapeType, I18nKeys] = [ShapeType.Edge, \"prompt.select.edges\"];\n            if (this.category.selectedIndex === 1) {\n                type = [ShapeType.Face, \"prompt.select.faces\"];\n            } else if (this.category.selectedIndex === 2) {\n                type = [ShapeType.Solid, \"prompt.select.solids\"];\n            }\n\n            const step = new SelectShapeStep(type[0], type[1]);\n            const result = await step.execute(this.document, this.controller);\n            if (this.controller.result?.status !== \"success\") {\n                if (this.#isChangedType) {\n                    this.#isChangedType = false;\n                    continue;\n                } else {\n                    return;\n                }\n            }\n            this.createMeasure(result?.shapes[0]);\n        }\n    }\n\n    private readonly createMeasure = (shape: VisualShapeData | undefined) => {\n        if (!shape) return;\n        if (shape.shape.shapeType === ShapeType.Edge) {\n            this.edgeMeasure(shape.shape as IEdge, shape.transform);\n        } else if (shape.shape.shapeType === ShapeType.Face) {\n            this.faceMeasure(shape.shape as IFace, shape.transform);\n        } else if (shape.shape.shapeType === ShapeType.Solid) {\n            this.solidMeasure(\n                shape.shape as ISolid,\n                shape.transform,\n                BoundingBox.center(shape.owner.boundingBox()),\n            );\n        }\n    };\n\n    private edgeMeasure(edge: IEdge, transform: Matrix4) {\n        edge = edge.transformedMul(transform) as IEdge;\n        const start = edge.curve.startPoint();\n        const end = edge.curve.endPoint();\n        const length = edge.length();\n        this.addSumItem(length);\n        const mesh = edge.mesh.edges!;\n        edge.dispose();\n        mesh.lineWidth = 3;\n        mesh.color = VisualConfig.highlightEdgeColor;\n\n        const id = this.document.visual.context.displayMesh([mesh]);\n        this.#disposeSet.add(\n            this.application.activeView!.htmlText(length.toFixed(2), start.add(end).multiply(0.5), {\n                hideDelete: true,\n                onDispose: () => {\n                    this.document.visual.context.removeMesh(id);\n                },\n            }),\n        );\n    }\n\n    private faceMeasure(face: IFace, transform: Matrix4) {\n        const wire = face.outerWire();\n        const mesh = wire.mesh.edges!;\n        wire.dispose();\n        mesh.lineWidth = 3;\n        mesh.color = VisualConfig.highlightEdgeColor;\n        mesh.position = new Float32Array(transform.ofPoints(mesh.position));\n\n        const area = face.area();\n        this.addSumItem(area);\n        const center = this.wireCenter(mesh.position);\n        const id = this.document.visual.context.displayMesh([mesh]);\n        this.#disposeSet.add(\n            this.application.activeView!.htmlText(area.toFixed(2), center, {\n                hideDelete: true,\n                onDispose: () => {\n                    this.document.visual.context.removeMesh(id);\n                },\n            }),\n        );\n    }\n\n    private wireCenter(points: ArrayLike<number>) {\n        const center = { x: 0, y: 0, z: 0 };\n        for (let i = 0; i < points.length; i += 3) {\n            center.x += points[i];\n            center.y += points[i + 1];\n            center.z += points[i + 2];\n        }\n\n        const length = points.length / 3;\n        center.x /= length;\n        center.y /= length;\n        center.z /= length;\n        return center;\n    }\n\n    private solidMeasure(solid: ISolid, transform: Matrix4, center: XYZ) {\n        const mesh = solid.mesh.edges!;\n        mesh.lineWidth = 3;\n        mesh.color = VisualConfig.highlightEdgeColor;\n        mesh.position = new Float32Array(transform.ofPoints(mesh.position));\n\n        const volume = solid.volume();\n        this.addSumItem(volume);\n        const id = this.document.visual.context.displayMesh([mesh]);\n        this.#disposeSet.add(\n            this.application.activeView!.htmlText(volume.toFixed(2), transform.ofPoint(center), {\n                hideDelete: true,\n                onDispose: () => {\n                    this.document.visual.context.removeMesh(id);\n                },\n            }),\n        );\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    AsyncController,\n    BoundingBox,\n    command,\n    Component,\n    ComponentNode,\n    GeometryNode,\n    LineType,\n    MathUtils,\n    Matrix4,\n    MeshNode,\n    Plane,\n    PlaneAngle,\n    Precision,\n    Property,\n    PubSub,\n    Ray,\n    ShapeMeshData,\n    Transaction,\n    VisualNode,\n    XYZ,\n} from \"chili-core\";\nimport { Dimension, PointSnapData, SnapLengthAtPlaneData } from \"../../snap\";\nimport { AngleStep, IStep, LengthAtPlaneStep, PointOnAxisStep, PointStep } from \"../../step\";\nimport { MultistepCommand } from \"../multistepCommand\";\n\n@command({\n    key: \"modify.array\",\n    icon: \"icon-array\",\n})\nexport class ArrayCommand extends MultistepCommand {\n    private _planeAngle: PlaneAngle | undefined;\n    private _meshId: number | undefined = undefined;\n    protected models?: VisualNode[];\n    protected positions?: number[];\n\n    @Property.define(\"common.isGroup\")\n    get isGroup() {\n        return this.getPrivateValue(\"isGroup\", true);\n    }\n    set isGroup(value: boolean) {\n        this.setProperty(\"isGroup\", value);\n    }\n\n    @Property.define(\"option.command.circularPattern\")\n    get circularPattern() {\n        return this.getPrivateValue(\"circularPattern\", false);\n    }\n    set circularPattern(value: boolean) {\n        this.setProperty(\"circularPattern\", value, () => {\n            this.restart();\n        });\n    }\n\n    @Property.define(\"common.count\", {\n        dependencies: [\n            {\n                property: \"circularPattern\",\n                value: true,\n            },\n        ],\n    })\n    get count() {\n        return this.getPrivateValue(\"count\", 3);\n    }\n    set count(value: number) {\n        this.setProperty(\"count\", value, () => this.resetMesh());\n    }\n\n    @Property.define(\"common.numberX\", {\n        dependencies: [\n            {\n                property: \"circularPattern\",\n                value: false,\n            },\n        ],\n    })\n    get numberX() {\n        return this.getPrivateValue(\"numberX\", 3);\n    }\n    set numberX(value: number) {\n        this.setProperty(\"numberX\", value, () => this.resetMesh());\n    }\n\n    @Property.define(\"common.numberY\", {\n        dependencies: [\n            {\n                property: \"circularPattern\",\n                value: false,\n            },\n        ],\n    })\n    get numberY() {\n        return this.getPrivateValue(\"numberY\", 3);\n    }\n    set numberY(value: number) {\n        this.setProperty(\"numberY\", value, () => this.resetMesh());\n    }\n\n    @Property.define(\"common.numberZ\", {\n        dependencies: [\n            {\n                property: \"circularPattern\",\n                value: false,\n            },\n        ],\n    })\n    get numberZ() {\n        return this.getPrivateValue(\"numberZ\", 3);\n    }\n    set numberZ(value: number) {\n        this.setProperty(\"numberZ\", value, () => this.resetMesh());\n    }\n\n    private async ensureSelectedModels() {\n        this.models = this.document.selection.getSelectedNodes().filter((x) => x instanceof VisualNode);\n        if (this.models.length > 0) return true;\n\n        this.controller = new AsyncController();\n        this.models = await this.document.selection.pickNode(\"prompt.select.models\", this.controller, true);\n\n        if (this.models.length > 0) return true;\n        if (this.controller.result?.status === \"success\") {\n            PubSub.default.pub(\"showToast\", \"toast.select.noSelected\");\n        }\n\n        return false;\n    }\n\n    protected override async canExcute(): Promise<boolean> {\n        if (this.positions) return true;\n\n        if (!(await this.ensureSelectedModels())) return false;\n\n        this.collectionPosition();\n\n        return true;\n    }\n\n    private collectionPosition() {\n        this.positions = this.models!.flatMap((model) => {\n            if (model instanceof MeshNode) {\n                return model.mesh.position ? model.transform.ofPoints(model.mesh.position) : [];\n            } else if (model instanceof GeometryNode) {\n                return model.mesh.edges?.position ? model.transform.ofPoints(model.mesh.edges.position) : [];\n            } else if (model instanceof ComponentNode) {\n                return Array.from(BoundingBox.wireframe(model.boundingBox()!).position);\n            }\n            return [];\n        });\n    }\n\n    override afterExecute() {\n        this.removeMesh();\n\n        super.afterExecute();\n    }\n\n    private removeMesh() {\n        if (this._meshId) {\n            this.document.visual.context.removeMesh(this._meshId);\n            this._meshId = undefined;\n        }\n    }\n\n    private resetMesh() {\n        this.removeMesh();\n\n        if (!this.positions) return;\n\n        let count = this.count;\n        if (!this.circularPattern) {\n            count = this.numberX * this.numberY * this.numberZ;\n        }\n\n        const positions = new Float32Array(this.positions.length * count);\n        for (let i = 0; i < count; i++) {\n            positions.set(this.positions, i * this.positions.length);\n        }\n\n        this._meshId = this.document.visual.context.displayLineSegments({\n            position: positions,\n            lineType: LineType.Solid,\n            range: [],\n        });\n    }\n\n    private readonly updatePosition = (matrixs: Matrix4[]) => {\n        const positions = new Float32Array(this.positions!.length * matrixs.length);\n        for (let i = 0; i < matrixs.length; i++) {\n            positions.set(matrixs[i].ofPoints(this.positions!), i * this.positions!.length);\n        }\n\n        this.document.visual.context.setPosition(this._meshId!, positions);\n    };\n\n    private getBoxTransforms(xvec: XYZ, yvec: XYZ, zvec: XYZ) {\n        const count = this.numberX * this.numberY * this.numberZ;\n        const transforms = new Array<Matrix4>(count);\n        let index = 0;\n        for (let i = 0; i < this.numberX; i++) {\n            for (let j = 0; j < this.numberY; j++) {\n                for (let k = 0; k < this.numberZ; k++) {\n                    const vec = xvec.multiply(i).add(yvec.multiply(j)).add(zvec.multiply(k));\n                    transforms[index++] = Matrix4.fromTranslation(vec.x, vec.y, vec.z);\n                }\n            }\n        }\n        return transforms;\n    }\n\n    private getArcMatrixs(center: XYZ, normal: XYZ, angle: number) {\n        const transforms = new Array<Matrix4>(this.count);\n        for (let i = 0; i < this.count; i++) {\n            transforms[i] = Matrix4.fromAxisRad(center, normal, i * angle);\n        }\n        return transforms;\n    }\n\n    protected override getSteps(): IStep[] {\n        this.resetMesh();\n\n        if (this.circularPattern) {\n            return [\n                new PointStep(\"prompt.pickCircleCenter\", undefined, true),\n                new LengthAtPlaneStep(\"prompt.pickRadius\", this.getRadiusData, true),\n                new AngleStep(\n                    \"prompt.pickNextPoint\",\n                    () => this.stepDatas[0].point!,\n                    () => this.stepDatas[1].point!,\n                    this.getAngleData,\n                    true,\n                ),\n            ];\n        } else {\n            return [\n                new PointStep(\"prompt.pickFistPoint\", undefined, true),\n                new PointStep(\"prompt.pickNextPoint\", () => this.vectorArrayStepData(), true),\n                new PointOnAxisStep(\"prompt.pickNextPoint\", () => this.pointOnAxisArray(2), true),\n                new PointOnAxisStep(\"prompt.pickNextPoint\", () => this.pointOnAxisArray(3), true),\n            ];\n        }\n    }\n\n    private readonly getRadiusData = (): SnapLengthAtPlaneData => {\n        const { point, view } = this.stepDatas[0];\n        return {\n            point: () => point!,\n            preview: this.circlePreview,\n            plane: (p: XYZ | undefined) => this.findPlane(view, point!, p),\n            validator: (p: XYZ) => {\n                if (p.distanceTo(point!) < Precision.Distance) return false;\n                return p.sub(point!).isParallelTo(this.stepDatas[0].view.workplane.normal) === false;\n            },\n        };\n    };\n\n    private readonly circlePreview = (end: XYZ | undefined) => {\n        const visualCenter = this.meshPoint(this.stepDatas[0].point!);\n        if (!end) return [visualCenter];\n        const { point, view } = this.stepDatas[0];\n        const plane = this.findPlane(view, point!, end);\n        return [\n            visualCenter,\n            this.meshLine(this.stepDatas[0].point!, end),\n            this.meshCreatedShape(\"circle\", plane.normal, point!, plane.projectDistance(point!, end)),\n        ];\n    };\n\n    private readonly getAngleData = () => {\n        const [center, p1] = [this.stepDatas[0].point!, this.stepDatas[1].point!];\n        const plane = this.stepDatas[1].plane ?? this.findPlane(this.stepDatas[1].view, center, p1);\n        const points: ShapeMeshData[] = [this.meshPoint(center), this.meshPoint(p1)];\n        this._planeAngle = new PlaneAngle(new Plane(center, plane.normal, p1.sub(center)));\n\n        return {\n            dimension: Dimension.D1D2,\n            preview: (point: XYZ | undefined) => this.anglePreview(point, center, p1, points),\n            plane: () => plane,\n            validators: [this.angleValidator(center, plane)],\n        };\n    };\n\n    private anglePreview(\n        point: XYZ | undefined,\n        center: XYZ,\n        p1: XYZ,\n        points: ShapeMeshData[],\n    ): ShapeMeshData[] {\n        point = point ?? p1;\n        this._planeAngle!.movePoint(point);\n        const result = [...points];\n        if (Math.abs(this._planeAngle!.angle) > Precision.Angle) {\n            const transforms = this.getArcMatrixs(\n                center,\n                this._planeAngle!.plane.normal,\n                MathUtils.degToRad(this._planeAngle!.angle),\n            );\n            this.updatePosition(transforms);\n\n            result.push(\n                this.meshCreatedShape(\n                    \"arc\",\n                    this._planeAngle!.plane.normal,\n                    center,\n                    p1,\n                    this._planeAngle!.angle,\n                ),\n            );\n        }\n        return result;\n    }\n\n    private angleValidator(center: XYZ, plane: Plane) {\n        return (p: XYZ) =>\n            p.distanceTo(center) >= Precision.Distance && !p.sub(center).isParallelTo(plane.normal);\n    }\n\n    private readonly vectorArrayStepData = () => {\n        return {\n            dimension: Dimension.D1,\n            refPoint: () => this.stepDatas[0].point!,\n            validator: (p: XYZ | undefined) =>\n                p !== undefined && p.distanceTo(this.stepDatas[0].point!) > Precision.Distance,\n            preview: (p: XYZ | undefined) => {\n                if (!p) {\n                    return [this.meshPoint(this.stepDatas[0].point!)];\n                }\n                const vector = p.sub(this.stepDatas[0].point!);\n                const matrixs = this.getBoxTransforms(vector, XYZ.zero, XYZ.zero);\n                this.updatePosition(matrixs);\n\n                return [\n                    this.meshPoint(this.stepDatas[0].point!),\n                    this.meshLine(this.stepDatas[0].point!, p),\n                    this.meshPoint(p),\n                ];\n            },\n        } satisfies PointSnapData;\n    };\n\n    private readonly pointOnAxisArray = (index: 2 | 3) => {\n        const { ray, yvec, normal, xvec } = this.boxPlaneInfo(index);\n\n        return {\n            ray,\n            validator: (p: XYZ) => {\n                return ray.location.distanceTo(p) > Precision.Distance;\n            },\n            preview: (p: XYZ | undefined) => {\n                if (!p) {\n                    return [this.meshPoint(this.stepDatas[0].point!)];\n                }\n\n                const matrixs = this.boxArrayMatrixs(index, xvec, yvec, normal, p);\n                this.updatePosition(matrixs);\n                return [\n                    this.meshLine(this.stepDatas[1].point!, p),\n                    this.meshPoint(p),\n                    this.meshPoint(this.stepDatas[1].point!),\n                ];\n            },\n        };\n    };\n\n    private boxArrayMatrixs(index: 2 | 3, xvec: XYZ, yvec: XYZ, normal: XYZ, end: XYZ) {\n        const x = xvec.multiply(this.stepDatas[1].point!.sub(this.stepDatas[0].point!).dot(xvec));\n        let y: XYZ, z: XYZ;\n        if (index === 2) {\n            y = yvec.multiply(end.sub(this.stepDatas[0].point!).dot(yvec));\n            z = XYZ.zero;\n        } else {\n            y = yvec.multiply(this.stepDatas[2].point!.sub(this.stepDatas[0].point!).dot(yvec));\n            z = normal.multiply(end.sub(this.stepDatas[0].point!).dot(normal));\n        }\n        return this.getBoxTransforms(x, y, z);\n    }\n\n    private boxPlaneInfo(index: number) {\n        const plane =\n            this.stepDatas[1].plane ??\n            this.findPlane(this.stepDatas[1].view, this.stepDatas[0].point!, this.stepDatas[1].point);\n\n        const xvec = this.stepDatas[1].point!.sub(this.stepDatas[0].point!).normalize()!;\n        let normal = plane.normal;\n        if (normal.isEqualTo(xvec)) {\n            normal = XYZ.unitZ;\n        } else if (normal.isEqualTo(xvec.reverse())) {\n            normal = XYZ.unitZ.reverse();\n        }\n        const yvec = normal.cross(xvec).normalize()!;\n\n        const ray =\n            index === 2\n                ? new Ray(this.stepDatas[1].point!, yvec)\n                : new Ray(this.stepDatas[1].point!, normal);\n        return { ray, yvec, normal, xvec };\n    }\n\n    protected override executeMainTask(): void {\n        const nodes: VisualNode[] = this.cloneNodes();\n\n        Transaction.execute(this.document, \"Array\", () => {\n            if (this.isGroup) {\n                const component = new Component(\"Array\", nodes);\n                this.document.components.push(component);\n                this.document.addNode(\n                    new ComponentNode(this.document, \"Array\", component.id, component.origin),\n                );\n            } else {\n                this.document.addNode(...nodes);\n            }\n            this.models?.forEach((model) => {\n                model.parent?.remove(model);\n            });\n        });\n    }\n\n    private cloneNodes() {\n        let matrixs: Matrix4[];\n        if (this.circularPattern) {\n            matrixs = this.getArcMatrixs(\n                this.stepDatas[0].point!,\n                this._planeAngle!.plane.normal,\n                MathUtils.degToRad(this._planeAngle!.angle),\n            );\n        } else {\n            const { xvec, yvec, normal } = this.boxPlaneInfo(3);\n            matrixs = this.boxArrayMatrixs(3, xvec, yvec, normal, this.stepDatas[3].point!);\n        }\n        const nodes: VisualNode[] = [];\n        for (const matrix of matrixs) {\n            this.models?.forEach((model) => {\n                const cloned = model.clone();\n                cloned.transform = cloned.transform.multiply(matrix);\n                nodes.push(cloned);\n            });\n        }\n        return nodes;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    EditableShapeNode,\n    IEdge,\n    ITrimmedCurve,\n    ShapeNode,\n    ShapeType,\n    Transaction,\n    XYZ,\n    command,\n} from \"chili-core\";\nimport { Dimension } from \"../../snap\";\nimport { IStep, PointOnCurveStep } from \"../../step\";\nimport { SelectShapeStep } from \"../../step/selectStep\";\nimport { MultistepCommand } from \"../multistepCommand\";\n\n@command({\n    key: \"modify.break\",\n    icon: \"icon-break\",\n})\nexport class Break extends MultistepCommand {\n    protected override executeMainTask() {\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\n            const shape = this.stepDatas[0].shapes[0].shape as IEdge;\n            const curve = shape.curve;\n            const point = this.stepDatas[0].shapes[0].owner.node\n                .worldTransform()\n                .invert()!\n                .ofPoint(this.stepDatas[1].point!);\n            const parameter = curve.parameter(point, 1e-3);\n            if (parameter === undefined) return;\n\n            const curve2 = curve.trim(parameter, curve.lastParameter());\n            curve.setTrim(curve.firstParameter(), parameter);\n            shape.update(curve);\n\n            const model = this.stepDatas[0].nodes![0] as ShapeNode;\n            const model1 = new EditableShapeNode(this.document, `${model.name}_1`, shape);\n            const model2 = new EditableShapeNode(this.document, `${model.name}_2`, curve2.makeEdge());\n            model1.transform = model.transform;\n            model2.transform = model.transform;\n            model.parent?.insertAfter(model, model1);\n            model.parent?.insertAfter(model1, model2);\n            model.parent?.remove(model);\n\n            this.document.visual.update();\n        });\n    }\n\n    protected override getSteps(): IStep[] {\n        return [\n            new SelectShapeStep(ShapeType.Shape, \"prompt.select.edges\", {\n                shapeFilter: { allow: (s) => s.shapeType === ShapeType.Edge },\n            }),\n            new PointOnCurveStep(\"prompt.pickFistPoint\", this.handlePointData, true),\n        ];\n    }\n\n    private readonly handlePointData = () => {\n        const edge = this.stepDatas[0].shapes[0].shape as IEdge;\n        const curve = edge.curve.transformed(\n            edge.matrix.multiply(this.stepDatas[0].shapes[0].transform),\n        ) as ITrimmedCurve;\n        this.disposeStack.add(curve);\n\n        return {\n            curve,\n            dimension: Dimension.D1,\n            preview: (point: XYZ | undefined) => {\n                if (!point) return [];\n                let project = curve.project(point).at(0);\n                return [this.meshPoint(project ?? point)];\n            },\n        };\n    };\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { command, GeometryNode, ISubFaceShape, Property, ShapeType, Transaction } from \"chili-core\";\nimport { IStep, SelectNodeStep, SelectShapeStep } from \"../../step\";\nimport { MultistepCommand } from \"../multistepCommand\";\n\n@command({\n    key: \"modify.brushAdd\",\n    icon: \"icon-addBrush\",\n})\nexport class AddBrushCommand extends MultistepCommand {\n    @Property.define(\"common.material\", { type: \"materialId\" })\n    get materialId(): string {\n        return this.getPrivateValue(\"materialId\", this.document.materials.at(0)?.id);\n    }\n    set materialId(value: string) {\n        this.setProperty(\"materialId\", value);\n    }\n\n    protected override getSteps(): IStep[] {\n        return [new SelectShapeStep(ShapeType.Face, \"prompt.select.faces\", { multiple: true })];\n    }\n    protected override executeMainTask(): void {\n        const nodeMatiralMape = new Map<GeometryNode, { faceIndex: number; materialId: string }[]>();\n\n        this.stepDatas[0].shapes.forEach((x) => {\n            if (x.owner.node instanceof GeometryNode) {\n                if (!nodeMatiralMape.has(x.owner.node)) {\n                    nodeMatiralMape.set(x.owner.node, []);\n                }\n                nodeMatiralMape.get(x.owner.node)!.push({\n                    faceIndex: (x.shape as ISubFaceShape).index,\n                    materialId: this.materialId,\n                });\n            }\n        });\n\n        Transaction.execute(this.document, \"add face material\", () => {\n            nodeMatiralMape.forEach((value, key) => {\n                key.addFaceMaterial(value);\n            });\n        });\n\n        this.document.visual.update();\n    }\n}\n\n@command({\n    key: \"modify.brushRemove\",\n    icon: \"icon-removeBrush\",\n})\nexport class RemoveBrushCommand extends MultistepCommand {\n    protected override getSteps(): IStep[] {\n        return [new SelectShapeStep(ShapeType.Face, \"prompt.select.faces\", { multiple: true })];\n    }\n\n    protected override executeMainTask(): void {\n        const nodeMatiralMape = new Map<GeometryNode, number[]>();\n\n        this.stepDatas[0].shapes.forEach((x) => {\n            if (x.owner.node instanceof GeometryNode) {\n                if (!nodeMatiralMape.has(x.owner.node)) {\n                    nodeMatiralMape.set(x.owner.node, []);\n                }\n                nodeMatiralMape.get(x.owner.node)!.push((x.shape as ISubFaceShape).index);\n            }\n        });\n\n        Transaction.execute(this.document, \"remove face material\", () => {\n            nodeMatiralMape.forEach((value, key) => {\n                key.removeFaceMaterial(value);\n            });\n        });\n\n        this.document.visual.update();\n    }\n}\n\n@command({\n    key: \"modify.brushClear\",\n    icon: \"icon-clearBrush\",\n})\nexport class ClearBrushCommand extends MultistepCommand {\n    protected override getSteps(): IStep[] {\n        return [new SelectNodeStep(\"prompt.select.shape\", { multiple: true, keepSelection: true })];\n    }\n\n    protected override executeMainTask(): void {\n        Transaction.execute(this.document, \"clear face material\", () => {\n            this.stepDatas[0].nodes?.forEach((x) => {\n                if (x instanceof GeometryNode) {\n                    x.clearFaceMaterial();\n                }\n            });\n        });\n\n        this.document.visual.update();\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    EditableShapeNode,\n    ISubEdgeShape,\n    Property,\n    ShapeNode,\n    ShapeType,\n    Transaction,\n    VisualState,\n    command,\n} from \"chili-core\";\nimport { SelectShapeStep } from \"../../step/selectStep\";\nimport { MultistepCommand } from \"../multistepCommand\";\n\n@command({\n    key: \"modify.chamfer\",\n    icon: \"icon-chamfer\",\n})\nexport class ChamferCommand extends MultistepCommand {\n    @Property.define(\"common.length\")\n    get length() {\n        return this.getPrivateValue(\"length\", 10);\n    }\n\n    set length(value: number) {\n        this.setProperty(\"length\", value);\n    }\n\n    protected override executeMainTask() {\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\n            const node = this.stepDatas[0].shapes[0].owner.node as ShapeNode;\n            const edges = this.stepDatas.at(-1)!.shapes.map((x) => (x.shape as ISubEdgeShape).index);\n            const filetShape = this.document.application.shapeFactory.chamfer(\n                node.shape.value,\n                edges,\n                this.length,\n            );\n\n            const model = new EditableShapeNode(this.document, node.name, filetShape, node.materialId);\n            model.transform = node.transform;\n\n            (node.parent ?? this.document.rootNode).add(model);\n            node.parent?.remove(node);\n            this.document.visual.update();\n        });\n    }\n\n    protected override getSteps() {\n        return [\n            new SelectShapeStep(ShapeType.Shape, \"prompt.select.shape\", {\n                shapeFilter: {\n                    allow: (shape) => {\n                        return (\n                            shape.shapeType === ShapeType.Solid ||\n                            shape.shapeType === ShapeType.Compound ||\n                            shape.shapeType === ShapeType.CompoundSolid\n                        );\n                    },\n                },\n                selectedState: VisualState.faceTransparent,\n            }),\n            new SelectShapeStep(ShapeType.Edge, \"prompt.select.edges\", {\n                multiple: true,\n                keepSelection: true,\n            }),\n        ];\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    ComponentNode,\n    EditableShapeNode,\n    GroupNode,\n    IShape,\n    MultiShapeNode,\n    ShapeNode,\n    ShapeType,\n    Transaction,\n    command,\n} from \"chili-core\";\nimport { IStep } from \"../../step\";\nimport { GetOrSelectNodeStep } from \"../../step/selectStep\";\nimport { MultistepCommand } from \"../multistepCommand\";\n\n@command({\n    key: \"modify.explode\",\n    icon: \"icon-explode\",\n})\nexport class Explode extends MultistepCommand {\n    protected override getSteps(): IStep[] {\n        return [new GetOrSelectNodeStep(\"prompt.select.shape\", { multiple: true })];\n    }\n\n    protected override executeMainTask() {\n        this.document.selection.clearSelection();\n\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\n            this.stepDatas[0].nodes?.forEach((x) => {\n                if (x instanceof ShapeNode) {\n                    this.explodeShapeNode(x);\n                } else if (x instanceof ComponentNode) {\n                    this.explodeComponentNode(x);\n                } else if (x instanceof MultiShapeNode) {\n                    this.explodeMultiShapeNode(x);\n                }\n            });\n        });\n\n        this.document.visual.update();\n    }\n\n    private explodeShapeNode(x: ShapeNode) {\n        let subShapes = x.shape.value.iterShape();\n        if (subShapes.length === 1) {\n            const subShapeNode = new EditableShapeNode(this.document, x.name, subShapes[0], x.materialId);\n            subShapeNode.transform = x.transform;\n            x.parent?.insertAfter(x.previousSibling, subShapeNode);\n        } else {\n            this.groupShapes(x, subShapes);\n        }\n\n        x.parent?.remove(x);\n    }\n\n    private groupShapes(node: ShapeNode, subShapes: IShape[]) {\n        const folder = new GroupNode(this.document, node.name);\n        folder.transform = node.transform;\n        node.parent?.insertAfter(node.previousSibling, folder);\n\n        let i = 1;\n        for (const subShape of subShapes) {\n            const name = `${ShapeType.stringValue(subShape.shapeType)} ${i++}`;\n            let subShapeNode = new EditableShapeNode(this.document, name, subShape);\n            folder.add(subShapeNode);\n        }\n    }\n\n    private explodeComponentNode(x: ComponentNode) {\n        for (const node of x.component.nodes) {\n            const newNode = node.clone();\n            newNode.transform = node.transform.multiply(x.transform);\n            x.parent?.insertAfter(x.previousSibling, newNode);\n        }\n\n        x.parent?.remove(x);\n    }\n\n    private explodeMultiShapeNode(x: MultiShapeNode) {\n        for (const shape of x.shapes) {\n            const node = new EditableShapeNode(this.document, x.name, shape.transformed(x.transform));\n            x.parent?.insertAfter(x.previousSibling, node);\n        }\n\n        x.parent?.remove(x);\n        x.shapes.forEach((x) => x.dispose());\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    EditableShapeNode,\n    ISubEdgeShape,\n    Property,\n    ShapeNode,\n    ShapeType,\n    Transaction,\n    VisualState,\n    command,\n} from \"chili-core\";\nimport { SelectShapeStep } from \"../../step/selectStep\";\nimport { MultistepCommand } from \"../multistepCommand\";\n\n@command({\n    key: \"modify.fillet\",\n    icon: \"icon-fillet\",\n})\nexport class FilletCommand extends MultistepCommand {\n    @Property.define(\"circle.radius\")\n    get radius() {\n        return this.getPrivateValue(\"radius\", 10);\n    }\n\n    set radius(value: number) {\n        this.setProperty(\"radius\", value);\n    }\n\n    protected override executeMainTask() {\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\n            const node = this.stepDatas[0].shapes[0].owner.node as ShapeNode;\n            const edges = this.stepDatas.at(-1)!.shapes.map((x) => (x.shape as ISubEdgeShape).index);\n            const filetShape = this.document.application.shapeFactory.fillet(\n                node.shape.value,\n                edges,\n                this.radius,\n            );\n\n            const model = new EditableShapeNode(this.document, node.name, filetShape, node.materialId);\n            model.transform = node.transform;\n            (node.parent ?? this.document.rootNode).add(model);\n            node.parent?.remove(node);\n            this.document.visual.update();\n        });\n    }\n\n    protected override getSteps() {\n        return [\n            new SelectShapeStep(ShapeType.Shape, \"prompt.select.shape\", {\n                shapeFilter: {\n                    allow: (shape) => {\n                        return (\n                            shape.shapeType === ShapeType.Solid ||\n                            shape.shapeType === ShapeType.Compound ||\n                            shape.shapeType === ShapeType.CompoundSolid\n                        );\n                    },\n                },\n                selectedState: VisualState.faceTransparent,\n            }),\n            new SelectShapeStep(ShapeType.Edge, \"prompt.select.edges\", {\n                multiple: true,\n                keepSelection: true,\n            }),\n        ];\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    AsyncController,\n    BoundingBox,\n    ComponentNode,\n    EdgeMeshData,\n    GeometryNode,\n    LineType,\n    Matrix4,\n    MeshNode,\n    Property,\n    PubSub,\n    Transaction,\n    VisualConfig,\n    VisualNode,\n    XYZ,\n} from \"chili-core\";\nimport { MultistepCommand } from \"../multistepCommand\";\n\nexport abstract class TransformedCommand extends MultistepCommand {\n    protected models?: VisualNode[];\n    protected positions?: number[];\n\n    @Property.define(\"common.clone\")\n    get isClone() {\n        return this.getPrivateValue(\"isClone\", false);\n    }\n    set isClone(value: boolean) {\n        this.setProperty(\"isClone\", value);\n    }\n\n    protected abstract transfrom(p2: XYZ): Matrix4;\n\n    protected transformPreview = (point: XYZ): EdgeMeshData => {\n        const transform = this.transfrom(point);\n        const positions = transform.ofPoints(this.positions!);\n        return {\n            position: new Float32Array(positions),\n            lineType: LineType.Solid,\n            color: VisualConfig.defaultEdgeColor,\n            range: [],\n        };\n    };\n\n    private async ensureSelectedModels() {\n        this.models = this.document.selection.getSelectedNodes().filter((x) => x instanceof VisualNode);\n        if (this.models.length > 0) return true;\n\n        this.controller = new AsyncController();\n        this.models = await this.document.selection.pickNode(\"prompt.select.models\", this.controller, true);\n\n        if (this.models.length > 0) return true;\n        if (this.controller.result?.status === \"success\") {\n            PubSub.default.pub(\"showToast\", \"toast.select.noSelected\");\n        }\n        return false;\n    }\n\n    protected override async canExcute(): Promise<boolean> {\n        if (!(await this.ensureSelectedModels())) return false;\n\n        this.positions = this.models!.flatMap((model) => {\n            if (model instanceof MeshNode) {\n                return model.mesh.position ? model.transform.ofPoints(model.mesh.position) : [];\n            } else if (model instanceof GeometryNode) {\n                return model.mesh.edges?.position ? model.transform.ofPoints(model.mesh.edges.position) : [];\n            } else if (model instanceof ComponentNode) {\n                return Array.from(BoundingBox.wireframe(model.boundingBox()!).position);\n            }\n            return [];\n        });\n        return true;\n    }\n\n    protected getTempLineData(start: XYZ, end: XYZ) {\n        return EdgeMeshData.from(start, end, VisualConfig.temporaryEdgeColor, LineType.Solid);\n    }\n\n    protected executeMainTask(): void {\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\n            const transform = this.transfrom(this.stepDatas.at(-1)!.point!);\n\n            if (this.isClone) {\n                this.models?.forEach((x) => {\n                    const clone = x.clone();\n                    clone.transform = x.transform.multiply(transform);\n                    x.parent?.insertAfter(x, clone);\n                });\n            } else {\n                this.models?.forEach((x) => {\n                    x.transform = x.transform.multiply(transform);\n                });\n            }\n\n            this.document.visual.update();\n        });\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Matrix4, Plane, ShapeMeshData, XYZ, command } from \"chili-core\";\nimport { Dimension, PointSnapData } from \"../../snap\";\nimport { IStep, PointStep } from \"../../step\";\nimport { TransformedCommand } from \"./transformedCommand\";\n\n@command({\n    key: \"modify.mirror\",\n    icon: \"icon-mirror\",\n})\nexport class Mirror extends TransformedCommand {\n    protected override transfrom(point: XYZ): Matrix4 {\n        const center = this.stepDatas[0].point!;\n        const xvec = this.stepDatas[0].view.workplane.normal;\n        const yvec = point.sub(center);\n        const normal = yvec.cross(xvec);\n        const plane = new Plane(center, normal, xvec);\n        return Matrix4.createMirrorWithPlane(plane);\n    }\n\n    getSteps(): IStep[] {\n        let firstStep = new PointStep(\"prompt.pickFistPoint\", undefined, true);\n        let secondStep = new PointStep(\"prompt.pickNextPoint\", this.getSecondPointData, true);\n        return [firstStep, secondStep];\n    }\n\n    private readonly getSecondPointData = (): PointSnapData => {\n        return {\n            refPoint: () => this.stepDatas[0].point!,\n            dimension: Dimension.D1D2,\n            preview: this.mirrorPreview,\n            validator: (p) => {\n                const vec = p.sub(this.stepDatas[0].point!);\n                return vec.length() > 1e-3 && !vec.isParallelTo(this.stepDatas[0].view.workplane.normal);\n            },\n        };\n    };\n\n    private readonly mirrorPreview = (point: XYZ | undefined): ShapeMeshData[] => {\n        const p1 = this.meshPoint(this.stepDatas[0].point!);\n        if (!point) return [p1];\n        const shape = this.transformPreview(point);\n        const offset = point.sub(this.stepDatas[0].point!).normalize()!.multiply(1e6);\n        const line = this.getTempLineData(this.stepDatas[0].point!.sub(offset), point.add(offset));\n        return [p1, shape, line];\n    };\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Matrix4, XYZ, command } from \"chili-core\";\nimport { Dimension, PointSnapData } from \"../../snap\";\nimport { IStep, PointStep } from \"../../step\";\nimport { TransformedCommand } from \"./transformedCommand\";\n\n@command({\n    key: \"modify.move\",\n    icon: \"icon-move\",\n})\nexport class Move extends TransformedCommand {\n    getSteps(): IStep[] {\n        return [\n            new PointStep(\"prompt.pickFistPoint\", undefined, true),\n            new PointStep(\"prompt.pickNextPoint\", this.getSecondPointData, true),\n        ];\n    }\n\n    private readonly getSecondPointData = (): PointSnapData => {\n        return {\n            refPoint: () => this.stepDatas[0].point!,\n            dimension: Dimension.D1D2D3,\n            preview: this.movePreview,\n        };\n    };\n\n    private readonly movePreview = (point: XYZ | undefined) => {\n        const p1 = this.meshPoint(this.stepDatas[0].point!);\n        if (!point) return [p1];\n        return [p1, this.transformPreview(point), this.getTempLineData(this.stepDatas[0].point!, point)];\n    };\n\n    protected override transfrom(point: XYZ): Matrix4 {\n        const { x, y, z } = point.sub(this.stepDatas[0].point!);\n        return Matrix4.fromTranslation(x, y, z);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    EditableShapeNode,\n    IFace,\n    ShapeNode,\n    ShapeType,\n    Transaction,\n    VisualState,\n    command,\n} from \"chili-core\";\nimport { SelectShapeStep } from \"../../step/selectStep\";\nimport { MultistepCommand } from \"../multistepCommand\";\n\n@command({\n    key: \"modify.removeFeature\",\n    icon: \"icon-removeFeature\",\n})\nexport class RemoveFaceCommand extends MultistepCommand {\n    protected override executeMainTask() {\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\n            const node = this.stepDatas[0].shapes[0].owner.node as ShapeNode;\n            const faces = this.stepDatas.at(-1)!.shapes.map((x) => x.shape as IFace);\n            const filetShape = this.document.application.shapeFactory.removeFeature(node.shape.value, faces);\n\n            const model = new EditableShapeNode(this.document, node.name, filetShape, node.materialId);\n            model.transform = node.transform;\n\n            this.document.addNode(model);\n            node.parent?.remove(node);\n            this.document.visual.update();\n        });\n    }\n\n    protected override getSteps() {\n        return [\n            new SelectShapeStep(ShapeType.Shape, \"prompt.select.shape\", {\n                shapeFilter: {\n                    allow: (shape) => {\n                        return (\n                            shape.shapeType === ShapeType.Solid ||\n                            shape.shapeType === ShapeType.Compound ||\n                            shape.shapeType === ShapeType.CompoundSolid\n                        );\n                    },\n                },\n                selectedState: VisualState.faceTransparent,\n            }),\n            new SelectShapeStep(ShapeType.Face, \"prompt.select.faces\", {\n                multiple: true,\n                keepSelection: true,\n            }),\n        ];\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { EditableShapeNode, ShapeNode, ShapeType, Transaction, VisualState, command } from \"chili-core\";\nimport { SelectShapeStep } from \"../../step/selectStep\";\nimport { MultistepCommand } from \"../multistepCommand\";\n\n@command({\n    key: \"modify.removeShapes\",\n    icon: \"icon-removeSubShape\",\n})\nexport class RemoveSubShapesCommand extends MultistepCommand {\n    protected override executeMainTask() {\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\n            const node = this.stepDatas[0].shapes[0].owner.node as ShapeNode;\n            const subShapes = this.stepDatas.at(-1)!.shapes.map((x) => x.shape);\n            const shape = this.document.application.shapeFactory.removeSubShape(node.shape.value, subShapes);\n\n            const model = new EditableShapeNode(this.document, node.name, shape, node.materialId);\n            model.transform = node.transform;\n\n            node.parent?.insertAfter(node.previousSibling, model);\n            node.parent?.remove(node);\n            this.document.visual.update();\n        });\n    }\n\n    protected override getSteps() {\n        return [\n            new SelectShapeStep(ShapeType.Shape, \"prompt.select.shape\", {\n                shapeFilter: {\n                    allow: (shape) => {\n                        return shape.shapeType !== ShapeType.Vertex && shape.shapeType !== ShapeType.Edge;\n                    },\n                },\n                selectedState: VisualState.faceTransparent,\n            }),\n            new SelectShapeStep(ShapeType.Edge | ShapeType.Face, \"prompt.select.shape\", {\n                multiple: true,\n                keepSelection: true,\n            }),\n        ];\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Matrix4, Precision, ShapeMeshData, XYZ, command } from \"chili-core\";\nimport { Dimension, PointSnapData, SnapLengthAtPlaneData } from \"../../snap\";\nimport { AngleStep, IStep, LengthAtPlaneStep, PointStep } from \"../../step\";\nimport { TransformedCommand } from \"./transformedCommand\";\n\n@command({\n    key: \"modify.rotate\",\n    icon: \"icon-rotate\",\n})\nexport class Rotate extends TransformedCommand {\n    protected override transfrom(point: XYZ): Matrix4 {\n        const normal = this.stepDatas[1].plane!.normal;\n        const center = this.stepDatas[0].point!;\n        const angle = this.getAngle(point);\n        return Matrix4.fromAxisRad(center, normal, angle);\n    }\n\n    getSteps(): IStep[] {\n        let firstStep = new PointStep(\"prompt.pickFistPoint\", undefined, true);\n        let secondStep = new LengthAtPlaneStep(\"prompt.pickNextPoint\", this.getSecondPointData, true);\n        let thirdStep = new AngleStep(\n            \"prompt.pickNextPoint\",\n            () => this.stepDatas[0].point!,\n            () => this.stepDatas[1].point!,\n            this.getThirdPointData,\n            true,\n        );\n        return [firstStep, secondStep, thirdStep];\n    }\n\n    private readonly getSecondPointData = (): SnapLengthAtPlaneData => {\n        const { point, view } = this.stepDatas[0];\n        return {\n            point: () => point!,\n            preview: this.circlePreview,\n            plane: (p: XYZ | undefined) => this.findPlane(view, point!, p),\n            validator: (p: XYZ) => {\n                if (p.distanceTo(point!) < Precision.Distance) return false;\n                return p.sub(point!).isParallelTo(this.stepDatas[0].view.workplane.normal) === false;\n            },\n        };\n    };\n\n    private readonly circlePreview = (end: XYZ | undefined) => {\n        const visualCenter = this.meshPoint(this.stepDatas[0].point!);\n        if (!end) return [visualCenter];\n        const { point, view } = this.stepDatas[0];\n        const plane = this.findPlane(view, point!, end);\n        return [\n            visualCenter,\n            this.meshLine(this.stepDatas[0].point!, end),\n            this.meshCreatedShape(\"circle\", plane.normal, point!, plane.projectDistance(point!, end)),\n        ];\n    };\n\n    private readonly getThirdPointData = (): PointSnapData => {\n        return {\n            dimension: Dimension.D1D2,\n            preview: this.anglePreview,\n            plane: () => this.stepDatas[1].plane!,\n            validator: (p) => {\n                return (\n                    p.distanceTo(this.stepDatas[0].point!) > 1e-3 &&\n                    p.distanceTo(this.stepDatas[1].point!) > 1e-3\n                );\n            },\n        };\n    };\n\n    private getAngle(point: XYZ) {\n        const normal = this.stepDatas[1].plane!.normal;\n        const center = this.stepDatas[0].point!;\n        const p1 = this.stepDatas[1].point!;\n        const v1 = p1.sub(center);\n        const v2 = point.sub(center);\n        return v1.angleOnPlaneTo(v2, normal)!;\n    }\n\n    private readonly anglePreview = (point: XYZ | undefined): ShapeMeshData[] => {\n        point = point ?? this.stepDatas[1].point!;\n        const result = [\n            this.transformPreview(point),\n            this.meshPoint(this.stepDatas[0].point!),\n            this.meshPoint(this.stepDatas[1].point!),\n            this.getRayData(this.stepDatas[1].point!),\n            this.getRayData(point),\n        ];\n\n        const angle = this.getAngle(point);\n        if (Math.abs(angle) > Precision.Angle) {\n            result.push(\n                this.meshCreatedShape(\n                    \"arc\",\n                    this.stepDatas[1].plane!.normal,\n                    this.stepDatas[0].point!,\n                    this.stepDatas[1].point!,\n                    (angle * 180) / Math.PI,\n                ),\n            );\n        }\n        return result;\n    };\n\n    private getRayData(end: XYZ) {\n        let center = this.stepDatas[0].point!;\n        let rayEnd = center.add(end.sub(center).normalize()!.multiply(1e6));\n        return this.getTempLineData(center, rayEnd);\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    EditableShapeNode,\n    IEdge,\n    IVisualObject,\n    ShapeType,\n    Transaction,\n    VisualState,\n    command,\n} from \"chili-core\";\nimport { IStep } from \"../../step\";\nimport { SelectShapeStep } from \"../../step/selectStep\";\nimport { MultistepCommand } from \"../multistepCommand\";\n\n@command({\n    key: \"modify.split\",\n    icon: \"icon-split\",\n})\nexport class Split extends MultistepCommand {\n    private splitedShape() {\n        const shape1 = this.stepDatas[0].shapes[0].shape;\n        const invertTransform = this.stepDatas[0].shapes[0].transform.invert()!;\n        const edges = this.stepDatas[1].shapes.map((x) =>\n            x.shape.transformedMul(x.transform.multiply(invertTransform)),\n        ) as IEdge[];\n        const result = shape1.split(edges);\n\n        edges.forEach((x) => x.dispose());\n\n        return result;\n    }\n\n    protected override executeMainTask() {\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\n            const old = this.stepDatas[0].nodes![0];\n            const shape = this.splitedShape();\n            let subShapes = shape.iterShape();\n            if (subShapes.length > 1) {\n                let i = 1;\n                old.parent?.add(\n                    ...subShapes.map((x) => {\n                        const model = new EditableShapeNode(this.document, old.name + i++, x);\n                        model.transform = old.transform;\n                        return model;\n                    }),\n                );\n            } else {\n                const model = new EditableShapeNode(this.document, old.name, shape);\n                model.transform = old.transform;\n                old.parent?.add(model);\n            }\n\n            this.removeModels(\n                this.stepDatas[0].shapes[0].owner,\n                ...this.stepDatas[1].shapes.map((x) => x.owner),\n            );\n            this.document.visual.update();\n        });\n    }\n\n    private removeModels(...shapes: IVisualObject[]) {\n        shapes.forEach((x) => {\n            const model = this.document.visual.context.getNode(x);\n            model?.parent?.remove(model);\n        });\n    }\n\n    protected override getSteps(): IStep[] {\n        return [\n            new SelectShapeStep(ShapeType.Shape, \"prompt.select.shape\", {\n                selectedState: VisualState.faceTransparent,\n            }),\n            new SelectShapeStep(ShapeType.Edge | ShapeType.Wire | ShapeType.Face, \"prompt.select.shape\", {\n                multiple: true,\n                keepSelection: true,\n            }),\n        ];\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    AsyncController,\n    BoundingBox,\n    CancelableCommand,\n    EditableShapeNode,\n    GeometryNode,\n    I18n,\n    ICurve,\n    IDisposable,\n    IDocument,\n    IEdge,\n    IShape,\n    IShapeFilter,\n    ITrimmedCurve,\n    IView,\n    IVisualGeometry,\n    ShapeNode,\n    ShapeType,\n    Transaction,\n    VisualConfig,\n    VisualShapeData,\n    command,\n} from \"chili-core\";\nimport { GeoUtils } from \"chili-geo\";\nimport { ShapeSelectionHandler } from \"chili-vis\";\n\n@command({\n    key: \"modify.trim\",\n    icon: \"icon-trim\",\n})\nexport class Trim extends CancelableCommand {\n    protected override async executeAsync() {\n        let transaction = new Transaction(this.document, I18n.translate(\"command.modify.trim\"));\n        transaction.start();\n        try {\n            await this.trimAsync();\n        } catch (e) {\n            transaction.rollback();\n            throw e;\n        }\n        transaction.commit();\n    }\n\n    private async trimAsync() {\n        this.document.visual.highlighter.clear();\n        this.document.selection.clearSelection();\n\n        while (!this.isCompleted) {\n            this.controller = new AsyncController();\n            let handler = new PickTrimEdgeEventHandler(this.document, this.controller);\n            await this.document.selection.pickAsync(\n                handler,\n                \"prompt.select.edges\",\n                this.controller,\n                false,\n                \"select.default\",\n            );\n            if (this.controller.result?.status !== \"success\" || !handler.selected) {\n                break;\n            }\n            this.trimEdge(handler.selected);\n            handler.dispose();\n        }\n    }\n\n    private trimEdge(selected: TrimEdge) {\n        let model = this.document.visual.context.getNode(selected.edge.owner);\n        let materialId = (model as GeometryNode)?.materialId;\n        selected.segments.retainSegments.forEach((segment) => {\n            let newEdge = selected.curve.trim(segment.start, segment.end).makeEdge();\n            model?.parent?.add(new EditableShapeNode(this.document, model.name, newEdge, materialId));\n        });\n        model?.parent?.remove(model);\n    }\n}\n\nexport class EdgeFilter implements IShapeFilter {\n    allow(shape: IShape): boolean {\n        return shape.shapeType === ShapeType.Edge;\n    }\n}\n\ninterface TrimEdge {\n    edge: VisualShapeData;\n    curve: ICurve;\n    segments: {\n        deleteSegment: {\n            start: number;\n            end: number;\n        };\n        retainSegments: {\n            start: number;\n            end: number;\n        }[];\n    };\n}\n\nexport class PickTrimEdgeEventHandler extends ShapeSelectionHandler {\n    #selected: TrimEdge | undefined;\n    private highlightedEdge: number | undefined;\n    private highlight: undefined | TrimEdge;\n    private readonly releaseStack = new Set<IDisposable>();\n\n    get selected() {\n        return this.#selected;\n    }\n\n    constructor(document: IDocument, controller: AsyncController) {\n        super(document, ShapeType.Shape, false, controller, new EdgeFilter());\n    }\n\n    protected override highlightDetecteds(view: IView, detecteds: VisualShapeData[]): void {\n        this.cleanHighlights();\n        if (detecteds.length !== 1 || detecteds[0].shape.shapeType !== ShapeType.Edge) return;\n\n        const box = BoundingBox.transformed(detecteds[0].owner.boundingBox()!, detecteds[0].transform);\n        const edges = this.filterByBoundingBox(box, view, detecteds[0].shape.id);\n        const edge = detecteds[0].shape.transformedMul(detecteds[0].transform) as IEdge;\n        this.releaseStack.add(edge);\n\n        let segments = findSegments(edge.curve, edge, edges, detecteds);\n        let mesh = edge.trim(segments.deleteSegment.start, segments.deleteSegment.end).mesh.edges!;\n        mesh.color = VisualConfig.highlightEdgeColor;\n        mesh.lineWidth = 3;\n        this.highlightedEdge = view.document.visual.highlighter.highlightMesh(mesh);\n        this.highlight = { edge: detecteds[0], segments, curve: edge.curve };\n        view.update();\n    }\n\n    protected override cleanHighlights(): void {\n        if (this.highlightedEdge !== undefined) {\n            this.document.visual.highlighter.removeHighlightMesh(this.highlightedEdge);\n            this.highlightedEdge = undefined;\n            this.highlight = undefined;\n            this.document.application.activeView?.update();\n        }\n    }\n\n    protected override clearSelected(document: IDocument): void {\n        this.#selected = undefined;\n    }\n\n    protected override select(view: IView, event: PointerEvent): number {\n        this.#selected = this.highlight;\n        return this.#selected ? 1 : 0;\n    }\n\n    private filterByBoundingBox(box: BoundingBox, view: IView, currentId: string) {\n        let boundingBox = BoundingBox.expand(box, 1e-3);\n        return view.document.visual.context\n            .boundingBoxIntersectFilter(boundingBox, new EdgeFilter())\n            .map((x) => {\n                const node = (x as IVisualGeometry)?.geometryNode;\n                const shape = (node as ShapeNode)?.shape?.value;\n                if (!shape || shape?.id === currentId) return undefined;\n                const edge = shape.transformedMul(node.worldTransform()) as IEdge;\n                this.releaseStack.add(edge);\n                return edge;\n            })\n            .filter((x) => x !== undefined);\n    }\n\n    override disposeInternal(): void {\n        super.disposeInternal();\n\n        this.releaseStack.forEach((x) => x.dispose());\n        this.releaseStack.clear();\n    }\n}\n\nfunction findSegments(curve: ITrimmedCurve, edge: IEdge, otherEdges: IEdge[], detecteds: VisualShapeData[]) {\n    let intersections = GeoUtils.intersects(edge, otherEdges).map((x) => x.parameter);\n    intersections.push(curve.firstParameter(), curve.lastParameter());\n    intersections = Array.from(new Set(intersections)).sort((a, b) => a - b);\n\n    if (intersections.length === 2) return allSegment(intersections);\n\n    let parameter = curve.parameter(detecteds[0].point!, 5)!;\n    for (let i = 1; i < intersections.length; i++) {\n        if (parameter < intersections[i]) {\n            if (i === 1) {\n                return startSegment(intersections);\n            } else if (i === intersections.length - 1) {\n                return lastSegment(intersections);\n            } else {\n                return centerSegment(intersections, i);\n            }\n        }\n    }\n\n    return allSegment(intersections);\n}\n\nfunction allSegment(intersections: number[]) {\n    return {\n        deleteSegment: {\n            start: intersections[0],\n            end: intersections.at(-1)!,\n        },\n        retainSegments: [],\n    };\n}\n\nfunction centerSegment(intersections: number[], i: number) {\n    return {\n        deleteSegment: {\n            start: intersections.at(i - 1)!,\n            end: intersections.at(i)!,\n        },\n        retainSegments: [\n            {\n                start: intersections[0],\n                end: intersections[i - 1],\n            },\n            {\n                start: intersections[i],\n                end: intersections.at(-1)!,\n            },\n        ],\n    };\n}\n\nfunction lastSegment(intersections: number[]) {\n    return {\n        deleteSegment: {\n            start: intersections.at(-2)!,\n            end: intersections.at(-1)!,\n        },\n        retainSegments: [\n            {\n                start: intersections[0],\n                end: intersections.at(-2)!,\n            },\n        ],\n    };\n}\n\nfunction startSegment(intersections: number[]) {\n    return {\n        deleteSegment: {\n            start: intersections[0],\n            end: intersections[1],\n        },\n        retainSegments: [\n            {\n                start: intersections[1],\n                end: intersections.at(-1)!,\n            },\n        ],\n    };\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { command, IApplication, ICommand } from \"chili-core\";\n\n@command({\n    key: \"edit.redo\",\n    icon: \"icon-redo\",\n})\nexport class Redo implements ICommand {\n    async execute(app: IApplication): Promise<void> {\n        const document = app.activeView?.document;\n        document?.history.redo();\n        document?.visual.update();\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { command, IApplication, ICommand } from \"chili-core\";\n\n@command({\n    key: \"edit.undo\",\n    icon: \"icon-undo\",\n})\nexport class Undo implements ICommand {\n    async execute(application: IApplication): Promise<void> {\n        const document = application.activeView?.document;\n        document?.history.undo();\n        document?.visual.update();\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { RadioGroup, div } from \"chili-controls\";\nimport {\n    AsyncController,\n    DialogResult,\n    I18n,\n    IApplication,\n    ICommand,\n    ICurve,\n    IEdge,\n    IFace,\n    Observable,\n    Plane,\n    Property,\n    PubSub,\n    SelectMode,\n    SelectableItems,\n    ShapeType,\n    XYZ,\n    command,\n} from \"chili-core\";\nimport { Dimension } from \"../snap\";\nimport { IStep, PointOnCurveStep, SelectShapeStep } from \"../step\";\nimport { MultistepCommand } from \"./multistepCommand\";\n\nexport class WorkingPlaneViewModel extends Observable {\n    @Property.define(\"dialog.title.selectWorkingPlane\")\n    planes: SelectableItems<string> = new SelectableItems([\"XOY\", \"YOZ\", \"ZOX\"], SelectMode.radio, [\"XOY\"]);\n}\n\n@command({\n    key: \"workingPlane.set\",\n    icon: \"icon-setWorkingPlane\",\n})\nexport class SetWorkplane implements ICommand {\n    async execute(application: IApplication): Promise<void> {\n        const view = application.activeView;\n        if (!view) return;\n\n        const vm = new WorkingPlaneViewModel();\n        PubSub.default.pub(\"showDialog\", \"dialog.title.selectWorkingPlane\", this.ui(vm), (result) => {\n            if (result === DialogResult.ok) {\n                const planes = [Plane.XY, Plane.YZ, Plane.ZX];\n                view.workplane = planes[vm.planes.selectedIndexes[0]];\n            }\n        });\n    }\n\n    private ui(vm: WorkingPlaneViewModel) {\n        return div(\n            ...Property.getProperties(vm).map((x) => {\n                const value = (vm as any)[x.name];\n                if (value instanceof SelectableItems) {\n                    return new RadioGroup(I18n.translate(x.display), value);\n                }\n                return \"\";\n            }),\n        );\n    }\n}\n\n@command({\n    key: \"workingPlane.alignToPlane\",\n    icon: \"icon-alignWorkingPlane\",\n})\nexport class AlignToPlane implements ICommand {\n    async execute(application: IApplication): Promise<void> {\n        const view = application.activeView;\n        if (!view) return;\n        view.document.selection.clearSelection();\n        const controller = new AsyncController();\n        const data = await new SelectShapeStep(ShapeType.Face, \"prompt.select.faces\").execute(\n            view.document,\n            controller,\n        );\n        controller.dispose();\n        if (!data || data.shapes.length === 0) return;\n        view.document.visual.highlighter.clear();\n        const face = data.shapes[0].shape.transformedMul(data.shapes[0].transform) as IFace;\n        const [point, normal] = face.normal(0, 0);\n        face.dispose();\n        let xvec = XYZ.unitX;\n        if (!normal.isParallelTo(XYZ.unitZ)) {\n            xvec = XYZ.unitZ.cross(normal).normalize()!;\n        }\n        view.workplane = new Plane(point, normal, xvec);\n    }\n}\n\n@command({\n    key: \"workingPlane.fromSection\",\n    icon: \"icon-fromSection\",\n})\nexport class FromSection extends MultistepCommand {\n    protected override executeMainTask() {\n        const curve = this.transformedCurve();\n        const point = this.stepDatas[1].point!;\n\n        const parameter = curve.parameter(point, 1e-3);\n        if (parameter === undefined) return;\n        const direction = curve.d1(parameter).vec.normalize()!;\n        let xvec: XYZ = this.findXVec(direction);\n        const plane = new Plane(point, direction, xvec);\n        const view = this.application.activeView;\n        if (!view) return;\n        view.workplane = plane;\n    }\n\n    private findXVec(direction: XYZ) {\n        let xvec: XYZ;\n        if (direction.isEqualTo(XYZ.unitZ)) {\n            xvec = XYZ.unitX;\n        } else if (direction.isEqualTo(new XYZ(0, 0, -1))) {\n            xvec = XYZ.unitY;\n        } else {\n            xvec = direction.cross(XYZ.unitZ).normalize()!;\n        }\n        return xvec;\n    }\n\n    protected override getSteps(): IStep[] {\n        return [\n            new SelectShapeStep(ShapeType.Edge, \"prompt.select.edges\"),\n            new PointOnCurveStep(\"prompt.pickFistPoint\", this.handlePointData, true),\n        ];\n    }\n\n    private transformedCurve() {\n        const shape = this.stepDatas[0].shapes[0].shape as IEdge;\n        const matrix = shape.matrix.multiply(this.stepDatas[0].shapes[0].transform);\n        const curve = shape.curve.transformed(matrix) as ICurve;\n        this.disposeStack.add(curve);\n        return curve;\n    }\n\n    private readonly handlePointData = () => {\n        const curve = this.transformedCurve();\n        return {\n            curve,\n            dimension: Dimension.D1,\n            preview: (point: XYZ | undefined) => {\n                if (!point) return [];\n                let project = curve.project(point).at(0);\n                return [this.meshPoint(project ?? point)];\n            },\n        };\n    };\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IDocument, INode, PubSub } from \"chili-core\";\nimport { NodeSelectionHandler } from \"chili-vis\";\n\nexport class EditEventHandler extends NodeSelectionHandler {\n    constructor(\n        document: IDocument,\n        readonly selectedNodes: INode[],\n    ) {\n        super(document, true);\n        PubSub.default.pub(\"showProperties\", document, selectedNodes);\n    }\n\n    override disposeInternal() {\n        PubSub.default.pub(\"showProperties\", this.document, []);\n        super.disposeInternal();\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Command, CommandKeys, IApplication, ICommand, IService, IView, Logger, PubSub } from \"chili-core\";\n\nexport class CommandService implements IService {\n    private _lastCommand: CommandKeys | undefined;\n    private _checking: boolean = false;\n    private _app: IApplication | undefined;\n\n    private get app(): IApplication {\n        if (this._app === undefined) {\n            throw new Error(\"Executor is not initialized\");\n        }\n        return this._app;\n    }\n\n    start(): void {\n        PubSub.default.sub(\"executeCommand\", this.executeCommand);\n        PubSub.default.sub(\"activeViewChanged\", this.onActiveViewChanged);\n        Logger.info(`${CommandService.name} started`);\n    }\n\n    stop(): void {\n        PubSub.default.remove(\"executeCommand\", this.executeCommand);\n        PubSub.default.remove(\"activeViewChanged\", this.onActiveViewChanged);\n        Logger.info(`${CommandService.name} stoped`);\n    }\n\n    register(app: IApplication) {\n        this._app = app;\n        Logger.info(`${CommandService.name} registed`);\n    }\n\n    private readonly onActiveViewChanged = async (view: IView | undefined) => {\n        if (this.app.executingCommand && ICommand.isCancelableCommand(this.app.executingCommand))\n            await this.app.executingCommand.cancel();\n    };\n\n    private readonly executeCommand = async (commandName: CommandKeys) => {\n        const command = commandName === \"special.last\" ? this._lastCommand : commandName;\n        if (!command || !(await this.canExecute(command))) return;\n        Logger.info(`executing command ${command}`);\n        await this.executeAsync(command);\n    };\n\n    private async executeAsync(commandName: CommandKeys) {\n        const commandCtor = Command.get(commandName)!;\n        if (!commandCtor) {\n            Logger.error(`Can not find ${commandName} command`);\n            return;\n        }\n\n        const command = new commandCtor();\n        this.app.executingCommand = command;\n        PubSub.default.pub(\"showProperties\", this.app.activeView?.document!, []);\n        try {\n            await command.execute(this.app);\n        } catch (err) {\n            PubSub.default.pub(\"displayError\", err as string);\n            Logger.error(err);\n        } finally {\n            this._lastCommand = commandName;\n            this.app.executingCommand = undefined;\n        }\n    }\n\n    private async canExecute(commandName: CommandKeys) {\n        if (this._checking) return false;\n        this._checking = true;\n        const result = await this.checking(commandName);\n        this._checking = false;\n        return result;\n    }\n\n    private async checking(commandName: CommandKeys) {\n        const commandData = Command.getData(commandName);\n        if (!commandData?.isApplicationCommand && this.app.activeView === undefined) {\n            Logger.error(\"No active document\");\n            return false;\n        }\n        if (!this.app.executingCommand) {\n            return true;\n        }\n        if (Command.getData(this.app.executingCommand)?.key === commandName) {\n            PubSub.default.pub(\"showToast\", \"toast.command.{0}excuting\", commandName);\n            return false;\n        }\n        if (ICommand.isCancelableCommand(this.app.executingCommand)) {\n            await this.app.executingCommand.cancel();\n            return true;\n        }\n        return false;\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { IApplication, IDocument, IEventHandler, INode, IService, Logger, PubSub } from \"chili-core\";\n\nexport class EditorService implements IService {\n    private editHandler?: IEventHandler;\n\n    constructor(readonly factory: (document: IDocument, selected: INode[]) => IEventHandler) {}\n\n    register(_app: IApplication): void {\n        Logger.info(`${EditorService.name} registed`);\n    }\n\n    start(): void {\n        PubSub.default.sub(\"selectionChanged\", this.handleSelectionChanged);\n        Logger.info(`${EditorService.name} started`);\n    }\n\n    stop(): void {\n        PubSub.default.remove(\"selectionChanged\", this.handleSelectionChanged);\n        Logger.info(`${EditorService.name} stopped`);\n    }\n\n    private readonly handleSelectionChanged = (document: IDocument, selected: INode[]) => {\n        this.editHandler?.dispose();\n        this.editHandler = undefined;\n\n        if (document.application.executingCommand) return;\n\n        if (selected.length > 0) {\n            this.editHandler = this.factory(document, selected);\n            document.visual.eventHandler = this.editHandler;\n        } else {\n            document.visual.resetEventHandler();\n        }\n    };\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { CommandKeys, IApplication, IService, Logger, PubSub } from \"chili-core\";\n\nexport interface Keys {\n    key: string;\n    ctrlKey?: boolean;\n    shiftKey?: boolean;\n    altKey?: boolean;\n}\n\nexport interface HotkeyMap {\n    [key: string]: CommandKeys;\n}\n\nconst DefaultKeyMap: HotkeyMap = {\n    Delete: \"modify.deleteNode\",\n    Backspace: \"modify.deleteNode\",\n    \" \": \"special.last\",\n    Enter: \"special.last\",\n    \"ctrl+z\": \"edit.undo\",\n    \"ctrl+y\": \"edit.redo\",\n};\n\nexport class HotkeyService implements IService {\n    private app?: IApplication;\n    private readonly _keyMap = new Map<string, CommandKeys>();\n\n    constructor() {\n        this.addMap(DefaultKeyMap);\n    }\n\n    register(app: IApplication): void {\n        this.app = app;\n        Logger.info(`${HotkeyService.name} registed`);\n    }\n\n    start(): void {\n        window.addEventListener(\"keydown\", this.eventHandlerKeyDown);\n        window.addEventListener(\"keydown\", this.commandKeyDown);\n        Logger.info(`${HotkeyService.name} started`);\n    }\n\n    stop(): void {\n        window.removeEventListener(\"keydown\", this.eventHandlerKeyDown);\n        window.removeEventListener(\"keydown\", this.commandKeyDown);\n        Logger.info(`${HotkeyService.name} stoped`);\n    }\n\n    private readonly eventHandlerKeyDown = (e: KeyboardEvent) => {\n        e.preventDefault();\n        let visual = this.app?.activeView?.document?.visual;\n        let view = this.app?.activeView;\n        if (view && visual) {\n            visual.eventHandler.keyDown(view, e);\n            visual.viewHandler.keyDown(view, e);\n            if (this.app!.executingCommand) e.stopImmediatePropagation();\n        }\n    };\n\n    private readonly commandKeyDown = (e: KeyboardEvent) => {\n        e.preventDefault();\n        let command = this.getCommand(e);\n        if (command !== undefined) {\n            PubSub.default.pub(\"executeCommand\", command);\n        }\n    };\n\n    getKey(keys: Keys): string {\n        let key = keys.key;\n        if (keys.ctrlKey) key = \"ctrl+\" + key;\n        if (keys.shiftKey) key = \"shift+\" + key;\n        if (keys.altKey) key = \"alt+\" + key;\n        return key;\n    }\n\n    map(command: CommandKeys, keys: Keys) {\n        let key = this.getKey(keys);\n        this._keyMap.set(key, command);\n    }\n\n    getCommand(keys: Keys): CommandKeys | undefined {\n        let key = this.getKey(keys);\n        return this._keyMap.get(key);\n    }\n\n    addMap(map: HotkeyMap) {\n        let keys = Object.keys(map);\n        keys.forEach((key) => {\n            this._keyMap.set(key, map[key]);\n        });\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport {\n    EditableShapeNode,\n    I18n,\n    IDataExchange,\n    IDocument,\n    INode,\n    IShape,\n    PubSub,\n    Result,\n    ShapeNode,\n    VisualNode,\n} from \"chili-core\";\n\nexport class DefaultDataExchange implements IDataExchange {\n    importFormats(): string[] {\n        return [\".step\", \".stp\", \".iges\", \".igs\", \".brep\", \".stl\"];\n    }\n\n    exportFormats(): string[] {\n        return [\".step\", \".iges\", \".brep\", \".stl\", \".stl binary\", \".ply\", \".ply binary\", \".obj\"];\n    }\n\n    async import(document: IDocument, files: FileList | File[]): Promise<void> {\n        for (const file of files) {\n            await this.handleSingleFileImport(document, file);\n        }\n    }\n\n    private async handleSingleFileImport(document: IDocument, file: File) {\n        let importResult: Result<INode> | undefined;\n\n        const fileName = file.name.toLocaleLowerCase();\n        if (this.extensionIs(fileName, \".brep\")) {\n            importResult = await this.importBrep(document, file);\n        } else if (this.extensionIs(fileName, \".stl\")) {\n            importResult = await this.importStl(document, file);\n        } else if (this.extensionIs(fileName, \".step\", \".stp\")) {\n            importResult = await this.importStep(document, file);\n        } else if (this.extensionIs(fileName, \".iges\", \".igs\")) {\n            importResult = await this.importIges(document, file);\n        }\n\n        this.handleImportResult(document, fileName, importResult);\n    }\n\n    private extensionIs(fileName: string, ...extensions: string[]): boolean {\n        return extensions.some((ext) => fileName.endsWith(ext));\n    }\n\n    private handleImportResult(document: IDocument, name: string, nodeResult: Result<INode> | undefined) {\n        if (!nodeResult?.isOk) {\n            alert(I18n.translate(\"error.import.unsupportedFileType:{0}\", name));\n            return;\n        }\n\n        const node = nodeResult.value;\n        node.name = name;\n        document.addNode(node);\n        document.visual.update();\n    }\n\n    async importBrep(document: IDocument, file: File) {\n        const shape = document.application.shapeFactory.converter.convertFromBrep(await file.text());\n        if (!shape.isOk) {\n            return Result.err(shape.error);\n        }\n        return Result.ok(new EditableShapeNode(document, file.name, shape.value));\n    }\n\n    private async importStl(document: IDocument, file: File) {\n        const content = new Uint8Array(await file.arrayBuffer());\n        return document.application.shapeFactory.converter.convertFromSTL(document, content);\n    }\n\n    private async importIges(document: IDocument, file: File) {\n        const content = new Uint8Array(await file.arrayBuffer());\n        return document.application.shapeFactory.converter.convertFromIGES(document, content);\n    }\n\n    private async importStep(document: IDocument, file: File) {\n        const content = new Uint8Array(await file.arrayBuffer());\n        return document.application.shapeFactory.converter.convertFromSTEP(document, content);\n    }\n\n    async export(type: string, nodes: VisualNode[]): Promise<BlobPart[] | undefined> {\n        if (nodes.length === 0) return undefined;\n\n        const document = nodes[0].document;\n        let shapeResult: Result<BlobPart> | undefined;\n        if (type === \".stl\") {\n            shapeResult = document.visual.meshExporter.exportToStl(nodes, true);\n        } else if (type === \".stl binary\") {\n            shapeResult = document.visual.meshExporter.exportToStl(nodes, false);\n        } else if (type === \".ply\") {\n            shapeResult = document.visual.meshExporter.exportToPly(nodes, true);\n        } else if (type === \".ply binary\") {\n            shapeResult = document.visual.meshExporter.exportToPly(nodes, false);\n        } else if (type === \".obj\") {\n            shapeResult = document.visual.meshExporter.exportToObj(nodes);\n        } else {\n            const shapes = this.getExportShapes(nodes);\n            if (!shapes.length) return undefined;\n            if (type === \".step\") shapeResult = this.exportStep(document, shapes);\n            if (type === \".iges\") shapeResult = this.exportIges(document, shapes);\n            if (type === \".brep\") shapeResult = this.exportBrep(document, shapes);\n        }\n\n        if (shapeResult) {\n            return this.handleExportResult(shapeResult);\n        }\n        return undefined;\n    }\n\n    private getExportShapes(nodes: VisualNode[]): IShape[] {\n        const shapes = nodes\n            .filter((x): x is ShapeNode => x instanceof ShapeNode)\n            .map((x) => x.shape.value.transformedMul(x.worldTransform()));\n\n        !shapes.length && PubSub.default.pub(\"showToast\", \"error.export.noNodeCanBeExported\");\n        return shapes;\n    }\n\n    private exportStep(doc: IDocument, shapes: IShape[]) {\n        return doc.application.shapeFactory.converter.convertToSTEP(...shapes);\n    }\n\n    private exportIges(doc: IDocument, shapes: IShape[]) {\n        return doc.application.shapeFactory.converter.convertToIGES(...shapes);\n    }\n\n    private exportBrep(document: IDocument, shapes: IShape[]) {\n        const comp = document.application.shapeFactory.combine(shapes);\n        if (!comp.isOk) {\n            return Result.err(comp.error);\n        }\n\n        const result = document.application.shapeFactory.converter.convertToBrep(comp.value);\n        comp.value.dispose();\n        return result;\n    }\n\n    private handleExportResult(result: Result<BlobPart> | undefined) {\n        if (!result?.isOk) {\n            PubSub.default.pub(\"showToast\", \"error.default:{0}\", result?.error);\n            return undefined;\n        }\n        return [result.value];\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { Application, CommandService, EditEventHandler, EditorService, HotkeyService } from \"chili\";\nimport {\n    I18n,\n    IApplication,\n    IDataExchange,\n    IDocument,\n    INode,\n    IService,\n    IShapeFactory,\n    IStorage,\n    IVisualFactory,\n    IWindow,\n    Logger,\n} from \"chili-core\";\nimport { IAdditionalModule } from \"./additionalModule\";\nimport { DefaultDataExchange } from \"./defaultDataExchange\";\n\nexport class AppBuilder {\n    protected readonly _inits: (() => Promise<void>)[] = [];\n    protected readonly _additionalModules: IAdditionalModule[] = [];\n    protected _storage?: IStorage;\n    protected _visualFactory?: IVisualFactory;\n    protected _shapeFactory?: IShapeFactory;\n    protected _window?: IWindow;\n\n    useIndexedDB() {\n        this._inits.push(async () => {\n            Logger.info(\"initializing IndexedDBStorage\");\n\n            let db = await import(\"chili-storage\");\n            this._storage = new db.IndexedDBStorage();\n        });\n        return this;\n    }\n\n    useWasmOcc() {\n        this._inits.push(async () => {\n            Logger.info(\"initializing wasm occ\");\n\n            let wasm = await import(\"chili-wasm\");\n            await wasm.initWasm();\n            this._shapeFactory = new wasm.ShapeFactory();\n        });\n        return this;\n    }\n\n    useThree(): this {\n        this._inits.push(async () => {\n            Logger.info(\"initializing three\");\n\n            let three = await import(\"chili-three\");\n            this._visualFactory = new three.ThreeVisulFactory();\n        });\n        return this;\n    }\n\n    useUI(): this {\n        this._inits.push(async () => {\n            Logger.info(\"initializing MainWindow\");\n\n            this.loadAdditionalI18n();\n\n            let ui = await import(\"chili-ui\");\n            this._window = new ui.MainWindow(await this.getRibbonTabs());\n        });\n        return this;\n    }\n\n    addAdditionalModules(...modules: IAdditionalModule[]): this {\n        this._additionalModules.push(...modules);\n        return this;\n    }\n\n    async getRibbonTabs() {\n        let defaultRibbon = await import(\"./ribbon\");\n        return defaultRibbon.DefaultRibbon;\n    }\n\n    async build(): Promise<IApplication> {\n        for (const init of this._inits) {\n            await init();\n        }\n        this.ensureNecessary();\n\n        let app = this.createApp();\n        this._window?.init(app);\n\n        this.loadAdditionalCommands();\n\n        Logger.info(\"Application build completed\");\n\n        return app;\n    }\n\n    createApp() {\n        return new Application({\n            storage: this._storage!,\n            shapeFactory: this._shapeFactory!,\n            visualFactory: this._visualFactory!,\n            services: this.getServices(),\n            mainWindow: this._window,\n            dataExchange: this.initDataExchange(),\n        });\n    }\n\n    initDataExchange(): IDataExchange {\n        return new DefaultDataExchange();\n    }\n\n    private ensureNecessary() {\n        if (this._shapeFactory === undefined) {\n            throw new Error(\"ShapeFactory not set\");\n        }\n        if (this._visualFactory === undefined) {\n            throw new Error(\"VisualFactory not set\");\n        }\n        if (this._storage === undefined) {\n            throw new Error(\"storage has not been initialized\");\n        }\n    }\n\n    private loadAdditionalI18n() {\n        for (const module of this._additionalModules) {\n            module.i18n().forEach((local) => {\n                I18n.combineTranslation(local.code, local.translation);\n            });\n        }\n    }\n\n    private loadAdditionalCommands() {\n        for (const module of this._additionalModules) {\n            if (this._window) {\n                module.ribbonCommands().forEach((command) => {\n                    this._window!.registerRibbonCommand(command.tabName, command.groupName, command.command);\n                });\n            }\n        }\n    }\n\n    protected getServices(): IService[] {\n        return [\n            new CommandService(),\n            new HotkeyService(),\n            new EditorService((document: IDocument, selected: INode[]) => {\n                return new EditEventHandler(document, selected);\n            }),\n        ];\n    }\n}\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nexport class Loading extends HTMLElement {\n    constructor() {\n        super();\n        this.initSpinner();\n        this.initLabel();\n        this.initAnimation();\n        this.style.cssText = `\n            position: fixed;\n            display: block;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            z-index: 9999;\n            background-color: rgba(0, 0, 0, 0.5);\n        `;\n    }\n\n    private initSpinner() {\n        let text = document.createElement(\"div\");\n        text.style.cssText = `\n            position: absolute;\n            top: 40%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            width: 50px;\n            height: 50px;\n            border-radius: 50%;\n            border: 5px solid var(--foreground-color);\n            border-top-color: var(--background-color);\n            animation: spin 1s infinite linear;\n        `;\n        this.appendChild(text);\n    }\n\n    private initAnimation() {\n        let styleSheet = document.createElement(\"style\");\n        styleSheet.innerHTML = `\n          @keyframes spin {\n            from { transform: rotate(0deg); }\n            to { transform: rotate(360deg); }\n          }\n        `;\n        document.head.appendChild(styleSheet);\n    }\n\n    private initLabel() {\n        let text = document.createElement(\"div\");\n        text.innerText = \"Loading...\";\n        text.style.cssText = `\n        color: var(--foreground-color);\n        font-size: 16px;\n        position: relative;\n        top: calc(40% + 100px);\n        left: calc(50% + 25px);\n        transform: translate(-50%, -50%);\n        width: 50px;\n        height: 50px;\n        `;\n        this.appendChild(text);\n    }\n}\n\ncustomElements.define(\"chili-loading\", Loading);\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\n// See LICENSE file in the project root for full license information.\n\nimport { AppBuilder } from \"chili-builder\";\nimport { Logger } from \"chili-core\";\nimport { Loading } from \"./loading\";\n\nlet loading = new Loading();\ndocument.body.appendChild(loading);\n\n// prettier-ignore\nnew AppBuilder()\n    .useIndexedDB()\n    .useWasmOcc()\n    .useThree()\n    .useUI()\n    .build()\n    .then(app => {\n        document.body.removeChild(loading);\n        // Auto-create a new document for Bitcoin 3D\n        app.newDocument(\"Bitcoin 3D Project\");\n    })\n    .catch((err) => {\n        Logger.error(err);\n    });\n"],"names":["UrlStringConverter","value","Result","createControl","tag","props","children","e","document","Node","setProperties","c","left","prop","key","Localize","PathBinding","div","span","input","button","label","select","option","a","h1","h2","ul","img","br","svg","ns","child","className","String","addTitle","setSVGIcon","newIcon","title","collection","options","Collection","HTMLElement","Map","args","CollectionAction","Error","item","items","Array","ObservableCollection","x","from","to","item1","item2","index","i","customElements","ColorConverter","isNaN","result","parseInt","Number","NumberConverter","n","StringConverter","XYConverter","vs","isFinite","XY","XYZConverter","XYZ","Expander","style","header","text","node","nodes","RadioGroup","context","target","Set","currentApplication","getCurrentApplication","setCurrentApplication","app","AsyncController","message","listeners","status","undefined","listener","registry","FinalizationRegistry","binding","source","path","converter","property","element","WeakRef","sourceProperty","converted","Binding","SelectMode","NodeAction","ClassMap","Serializer","MessageType","Precision","Command","ObjectSnapType","CurveType","Continuity","ICurve","GeometryType","LineType","ShapeMeshData","EdgeMeshData","Orientation","JoinType","ShapeType","SurfaceType","Navigation3D","Nav3DType","ButtonSize","DialogResult","ViewMode","VisualState","itemSet","callback","Symbol","predicate","fromIndex","SelectableItems","indexes","mode","selectedItems","History","record","removed","action","previousState","PropertyHistoryRecord","object","oldValue","newValue","NodeLinkedListHistoryRecord","records","ArrayRecord","name","r","Logger","optionalParams","console","Transaction","WeakMap","arrayRecord","trans","transactionName","isPropertyChanged","obj","Observable","pubKey","defaultValue","privateKey","onPropertyChanged","equals","cb","handler","HistoryObservable","classNameToClass","serializeTypeArray","TypeArray","buffer","save","ctor","getClass","cls","propertiesMap","reflectMap","Float32Array","Uint32Array","serialze","keys","register","ctorParamNames","deserialize","serialize","deserializeObject","data","instance","deserializeInstance","deserializeProperties","properties","parameters","deserilizeParameters","deserialValue","v","ignores","Object","serializeObject","classKey","serializeProperties","getAllKeysOfPrototypeChain","serializePropertyValue","type","map","prototype","k","isOk","error","predict","DeepObserver","parts","sourceHandler","prefix","subSource","handlerMap","deepHandler","sources","IDisposable","isDisposable","Deletable","isDeletable","gc","resources","resource","Id","size","id","alphabet","Math","ObjectStorage","organization","application","storageKey","stringValue","JSON","localStorage","PubSub","callbacks","event","debounce","fun","ms","timeout","clearTimeout","window","download","blob","Blob","url","URL","isIOS","navigator","readFilesAsync","accept","multiple","Promise","resolve","cleanup","readFileAsync","method","filesResult","readInputedFiles","files","fileDataPromises","file","readFileDataAsync","reader","FileReader","PropertyKeyMap","Property","until","getProperty","define","display","getProperties","getOwnProperties","ICommand","isCancelableCommand","command","CancelableCommand","setTimeout","commandRegistry","metadata","constructor","getData","get","I18nId","I18nArgs","I18n","_currentLanguage","currentLanguage","Config","combineTranslation","language","translations","local","translate","_","isI18nKey","changeLanguage","newLanguage","html","en","zh","ptBr","defaultLanguageIndex","set","dom","has","snapTypes","targetType","add","remove","VisualItemConfig","theme","VisualConfig","CONFIG_STORAGE_KEY","snapType","themeMode","json","Constants","DOCUMENT_FILE_EXTENSION","isConic","curve","isCircle","circle","isLine","isTrimmed","MeshGroup","start","count","materialIndex","Mesh","positionSize","indexSize","mesh","concatTypedArrays","arrays","totalLength","acc","arr","offset","isVertex","isEdge","isFace","VertexMeshData","point","color","end","lineType","merge","other","otherRange","range","FaceMeshData","groups","group","MeshDataBuilder","g","b","EdgeMeshDataBuilder","shape","y","z","isWhole","hasCompound","hasCompoundSolid","hasSolid","hasShell","hasFace","hasWire","hasEdge","hasVertex","MathUtils","degrees","radians","values","tolerance","min","max","seg1Start","seg1End","seg2Start","seg2End","seg1Dir","seg2Dir","seg1ToSeg2Vec","seg1DirSqLen","seg1Seg2Dot","seg2DirSqLen","seg1DirToSeg1StartDot","sNumerator","sDenominator","tNumerator","tDenominator","computeSTParameters","adjustSTParameters","sParam","tParam","vecOnSeg1","vecOnSeg2","closestPointDiff","determinant","seg2DirToSeg1StartDot","adjustedValue","right","scalar","d","dx","dy","dz","p1","p2","cross","dot","normal","angle","vec","cos","BoundingBox","box","matrix","box1","box2","points","Infinity","Quaternion","w","axis","rad","sin","vec3","q","x2","y2","z2","xx","xy","xz","yy","yz","zz","wx","wy","wz","w1","x1","y1","z1","w2","qw","qx","qy","qz","sqw","sqx","sqy","sqz","unit","test","sig","xx2","xy2","xz2","yy2","yz2","zz2","sy2","sz2","sx2","Matrix4","roll","pitch","yaw","halfRoll","halfPitch","halfYaw","cr","sr","cp","sp","cy","sy","a00","a01","a02","a03","a10","a11","a12","a13","a20","a21","a22","a23","a30","a31","a32","a33","b0","b1","b2","b3","b4","b5","b00","b01","b02","b03","b04","b05","b06","b07","b08","b09","b10","b11","det","array","j","cx","sx","cz","sz","position","axes","plane","temp","temp2","temp3","vector","vectors","m","m11","m12","m13","m22","m23","m32","m33","rotation","scale","quaternion","te","Plane","origin","xvec","location","ray","containsExtension","len","t","dp1","dp2","PlaneAngle","vectorToPoint","projectionX","projectionY","angleInDegrees","angleInRadians","isMovingUpward","isMovingDownward","isCrossingX","Ray","direction","neareast1","neareast2","Texture","Material","material","PhongMaterial","PhysicalMaterial","INode","isLinkedListNode","serialized","getNodesFromPath","path1","path2","commonIndex","nodeOrChildrenAppendToNodes","path1ToCommonNodes","commonToPath2Nodes","next","nextParent","getNodesFromParentToChild","containsDescendant","parent","currentAtBack","preNode","curNode","getCommonParentIndex","prePath","curPath","getPathToRoot","getNodesBetween","node1","node2","findTopLevelNodes","NodeSerializer","serializeNodeToArray","parentId","nodeMap","VisualNode","visual","MeshNode","materialId","FaceMaterialPair","faceIndex","GeometryNode","oldMaterisl","Face","oldMaterial","oldFacePair","pairs","faceIndexs","toDelete","pair","MeshUtils","newMaterisl","ShapeNode","SHAPE_UNDEFINED","oldShape","MultiShapeMesh","totleMatrix","MultiShapeNode","shapes","meshes","ParameterShapeNode","EditableShapeNode","createComponentMesh","createComponentSize","Component","faceMaterialPair","ComponentNode","transform","totleTransform","materialIndexMap","materialONMap","materialIds","materials","componentId","insert","FacebaseNode","FolderNode","nullifyParent","prev","newParent","previousSibling","cache","GroupNode","getKey","navigationKeyMap","functionKey","ShapeNodeFilter","shapeFilter","Combobox","Act","view","cameraPosition","cameraTarget","cameraUp","IView","screenDistance","mx","my","IVisualObject","isGeometry","addState","removeState","hasState","testState","materialMap","arr1","arr2","grouped","groupStart","worldTransform","oldIndex","indices","indiceStart","indiceEnd","face","pointsMap","entry","GeoUtils","wire","nearest","minDistance","edge","tempPoint","edges","curve1","curve2","p3","p4","v1","v2","testNormal","testCurve","otherEdges","intersect","SelectionRectStyle","SelectionHandler","document1","multiMode","controller","s","rect","NodeSelectionHandler","filter","models","detected","detecteds","ShapeSelectionHandler","shapeType","shapefilter","nodeFilter","SubshapeSelectionHandler","ViewUtils","planes","distances","p","Dimension","Selection","prompt","selectedState","highlightState","showControl","cursor","oldHandler","reject","toggle","publish","selected","unSelected","Document","__DOCUMENT_VERSION__","image","Date","views","alert","rootNode","observer","importFiles","Application","ev","opens","imports","lightGray","deepGray","BoxNode","CircleNode","center","radius","ConeNode","CylinderNode","EllipseNode","majorRadius","minorRadius","LineNode","pnt","PolygonNode","PrismNode","length","PyramidNode","RectNode","RevolvedNode","profile","SphereNode","SweepedNode","round","NewDocument","OpenDocument","PerformanceTestCommand","performance","distance","OccPerformanceTestCommand","SaveDocument","SaveDocumentToFile","ToggleDynamicWorkplaneCommand","WeChatGroup","BooleanNode","contains","d1","d2","mapping","AxisSnap","dist","lineDats","BaseSnap","referencePoint","ids","meshId","highlighter","FeaturePointStrategy","_snapType","infos","addPoint","info","ObjectSnap","snaped","snap","featurePoints","ordered","basisCurve","temporary","current","s1","s2","e1","e2","intersections","PlaneSnapBase","refPoint","WorkplaneSnap","PlaneSnap","PointOnCurveSnap","pointData","Axis","containsZ","createAxis","axies","TrackingBase","trackingZ","AxisTracking","testAngle","ObjectTracking","currentTrackings","existingTracking","snaps","pointId","TrackingSnap","trackingAxisZ","trackingDatas","lines","newEnd","objectTrackingRays","snapedName","dir","SnapEventHandler","minDist","featurePoint","msg","AngleSnapEventHandler","snapPointData","objectSnap","SnapLengthAtAxisHandler","lengthData","inputValue","SnapLengthAtPlaneHandler","numbers","coords","PointSnapEventHandler","workplaneSnap","dims","isAbsolute","dimension","SnapPointOnCurveEventHandler","parameter","SnapPointOnAxisEventHandler","SnapStep","tip","handleStepData","keepSelected","executorHandler","oldValidator","defaultSnapedData","AngleStep","handleCenter","handleP1","handleP2Data","LengthAtAxisStep","LengthAtPlaneStep","pointAtPlane","PointStep","handleData","PointOnCurveStep","PointOnAxisStep","SelectStep","snapeType","SelectShapeStep","SelectNodeStep","GetOrSelectNodeStep","MultistepCommand","steps","lineWith","disposeShape","edgeMesh","step","shouldDispose","BooleanOperate","shape1","shape2","booleanType","booleanShape","tools","BooleanCommon","BooleanCut","BooleanFuse","ArcNode","CreateCommand","CreateFaceableCommand","Arc","p0","visualCenter","BezierCommand","bezier","firstStep","ps","res","RectData","atPlane","RectCommandBase","tmp","Rect","Box","h","Circle","body","Cone","p1Visual","up","height","FaceNode","wires","WireNode","ConvertCommand","ConvertToWire","wireBody","ConvertToFace","ConvertToShell","faces","shell","ConvertToSolid","solid","CopySubShapeCommand","subShape","model","CurveProjectionCommand","nums","curveProjection","Cylinder","Ellipse","Fuse","GroupDefinition","GroupCommand","definition","component","dialog","PickInsertPointCommand","HTMLDialogElement","defination","pickPointStep","Line","OffsetCommand","ax","nextEdge","nextDirection","Polygon","Prism","Pyramid","Revolve","LineFilter","Section","section","Sphere","Sweep","ThickSolidCommand","ActAlignCameraCommand","Delete","NewFolder","folder","Import","extenstions","Export","format","suffix","AngleMeasure","line2","arc","arcMid","visualId","LengthMeasure","firstPoint","secondPoint","SelectMeasure","li","area","volume","ArrayCommand","positions","matrixs","yvec","zvec","transforms","cloned","Break","model1","model2","project","AddBrushCommand","nodeMatiralMape","RemoveBrushCommand","ClearBrushCommand","ChamferCommand","filetShape","Explode","subShapes","subShapeNode","newNode","FilletCommand","TransformedCommand","clone","Mirror","Move","RemoveFaceCommand","RemoveSubShapesCommand","Rotate","rayEnd","Split","invertTransform","old","Trim","transaction","PickTrimEdgeEventHandler","segment","newEdge","EdgeFilter","segments","findSegments","currentId","boundingBox","allSegment","startSegment","lastSegment","centerSegment","Redo","Undo","WorkingPlaneViewModel","SetWorkplane","vm","AlignToPlane","FromSection","EditEventHandler","selectedNodes","CommandService","commandName","commandCtor","err","commandData","EditorService","factory","_app","DefaultKeyMap","HotkeyService","DefaultDataExchange","importResult","fileName","extensions","ext","nodeResult","content","Uint8Array","shapeResult","doc","comp","AppBuilder","db","wasm","three","ui","modules","defaultRibbon","init","module","Loading","styleSheet","loading"],"mappings":"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"}